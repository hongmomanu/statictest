(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{112:function(e,t,n){"use strict";t.__esModule=!0,t.init=function(e){var t=e.channel,n=e.kind,o=e.ZmAvsSDK,r=e.classType,a=new((0,i.makeChannelInstance)(t,n))(e);return a.init(o,r),a},t.makeUidFromMobile=function(e){return(0,o.makeUid)(e)};var i=n(252),o=n(21)},113:function(e,t,n){"use strict";t.__esModule=!0,t.MacAgora=void 0;var i=n(32),o=n(36),r=n(20),a=n(21);t.MacAgora=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="mac agora",i.loggerColor="lawngreen",i.isSupportBeauty=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._initModule_=function(){var e=(0,o.getCurrentWin)().getNativeWindowHandle();(0,o.macSendWinHandle)(e),(0,o.macInitModule)(this.channel)},t.prototype._remoteJoin_=function(e){var t=e.data;this._updateUids_(t),this._moveFunc_()},t.prototype.init=function(){e.prototype.init.call(this)},t.prototype._moveById_=function(e){e=""+e;var t=(0,o.getCurrentWin)().getContentBounds(),n=[t.width,t.height],i=this.document.getElementById(e);if(i){var r=i.getBoundingClientRect(),a=r.left,s=r.top,c=r.height,d=r.width,u=parseInt(a),l=parseInt(n[1]-s-c),p=parseInt(d),f=parseInt(c);this.logger("macwin move "+u+","+l+", "+p+", "+f+", "+e),(0,o.macNativeMethod)(["changeWinViewById",e,"x",u,"y",l,"w",p,"h",f])}},t.prototype.joinRoom=function(){var e=(0,a.getRoleType)(this.role,this.isWatcher);(0,o.macNativeMethod)(["initModule","getNativeWin-classroomwin","appid",r.APP_ID,"roomid",this.roomId,"uid",this.uid,"watcherflag",e]),(0,o.macNativeMethod)(["joinRoom",this.roomId,"uid",this.uid]),(0,o.macNativeMethod)(["changeWinViewById",this.uid,"x",0,"y",0,"w",0,"h",0])},t.prototype.leaveRoom=function(){(0,o.macNativeMethod)(["LeaveRoom"])},t.prototype.playById=function(e){},t.prototype.disableVideo=function(e){var t=e.id,n=e.flag;""+t==""+this.uid?(0,o.macNativeMethod)(["muteVideo",n]):(0,o.macNativeMethod)(["muteVideoById",t,"flag",n])},t.prototype.disableAudio=function(e){var t=e.id,n=e.flag;""+t==""+this.uid?(0,o.macNativeMethod)(["muteVoice",n]):(0,o.macNativeMethod)(["muteVoiceById",t,"flag",n])},t.prototype.hideVideoById=function(e){e=""+e,(0,o.macNativeMethod)(["changeWinViewById",e,"x",0,"y",0,"w",0,"h",0]),this._updateHidderUids_(e,"add")},t.prototype.showVideoById=function(t){e.prototype.showVideoById.call(this,t)},t}(i.WinAgora)},114:function(e,t,n){"use strict";t.__esModule=!0,t.ElectronAgora=void 0;var i=n(31),o=n(21),r=n(20);t.ElectronAgora=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="electron agora",i.loggerColor="darkyellow",i.isSupportBeauty=!1,i._getSupportBeaty_=i._getSupportBeaty_.bind(i),i._initModule_=i._initModule_.bind(i),i._isFirstLocalFrameInited_=!1,i.getChanelType=i.getChanelType.bind(i),i.avsEngine=null,i.ZmAvsSDK=null,i.APP_ID=r.APP_ID,i.appSign="",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getChanelType=function(){switch(this.channel){case r.VIDEO_CHANEL_AGORA:return this.ZmAvsSDK.ChannelType.CHANNEL_AGORA;case r.VIDEO_CHANEL_ZEGO:return this.ZmAvsSDK.ChannelType.CHANNEL_ZEGO;default:return this.ZmAvsSDK.ChannelType.CHANNEL_AGORA}},t.prototype._initModule_=function(){var e=this,t=this.getChanelType();console.log("channelType",t),this.avsEngine.initialize(this.APP_ID,this.appSign,t);var n=this.ZmAvsSDK.OrientationMode.ORIENTATION_MODE_FIXED_LANDSCAPE;this.avsEngine.setVideoEncoderConfiguration(320,240,15,0,-1,n),this.avsEngine.on(this.ZmAvsSDK.RtcEvent.RTC_EVENT_FIRST_LOCAL_VIDEO_FRAME,(function(t,n,i){console.log(e.ZmAvsSDK.RtcEvent.RTC_EVENT_FIRST_LOCAL_VIDEO_FRAME,t,n,i),e._isFirstLocalFrameInited_=!0,e.rtcCb({name:"onFirstLocalVideoFrame",data:Object.assign({},{},{code:e._code_enum_.MESSAGE_CODE_STREAM})})})),this.avsEngine.on(this.ZmAvsSDK.RtcEvent.RTC_EVENT_FIRST_REMOTE_VIDEO_DECODEED,(function(t,n,i,o){console.log(e.ZmAvsSDK.RtcEvent.RTC_EVENT_FIRST_REMOTE_VIDEO_DECODEED,t,n,i,o),e.rtcCb({name:"stream-added",data:Object.assign({},{uid:t},{code:e._code_enum_.MESSAGE_CODE_STREAM})})})),this.avsEngine.on(this.ZmAvsSDK.RtcEvent.RTC_EVENT_USER_OFFLINE,(function(t,n){var i=document.getElementById(""+t);e.avsEngine.destroyRenderView(t,i),e.rtcCb({name:"stream-removed",data:Object.assign({},{uid:t},{code:e._code_enum_.MESSAGE_CODE_STREAM})})}))},t.prototype.init=function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.avsEngine=new e,this.ZmAvsSDK=e,this._client_||(this.rtcCb({name:"inited",data:{code:this._code_enum_.MESSAGE_CODE_INIT}}),this._initModule_(),this.joinRoom(n),this._client_={},setTimeout((function(){t._isFirstLocalFrameInited_||t.isWatcher||t.rtcCb({name:"error",data:{msg:"本地加载视频第一帧失败",name:"onFirstLocalVideoFrame",code:t._code_enum_.MESSAGE_CODE_STREAM}})}),1e4))},t.prototype.joinRoom=function(e){var t=(0,o.getRoleType)(this.role,this.isWatcher),n=this.roomId,i=this.uid;this.avsEngine.joinChannel(e,n,"",t,i)},t.prototype.leaveRoom=function(){this.avsEngine.leaveChannel()},t.prototype.playById=function(e){var t=this;(0,o.waitFor)((function(){return document.getElementById(""+e)})).then((function(){var n=document.getElementById(""+e),i=t.uid===e?"local":e;t.uid!==e&&t.avsEngine.subscribe(i),t.avsEngine.initRender(i,n),t.avsEngine.setupViewContentMode(i,1),t.logger("playById "+e)}))},t.prototype.disableVideo=function(e){var t=e.id,n=e.flag;t===this.uid?this.avsEngine.muteLocalVideo(n):this.avsEngine.muteRemoteVideo(t,n)},t.prototype.disableAudio=function(e){var t=e.id,n=e.flag;t===this.uid?this.avsEngine.muteLocalAudio(n):this.avsEngine.muteRemoteAudio(t,n)},t.prototype.setFaceValue=function(e){},t.prototype._getSupportBeaty_=function(){try{return!1}catch(e){return!1}},t}(i.RtcKit)},20:function(e,t,n){"use strict";t.__esModule=!0;t.VIDEO_CHANEL_AGORA="agora",t.VIDEO_CHANEL_TALKCLOUD="talkcloud",t.VIDEO_CHANEL_ZMRTC="zmrtc",t.VIDEO_CHANEL_TENCENT1="tencent1",t.VIDEO_CHANEL_TENCENT2="tencent2",t.VIDEO_CHANEL_ZEGO="zego",t.APP_ID="0368433925644e9b83eeff9fff26b61e",t.TENCENT_APP_ID="1400029101",t.TENCENT_APP_TYPE="12108",t.MESSAGE_CODE_INIT=101,t.MESSAGE_CODE_ROOM=202,t.MESSAGE_CODE_STREAM=303,t.MESSAGE_CODE_UNKONOWN=404},21:function(e,t,n){"use strict";t.__esModule=!0,t.waitFor=function(e){return new Promise((function t(n){e()?n():setTimeout((function(e){return t(n)}),200)}))},t.showErrorMsg=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e.reason||e.info||e.msg||""},t.getRoleType=function(e,t){if(t)return 1;switch(e){case"teacher":return 0;case"student":return 2;case"seller":return 0;case"watcher":return 1;default:return 4}},t.getChanelType=function(e){switch(e){case i.VIDEO_CHANEL_ZMRTC:return 4;case i.VIDEO_CHANEL_AGORA:return 1;case i.VIDEO_CHANEL_TENCENT1:return 2;case i.VIDEO_CHANEL_TALKCLOUD:return 5;case i.VIDEO_CHANEL_ZEGO:return 6;case i.VIDEO_CHANEL_TENCENT2:return 7;default:return 0}},t.makeUid=function(e){if(!e)return"";var t=e%1e9;t<1e8&&(t+=1e8);return t};var i=n(20)},252:function(e,t,n){"use strict";t.__esModule=!0,t.makeChannelInstance=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"oldpc",n=(0,u.hasMethod)("LeaveRoom");if(console.log("kind",t),"oldpc"===t)switch(e){case i.VIDEO_CHANEL_AGORA:return(0,u.isWeb)()?o.WebAgora:(0,u.isWin)()&&!(0,u.isXp)()&&n?a.WinAgora:(0,u.isMac)()?f.MacAgora:o.WebAgora;case i.VIDEO_CHANEL_ZEGO:return s.WinZego;case i.VIDEO_CHANEL_TENCENT2:return l.WinTencentTwo;case i.VIDEO_CHANEL_TENCENT1:return(0,u.isWin)()?c.WinTencentOne:(0,u.isMac)()?d.MacTencentOne:c.WinTencentOne;case i.VIDEO_CHANEL_ZMRTC:return(0,u.isWeb)()?r.WebZmRtc:(0,u.isMac)()?r.WebZmRtc:(0,u.isXp)()?r.WebZmRtc:(0,u.isWin)()&&n?p.WinZmRtc:r.WebZmRtc;default:return o.WebAgora}else if("newpc"===t)switch(e){case i.VIDEO_CHANEL_AGORA:return m.ElectronAgora;case i.VIDEO_CHANEL_ZEGO:return g.ElectronZego;default:return m.ElectronAgora}else if("mobile"===t)switch(e){case i.VIDEO_CHANEL_AGORA:default:return v.MobileAgora}};var i=n(20),o=n(253),r=n(255),a=n(32),s=n(259),c=n(260),d=n(261),u=n(36),l=n(262),p=n(263),f=n(113),m=n(114),g=n(264),v=n(265)},253:function(e,t,n){"use strict";t.__esModule=!0,t.WebAgora=void 0;var i=n(31),o=n(21),r=n(20);var a=n(254),s=null,c={};t.WebAgora=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="web agora",i.loggerColor="green",i.timeId=null,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init=function(){var e=this;if(a.checkSystemRequirements())if(s)this.rtcCb({name:"error",data:{msg:"请不要重复实例化",code:this._code_enum_.MESSAGE_CODE_INIT}});else{var t=localStorage.getItem("ss.media.video_source_id"),n=localStorage.getItem("ss.media.audio_source_id");a.getDevices((function(i){if(i){e.logger("getDevices",i);for(var d=0;d<i.length;d++)i[d].deviceId===t&&(e.cameraId=t),i[d].deviceId===n&&(e.microphoneId=n)}e.logger("cameraId,microphoneId:",e.cameraId,e.microphoneId),(s=a.createClient({mode:"live",codec:"vp8"})).on("stream-published",(function(t){e.logger("本地推流成功"),e.rtcCb({name:"stream-published",data:{code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("error",(function(t){e.logger("Got error msg:",t.reason),e.rtcCb({name:"error",data:{msg:(0,o.showErrorMsg)(t),code:e._code_enum_.MESSAGE_CODE_UNKONOWN}})})),s.on("stream-added",(function(t){var n=t.stream;e.logger("远端视频流加入: "+n.getId()),e.logger("开始订阅视频流: "+n.getId()),e.rtcCb({name:"stream-added",data:{uid:n.getId(),code:e._code_enum_.MESSAGE_CODE_STREAM}}),s.subscribe(n,(function(t){var n="订阅失败: "+(0,o.showErrorMsg)(t);e.logger(n),e.rtcCb({name:"error",data:{msg:n,code:e._code_enum_.MESSAGE_CODE_STREAM}})}))})),s.on("stream-subscribed",(function(t){var n=t.stream,i=n.getId();e.logger("订阅远端流成功: "+i),c[i]=n,e.playById(i),e.rtcCb({name:"stream-subscribed",data:{uid:i,code:e._code_enum_.MESSAGE_CODE_STREAM}}),e.rtcCb({name:"RemoteJoin",data:{uid:i,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("stream-removed",(function(t){var n=t.stream;n.stop(),delete c[n.getId()],e.logger("远端流被移除 "+n.getId()),e.rtcCb({name:"stream-removed",data:{uid:n.getId(),code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("peer-leave",(function(t){var n=t.stream;n&&(n.stop(),delete c[t.uid],e.logger(t.uid+" 离开房间"),e.rtcCb({name:"peer-leave",data:{uid:t.uid,code:e._code_enum_.MESSAGE_CODE_ROOM}}))})),s.on("network-quality",(function(t){var n=t.downlinkNetworkQuality,i=t.uplinkNetworkQuality;e.rtcCb({name:"NetQA",data:{rxQuality:n,txQuality:i,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("mute-audio",(function(t){var n=t.uid;e.rtcCb({name:"mute_remote_audio",data:{uid:n,mute:!0,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("unmute-audio",(function(t){var n=t.uid;e.rtcCb({name:"mute_remote_audio",data:{uid:n,mute:!1,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("mute-video",(function(t){var n=t.uid;e.rtcCb({name:"mute_remote_video",data:{uid:n,mute:!0,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.on("unmute-video",(function(t){var n=t.uid;e.rtcCb({name:"mute_remote_video",data:{uid:n,mute:!1,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),s.init(r.APP_ID,(function(){e.logger("初始化成功"),e.rtcCb({name:"inited",data:{code:e._code_enum_.MESSAGE_CODE_INIT}}),e.joinRoom(),e._getVideoStatus_()}),(function(t){var n="初始化失败: "+(0,o.showErrorMsg)(t);e.logger(n),e.rtcCb({name:"error",data:{msg:n,code:e._code_enum_.MESSAGE_CODE_INIT}})}))}))}else this.rtcCb({name:"error",data:{msg:"初始化失败浏览器不支持WebRTC",code:this._code_enum_.MESSAGE_CODE_INIT}})},t.prototype._getVideoStatus_=function(){var e=this;this.timeId&&(clearInterval(this.timeId),this.timeId=null),this.timeId=setInterval((function(){e._getLocalVideoStats(),e._getRemoteVideoStats()}),3e3)},t.prototype.joinRoom=function(){var e=this,t=this.uid,n=this.roomId,i=this.isWatcher;this.logger("用户:"+t+" isWatcher:"+!!i+" 正在视图加入房间:"+n+"中..."),s.join(null,n,t,(function(t){if(e.logger("用户 "+t+" 加入房间成功"),e.rtcCb({name:"room joined",data:{code:e._code_enum_.MESSAGE_CODE_ROOM}}),!i){var n=a.createStream({streamID:t,audio:!0,cameraId:e.cameraId,microphoneId:e.microphoneId,video:!0,screen:!1});c[t]=n,n.setVideoProfile("240P"),n.on("accessAllowed",(function(){e.logger("本地设备允许访问"),e.rtcCb({name:"accessAllowed",data:{code:e._code_enum_.MESSAGE_CODE_STREAM}})})),n.on("accessDenied",(function(){e.logger("本地设备拒绝访问");e.rtcCb({name:"accessDenied",data:{msg:"本地设备拒绝访问",code:e._code_enum_.MESSAGE_CODE_STREAM}}),e.rtcCb({name:"error",data:{msg:"本地设备拒绝访问",name:"onFirstLocalVideoFrame",code:e._code_enum_.MESSAGE_CODE_STREAM}})})),n.init((function(){e.logger("本地化初始流第一帧成功"),e.rtcCb({name:"onFirstLocalVideoFrame",data:{code:e._code_enum_.MESSAGE_CODE_STREAM}}),e.playById(t),s.publish(n,(function(t){var n="本地推流失败: "+(0,o.showErrorMsg)(t);e.logger(n),e.rtcCb({name:"error",data:{msg:n,code:e._code_enum_.MESSAGE_CODE_STREAM}})}))}),(function(t){var n="本地化初始流第一帧失败: "+(0,o.showErrorMsg)(t);e.logger(n),e.rtcCb({name:"error",data:{msg:n,name:"onFirstLocalVideoFrame",code:e._code_enum_.MESSAGE_CODE_STREAM}})}))}}),(function(t){var n="加入房间失败: "+(0,o.showErrorMsg)(t);e.logger(n),e.rtcCb({name:"error",data:{msg:n,code:e._code_enum_.MESSAGE_CODE_ROOM}})}))},t.prototype.leaveRoom=function(){var e=this;s&&s.leave((function(){e.logger("离开房间成功"),e.rtcCb({name:"leave channel",data:{code:e._code_enum_.MESSAGE_CODE_ROOM}})}),(function(t){var n="离开房间失败"+(0,o.showErrorMsg)(t);e.logger(n),e.rtcCb({name:"error",data:{msg:n,code:e._code_enum_.MESSAGE_CODE_ROOM}})}));var t=c[this.uid];t&&(t.stop(),t.close(),delete c[this.uid])},t.prototype.playById=function(e){var t=this;(0,o.waitFor)((function(){return c[e]&&t.document.getElementById(""+e)})).then((function(){c[e].isPlaying()&&c[e].stop(),c[e].play(""+e),t.logger("playById "+e)}))},t.prototype.disableVideo=function(e){var t=e.id,n=e.flag;this.logger("disableVideo "+t+" "+n);var i=c[t];i&&(n?i.enableVideo(t):i.disableVideo(t))},t.prototype.disableAudio=function(e){var t=e.id,n=e.flag,i=c[t];i&&(n?i.enableAudio():i.disableAudio())},t.prototype.hideVideoById=function(e){},t.prototype.showVideoById=function(e){},t.prototype._getRemoteVideoStats=function(){var e=this;s&&s.getRemoteVideoStats((function(t){for(var n in t){e.logger(t[n]);var i=t[n],o=i.RenderResolutionHeight,r={name:"RemoteVideoStats",data:{uid:n,width:i.RenderResolutionWidth,height:o,receivedBitrate:i.RecvBitrate,receivedFrameRate:i.RenderFrameRate,code:e._code_enum_.MESSAGE_CODE_STREAM}};e.rtcCb(r)}}))},t.prototype._getLocalVideoStats=function(){var e=this;s&&s.getLocalVideoStats((function(t){for(var n in t){var i=t[n],o={name:"LocalVideoStats",data:{uid:n,sentBitrate:i.SendBitrate,sentFrameRate:i.SendFrameRate,code:e._code_enum_.MESSAGE_CODE_STREAM}};e.rtcCb(o)}}))},t.prototype.switchDevice=function(e,t){var n=c[this.uid];n&&n.switchDevice(e,t)},t}(i.RtcKit)},254:function(e,t,n){
/*! AgoraRTC|BUILD v2.8.0-0-g0d6a3be */
window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=22)}([function(e,t,n){"use strict";n.r(t);var i=n(5),o=n.n(i),r=n(6),a=n(2),s=n(1),c=0,d="free",u=[],l=[],p=0;setInterval((function(){Object(a.getParameter)("UPLOAD_LOG")&&f.info("console log upload")}),9e5);var f=function(){var e,t,n,i,f,m,g="https://".concat(Object(a.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v1"),v=["DEBUG","INFO","WARNING","ERROR","NONE"],h=0,y=function e(t){d="uploading",setTimeout((function(){!function(e,t,n){var i;Array.isArray(e)||(e=[e]),e=e.map((function(e){return{log_item_id:c++,log_level:e.log_level,payload_str:e.payload}})),i={sdk_version:a.VERSION,process_id:Object(s.a)(),payload:JSON.stringify(e)};try{Object(r.c)(g,i,(function(e){"OK"===e?t&&t():n&&n()}),(function(e){n&&n()}),{withCredentials:!0})}catch(e){n&&n()}}(t,(function(){p=0,0!==u.length?(l=u.length<10?u.splice(0,u.length):u.splice(0,10),e(l)):d="free"}),(function(){setTimeout((function(){e(l)}),p++<2?200:1e4)}))}),3e3)};t=function(){for(var t=[0],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},n=function(){for(var t=[1],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},i=function(){for(var t=[2],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},f=function(){for(var t=[3],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)};var S={};return m=function(e){S[e]||(i.apply(void 0,arguments),S[e]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,enableLogUpload:function(){Object(a.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(a.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(e){g=e?"https://".concat(e,"/ls/?h=").concat(Object(a.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Object(a.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v1")},setLogLevel:function(e){e>4?e=4:e<0&&(e=0),h=e},log:e=function(){var e,t=arguments[0],n=arguments;if(n[0]=(e=new Date).toTimeString().split(" ")[0]+":"+e.getMilliseconds()+" Agora-SDK ["+(v[t]||"DEFAULT")+"]:",function(e,t){if(Object(a.getParameter)("UPLOAD_LOG"))try{t=Array.prototype.slice.call(t);var n="";t.forEach((function(e){"object"===o()(e)&&(e=JSON.stringify(e)),n=n+e+" "})),u.push({payload:n,log_level:e}),"free"===d&&(l=u.length<10?u.splice(0,u.length):u.splice(0,10),y(l))}catch(e){}}(t,n),!(t<h))switch(t){case 0:case 1:console.log.apply(console,n);break;case 2:console.warn.apply(console,n);break;case 3:console.error.apply(console,n);break;default:return void console.log.apply(console,n)}},debug:t,info:n,warning:i,deprecate:m,error:f}}();t.default=f},function(e,t,n){"use strict";var i=n(9),o=n.n(i),r=n(4),a=n.n(r),s=n(2),c=n(0),d=n(6),u=n(11),l=n.n(u);n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return m}));var p={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},f=null,m=function(){return f||(f="process-"+l()(),c.default.info("processId: "+f)),f},g=function(){var e={list:{}};e.url=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6080/events/message"),e.urlBackup=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6080/events/message"),e.setProxyServer=function(t){t?(e.url=Object(d.e)()?"https://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"http://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6080&d=events/message"),e.urlBackup=Object(d.e)()?"https://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"http://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6080&d=events/message"),c.default.debug("reportProxyServerURL: ".concat(e.url)),c.default.debug("reportProxyServerBackupURL: ".concat(e.urlBackup))):(e.url=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6080/events/message"),e.urlBackup=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6080/events/message"))},e.sessionInit=function(t,n){var i=a()({},p);i.startTime=+new Date,i.sid=t,i.cname=n.cname,e.list[t]=i;var o=a()({},{willUploadConsoleLog:Object(s.getParameter)("UPLOAD_LOG")},n.extend),r=a()({},i);r.eventType="session_init",r.appid=n.appid,r.browser=navigator.userAgent,r.build=s.BUILD,r.lts=+new Date,r.elapse=r.lts-r.startTime,r.extend=JSON.stringify(o),r.mode=n.mode,r.process=m(),r.success=n.succ,r.version=s.VERSION,delete r.startTime,e.send({type:"io.agora.pb.Wrtc.Session",data:r}),e._flushInvokeReport(t)},e.joinChooseServer=function(t,n,i){n.uid&&(e.list[t].uid=parseInt(n.uid)),n.cid&&(e.list[t].cid=parseInt(n.cid));var o=a()({},e.list[t]);o.eventType="join_choose_server";var r=n.lts;o.lts=Date.now(),o.eventElapse=o.lts-r,o.chooseServerAddr=n.csAddr,o.errorCode=n.ec,o.elapse=o.lts-o.startTime,o.success=n.succ,o.chooseServerAddrList=JSON.stringify(n.serverList),delete o.startTime,e.send({type:"io.agora.pb.Wrtc.JoinChooseServer",data:o})},e.reqUserAccount=function(t,n){n.vid&&(e.list[t].vid=n.vid);var i=a()({},e.list[t]),o=n.lts;i.eventType="req_user_account",i.lts=Date.now(),i.success=n.success,i.serverAddress=n.serverAddress,i.stringUid=n.stringUid,i.uid=n.uid,i.errorCode=n.errorCode,i.elapse=i.lts-i.startTime,i.eventElapse=i.lts-o,i.extend="string"==typeof n.extend?n.extend:JSON.stringify(n.extend),delete i.startTime,e.send({type:"io.agora.pb.Wrtc.ReqUserAccount",data:i})},e.joinGateway=function(t,n){n.vid&&(e.list[t].vid=n.vid);var i=a()({},e.list[t]),o=n.lts;i.eventType="join_gateway",i.lts=Date.now(),i.gatewayAddr=n.addr,i.success=n.succ,i.errorCode=n.ec,i.elapse=i.lts-i.startTime,i.eventElapse=i.lts-o,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.JoinGateway",data:i})},e.publish=function(t,n){var i=a()({},e.list[t]);i.eventType="publish";var o=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.success=n.succ,i.errorCode=n.ec,n.videoName&&(i.videoName=n.videoName),n.audioName&&(i.audioName=n.audioName),n.screenName&&(i.screenName=n.screenName),delete i.startTime,e.send({type:"io.agora.pb.Wrtc.Publish",data:i}),e._flushInvokeReport(t)},e.subscribe=function(t,n){var i=a()({},e.list[t]);i.eventType="subscribe";var o=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.errorCode=n.ec,i.success=n.succ,isFinite(n.peerid)?i.peer=n.peerid:i.peerSuid=""+n.peerid,"boolean"==typeof n.video&&(i.video=n.video),"boolean"==typeof n.audio&&(i.audio=n.audio),delete i.startTime,e.send({type:"io.agora.pb.Wrtc.Subscribe",data:i}),e._flushInvokeReport(t)},e.firstRemoteFrame=function(t,n){var i=a()({},e.list[t]);i.eventType="first_remote_frame";var o=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.width=n.width,i.height=n.height,i.success=n.succ,i.errorCode=n.ec,isFinite(n.peerid)?i.peer=n.peerid:i.peerSuid=""+n.peerid,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.FirstFrame",data:i})},e.streamSwitch=function(t,n){var i=a()({},e.list[t]);i.eventType="stream_switch",i.lts=Date.now(),i.isDual=n.isdual,i.elapse=i.lts-i.startTime,i.success=i.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.StreamSwitch",data:i})},e.audioSendingStopped=function(t,n){var i=a()({},e.list[t]);i.eventType="audio_sending_stopped",i.lts=Date.now(),i.elapse=i.lts-i.startTime,i.reason=n.reason,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.AudioSendingStopped",data:i})},e.videoSendingStopped=function(t,n){var i=a()({},e.list[t]);i.eventType="video_sending_stopped",i.lts=Date.now(),i.elapse=i.lts-i.startTime,i.reson=n.reason,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.VideoSendingStopped",data:i})},e.requestProxyAppCenter=function(t,n){var i=a()({},e.list[t]),o=n.lts;i.eventType="request_proxy_appcenter",i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.extend=n.extend+"",i.APAddr=n.APAddr,i.workerManagerList=n.workerManagerList,i.response=n.response,i.errorCode=n.ec,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.RequestProxyAppCenter",data:i})},e.requestProxyWorkerManager=function(t,n){var i=a()({},e.list[t]),o=n.lts;i.eventType="request_proxy_worker_manager",i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.extend=n.extend,i.workerManagerAddr=n.workerManagerAddr,i.response=n.response,i.errorCode=n.ec,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.RequestProxyWorkerManager",data:i})};var t=0;return e.reportApiInvoke=function(e,n){var i=n.tag,r=n.name,a=n.getStates,s=n.options,c=n.timeout,d=void 0===c?6e4:c,u=n.callback,l=n.reportResult,p=void 0===l||l,f=Date.now(),m=0,v=t++,h=function(){return o()({tag:i,invokeId:v,sid:e,name:r,apiInvokeTime:f,options:s},a&&{states:(t=a(),Object.keys(t).reduce((function(e,n){var i=e;return null!=t[n]&&(i[n]=t[n]),i}),{}))});var t},y=setTimeout((function(){g._sendApiInvoke(o()({},h(),{error:"API_INVOKE_TIMEOUT",success:!1}))}),d);return function(e,t){if(clearTimeout(y),++m>1&&(e="EXECUTOR_INVOKE_".concat(m)),e)return g._sendApiInvoke(o()({},h(),{success:!1,error:e},a&&{states:a()})),u&&u(e);g._sendApiInvoke(o()({},h(),{success:!0},p&&{result:t},a&&{states:a()})),u&&u(null,t)}},e._cachedItems=[],e._cacheInvokeReport=function(t){t.lts||(t.lts=Date.now()),e._cachedItems.push(t),e._cachedItems.length>50&&e._cachedItems.shift()},e._flushInvokeReport=function(t){if(e._cachedItems.length){var n=e._cachedItems;e._cachedItems=[],c.default.debug("Flush cached event reporting:",n.length),n.forEach((function(n,i){n.sid=t,setTimeout((function(){e._sendApiInvoke(n)}),5e3+500*i)}))}},e._sendApiInvoke=function(t){var n=t.tag,i=t.invokeId,r=t.sid,a=t.name,c=t.result,d=t.states,u=t.options,l=t.error,p=t.success,f=t.apiInvokeTime,m=t.lts,g=Object(s.getParameter)("NOT_REPORT_EVENT");if(!(n&&g instanceof Array&&-1!==g.indexOf(n)))if(e.list[r]){var v=e.list[r],h=v.startTime,y=v.cname,S=v.uid,b=v.cid,I=(m=m||Date.now())-h,_=m-f,E=o()({invokeId:i,sid:r,cname:y,cid:b,lts:m,uid:S,success:p,elapse:I,apiName:a,execElapse:_},void 0!==u&&{options:JSON.stringify(u)},void 0!==d&&{execStates:JSON.stringify(d)},void 0!==l&&{errorCode:JSON.stringify(l)},void 0!==c&&{execResult:JSON.stringify(c)});e.send({type:"io.agora.pb.Wrtc.ApiInvoke",data:E})}else e._cacheInvokeReport(arguments[0])},e._send=function(t){try{var n=[];t&&t.data&&t.data.apiName?n.push(["apiName",""+t.data.apiName]):t&&t.data&&t.data.eventType&&n.push(["eventType",t.data.eventType]);var i=n.map((function(e){return"".concat(e[0],"=").concat(encodeURIComponent(e[1]))})).join("&"),o=-1===e.url.indexOf("?")?"".concat(e.url,"?").concat(i):e.url;Object(d.c)(o,t,null,(function(n){var o=-1===e.urlBackup.indexOf("?")?"".concat(e.urlBackup,"?").concat(i):e.urlBackup;Object(d.c)(o,t,null,(function(e){}),{timeout:1e4})}),{timeout:1e4})}catch(e){}},e.sendCache=[],e.sendTimer=null,e.send=function(t){if(e.sendCache.push(t),null===e.sendTimer)return function t(){e.sendTimer=setTimeout((function(){if(0!==e.sendCache.length)return e._send(e.sendCache.shift()),t();e.sendTimer=null}),Object(s.getParameter)("EVENT_REPORT_SEND_INTERVAL"))}()},e}()},function(e,t,n){"use strict";t.__esModule=!0,t.BUILD="v2.8.0-0-g0d6a3be",t.VERSION="2.8.0",t.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90,null,null,null,null],"120p_1":[160,120,15,15,30,65],"120p_3":[120,120,15,15,30,50],"120p_4":[212,120,null,null,null,null],"180p_1":[320,180,15,15,30,140],"180p_3":[180,180,15,15,30,100],"180p_4":[240,180,15,15,30,120],"240p_1":[320,240,15,15,40,200],"240p_3":[240,240,15,15,40,140],"240p_4":[424,240,15,15,40,220],"360p_1":[640,360,15,15,80,400],"360p_3":[360,360,15,15,80,260],"360p_4":[640,360,30,30,80,600],"360p_6":[360,360,30,30,80,400],"360p_7":[480,360,15,15,80,320],"360p_8":[480,360,30,30,80,490],"360p_9":[640,360,15,15,80,800],"360p_10":[640,360,24,24,80,800],"360p_11":[640,360,24,24,80,1e3],"480p_1":[640,480,15,15,20,500,1,5],"480p_2":[640,480,30,30,100,1e3,25,30],"480p_3":[480,480,15,15,100,400],"480p_4":[640,480,30,30,100,750],"480p_6":[480,480,30,30,100,600],"480p_8":[848,480,15,15,100,610],"480p_9":[848,480,30,30,100,930],"480p_10":[640,480,10,10,100,400],"720p_1":[1280,720,15,15,120,1130,1,5],"720p_2":[1280,720,30,30,120,2e3,25,30],"720p_3":[1280,720,30,30,120,1710],"720p_5":[960,720,15,15,120,910],"720p_6":[960,720,30,30,120,1380],"1080p_1":[1920,1080,15,15,120,2080,1,5],"1080p_2":[1920,1080,30,30,120,3e3,25,30],"1080p_3":[1920,1080,30,30,120,3150],"1080p_5":[1920,1080,60,60,120,4780],"1440p_1":[2560,1440,30,30,120,4850],"1440p_2":[2560,1440,60,60,120,7350],"4k_1":[3840,2160,30,30,120,8910],"4k_3":[3840,2160,60,60,120,13500]},t.AUDIO_PROFILE_SETTINGS={speech_low_quality:[!1,!1,!0,!0],speech_standard:[!1,!1,!0,!1],music_standard:[!1,!1,!1,!1],standard_stereo:[!1,!0,!1,!1],high_quality:[!0,!1,!1,!1],high_quality_stereo:[!0,!0,!1,!1],default:[!1,!1,!1,!1]};var i={WEBCS_DOMAIN:["ap-web-1.agora.io","ap-web-2.agoraio.cn"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-3.agora.io","ap-web-4.agoraio.cn"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],ACCOUNT_REGISTER:["ap-web-1.agora.io","ap-web-2.agoraio.cn","ap-web-3.agora.io","ap-web-4.agoraio.cn"],ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"webcollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"webcollector-2.agoraio.cn",WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,PLAYER_STATE_DEFER:2e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255,SUBSCRIBE_TCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:1e3,MEDIA_ELEMENT_EXISTS_DEPTH:3,CANDIDATE_TIMEOUT:2e3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3};t.setParameter=function(e,t){return void 0!==i[e]&&(i[e]=t,!0)},t.getParameter=function(e){return void 0!==i[e]?i[e]:null}},function(e,t,n){"use strict";n.r(t),n.d(t,"getBrowserInfo",(function(){return y})),n.d(t,"getBrowserVersion",(function(){return p})),n.d(t,"getBrowserOS",(function(){return f})),n.d(t,"isChrome",(function(){return i})),n.d(t,"isSafari",(function(){return o})),n.d(t,"isFireFox",(function(){return a})),n.d(t,"isOpera",(function(){return s})),n.d(t,"isEdge",(function(){return r})),n.d(t,"isQQBrowser",(function(){return c})),n.d(t,"isWeChatBrowser",(function(){return d})),n.d(t,"isLegacyChrome",(function(){return g})),n.d(t,"isSupportedPC",(function(){return u})),n.d(t,"isSupportedMobile",(function(){return l})),n.d(t,"getChromeKernelVersion",(function(){return h})),n.d(t,"isChromeKernel",(function(){return m}));var i=function(){var e=y();return e.name&&"Chrome"===e.name},o=function(){var e=y();return e.name&&"Safari"===e.name},r=function(){var e=y();return e.name&&"Edge"===e.name},a=function(){var e=y();return e.name&&"Firefox"===e.name},s=function(){var e=y();return e.name&&"OPR"===e.name},c=function(){var e=y();return e.name&&"QQBrowser"===e.name},d=function(){var e=y();return e.name&&"MicroMessenger"===e.name},u=function(){var e=f();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},l=function(){var e=f();return"Android"===e||"iOS"===e},p=function(){return y().version},f=function(){return y().os},m=function(){return!!navigator.userAgent.match(/chrome\/[\d]./i)};function g(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}var v,h=function(){var e=navigator.userAgent.match(/chrome\/[\d]./i);return e&&e[0]&&e[0].split("/")[1]},y=(v=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===n[1]&&null!=(e=t.match(/(OPR(?=\/))\/?(\d+)/i))&&(n=e),"Safari"===n[1]&&null!=(e=t.match(/version\/(\d+)/i))&&(n[2]=e[1]),~t.toLowerCase().indexOf("qqbrowser")&&null!=(e=t.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("micromessenger")&&null!=(e=t.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("edge")&&null!=(e=t.match(/(edge(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("trident")&&null!=(e=/\brv[ :]+(\d+)/g.exec(t)||[])&&(n=[null,"IE",e[1]]);var i=void 0,o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var r in o){var a=o[r];if(a.r.test(navigator.userAgent)){i=a.s;break}}return{name:n[1],version:n[2],os:i}}(),function(){return v})},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n.apply(this,arguments)}e.exports=n},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=i=function(e){return n(e)}:e.exports=i=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},i(t)}e.exports=i},function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return d}));var i=n(2),o=n(7),r=0,a=0,s=function(){return r},c=function(){return a},d=function(){r=0,a=0},u=function(e,t,n,s,c){var d=new XMLHttpRequest;if(d.timeout=t.timeout||Object(i.getParameter)("HTTP_CONNECT_TIMEOUT"),d.open("POST",e,!0),d.setRequestHeader("Content-type","application/json; charset=utf-8"),c)for(var u in c)"withCredentials"==u?d.withCredentials=!0:d.setRequestHeader(u,c[u]);d.onload=function(e){a+=Object(o.e)(d.responseText),n&&n(d.responseText)},d.onerror=function(t){s&&s(t,e)},d.ontimeout=function(t){s&&s(t,e)};var l=JSON.stringify(t);r+=Object(o.e)(l),d.send(l)},l=function(){return"https:"==document.location.protocol}},function(e,t,n){"use strict";n.d(t,"d",(function(){return g})),n.d(t,"b",(function(){return p})),n.d(t,"a",(function(){return l})),n.d(t,"h",(function(){return f})),n.d(t,"c",(function(){return m})),n.d(t,"g",(function(){return h})),n.d(t,"f",(function(){return S})),n.d(t,"e",(function(){return y}));var i=n(5),o=n.n(i),r=n(3),a=n(0),s=n(11),c=n.n(s),d=n(12),u=n(8),l=function(e){return this.audioContext=Object(d.a)(),this.sourceNode=e.otWebkitAudioSource||this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var e=0,t=0;t<this.timeDomainData.length;t++)e=Math.max(e,Math.abs(this.timeDomainData[t]-128));return e/128}return a.default.warning("can't find analyser in audioLevelHelper"),0},this};function p(){return c()().replace(/-/g,"").toUpperCase()}var f=function(e,t,n){try{var i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(i),i.addEventListener("playing",(function(e){r.isFireFox()?i.videoWidth&&(t(i.videoWidth,i.videoHeight),document.body.removeChild(i)):(t(i.videoWidth,i.videoHeight),document.body.removeChild(i))})),Object(u.setSrcObject)(i,e)}catch(e){n(e)}},m=function(e){return"number"==typeof e&&0<=e&&e<=4294967295},g=function(e){var t=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var n in e)if("lowLatency"===n&&"boolean"!=typeof e[n]||"userConfigExtraInfo"===n&&"object"!==o()(e[n])||"transcodingUsers"===n&&!v(e[n])||!~t.indexOf(n)&&"number"!=typeof e[n])throw new Error("Param ["+n+"] is inValid");return!0},v=function(e){for(var t=0;t<e.length;t++)for(var n in e[t])if("number"!=typeof e[t][n])throw new Error("Param user["+t+"] - ["+n+"] is inValid");return!0},h=function(e){isNaN(e)&&(e=1e3);var t=+new Date,n=(t=(9301*t+49297)%233280)/233280;return Math.ceil(n*e)},y=function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},S=function(){if(!document.getElementById("agora-ban-tip")){var e=document.createElement("div");e.id="agora-ban-tip",e.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(e);var t=document.createElement("div");t.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",e.append(t);var n=document.createElement("div");n.style="height: 76px; display: flex; justify-content: center; align-items: center;";var i=document.createElement("span");i.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",i.innerText="!";var o=document.createElement("span");o.innerText="This browser does not support webRTC",n.append(i),n.append(o);var r=document.createElement("div");r.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",r.innerText="OK",t.append(n),t.append(r),r.onclick=function(){var e=document.getElementById("agora-ban-tip");e.parentNode.removeChild(e)}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"RTCPeerConnection",(function(){return _})),n.d(t,"getUserMedia",(function(){return r})),n.d(t,"attachMediaStream",(function(){return a})),n.d(t,"reattachMediaStream",(function(){return s})),n.d(t,"setSrcObject",(function(){return p})),n.d(t,"getSrcObject",(function(){return f})),n.d(t,"webrtcDetectedBrowser",(function(){return c})),n.d(t,"webrtcDetectedVersion",(function(){return d})),n.d(t,"webrtcMinimumVersion",(function(){return u})),n.d(t,"webrtcTesting",(function(){return E})),n.d(t,"webrtcUtils",(function(){return v}));var i=n(5),o=n.n(i),r=null,a=null,s=null,c=null,d=null,u=null,l=null,p=null,f=null,m=null,g={addStream:null},v={log:function(){},extractVersion:function(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n])}};if("object"==("undefined"==typeof window?"undefined":o()(window))?(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype?(p=function(e,t){e.srcObject=t},f=function(e){return e.srcObject}):(p=function(e,t){"mozSrcObject"in e?e.mozSrcObject=t:(e._srcObject=t,e.src=t?URL.createObjectURL(t):null)},f=function(e){return"mozSrcObject"in e?e.mozSrcObject:e._srcObject}),r=window.navigator&&window.navigator.getUserMedia):(p=function(e,t){e.srcObject=t},f=function(e){return e.srcObject}),a=function(e,t){p(e,t)},s=function(e,t){p(e,f(t))},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var h in v.log("This appears to be Firefox"),c="firefox",d=v.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),u=31,m=mozRTCPeerConnection,g)g[h]=m.prototype[h];if(l=function(e,t){if(d<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var r=0;r<o.urls.length;r++){var a={url:o.urls[r]};0===o.urls[r].indexOf("turn")&&(a.username=o.username,a.credential=o.credential),n.push(a)}else n.push(e.iceServers[i])}e.iceServers=n}var s=new m(e,t);for(var c in g)s[c]=g[c];return s},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),r=function(e,t,n){var i=function(e){if("object"!==o()(e)||e.require)return e;var t=[];return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"===o()(e[n])?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof i.ideal?r[n]={min:i.ideal,max:i.ideal}:r[n]=i.ideal,e.advanced.push(r),delete i.ideal,Object.keys(i).length||delete e[n]}}})),t.length&&(e.require=t),e};return d<38&&(v.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=i(e.audio)),e.video&&(e.video=i(e.video)),v.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=r,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:I,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise((function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},d<41){var y=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return y().then(void 0,(function(e){if("NotFoundError"===e.name)return[];throw e}))}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var h in v.log("This appears to be Chrome"),c="chrome",d=v.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),u=38,m=webkitRTCPeerConnection,g)g[h]=m.prototype[h];l=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new m(e,t);for(var i in g)n[i]=g[i];var o=n.getStats.bind(n);return n.getStats=function(e,t,n){var i=this,r=arguments;r.length>0&&"function"==typeof e&&(t?(n=t,t=e,r=[e=null,t,n]):(t=e,r=[e=null,t]));var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t};return r.length>=2?o.apply(this,[function(e){r[1](a(e))},r[0]]):new Promise((function(t,n){1===r.length&&null===e?o.apply(i,[function(e){t.apply(null,[a(e)])},n]):o.apply(i,[t,n])}))},n},["createOffer","createAnswer"].forEach((function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===o()(arguments[0])){var n=1===arguments.length?arguments[0]:void 0;return new Promise((function(i,o){t.apply(e,[i,o,n])}))}return t.apply(this,arguments)}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise((function(i,o){t.apply(n,[e[0],function(){i(),e.length>=2&&e[1].apply(null,[])},function(t){o(t),e.length>=3&&e[2].apply(null,[t])}])}))}}));var S=function(e){if("object"!==o()(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===o()(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[r("min",n)]=i.ideal,t.optional.push(a),(a={})[r("max",n)]=i.ideal,t.optional.push(a)):(a[r("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(r=function(e,t,n){return e.audio&&(e.audio=S(e.audio)),e.video&&(e.video=S(e.video)),v.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=r,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:I,enumerateDevices:function(){return new Promise((function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(n){e(n.map((function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}})))}))}))}}),navigator.mediaDevices.getUserMedia){var b=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return v.log("spec:   "+JSON.stringify(e)),e.audio=S(e.audio),e.video=S(e.video),v.log("chrome: "+JSON.stringify(e)),b(e)}}else navigator.mediaDevices.getUserMedia=function(e){return I(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){v.log("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){v.log("Dummy mediaDevices.removeEventListener called.")}),a=function(e,t){d>=43?p(e,t):void 0!==e.src?e.src=t?URL.createObjectURL(t):null:v.log("Error attaching stream to element.")},s=function(e,t){d>=43?p(e,f(t)):e.src=t.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(v.log("This appears to be Edge"),c="edge",d=v.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),u=12):v.log("Browser does not appear to be WebRTC-capable");else v.log("This does not appear to be a browser"),c="not a browser";function I(e){return new Promise((function(t,n){r(e,t,n)}))}var _,E={};try{Object.defineProperty(E,"version",{set:function(e){d=e}})}catch(e){}l?_=l:"undefined"!=typeof window&&(_=window.RTCPeerConnection)},function(e,t,n){var i=n(18);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){i(e,t,n[t])}))}return e}},function(e,t,n){e.exports=n(20)},function(e,t,n){var i=n(16),o=n(17);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[r+s]=a[s];return t||o(a)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=window.AudioContext||window.webkitAudioContext,o=n(2),r=o.getParameter,a=o.setParameter,s=function(){return r("AUDIO_CONTEXT")||(console.log("Creating Audio Context"),a("AUDIO_CONTEXT",function(){if(i)return new i;throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")}())),r("AUDIO_CONTEXT")}},function(e,t,n){"use strict";t.__esModule=!0;var i,o=n(0),r=n(8);!function(e){e.NEW="new",e.PREPARING_OFFER="preparing-offer",e.OFFER_SENT="offer-sent",e.ESTABLISHED="established",e.CLOSED="closed"}(i||(i={}));var a=function(){function e(e){this.candidate=null,this.state=i.NEW,this.config=e,this.isSubscriber=this.config.isSubscriber,this.peerConnection=this.initPeecConnection(e),this.peerConnection.onicecandidate=this._onicecandidate.bind(this),this.peerConnection.oniceconnectionstatechange=this._oniceconnectionstatechange.bind(this),this.peerConnection.onaddstream=this._onaddstream.bind(this),this.peerConnection.ontrack=this._ontrack.bind(this),this.processSignalingMessage=this.setAnswer.bind(this),this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.setLocalSDP.bind(this)),this.sendVideoStats={id:"",type:"",mediaType:"",googCodecName:"h264"===this.config.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},this.sendAudioStats={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},this.receiveAudioStats={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},this.receiveVideoStats={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"}}return e.prototype.addStream=function(e){this.peerConnection.addStream(e)},e.prototype.setAnswer=function(e){var t=JSON.parse(e);this.peerConnection.setRemoteDescription(new RTCSessionDescription({sdp:t.sdp,type:"answer"})),this.onsignalingmessage&&this.onsignalingmessage("")},e.prototype.close=function(){this.peerConnection.close()},e.prototype.getStats=function(e,t){if(void 0===t&&(t=500),t=t>500?500:t,Date.now()-this.lastTimeGetStats<t){var n=[];this.config.isSubscriber?(n.push(this.receiveVideoStats),n.push(this.receiveAudioStats)):(n.push(this.sendAudioStats),n.push(this.sendVideoStats)),n.push({id:"time",startTime:this.connectedTime,timestamp:Date.now()}),e&&e(n)}else this._getStats(e)},e.prototype._getStats=function(e){var t=this,n=[];this.peerConnection.getStats(null).then((function(i){t.lastTimeGetStats=Date.now(),Object.keys(i).map((function(e){var n=i[e];t.config.isSubscriber?n.type&&"inboundrtp"===n.type&&n.mediaType&&"audio"===n.mediaType?(t.receiveAudioStats.id=n.id+"recv",t.receiveAudioStats.type=n.type+"",t.receiveAudioStats.mediaType=n.mediaType+"",t.receiveAudioStats.packetsReceived=n.packetsReceived+"",t.receiveAudioStats.bytesReceived=n.bytesReceived+"",t.receiveAudioStats.packetsLost=n.packetsLost+"",t.receiveAudioStats.googJitterReceived=n.jitter+""):n.type&&"inboundrtp"===n.type&&n.mediaType&&"video"===n.mediaType?(t.receiveVideoStats.id=n.id+"recv",t.receiveVideoStats.type=n.type+"",t.receiveVideoStats.mediaType=n.mediaType+"",t.receiveVideoStats.packetsReceived=n.packetsReceived+"",t.receiveVideoStats.bytesReceived=n.bytesReceived+"",t.receiveVideoStats.packetsLost=n.packetsLost+"",t.receiveVideoStats.googJitterBufferMs=n.jitter+"",t.receiveVideoStats.googPlisSent=n.pliCount+"",t.receiveVideoStats.googFirsSent=n.firCount+"",t.receiveVideoStats.googNacksSent=n.nackCount+""):n.remoteSource&&n.type&&"track"===n.type&&n.trackIdentifier&&-1!==n.trackIdentifier.indexOf("v")?(t.receiveVideoStats.googFrameHeightReceived=n.frameHeight+"",t.receiveVideoStats.googFrameWidthReceived=n.frameWidth+"",t.receiveVideoStats.googFrameRateDecoded=n.framesPerSecond+"",t.receiveVideoStats.googFrameRateOutput=n.framesPerSecond+"",t.receiveVideoStats.googFrameRateReceived=n.framesPerSecond+"",t.receiveVideoStats.googFramesDecoded=n.framesDecoded+"",t.receiveVideoStats.googFrameReceived=n.framesReceived+""):n.remoteSource&&n.type&&"track"===n.type&&n.trackIdentifier&&-1!==n.trackIdentifier.indexOf("a")&&(t.receiveAudioStats.audioOutputLevel=n.audioLevel+""):!n.isRemote&&n.type&&"outboundrtp"===n.type&&n.mediaType&&"audio"===n.mediaType?(t.sendAudioStats.id=n.id+"send",t.sendAudioStats.type=n.type+"",t.sendAudioStats.mediaType=n.mediaType+"",t.sendAudioStats.packetsSent=n.packetsSent+"",t.sendAudioStats.bytesSent=n.bytesSent+""):!n.isRemote&&n.type&&"outboundrtp"===n.type&&n.mediaType&&"video"===n.mediaType?(t.sendVideoStats.id=n.id+"send",t.sendVideoStats.type=n.type+"",t.sendVideoStats.mediaType=n.mediaType+"",t.sendVideoStats.packetsSent=n.packetsSent+"",t.sendVideoStats.bytesSent=n.bytesSent+"",t.sendVideoStats.googRtt=n.roundTripTime+"",t.sendVideoStats.googPlisReceived=n.pliCount+"",t.sendVideoStats.googFirsReceived=n.firCount+"",t.sendVideoStats.googNacksReceived=n.nackCount+""):!n.remoteSource&&n.type&&"track"===n.type&&n.framesSent&&0!==n.framesSent&&(t.sendVideoStats.googFrameHeightSent=n.frameHeight+"",t.sendVideoStats.googFrameHeightInput=n.frameHeight+"",t.sendVideoStats.googFrameWidthSent=n.frameWidth+"",t.sendVideoStats.googFrameWidthInput=n.frameWidth+"",t.sendVideoStats.googFramesEncoded=n.framesSent+"",t.sendVideoStats.googFrameRateSent=n.framesPerSecond+"")})),t.config.isSubscriber?(n.push(t.receiveVideoStats),n.push(t.receiveAudioStats)):(n.push(t.sendAudioStats),n.push(t.sendVideoStats)),n.push({id:"time",startTime:t.connectedTime,timestamp:Date.now()}),e&&e(n)}))},e.prototype.getStatsRate=function(e){this.getStats(e)},e.prototype.initPeecConnection=function(e){var t=e.stunServerUrl,n=e.turnServer,i=e.iceServers;return this.pcConfig={iceServers:[{urls:"stun:webcs.agora.io:3478"}]},i instanceof Array?this.pcConfig.iceServers=e.iceServers:t&&(t instanceof Array?t.map((function(e){"string"==typeof e&&""!==e&&this.pcConfig.iceServers.push({urls:e})})):"string"==typeof t&&""!==t&&this.pcConfig.iceServers.push({urls:t})),n&&(n instanceof Array?n.map((function(e){"string"==typeof e.url&&""!==e.url&&this.pcConfig.iceServers.push({username:e.username,credential:e.credential,url:e.url})})):"string"==typeof n.url&&""!==n.url&&(this.pcConfig.iceServers.push({username:n.username,credential:n.credential,credentialType:"password",urls:"turn:"+n.url+":"+n.udpport+"?transport=udp"}),"string"==typeof n.tcpport&&""!==n.tcpport&&this.pcConfig.iceServers.push({username:n.username,credential:n.credential,credentialType:"password",urls:"turn:"+n.url+":"+n.tcpport+"?transport=tcp"}),!0===n.forceturn&&(this.pcConfig.iceTransportPolicy="relay"))),new r.RTCPeerConnection(this.pcConfig)},e.prototype._ontrack=function(e){this.onaddstream&&this.onaddstream(e,"ontrack")},e.prototype._onaddstream=function(e){this.onaddstream&&this.onaddstream(e,"onaddstream")},e.prototype._oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(this.state=i.ESTABLISHED,this.connectedTime=Date.now()),this.oniceconnectionstatechange&&this.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},e.prototype._onicecandidate=function(e){!this.candidate&&e&&(this.candidate=e.candidate,this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(this.editLocalSDP.bind(this)).then(this.setLocalSDP.bind(this)).then(this.sendOffer.bind(this)).catch())},e.prototype.setLocalSDP=function(e){return this.peerConnection.setLocalDescription(new RTCSessionDescription({sdp:e.sdp,type:"offer"})),this.state=i.PREPARING_OFFER,e},e.prototype.editLocalSDP=function(e){return e.sdp=this.setBandWidth(e.sdp),e.sdp=this.reviseOpus(e.sdp),e.sdp=this.addCandidate(e.sdp),e},e.prototype.setSendRecv=function(e){return(e=(e=e.replace(/a=recvonly\r\n/g,"a=sendrecv\r\n")).replace(/a=sendonly\r\n/g,"a=sendrecv\r\n")).replace(/a=inactive\r\n/g,"a=sendrecv\r\n")},e.prototype.setBandWidth=function(e){var t,n,i=this.config,r=i.codec,a=i.minVideoBW,s=i.maxVideoBW,c=i.maxAudioBW,d=i.clientId;if((t=e.match(/m=video.*\r\n/))&&a&&s){n=t[0]+"b=AS:"+s+"\r\n";var u=0,l=0;"h264"===r?(u=e.search(/a=rtpmap:(\d+) H264\/90000\r\n/),l=e.search(/H264\/90000\r\n/)):"vp8"===r&&(u=e.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),l=e.search(/VP8\/90000\r\n/)),-1!==u&&-1!==l&&l-u>10&&(n=n+"a=fmtp:"+e.slice(u+9,l-1)+" x-google-min-bitrate="+a+"\r\n"),e=e.replace(t[0],n),o.default.debug("["+d+"]Set Video Bitrate - min:"+a+" max:"+s)}return(t=e.match(/m=audio.*\r\n/))&&c&&(n=t[0]+"b=AS:"+c+"\r\n",e=e.replace(t[0],n)),e},e.prototype.reviseOpus=function(e){return(e=e.replace(/a=rtpmap:102 opus\/48000\/2/g,"a=rtpmap:111 opus/48000/2")).replace(/m=audio 9 UDP\/TLS\/RTP\/SAVPF 102 0 8 97 13 118 101/g,"m=audio 9 UDP/TLS/RTP/SAVPF 111 0 8 97 13 118 101")},e.prototype.addCandidate=function(e){return e+"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"},e.prototype.sendOffer=function(e){this.config.callback(JSON.stringify({sdp:e.sdp,messageType:"OFFER",tiebreaker:Math.floor(429496723*Math.random()+1)})),this.state=i.OFFER_SENT},e}();t.default=a},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},r=this;t.__esModule=!0;var a=n(19),s=n(3),c=n(0);t.getSupportedCodec=function(e){return i(r,void 0,void 0,(function(){var t,n,i,r,u;return o(this,(function(o){switch(o.label){case 0:return t={video:[],audio:[]},"undefined"!=typeof window?[3,1]:(c.default.error("getSupportedCodec: NOT_BROWSER_ENV"),[2,Promise.reject("NOT_BROWSER_ENV")]);case 1:try{n=a.createRTCPeerConnection({iceServers:[]})}catch(e){return c.default.error("Failed to init RTCPeerConnection",e),[2,Promise.reject(e)]}return n?[3,2]:(c.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),[2,Promise.resolve(t)]);case 2:return e&&e.stream?[3,7]:(i={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},r=void 0,(s.isSafari()||s.isFireFox()||s.isWeChatBrowser())&&n.addTransceiver?(n.addTransceiver("audio"),n.addTransceiver("video"),[4,n.createOffer()]):[3,4]);case 3:return r=o.sent(),[3,6];case 4:return[4,new Promise((function(e,t){var o=setTimeout((function(){t("CREATEOFFER_TIMEOUT")}),3e3);n.createOffer((function(t){clearTimeout(o),e(t)}),(function(e){clearTimeout(o),t(e)}),i)}))];case 5:r=o.sent(),o.label=6;case 6:return n.close(),u=r.sdp,[2,d(u)];case 7:return e.stream.getTracks&&n.addTrack?e.stream.getTracks().forEach((function(t){n.addTrack(t,e.stream)})):n.addStream(e.stream),r=void 0,s.isSafari()||s.isFireFox()?[4,n.createOffer()]:[3,9];case 8:return r=o.sent(),[3,11];case 9:return[4,new Promise((function(e,t){n.createOffer(e,t)}))];case 10:r=o.sent(),o.label=11;case 11:return n.close(),u=r.sdp,[2,d(u)]}}))}))};var d=function(e){var t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ opus/i)&&t.audio.push("OPUS"),Promise.resolve(t)}},function(e,t){function n(e,t,n,i,o,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,o)}e.exports=function(e){return function(){var t=this,i=arguments;return new Promise((function(o,r){var a=e.apply(t,i);function s(e){n(a,o,r,s,c,"next",e)}function c(e){n(a,o,r,s,c,"throw",e)}s(void 0)}))}}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,o=n;return[o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]]].join("")}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";t.__esModule=!0;var i="object"==typeof window&&window.RTCPeerConnection,o="object"==typeof window&&window.webkitRTCPeerConnection,r="object"==typeof window&&window.mozRTCPeerConnection;t.createRTCPeerConnection=function(e){var t=i||o||r;return t?new t(e):null}},function(e,t,n){var i=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=i.regeneratorRuntime&&Object.getOwnPropertyNames(i).indexOf("regeneratorRuntime")>=0,r=o&&i.regeneratorRuntime;if(i.regeneratorRuntime=void 0,e.exports=n(21),o)i.regeneratorRuntime=r;else try{delete i.regeneratorRuntime}catch(e){i.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";var n,i=Object.prototype,o=i.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag",d="object"==typeof e,u=t.regeneratorRuntime;if(u)d&&(e.exports=u);else{(u=t.regeneratorRuntime=d?e.exports:{}).wrap=b;var l="suspendedStart",p="suspendedYield",f="executing",m="completed",g={},v={};v[a]=function(){return this};var h=Object.getPrototypeOf,y=h&&h(h(D([])));y&&y!==i&&o.call(y,a)&&(v=y);var S=C.prototype=_.prototype=Object.create(v);E.prototype=S.constructor=C,C.constructor=E,C[c]=E.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(S),e},u.awrap=function(e){return{__await:e}},T(w.prototype),w.prototype[s]=function(){return this},u.AsyncIterator=w,u.async=function(e,t,n,i){var o=new w(b(e,t,n,i));return u.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(S),S[c]="Generator",S[a]=function(){return this},S.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},u.values=D,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(O),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,o){return s.type="throw",s.arg=e,t.next=i,o&&(t.method="next",t.arg=n),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var c=o.call(a,"catchLoc"),d=o.call(a,"finallyLoc");if(c&&d){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!d)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;O(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:D(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=n),g}}}function b(e,t,n,i){var o=t&&t.prototype instanceof _?t:_,r=Object.create(o.prototype),a=new k(i||[]);return r._invoke=function(e,t,n){var i=l;return function(o,r){if(i===f)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw r;return N()}for(n.method=o,n.arg=r;;){var a=n.delegate;if(a){var s=R(a,n);if(s){if(s===g)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===l)throw i=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var c=I(e,t,n);if("normal"===c.type){if(i=n.done?m:p,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=m,n.method="throw",n.arg=c.arg)}}}(e,n,a),r}function I(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function _(){}function E(){}function C(){}function T(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,i){function r(){return new Promise((function(t,r){!function t(n,i,r,a){var s=I(e[n],e,i);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==typeof d&&o.call(d,"__await")?Promise.resolve(d.__await).then((function(e){t("next",e,r,a)}),(function(e){t("throw",e,r,a)})):Promise.resolve(d).then((function(e){c.value=e,r(c)}),(function(e){return t("throw",e,r,a)}))}a(s.arg)}(n,i,t,r)}))}return t=t?t.then(r,r):r()}}function R(e,t){var i=e.iterator[t.method];if(i===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,R(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var o=I(i,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,g;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function D(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(o.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=n,t.done=!0,t};return r.next=r}}return{next:N}}function N(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){"use strict";n.r(t);var o=n(2),r=n(0),a=n(1),s=function(){var e={dispatcher:{}};return e.dispatcher.eventListeners={},e.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},e.hasListeners=function(t){return!(!e.dispatcher.eventListeners[t]||!e.dispatcher.eventListeners[t].length)},e.on=e.addEventListener,e.removeEventListener=function(t,n){var i;-1!==(i=e.dispatcher.eventListeners[t].indexOf(n))&&e.dispatcher.eventListeners[t].splice(i,1)},e.dispatchEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t)},e.dispatchSocketEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t.msg)},e},c=function(e){var t={};return t.type=e.type,t},d=function(e){var t=c(e);return t.stream=e.stream,t.reason=e.reason,t.msg=e.msg,t},u=function(e){var t=c(e);return t.uid=e.uid,t.attr=e.attr,t.stream=e.stream,t},l=function(e){var t=c(e);return t.msg=e.msg,t},p=function(e){var t=c(e);return t.url=e.url,t.uid=e.uid,t.status=e.status,t.reason=e.reason,t},f=n(3),m=function(){};m.prototype.set=function(e,t){["BatteryLevel"].indexOf(e)>-1&&(this[e]=t)};var g=new function(){var e=s();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.batteryManager=null,e._init=function(t,n){e.state=e.states.INITING,navigator.getBattery?navigator.getBattery().then((function(n){e.batteryManager=n,t&&setTimeout((function(){t()}),0)})).catch((function(e){r.default.debug("navigator.getBattery is disabled",e),t&&t()})):(e.state=e.states.INITED,t&&t())},e._getBatteryStats=function(){var t={};return e.batteryManager&&e.batteryManager.level?t.BatteryLevel=Math.floor(100*e.batteryManager.level):t.BatteryLevel="UNSUPPORTED",t},e.getStats=function(t,n){var i=new m,o=e._getBatteryStats();o&&o.BatteryLevel&&i.set("BatteryLevel",o.BatteryLevel),t&&t(i)},e._init(),e},v=n(4),h=n.n(v),y=function(e){var t=s();return t.url=".",t},S=n(8),b={101100:"NO_FLAG_SET",101101:"FLAG_SET_BUT_EMPTY",101102:"INVALID_FALG_SET",101203:"NO_SERVICE_AVIABLE",0:"OK_CODE",5:"INVALID_VENDOR_KEY",7:"INVALID_CHANNEL_NAME",8:"INTERNAL_ERROR",9:"NO_AUTHORIZED",10:"DYNAMIC_KEY_TIMEOUT",11:"NO_ACTIVE_STATUS",13:"DYNAMIC_KEY_EXPIRED",14:"STATIC_USE_DYANMIC_KEY",15:"DYNAMIC_USE_STATIC_KEY"},I={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},_={1:"ERROR_ILLEAGAL_APPID",2:"ERROR_ILLEAGAL_UID",3:"INTERNAL_SERVER_ERROR"},E=["NO_SERVICE_AVIABLE"],C={19:"ERR_ALREADY_IN_USE",10:"ERR_TIMEDOUT",3:"ERR_NOT_READY",9:"ERR_NO_PERMISSION",0:"UNKNOW_ERROR"},T="INVALID_CLIENT_MODE",w="INVALID_CLIENT_CODEC",R="CLIENT_MODE_CODEC_MISMATCH",A="WEB_API_NOT_SUPPORTED",O="INVALID_PARAMETER",k="INVALID_OPERATION",D="INVALID_LOCAL_STREAM",N="INVALID_REMOTE_STREAM",x="STREAM_ALREADY_PUBLISHED",M="STREAM_NOT_YET_PUBLISHED",P="SOCKET_ERROR",L="SOCKET_DISCONNECTED",V="PEERCONNECTION_FAILED",j="JOIN_CHANNEL_FAILED",F="PUBLISH_STREAM_FAILED",B="SUBSCRIBE_STREAM_FAILED",U="UNSUBSCRIBE_STREAM_FAILED",W="NO_SUCH_REMOTE_STREAM",G="IOS_NOT_SUPPORT",H="WECHAT_NOT_SUPPORT",z="SHARING_SCREEN_NOT_SUPPORT",q="STILL_ON_PUBLISHING",J="LOW_STREAM_ALREADY_PUBLISHED",K="LOW_STREAM_ALREADY_PUBLISHED",Y="HIGH_STREAM_NOT_VIDEO_TRACE",X="NOT_FIND_DEVICE_BY_LABEL",Q="ENABLE_DUALSTREAM_FAILED",$="DISABLE_DUALSTREAM_FAILED",Z="PLAYER_NOT_FOUND",ee="BAD_ENVIRONMENT",te=0,ne=function(e){var t=y();t.id=e.id,t.playerId=te++,t.fit=e.options&&e.options.fit,"contain"!==t.fit&&"cover"!==t.fit&&(t.fit=null),t.url=e.url,t.stream=e.stream.stream,t.elementID=e.elementID,t.setAudioOutput=function(e,n,i){var o=t.video||t.audio;return o?o.setSinkId?void o.setSinkId(e).then((function(){return r.default.debug("["+t.id+"] "+"video ".concat(t.id," setAudioOutput ").concat(e," SUCCESS")),o==t.video&&t.audio?t.audio.setSinkId(e):Promise.resolve()})).then((function(){return r.default.debug("["+t.id+"] "+"audio ".concat(t.id," setAudioOutput ").concat(e," SUCCESS")),n&&n()})).catch((function(e){return r.default.error("["+t.id+"] VideoPlayer.setAudioOutput",e),i&&i(e)})):(r.default.error("["+t.id+"] ",A),i&&i(A)):(r.default.error("["+t.id+"] ",Z),i&&i(Z))},t.destroy=function(){r.default.debug("destroy ".concat(e.stream.local?"local":"remote"," Player ").concat(t.id)),Object(S.setSrcObject)(t.video,null),Object(S.setSrcObject)(t.audio,null),t.video.pause(),delete t.resizer,clearInterval(t.mediaPlayerTimer),t.mediaPlayerTimer=null,document.getElementById(t.div.id)&&t.parentNode.contains(t.div)&&t.parentNode.removeChild(t.div),["video","audio"].forEach((function(n){t[n];var i=s[n];clearTimeout(i.playDeferTimeout),i.formerMediaState=null;var o={playerId:t.playerId,stateId:i.stateId+1,playDeferTimeout:null,error:!1,status:"aborted",reason:"stop",updatedAt:Date.now()};s[n]=o;var c={type:"player-status-change",playerId:t.playerId,mediaType:n,status:o.status,reason:o.reason,isErrorState:!1};r.default.debug("Media Player Status Change Triggered by destroy()",c),e.stream.dispatchEvent(c),a.b.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:c,tag:"tracer"})()}))},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),e.stream.video?t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),t.video=document.createElement("video"),t.video.setAttribute("id","video"+t.id),e.stream.local&&!e.stream.screen?e.stream.mirror?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(t.fit||"cover",";")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):e.stream.video?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):e.stream.screen?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"contain")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(t.fit||"cover"));var n={autoplay:!0,muted:!!e.stream.local||!(!f.isSafari()&&"iOS"!==f.getBrowserOS())&&"video_element_muted",playsinline:!0,controls:!(!f.isSafari()&&"iOS"!==f.getBrowserOS()||e.stream.local),volume:null},i=h()({},n,e.options);!0!==i.muted||i.volume||(i.volume=0),i.autoplay&&t.video.setAttribute("autoplay",""),!0!==i.muted&&"video_element_muted"!==i.muted||(t.video.setAttribute("muted",""),t.video.muted=!0),i.playsinline&&t.video.setAttribute("playsinline",""),i.controls&&t.video.setAttribute("controls",""),Number.isFinite(i.volume)&&(t.video.volume=i.volume),t.audio=document.createElement("audio"),t.audio.setAttribute("id","audio"+t.id),i.autoplay&&t.audio.setAttribute("autoplay",""),!0===i.muted&&t.audio.setAttribute("muted",""),!0===i.muted&&(t.audio.muted=!0),i.playsinline&&t.audio.setAttribute("playsinline",""),Number.isFinite(i.volume)&&(t.audio.volume=i.volume),void 0!==t.elementID?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode;var s={video:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()},audio:{playerId:t.playerId,stateId:0,playDeferTimeout:null,error:!1,status:"init",reason:null,updatedAt:Date.now()}};t.mediaElemExists=function(e){for(var t=e,n=0;n<Object(o.getParameter)("MEDIA_ELEMENT_EXISTS_DEPTH")&&t;n++)t=t.parentNode;return!!t};var c=function(e){return t.mediaElemExists(e)?e.paused?"paused":"play":"aborted"},d=function(e,t,n){var i=c(e),o=!0;return"paused"===i?("audio"===t&&!0===n.muted&&(o=!1),n.autoplay||(o=!1)):"play"===i?"video"===t?o=!1:!0===n.muted?e.muted&&(o=!1):e.muted||(o=!1):"aborted"===i&&(o=!1),o},u=function(n){var u,l=this;if(l===t.video?u="video":l===t.audio&&(u="audio"),u){n.type||r.default.error("Unexpected evt",n);var p=c(l);clearTimeout(s[u].playDeferTimeout),s[u].playDeferTimeout=setTimeout((function(){s[u].playDeferTimeout=null;var o=s[u],f=c(l);if(p===f){var m={playerId:t.playerId,stateId:o.stateId+1,playDeferTimeout:null,error:d(l,u,i),status:c(l),reason:n.type,updatedAt:Date.now()};if(o.status!==m.status){s[u]=m;var g={type:"player-status-change",playerId:t.playerId,mediaType:u,status:m.status,reason:m.reason,isErrorState:m.error};r.default.debug("Media Player Status Change",g),e.stream.dispatchEvent(g),a.b.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:g,tag:"tracer"})()}}else r.default.debug("Status Change after event Triggered."+"Stream ".concat(t.id," PlayerId ").concat(t.playerId," mediaType ").concat(u," Status ").concat(p,"=>").concat(f))}),Object(o.getParameter)("PLAYER_STATE_DEFER"))}else r.default.error("Unknown media element",l)};if(t.mediaPlayerTimer=setInterval((function(){["video","audio"].forEach((function(n){var o=t[n],u=s[n];if(!u.playDeferTimeout){var l={playerId:t.playerId,stateId:u.stateId+1,playDeferTimeout:null,error:d(o,n,i),status:c(o),reason:"timer",updatedAt:Date.now()};if(u.status!==l.status){r.default.debug("Player ".concat(t.playerId," ").concat(n," Status Changed Detected by Timer: ").concat(u.status,"=>").concat(l.status)),s[n]=l;var p={type:"player-status-change",playerId:t.playerId,mediaType:n,status:l.status,reason:l.reason,isErrorState:l.error};r.default.debug("Media Player Status Change",p),e.stream.dispatchEvent(p),a.b.reportApiInvoke(e.stream.sid,{name:"Stream.playerStatusChange",options:p,tag:"tracer"})()}}}))}),Object(o.getParameter)("PLAYER_STATE_DEFER")),t.video.addEventListener("playing",(function(e){!function e(){t.video.videoWidth*t.video.videoHeight>4?r.default.debug("["+t.id+"] video dimensions:",t.video.videoWidth,t.video.videoHeight):setTimeout(e,50)}()})),t.video.addEventListener("playing",u),t.video.addEventListener("canplay",u),t.video.addEventListener("abort",u),t.video.addEventListener("onerror",u),t.video.addEventListener("suspend",u),t.video.addEventListener("stalled",u),t.video.addEventListener("pause",u),t.audio.addEventListener("playing",u),t.audio.addEventListener("canplay",u),t.audio.addEventListener("abort",u),t.audio.addEventListener("onerror",u),t.audio.addEventListener("suspend",u),t.audio.addEventListener("stalled",u),t.audio.addEventListener("pause",u),e.stream.hasVideo()||e.stream.hasScreen())t.div.appendChild(t.video),t.div.appendChild(t.audio),f.isEdge()?t.video.srcObject=e.stream.stream:(Object(S.attachMediaStream)(t.video,e.stream.stream),Object(S.attachMediaStream)(t.audio,e.stream.stream));else if(!1!==i.muted&&"video_element_muted"!==i.muted||(t.video.removeAttribute("muted"),t.video.muted=!1),t.div.appendChild(t.video),window.MediaStream&&f.isSafari()){var l=new MediaStream(e.stream.stream.getAudioTracks());Object(S.setSrcObject)(t.video,l)}else Object(S.setSrcObject)(t.video,e.stream.stream);return t.setAudioVolume=function(e){var n=parseInt(e)/100;isFinite(n)&&(n<0?n=0:n>1&&(n=1),t.video&&(t.video.volume=n),t.audio&&(t.audio.volume=n))},t},ie=n(13),oe=n.n(ie),re=null,ae=function(){try{re=window.require("electron")}catch(e){}return re},se=function(e){var t=a.b.reportApiInvoke(null,{callback:e,name:"getScreenSources",options:arguments,tag:"tracer"}),n=ae();if(!n)return t&&t("electron is null");n.desktopCapturer.getSources({types:["window","screen"]},(function(e,n){if(e)return t&&t(e);t&&t(null,n)}))},ce=function(e,t,n){var i=t.width;t={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:t.height,maxWidth:i,maxFrameRate:t.frameRate&&t.frameRate.max,minFrameRate:t.frameRate&&t.frameRate.min}}},navigator.webkitGetUserMedia(t,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}))},de=se,ue=ce,le=103,pe=function(e){var t={};if(t.clientId=e.clientId,e.session_id=le+=1,"undefined"==typeof window||!window.navigator)throw r.default.error("["+t.streamId+"]["+t.clientId+"]Publish/subscribe video/audio streams not supported yet"),new Error("NON_BROWSER_ENV_DETECTED");return null!==window.navigator.userAgent.match("Firefox")?(t.browser="mozilla",t=function(e){var t={},n=(mozRTCPeerConnection,mozRTCSessionDescription),i=!1;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.filterStatsCache=[],t.originStatsCache=[],t.lastTimeGetStats=null,t.pc_config={iceServers:[]},e.iceServers instanceof Array?e.iceServers.map((function(e){0===e.url.indexOf("stun:")&&t.pc_config.iceServers.push({url:e.url})})):(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay"))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0},t.roapSessionId=103,t.peerConnection=new S.RTCPeerConnection(t.pc_config),r.default.debug("["+t.clientId+']safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.iceCandidateTimer=setTimeout((function(){t.iceCandidateTimer=null,r.default.debug("[".concat(t.clientId,"]Candidates collected: ").concat(t.iceCandidateCount)),t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),Object(o.getParameter)("CANDIDATE_TIMEOUT")),t.peerConnection.onicecandidate=function(e){var n,i,o,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),null===i&&null===o&&null===a||void 0!==t.ice||!t.iceCandidateTimer||(r.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+o),clearTimeout(t.iceCandidateTimer),t.iceCandidateTimer=null,t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},t.checkMLineReverseInSDP=function(e){return!(!~e.indexOf("m=audio")||!~e.indexOf("m=video"))&&e.indexOf("m=audio")>e.indexOf("m=video")},t.reverseMLineInSDP=function(e){var t=e.split("m=audio"),n=t[1].split("m=video"),i="m=video"+n[1],o="m=audio"+n[0];return t[0]+i+o},t.processSignalingMessage=function(e){var i,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(o.sdp=l(o.sdp),i={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){r.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){r.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?(o.sdp=l(o.sdp),o.sdp=o.sdp.replace(/ generation 0/g,""),o.sdp=o.sdp.replace(/ udp /g," UDP "),-1!==o.sdp.indexOf("a=group:BUNDLE")?(o.sdp=o.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),o.sdp=o.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),o.sdp=o.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(o.sdp=o.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),o.sdp=o.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),i={sdp:o.sdp,type:"answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){r.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){r.default.info("["+t.clientId+"]setRemoteDescription failed: "+e)})),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(i={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){r.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){r.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)}))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(i={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){r.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){r.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))};var a={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},s={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},c={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},d={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},u=0;t.getVideoRelatedStats=function(e){t.peerConnection.getStats().then((function(n){var i=!0,o=!1,r=void 0;try{for(var a,s=n.values()[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;if(t.isSubscriber){if(("inbound-rtp"===c.type||"inboundrtp"===c.type)&&"video"===c.mediaType){if(!t.lastReport)return void(t.lastReport=c);e&&e({browser:"firefox",mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:c.framerateMean+"",frameRateDecoded:c.framesDecoded-t.lastReport.framesDecoded+"",bytesReceived:c.bytesReceived+"",packetsReceived:c.packetsReceived+"",packetsLost:c.packetsLost+""}),t.lastReport=c}}else if(("outbound-rtp"===c.type||"outboundrtp"===c.type)&&"video"===c.mediaType){if(!t.lastReport)return void(t.lastReport=c);e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:c.framerateMean+"",frameRateSent:c.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=c}}}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){var i=!0,o=!1,r=void 0;try{for(var a,s=n.values()[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;t.isSubscriber&&("inbound-rtp"!==c.type&&"inboundrtp"!==c.type||"audio"!==c.mediaType||e&&e({browser:"firefox",mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:c.packetsLost+"",frameReceived:c.packetsReceived+"",googJitterReceived:c.jitter+"",bytesReceived:c.bytesReceived+"",packetsReceived:c.packetsReceived+"",packetsLost:c.packetsLost+""}))}}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){"inbound-rtp"!==e.type&&"inboundrtp"!==e.type||"video"!==e.mediaType||e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-u)/3).toString(),u=e.googFramesDecoded)})),e(t)}))},t.getStats=function(e,n){n=(n=n||500)>500?500:n,t.lastTimeGetStats&&Date.now()-t.lastTimeGetStats<n?e&&e(t.filterStatsCache,t.originStatsCache):this._getStats((function(n,i){t.filterStatsCache=n,t.originStatsCache=i,t.lastTimeGetStats=Date.now(),e&&e(n,i)}))},t._getStats=function(e){t.peerConnection.getStats().then((function(n){var i=[],o=!0,r=!1,u=void 0;try{for(var l,p=n.values()[Symbol.iterator]();!(o=(l=p.next()).done);o=!0){var f=l.value;i.push(f),"outbound-rtp"!==f.type&&"outboundrtp"!==f.type||"video"!==f.mediaType||-1!==f.id.indexOf("rtcp")||(s.id=f.id,s.type=f.type,s.mediaType=f.mediaType,s.bytesSent=f.bytesSent?f.bytesSent+"":"0",s.packetsSent=f.packetsSent?f.packetsSent+"":"0",s.googPlisReceived=f.pliCount?f.pliCount+"":"0",s.googNacksReceived=f.nackCount?f.nackCount+"":"0",s.googFirsReceived=f.firCount?f.firCount+"":"0",s.googFrameRateSent=f.framerateMean?f.framerateMean+"":"0"),"outbound-rtp"!==f.type&&"outboundrtp"!==f.type||"audio"!==f.mediaType||-1!==f.id.indexOf("rtcp")||(a.id=f.id,a.type=f.type,a.mediaType=f.mediaType,a.bytesSent=f.bytesSent?f.bytesSent+"":"0",a.packetsSent=f.packetsSent?f.packetsSent+"":"0"),"inbound-rtp"!==f.type&&"inboundrtp"!==f.type||"audio"!==f.mediaType||f.isRemote||-1!==f.id.indexOf("rtcp")||(c.id=f.id,c.type=f.type,c.mediaType=f.mediaType,c.bytesReceived=f.bytesReceived?f.bytesReceived+"":"0",c.packetsLost=f.packetsLost?f.packetsLost+"":"0",c.packetsReceived=f.packetsReceived?f.packetsReceived+"":"0",c.googJitterReceived=f.jitter?f.jitter+"":"0"),"inbound-rtp"!==f.type&&"inboundrtp"!==f.type||"video"!==f.mediaType||f.isRemote||-1!==f.id.indexOf("rtcp")||(d.id=f.id,d.type=f.type,d.mediaType=f.mediaType,d.bytesReceived=f.bytesReceived?f.bytesReceived+"":"0",d.googFrameRateReceived=f.framerateMean?f.framerateMean+"":"0",d.googFramesDecoded=f.framesDecoded?f.framesDecoded+"":"0",d.packetsLost=f.packetsLost?f.packetsLost+"":"0",d.packetsReceived=f.packetsReceived?f.packetsReceived+"":"0",d.googJitterBufferMs=f.jitter?f.jitter+"":"0",d.googNacksSent=f.nackCount?f.nackCount+"":"0",d.googPlisSent=f.pliCount?f.pliCount+"":"0",d.googFirsSent=f.firCount?f.firCount+"":"0"),-1!==f.id.indexOf("outbound_rtcp_video")&&(s.packetsLost=f.packetsLost?f.packetsLost+"":"0")}}catch(e){r=!0,u=e}finally{try{o||null==p.return||p.return()}finally{if(r)throw u}}var m=[s,a,c,d];m.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(m,i)}),(function(e){r.default.error("["+t.clientId+"]"+e)}))},t.addStream=function(e){i=!0,t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)i&&(t.mediaConstraints=void 0),t.peerConnection.createOffer((function(e){if(e.sdp=l(e.sdp),e.sdp=e.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("["+t.clientId+"]Not sending a new offer")}),(function(e){r.default.debug("["+t.clientId+"]Ups! create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.offerCandidates=t.prevOffer.match(/a=candidate.+\r\n/g)||[],t.offerCandidates.length||(r.default.warning("[".concat(t.clientId,"]No Ice Candidate generated")),Object(o.getParameter)("SHIM_CANDIDATE")?(r.default.debug("Shimming fake candidate"),t.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):r.default.error("[".concat(t.clientId,"]None Ice Candidate not allowed"))),t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(){r.default.debug("["+t.clientId+"]Ups! Something went wrong")}));else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;var e=t.peerConnection.localDescription.sdp;t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var l=function(t){var n;if(e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0)){var i=n[0]+"b=TIAS:"+1e3*e.maxVideoBW+"\r\n";t=t.replace(n[0],i)}return e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0)&&(i=n[0]+"b=TIAS:"+1e3*e.maxAudioBW+"\r\n",t=t.replace(n[0],i)),t};return t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e)):"iOS"===f.getBrowserOS()||f.isSafari()?(r.default.debug("["+t.streamId+"]["+t.clientId+"]Safari"),(t=function(e){var t={},n=S.RTCPeerConnection;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.filterStatsCache=[],t.originStatsCache=[],t.lastTimeGetStats=null,t.pc_config={iceServers:[{urls:["stun:webcs.agora.io:3478","stun:stun.l.google.com:19302"]}],bundlePolicy:"max-bundle"},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map((function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,url:e.url})})):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:["turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"]}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:["turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"]}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103;try{t.pc_config.sdpSemantics="plan-b",t.peerConnection=new n(t.pc_config,t.con)}catch(e){delete t.pc_config.sdpSemantics,t.peerConnection=new n(t.pc_config,t.con)}r.default.debug("["+t.clientId+']safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.iceCandidateTimer=setTimeout((function(){t.iceCandidateTimer=null,r.default.debug("[".concat(t.clientId,"]Candidates collected: ").concat(t.iceCandidateCount)),t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),Object(o.getParameter)("CANDIDATE_TIMEOUT")),t.peerConnection.onicecandidate=function(e){var n,i,o,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout((function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),1e3)),null===i&&null===o&&null===a||void 0!==t.ice||!t.iceCandidateTimer||(r.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+o),clearTimeout(t.iceCandidateTimer),t.iceCandidateTimer=null,t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1};var i=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},a=function(n){var i,o;return(i=n.match(/m=video.*\r\n/))&&e.minVideoBW&&e.maxVideoBW&&(o=i[0]+"b=AS:"+e.maxVideoBW+"\r\n",n=n.replace(i[0],o),r.default.debug("["+t.clientId+"]Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),(i=n.match(/m=audio.*\r\n/))&&e.maxAudioBW&&(o=i[0]+"b=AS:"+e.maxAudioBW+"\r\n",n=n.replace(i[0],o)),n};t.processSignalingMessage=function(e){var n,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=a(n.sdp),n.sdp=n.sdp.replace(/a=x-google-flag:conference\r\n/g,""),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(n={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))};var s={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},c={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},d={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},u={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},l={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},p=0,f=0,m=0;return t.getVideoRelatedStats=function(n){t.peerConnection.getStats().then((function(i){var o={peerId:t.uid,mediaType:"video",isVideoMute:t.isVideoMute};i.forEach((function(i){if(t.isSubscriber){if("track"===i.type&&(~i.id.indexOf("video")||~i.trackIdentifier.indexOf("v"))){if(!t.lastReport)return void(t.lastReport=i);o.frameRateReceived=i.framesReceived-t.lastReport.framesReceived+"",o.frameRateDecoded=i.framesDecoded-t.lastReport.framesDecoded+"",t.lastReport=i}"inbound-rtp"===i.type&&~i.id.indexOf("Video")&&(o.bytesReceived=i.bytesReceived+"",o.packetsReceived=i.packetsReceived+"",o.packetsLost=i.packetsLost+"")}else if("outbound-rtp"===i.type&&~i.id.indexOf("Video")){if(!t.lastReport)return void(t.lastReport=i);n&&n({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:e.maxFrameRate+"",frameRateSent:i.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=i}})),n&&n(o)}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){n.forEach((function(n){t.isSubscriber&&"inbound-rtp"===n.type&&~n.id.indexOf("Audio")&&e&&e({peerId:t.uid,mediaType:"audio",isAudioMute:t.isAudioMute,frameDropped:n.packetsLost+"",frameReceived:n.packetsReceived+"",googJitterReceived:n.jitter+"",bytesReceived:n.bytesReceived+"",packetsReceived:n.packetsReceived+"",packetsLost:n.packetsLost+""})}))}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){"outbound-rtp"===e.type&&"video"===e.mediaType&&e.googFramesEncoded&&(e.googFrameRateSent=((e.googFramesEncoded-p)/3).toString(),p=e.googFramesEncoded),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(e.googFrameRateReceived&&(e.googFrameRateReceived=((e.googFrameReceived-m)/3).toString(),m=e.googFrameReceived),e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-f)/3).toString(),f=e.googFramesDecoded))})),e(t)}))},t.getStats=function(e,n){n=(n=n||500)>500?500:n,t.lastTimeGetStats&&Date.now()-t.lastTimeGetStats<n?e&&e(t.filterStatsCache,t.originStatsCache):this._getStats((function(n,i){t.filterStatsCache=n,t.originStatsCache=i,t.lastTimeGetStats=Date.now(),e&&e(n,i)}))},t._getStats=function(e){var n=[];t.peerConnection.getStats().then((function(i){i.forEach((function(e){n.push(e),"outbound-rtp"===e.type&&"audio"===e.mediaType&&(s.id=e.id,s.type=e.type,s.mediaType=e.mediaType,s.bytesSent=e.bytesSent?e.bytesSent+"":"0",s.packetsSent=e.packetsSent?e.packetsSent+"":"0"),"outbound-rtp"===e.type&&"video"===e.mediaType&&(c.id=e.id,c.type=e.type,c.mediaType=e.mediaType,c.bytesSent=e.bytesSent?e.bytesSent+"":"0",c.packetsSent=e.packetsSent?e.packetsSent+"":"0",c.googPlisReceived=e.pliCount?e.pliCount+"":"0",c.googNacksReceived=e.nackCount?e.nackCount+"":"0",c.googFirsReceived=e.firCount?e.firCount+"":"0",c.googFramesEncoded=e.framesEncoded?e.framesEncoded+"":"0"),"inbound-rtp"===e.type&&-1!=e.id.indexOf("44444")&&(d.id=e.id,d.type=e.type,d.mediaType="audio",d.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",d.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",d.packetsLost=e.packetsLost?e.packetsLost+"":"0",d.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",d.googJitterReceived=e.jitter?e.jitter+"":"0"),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(u.id=e.id,u.type=e.type,u.mediaType="video",u.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",u.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",u.packetsLost=e.packetsLost?e.packetsLost+"":"0",u.googJitterBufferMs=e.jitter?e.jitter+"":"0",u.googNacksSent=e.nackCount?e.nackCount+"":"0",u.googPlisSent=e.pliCount?e.pliCount+"":"0",u.googFirsSent=e.firCount?e.firCount+"":"0"),"track"!==e.type||-1==e.id.indexOf("55543")&&!~e.trackIdentifier.indexOf("v")&&null!=e.audioLevel||(u.googFrameWidthReceived=e.frameWidth?e.frameWidth+"":"0",u.googFrameHeightReceived=e.frameHeight?e.frameHeight+"":"0",u.googFrameReceived=e.framesReceived?e.framesReceived+"":"0",u.googFramesDecoded=e.framesDecoded?e.framesDecoded+"":"0"),"track"!==e.type||-1==e.id.indexOf("44444")&&!~e.trackIdentifier.indexOf("a")&&void 0===e.audioLevel||(d.audioOutputLevel=e.audioLevel+"",s.audioInputLevel=e.audioLevel+""),"candidate-pair"===e.type&&(0==e.availableIncomingBitrate?l.googAvailableSendBandwidth=e.availableOutgoingBitrate+"":l.googAvailableReceiveBandwidth=e.availableIncomingBitrate+"")}));var o=[l,s,c,d,u];o.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(o,n)})).catch((function(e){console.error(e)}))},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){var i=t.peerConnection.getSenders().find((function(t){return t.track==e}));i.replaceTrack(null),t.peerConnection.removeTrack(i)},t.addStream=function(e){window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?e.getTracks().forEach((function(n){return t.peerConnection.addTrack(n,e)})):t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var n;if(t.actionNeeded){if("new"===t.state||"established"===t.state)e.isSubscriber&&(t.peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.peerConnection.addTransceiver("video",{direction:"recvonly"})),t.peerConnection.createOffer(t.mediaConstraints).then((function(n){if(n.sdp=a(n.sdp),e.isSubscriber||(n.sdp=n.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\r\n/g,"")),n.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(n),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("["+t.clientId+"]Not sending a new offer")})).catch((function(e){r.default.debug("["+t.clientId+"]peer connection create offer failed ",e)}));else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.offerCandidates=t.prevOffer.match(/a=candidate.+\r\n/g)||[],t.offerCandidates.length||(r.default.warning("[".concat(t.clientId,"]No Ice Candidate generated")),Object(o.getParameter)("SHIM_CANDIDATE")?(r.default.debug("Shimming fake candidate"),t.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):r.default.error("[".concat(t.clientId,"]None Ice Candidate not allowed"))),t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){r.default.debug("["+t.clientId+"]peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;n=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",n),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.renegotiate=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then((function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),e.sdp=i(e.sdp),e.sdp=a(e.sdp),t.peerConnection.setLocalDescription(e)})).then((function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)})).catch((function(e){console.log("createOffer error: ",e)}))},t.peerConnection.onnegotiationneeded=t.renegotiate,t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e)).browser="safari"):~window.navigator.userAgent.indexOf("Edge")?t=new oe.a(e):(t=function(e){var t={},n=S.RTCPeerConnection;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.filterStatsCache=[],t.originStatsCache=[],t.lastTimeGetStats=null,t.pc_config={iceServers:[{url:"stun:webcs.agora.io:3478"}]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map((function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,url:e.url})})):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103;try{t.pc_config.sdpSemantics="plan-b",t.peerConnection=new n(t.pc_config,t.con)}catch(e){delete t.pc_config.sdpSemantics,t.peerConnection=new n(t.pc_config,t.con)}t.iceCandidateTimer=setTimeout((function(){t.iceCandidateTimer=null,r.default.debug("[".concat(t.clientId,"]Candidates collected: ").concat(t.iceCandidateCount)),t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),Object(o.getParameter)("CANDIDATE_TIMEOUT")),t.peerConnection.onicecandidate=function(e){var n,i,o,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),o=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),null===i&&null===o&&null===a||void 0!==t.ice||!t.iceCandidateTimer||(r.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+o),clearTimeout(t.iceCandidateTimer),t.iceCandidateTimer=null,t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},r.default.debug("["+t.clientId+']Created webkitRTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".');var i=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},a=function(n){var i,o;if((i=n.match(/m=video.*\r\n/))&&e.minVideoBW&&e.maxVideoBW){o=i[0]+"b=AS:"+e.maxVideoBW+"\r\n";var a=0,s=0;"h264"===e.codec?(a=n.search(/a=rtpmap:(\d+) H264\/90000\r\n/),s=n.search(/H264\/90000\r\n/)):"vp8"===e.codec&&(a=n.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),s=n.search(/VP8\/90000\r\n/)),-1!==a&&-1!==s&&s-a>10&&(o=o+"a=fmtp:"+n.slice(a+9,s-1)+" x-google-min-bitrate="+e.minVideoBW+"\r\n"),n=n.replace(i[0],o),r.default.debug("["+t.clientId+"]Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)}return(i=n.match(/m=audio.*\r\n/))&&e.maxAudioBW&&(o=i[0]+"b=AS:"+e.maxAudioBW+"\r\n",n=n.replace(i[0],o)),n};return t.processSignalingMessage=function(e){var n,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(n={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=a(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))},t.getVideoRelatedStats=function(e){t.peerConnection.getStats((function(n){Object.keys(n).forEach((function(i){var o=n[i];t.isSubscriber?"video"===o.mediaType&&o.id&&~o.id.indexOf("recv")&&e&&e({mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:o.googFrameRateReceived,frameRateDecoded:o.googFrameRateDecoded,bytesReceived:o.bytesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost}):"video"===o.mediaType&&o.id&&~o.id.indexOf("send")&&e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:o.googFrameRateInput,frameRateSent:o.googFrameRateSent,googRtt:o.googRtt})}))}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats((function(n){Object.keys(n).forEach((function(i){var o=n[i];t.isSubscriber&&"audio"===o.mediaType&&o.id&&~o.id.indexOf("recv")&&e&&e({mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:parseInt(o.googDecodingPLC)+parseInt(o.googDecodingPLCCNG)+"",frameReceived:o.googDecodingCTN,googJitterReceived:o.googJitterReceived,bytesReceived:o.bytesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost})}))}))},t.getStatsRate=function(e){t.getStats((function(t){e(t)}))},t.getStats=function(e,n){n=(n=n||500)>500?500:n,t.lastTimeGetStats&&Date.now()-t.lastTimeGetStats<n?e&&e(t.filterStatsCache,t.originStatsCache):this._getStats((function(n,i){t.filterStatsCache=n,t.originStatsCache=i,t.lastTimeGetStats=Date.now(),e&&e(n,i)}))},t._getStats=function(e){t.peerConnection.getStats((function(n){var i=[],o=[],r=null;Object.keys(n).forEach((function(e){var t=n[e];o.push(t),"ssrc"!==t.type&&"VideoBwe"!==t.type||(r=t.timestamp,i.push(t))})),i.push({id:"time",startTime:t.connectedTime,timestamp:r||new Date}),e(i,o)}))},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){t.peerConnection.removeTrack(t.peerConnection.getSenders().find((function(t){return t.track==e})))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var e;if(t.actionNeeded){if("new"===t.state||"established"===t.state)t.peerConnection.createOffer((function(e){if(e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();r.default.debug("["+t.clientId+"]Not sending a new offer")}),(function(e){r.default.debug("["+t.clientId+"]peer connection create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.offerCandidates=t.prevOffer.match(/a=candidate.+\r\n/g)||[],t.offerCandidates.length||(r.default.warning("[".concat(t.clientId,"]No Ice Candidate generated")),Object(o.getParameter)("SHIM_CANDIDATE")?(r.default.debug("Shimming fake candidate"),t.prevOffer+="a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"):r.default.error("[".concat(t.clientId,"]None Ice Candidate not allowed"))),t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;r.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){r.default.debug("["+t.clientId+"]peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;e=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&(t.onaddstream(e,"ontrack"),t.peerConnection.onaddstream=null)},t.peerConnection.onaddstream=function(e){t.onaddstream&&(t.onaddstream(e,"onaddstream"),t.peerConnection.ontrack=null)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.renegotiate=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then((function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),e.sdp=i(e.sdp),e.sdp=a(e.sdp),t.peerConnection.setLocalDescription(e)})).then((function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)})).catch((function(e){console.log("createOffer error: ",e)}))},t.peerConnection.onnegotiationneeded=t.renegotiate,t.onaddstream=null,t.onremovestream=null,t.onnegotiationneeded=null,t.state="new",t.markActionNeeded(),t}(e)).browser="chrome-stable",t},fe=function(e,t,n){var i={};i.config=e,i.streamId=e.streamId,delete e.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var o=0,a=1,s=!1,c=null,d=function(e){if(o++,c)if(c===e)r.default.debug("Using Video Source/ Audio Source");else{var n=c.getVideoTracks()[0],i=c.getAudioTracks()[0],d=e.getVideoTracks()[0],u=e.getAudioTracks()[0];d&&(n&&c.removeTrack(n),c.addTrack(d)),u&&(i&&c.removeTrack(i),c.addTrack(u))}else c=e;o!==a||s||(s=!0,setTimeout((function(){t(c)}),0))},u=function(e){r.default.error("Failed to GetUserMedia",e.name,e.code,e.message,e),o++,s||(s=!0,setTimeout((function(){n&&n(e)}),0))},l=function(){var t={video:e.video,audio:e.audio};if(r.default.debug("GetUserMedia",JSON.stringify(t)),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)navigator.mediaDevices.getUserMedia(t).then(d).catch(u);else if("undefined"!=typeof navigator&&navigator.getMedia)navigator.getMedia(e,d,u);else{var o={name:"MEDIA_NOT_SUPPORT",message:"Video/audio streams not supported yet"};r.default.error("["+i.streamId+"]"+o.message),n&&n(o)}};if((e.videoSource||e.audioSource)&&(c=new MediaStream,e.videoSource&&c.addTrack(e.videoSource),e.audioSource&&c.addTrack(e.audioSource)),e.video||e.audio||e.screen)if(e.screen){if(ae())return e.screen.sourceId?ue(e.screen.sourceId,e.screen,(function(e,t){e?u(e):d(t)})):function(e,t){se((function(n,i){if(n)return t&&t(n);!function(e,t){var n=document.createElement("div");n.innerText="share screen",n.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var r=document.createElement("div");r.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");var s=document.createElement("button");s.innerHTML="cancel",s.setAttribute("style","width: 85px;"),s.onclick=function(){document.body.removeChild(c),t&&t("NotAllowedError")},a.appendChild(s),i.appendChild(o),i.appendChild(r),i.appendChild(a);var c=document.createElement("div");c.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),c.appendChild(n),c.appendChild(i),document.body.appendChild(c),e.map((function(e){if(e.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+e.thumbnail.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</span>",n.onclick=function(){document.body.removeChild(c),t&&t(null,e.id)},r.appendChild(n)}}))}(i,(function(n,i){if(n)return t&&t(n);ce(i,e,t)}))}))}(e.screen,(function(e,t){e?u(e):d(t)}));if(f.isFireFox()){if(r.default.debug("["+i.streamId+"]Screen access requested"),!~["screen","window","application"].indexOf(e.screen.mediaSource))return n&&n("Invalid mediaSource, mediaSource should be one of [screen, window, application]");navigator.getMedia({video:e.screen},(function(t){e.audio&&(a++,l()),d(t)}),u)}else if(f.isChrome()&&e.screen.extensionId){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void n({code:"This browser does not support screen sharing"});r.default.debug("["+i.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(e.screen.extensionId,{getStream:!0},(function(t){void 0===t?(r.default.error("["+i.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),u({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})):(e.screen.mandatory.chromeMediaSourceId=t.streamId,navigator.getMedia({video:e.screen},(function(t){e.audio&&(a++,l()),d(t)}),u))}))}catch(e){return r.default.debug("["+i.streamId+"]AgoraRTC screensharing plugin is not accessible"),void n({code:"no_plugin_present"})}}else{if(window.navigator.mediaDevices.getDisplayMedia){var p={};return"number"==typeof e.screen.width&&"number"==typeof e.screen.height?p.video={width:{ideal:e.screen.width},height:{ideal:e.screen.height}}:p.video={width:e.screen.width,height:e.screen.height},e.screen.frameRate&&e.screen.frameRate.min?p.video.frameRate={ideal:e.screen.frameRate.max,max:e.screen.frameRate.max}:p.video.frameRate=e.screen.frameRate,r.default.debug("use getDisplayMedia, constraints:",p),window.navigator.mediaDevices.getDisplayMedia(p).then((function(t){e.audio&&(a++,l()),d(t)})).catch(u)}r.default.error("["+i.streamId+"]This browser does not support screenSharing")}}else l();else d(c)},me=n(7),ge=function(e,t,n){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight"].indexOf(t)>-1&&("string"==typeof n||isFinite(n)))return e[t]=""+n},ve=new function(){var e=s();return e.devicesHistory={},e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},e.deviceReloadTimer=null,e._init=function(t,n){e.state=e.states.INITING,e.devicesHistory={},e._reloadDevicesInfo((function(){e.state=e.states.INITED,e.dispatchEvent({type:"inited"}),t&&t()}),(function(t){r.default.warning("Device Detection functionality cannot start properly."),e.state=e.states.UNINIT,n&&n(t)}))},e._enumerateDevices=function(e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return r.default.warning("enumerateDevices() not supported."),t&&t("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then((function(t){e&&setTimeout((function(){e(t)}),0)})).catch((function(e){t&&t(e)}))},e._reloadDevicesInfo=function(t,n){var i=[];e._enumerateDevices((function(n){var o=Date.now();for(var a in n.forEach((function(t){var n=e.devicesHistory[t.deviceId];if((n?n.state:e.deviceStates.INACTIVE)!=e.deviceStates.ACTIVE){var r=n||{initAt:o};r.device=t,r.state=e.deviceStates.ACTIVE,i.push(r),e.devicesHistory[t.deviceId]=r}e.devicesHistory[t.deviceId].lastReloadAt=o})),e.devicesHistory){var s=e.devicesHistory[a];s&&s.state==e.deviceStates.ACTIVE&&s.lastReloadAt!==o&&(s.state=e.deviceStates.INACTIVE,i.push(s)),s.lastReloadAt=o}e.state==e.states.INITED&&i.forEach((function(t){var n=h()({},t);switch(t.device.kind){case"audioinput":n.type="recordingDeviceChanged";break;case"audiooutput":n.type="playoutDeviceChanged";break;case"videoinput":n.type="cameraChanged";break;default:r.default.warning("Unknown device change",n),n.type="unknownDeviceChanged"}e.dispatchEvent(n)})),t&&t()}),n)},e.getDeviceById=function(t,n,i){e.getDevices((function(e){for(var o=0;o<e.length;o++){var r=e[o];if(r&&r.deviceId===t)return n&&n(r)}return i&&i()}))},e.searchDeviceNameById=function(t){var n=e.devicesHistory[t];return n?n.device.label||n.device.deviceId:null},e.getDevices=function(t,n){e._enumerateDevices(t,(function(e){n&&n(e.name+": "+e.message)}))},e.getVideoCameraIdByLabel=function(t,n,i){e.getCameras((function(e){var o=!0,r=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var d=s.value;if(d.label===t)return n&&n(d.deviceId)}}catch(e){r=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}return i&&i(X)}),i)},e.getRecordingDevices=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"audioinput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e.getPlayoutDevices=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"audiooutput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e.getCameras=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"videoinput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e._init((function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",(function(){e._reloadDevicesInfo()})),e.deviceReloadTimer=setInterval(e._reloadDevicesInfo,5e3)})),e},he=n(5),ye=n.n(he),Se=function(e,t,n){for(var i=0;i<n.length;i++)if(e===n[i])return!0;throw new Error("".concat(t," can only be set as ").concat(JSON.stringify(n)))},be=function(e,t){if(!e)throw new Error("Invalid param: ".concat(t||"param"," cannot be empty"));if("object"!==ye()(e))throw new Error("".concat(t||"This paramter"," is of the object type"));return!0},Ie=function(e,t,n,i,o){if(De(n)&&(n=1),i=i||255,De(o)&&(o=!0),De(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!Ce(e,n,i,o))throw new Error("Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))},_e=function(e,t,n,i){if(De(n)&&(n=1),i=i||1e4,De(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!Te(e,n,i))throw new Error("Invalid ".concat(t||"number param",": The value range is [").concat(n,",").concat(i,"]. integer only"))},Ee=function(e,t){if(De(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!we(e))throw new Error("Invalid ".concat(t||"boolean param",": The value is of the boolean type."))},Ce=function(e,t,n,i){return t||(t=0),n||(n=Number.MAX_SAFE_INTEGER),De(i)&&(i=!0),ke(e)&&(!i||Ae(e))&&e.length>=t&&e.length<=n},Te=function(e,t,n){return Oe(e)&&e>=t&&e<=n},we=function(e){return"boolean"==typeof e},Re=function(e){return Ce(e,1,2047)},Ae=function(e){if("string"==typeof e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}},Oe=function(e){return"number"==typeof e&&e%1==0},ke=function(e){return"string"==typeof e},De=function(e){return null==e},Ne=n(12),xe=function(e){Ie(e,"profileName"),-1===(e=e.toLowerCase()).indexOf("_")&&(e+="_1"),Se(e,"profileName",Object.keys(o.SUPPORT_RESOLUTION_LIST));var t=o.SUPPORT_RESOLUTION_LIST[e];t||(e=Object(o.getParameter)("DEFAULT_PROFILE"),t=o.SUPPORT_RESOLUTION_LIST[e]);var n={profileName:e,video:{width:t[0],height:t[1]},attributes:{resolution:"".concat(t[0],"x").concat(t[1]),minFrameRate:t[2],maxFrameRate:t[3],minVideoBW:t[4],maxVideoBW:t[5]}};return t[2]&&t[3]&&(n.video.frameRate={ideal:t[2],max:t[3]}),t[6]&&t[7]&&(n.screen={width:t[0],height:t[1],frameRate:{min:t[6],max:t[7]}}),n},Me=function(e){return Object.keys(o.SUPPORT_RESOLUTION_LIST).filter((function(t){var n=o.SUPPORT_RESOLUTION_LIST[t],i=["width","height","frameRate"];for(var r in i){var a=i[r];if(e[a]&&n[r]){if("number"==typeof e[a].max&&e[a].max<n[r])return!1;if("number"==typeof e[a].min&&e[a].min>n[r])return!1}}return!0})).reverse()},Pe=function(e){var t=o.AUDIO_PROFILE_SETTINGS[e]||o.AUDIO_PROFILE_SETTINGS.default;return{highQuality:t[0],stereo:t[1],speech:t[2],lowQuality:t[3]}},Le=function(e){var t=s();if(t.params=h()({},e),t.stream=e.stream,t.url=e.url,t.onClose=void 0,t.local=!1,t.videoSource=e.videoSource,t.audioSource=e.audioSource,e.video=!(!e.videoSource&&!e.video),t.video=e.video,e.audio=!(!e.audioSource&&!e.audio),t.audio=e.audio,t.screen=!!e.screen,t.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},t.videoSize=e.videoSize,t.player=void 0,t.audioLevelHelper=null,e.attributes=e.attributes||{},t.attributes=e.attributes,t.microphoneId=e.microphoneId,t.cameraId=e.cameraId,t.inSwitchDevice=!1,t.userMuteVideo=!1,t.userMuteAudio=!1,t.peerMuteVideo=!1,t.peerMuteAudio=!1,t.lowStream=null,t.videoWidth=0,t.videoHeight=0,t.streamId=e.streamID,t.userId=null,t.mirror=!1!==e.mirror,t.DTX=e.audioProcessing&&e.audioProcessing.DTX,t.audioProcessing=e.audioProcessing,t.highQuality=!1,t.stereo=!1,t.speech=!1,t.screen||delete t.screen,!(void 0===t.videoSize||t.videoSize instanceof Array&&4===t.videoSize.length))throw Error("Invalid Video Size");function n(){var e={};t.getVideoTrack()===this?(r.default.debug("Video Track Ended"),e.type="videoTrackEnded",e.track=this):t.getAudioTrack()===this?(r.default.debug("Audio Track Ended"),e.type="audioTrackEnded",e.track=this):r.default.debug("Detached Track ended",this.kind,this.label,this),e.type&&t.dispatchEvent(e)}return t.videoSize=[640,480,640,480],void 0!==e.local&&!0!==e.local||(t.local=!0),t.initialized=!t.local,function(e){e.audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},e._initSoundIfNotExists=function(t,n){e.audioMixing.sounds[t]||(e.audioMixing.sounds[t]={soundId:t,state:"IDLE",muted:e.userMuteAudio,filePath:n,volume:e.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},e._initSoundIfNotExists(-1),e.loadAudioBuffer=function(t,n,i){var o=a.b.reportApiInvoke(e.sid,{callback:i,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});Ie(n,"url",1,1024,!1),Ie(t,"id",1,1024,!1);var s=new XMLHttpRequest;s.open("GET",n,!0),s.responseType="arraybuffer",s.onload=function(){if(s.status>400){var n=s.statusText;return r.default.error("[".concat(e.streamId,"] loadAudioBuffer Failed: ")+n),o(n)}var i=s.response;e.audioMixing.audioContextInited||e._initAudioContext(),e.audioMixing.ctx.decodeAudioData(i,(function(n){e.audioMixing.buffer[t]=n,o(null)}),(function(t){r.default.error("[".concat(e.streamId,"] decodeAudioData Failed: "),t),o(t)}))},s.send()},e.createAudioBufferSource=function(t){var n=a.b.reportApiInvoke(e.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(e.audioMixing.buffer[t.id]){var i=e.audioMixing.buffer[t.id],o=e.audioMixing.ctx.createBufferSource();o.buffer=i;var s=e.audioMixing.ctx.createGain();if(o.connect(s),s.connect(e.audioMixing.mediaStreamDest),o.gainNode=s,t.loop)o.loop=!0,o.start(0,t.playTime/1e3);else if(t.cycle>1)if(Object(f.isChrome)()){o.loop=!0;var c=t.cycle*i.duration*1e3-(t.playTime||0);o.start(0,t.playTime/1e3,c/1e3)}else r.default.warning("[".concat(e.streamId,"] Cycle Param is ignored by current browser")),o.start(0,t.playTime/1e3);else o.start(0,t.playTime/1e3);var d=e.audioMixing.sounds[t.soundId];return d.source=o,e._flushAudioMixingMuteStatus(),o.addEventListener("ended",(function(){o===d.source&&e.dispatchEvent({type:"audioSourceEnded",soundId:t.soundId,source:o,sound:d})})),n(),o}return r.default.error("[".concat(e.streamId,"] "),"AUDIOBUFFER_NOT_FOUND",t.id),n(!1),!1},e.on("audioSourceEnded",(function(t){t.source;var n=t.sound;n&&n.state===e.audioMixing.states.BUSY&&!n.pauseAt&&(n.state=e.audioMixing.states.IDLE,n.startAt=null,n.startOffset=null,n.resumeAt=null,n.resumeOffset=null,e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest))})),e.clearAudioBufferSource=function(){e.audioBufferSource.forEach((function(e){e.stop()}))},e._isSoundExists=function(t){return!!e.audioMixing.sounds[t.soundId]||(r.default.error("SoundId not exists. #".concat(t.soundId)),!1)},e._initAudioContext=function(){if(e.audioMixing.audioContextInited)throw new Error("Failed to init audio context. Already inited");if(!e.stream)throw new Error("Failed to init audio context. Local Stream not initialized");e.audioMixing.ctx=Object(Ne.a)(),e.audioMixing.mediaStreamSource=e.audioMixing.ctx.createMediaStreamSource(e.stream),e.audioMixing.mediaStreamDest=e.audioMixing.ctx.createMediaStreamDestination(),e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest);var t=e.stream.getVideoTracks()[0];if(t&&e.audioMixing.mediaStreamDest.stream.addTrack(t),e._isAudioMuted()?(e._unmuteAudio(),e.stream=e.audioMixing.mediaStreamDest.stream,e._muteAudio()):e.stream=e.audioMixing.mediaStreamDest.stream,e.audioLevelHelper=null,e.pc&&e.pc.peerConnection&&e.pc.peerConnection){var n=(e.pc.peerConnection&&e.pc.peerConnection.getSenders()).find((function(e){return e&&e.track&&"audio"==e.track.kind})),i=e.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];n&&n.replaceTrack&&i&&n.replaceTrack(i)}e.audioMixing.audioContextInited=!0},e._cleanupAudioMixing=function(){if(e.audioMixing.audioContextInited){for(var t in e.audioMixing.sounds){var n=e.audioMixing.sounds[t];n.state!==e.audioMixing.states.BUSY&&n.state!==e.audioMixing.states.PAUSED||e._stopOneEffect({soundId:t})}e.audioLevelHelper=null,e.audioMixing.audioContextInited=!1}},e._reloadInEarMonitoringMode=function(t){if(t){if(!e.audioMixing.inEarMonitoringModes[t])return r.default.error("[".concat(e.streamId,"] Invalid InEarMonitoringMode ").concat(t));e.audioMixing.inEarMonitoring=t}switch(e.audioMixing.audioContextInited||e._initAudioContext(),e.audioMixing.inEarMonitoring){case e.audioMixing.inEarMonitoringModes.FILE:e.audioMixing.mediaStreamSource.connectedToDestination&&(e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.ctx.destination),e.audioMixing.mediaStreamSource.connectedToDestination=!1);case e.audioMixing.inEarMonitoringModes.ALL:for(var n in e.audioMixing.sounds){var i=e.audioMixing.sounds[n];i&&i.source&&!i.source.connectedToDestination&&(i.source.gainNode.connect(e.audioMixing.ctx.destination),i.source.connectedToDestination=!0)}}switch(e.audioMixing.inEarMonitoring){case e.audioMixing.inEarMonitoringModes.MICROPHONE:e.audioMixing.source.forEach((function(t){t.connectedToDestination&&(t.gainNode.disconnect(e.audioMixing.ctx.destination),t.connectedToDestination=!1)}));case e.audioMixing.inEarMonitoringModes.ALL:e.audioMixing.mediaStreamSource.connectedToDestination||(e.audioMixing.mediaStreamSource.connect(e.audioMixing.ctx.destination),e.audioMixing.mediaStreamSource.connectedToDestination=!0)}},e._startAudioMixingBufferSource=function(t){e.audioMixing.audioContextInited||e._initAudioContext();var n={soundId:t.soundId,id:t.filePath,loop:t.loop,cycle:t.cycle,playTime:t.playTime||0},i=t.replace,o=e.createAudioBufferSource(n);return o.sound=e.audioMixing.sounds[t.soundId],o?(o.addEventListener("ended",e._audioMixingFinishedListener,{once:!0}),e._reloadInEarMonitoringMode(),i&&e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.mediaStreamDest),o):null},e._stopAudioMixingBufferSource=function(t){var n=e.audioMixing.sounds[t.soundId].source;return n?(n.removeEventListener("ended",e._audioMixingFinishedListener),e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest),n.stop(),n):null},e._flushAudioMixingMuteStatus=function(t){for(var n in e.audioMixing.sounds){var i=e.audioMixing.sounds[n];i&&(void 0!==t&&(i.muted=!!t),i.source&&(i.muted?i.source.gainNode.gain.value=0:i.source.gainNode.gain.value=i.volume/100))}},e._handleAudioMixingInvalidStateError=function(t,n,i){var o=e.audioMixing.sounds[n.soundId],a=-1===n.soundId?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";r.default.error("[".concat(e.streamId,"] Cannot ").concat(t,": ").concat(a,", state is ").concat(o.state)),i&&i(a)},e._handleAudioMixingNoSourceError=function(t,n,i){e.audioMixing.sounds[n.soundId].state=e.audioMixing.states.IDLE;var o=-1===n.soundId?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";r.default.error("[".concat(e.streamId,"] Cannot ").concat(t,": ").concat(o)),i&&i(o)},e._getOneEffectStates=function(t){var n=e.audioMixing.sounds[t.soundId];return function(){return n?{state:n.state,startAt:n.startAt,resumeAt:n.resumeAt,pauseOffset:n.pauseOffset,pauseAt:n.pauseAt,resumeOffset:n.resumeOffset,stopAt:n.stopAt,duration:e._getOneEffectDuration(t),position:e._getOneEffectCurrentPosition(t)}:{}}},e._audioMixingFinishedListener=function(){var t=this.sound;t.state===e.audioMixing.states.IDLE&&e.audioMixing.buffer[t.options.filePath]&&!t.options.cacheResource&&(r.default.debug("Recycled buffer ".concat(t.options.filePath)),delete e.audioMixing.buffer[t.options.filePath]),-1===t.soundId&&e.dispatchEvent({type:"audioMixingFinished"})},e._playOneEffect=function(t,n){be(t,"options");var i=t.soundId,o=(t.filePath,t.cacheResource);if(t.cycle,t.loop,t.playTime,t.replace,Object(f.isSafari)()&&Object(f.getBrowserVersion)()<12){var a="BROWSER_NOT_SUPPORT";return r.default.error("[".concat(e.streamId,"] Cannot _playOneEffect: "),a),n(a)}e.audioMixing.audioContextInited||e._initAudioContext(),e._initSoundIfNotExists(i);var s=e.audioMixing.sounds[i];if(s.state===e.audioMixing.states.IDLE){if(void 0!==t.cycle&&!t.cycle>0)return a="Invalid Parmeter cycle: "+t.cycle,r.default.error("[".concat(e.streamId,"] ").concat(i),a),n(a);if(De(o)&&(t.cacheResource=!0),s.state=e.audioMixing.states.STARTING,s.options=t,e.audioMixing.buffer[t.filePath]){var c=e._startAudioMixingBufferSource(t);if(c)return s.source=c,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=t.playTime||0,s.state=e.audioMixing.states.BUSY,e._flushAudioMixingMuteStatus(),n(null);s.state=e.audioMixing.states.IDLE;var d="CREATE_BUFFERSOURCE_FAILED";if(n)return n(d);r.default.error("[".concat(e.streamId,"] "),d)}else e.loadAudioBuffer(t.filePath,t.filePath,(function(i){if(i)s.state=e.audioMixing.states.IDLE,n?n(i):r.default.error("[".concat(e.streamId,"] "),i);else{var o=e._startAudioMixingBufferSource(t);if(o)return s.source=o,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=t.playTime||0,s.state=e.audioMixing.states.BUSY,e._flushAudioMixingMuteStatus(),n(null);if(s.state=e.audioMixing.states.IDLE,i="CREATE_BUFFERSOURCE_FAILED",n)return n(i);r.default.error("[".concat(e.streamId,"] "),i)}}))}else e._handleAudioMixingInvalidStateError("_playEffect",t,n)},e._stopOneEffect=function(t,n){var i=e.audioMixing.sounds[t.soundId];return e._isSoundExists(t)?i.state===e.audioMixing.states.BUSY||i.state===e.audioMixing.states.PAUSED?(e._stopAudioMixingBufferSource(t),i.stopAt=Date.now(),i.state=e.audioMixing.states.IDLE,e.audioMixing.buffer[i.options.filePath]&&!i.options.cacheResource&&(r.default.debug("Recycled buffer ".concat(i.options.filePath)),delete e.audioMixing.buffer[i.options.filePath]),void(n&&n(null))):void e._handleAudioMixingInvalidStateError("_stopOneEffect",t,n):n("SOUND_NOT_EXISTS")},e._pauseOneEffect=function(t,n){var i=e.audioMixing.sounds[t.soundId];if(i.state===e.audioMixing.states.BUSY)return e._stopAudioMixingBufferSource(t)?(i.pauseAt=Date.now(),i.state=e.audioMixing.states.PAUSED,i.resumeAt?i.pauseOffset=i.pauseAt-i.resumeAt+i.resumeOffset:i.pauseOffset=i.pauseAt-i.startAt+i.startOffset,n&&n(null)):void e._handleAudioMixingNoSourceError("_pauseOneEffect",t,n);e._handleAudioMixingInvalidStateError("_pauseOneEffect",t,n)},e._resumeOneEffect=function(t,n){var i=e.audioMixing.sounds[t.soundId];if(i.state===e.audioMixing.states.PAUSED){var o={soundId:t.soundId,filePath:i.options.filePath,cycle:i.options.cycle,loop:i.options.loop,playTime:i.pauseOffset,replace:i.options.replace},a=e._startAudioMixingBufferSource(o);if(!a){var s="CREATE_BUFFERSOURCE_FAILED";return n(s),void r.default.error("[".concat(e.streamId,"] "),s)}i.source=a,i.resumeAt=Date.now(),i.resumeOffset=i.pauseOffset,i.state=e.audioMixing.states.BUSY,i.pauseAt=null,i.pauseOffset=null,n(null)}else e._handleAudioMixingInvalidStateError("_resumeOneEffect",t,n)},e._getOneEffectDuration=function(t){var n=e.audioMixing.sounds[t.soundId];return n.options&&n.options.filePath&&e.audioMixing.buffer[n.options.filePath]?1e3*e.audioMixing.buffer[n.options.filePath].duration:null},e._getOneEffectCurrentPosition=function(t,n){var i=e.audioMixing.sounds[t.soundId];return i.state===e.audioMixing.states.PAUSED?i.pauseOffset%e._getOneEffectDuration(t):i.state===e.audioMixing.states.BUSY?i.resumeAt?(Date.now()-i.resumeAt+i.resumeOffset+i.startOffset)%e._getOneEffectDuration(t):(Date.now()-i.startAt+i.startOffset)%e._getOneEffectDuration(t):void(n&&e._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",t))},e._setOneEffectPosition=function(t,n,i){var o=e.audioMixing.sounds[t.soundId];if(o.state===e.audioMixing.states.BUSY){if(!e._stopAudioMixingBufferSource(t))return void e._handleAudioMixingNoSourceError("_setOneEffectPosition",t,i);var a={soundId:t.soundId,filePath:o.options.filePath,loop:o.options.loop,cycle:o.options.cycle,playTime:n},s=e._startAudioMixingBufferSource(a);if(!s){var c="CREATE_BUFFERSOURCE_FAILED";return i&&i(c),void r.default.error("[".concat(e.streamId,"] "),c)}o.source=s,o.startAt=Date.now(),o.startOffset=n,o.resumeAt=null,o.resumeOffset=null,o.pauseOffset=null,o.pauseAt=null}else{if(o.state!==e.audioMixing.states.PAUSED)return void e._handleAudioMixingInvalidStateError("_setOneEffectPosition",t,i);o.pauseOffset=n}i&&i(null)},e.startAudioMixing=function(t,n){var i=a.b.reportApiInvoke(e.sid,{callback:function(t){if(t)return n&&n(t);e.dispatchEvent({type:"audioMixingPlayed"}),n&&n(null)},getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:t});be(t,"options");var r=t.filePath,s=t.cacheResource,c=t.cycle,d=t.loop,u=t.playTime,l=t.replace;Ie(r,"filePath",1,Object(o.getParameter)("FILEPATH_LENMAX"),!1),_e(u,"playTime",0,1e8),!De(c)&&_e(c,"cycle"),!De(d)&&Ee(d,"loop"),!De(l)&&Ee(l,"replace"),!De(s)&&Ee(s,"cacheResource");var p=h()({soundId:-1},t);e._playOneEffect(p,i)},e.stopAudioMixing=function(t){var n=a.b.reportApiInvoke(e.sid,{callback:t,getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});e._stopOneEffect({soundId:-1},n)},e.pauseAudioMixing=function(t){var n=a.b.reportApiInvoke(e.sid,{callback:t,getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return e._pauseOneEffect({soundId:-1},n)},e.resumeAudioMixing=function(t){var n=a.b.reportApiInvoke(e.sid,{callback:function(n,i){if(n)return t&&t(n);e.dispatchEvent({type:"audioMixingPlayed"}),t&&t(null)},getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});e._resumeOneEffect({soundId:-1},n)},e.adjustAudioMixingVolume=function(t){var n=a.b.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});_e(t,"volume",0,100),e.audioMixing.sounds[-1].volume=t,e._flushAudioMixingMuteStatus(),n()},e.getAudioMixingDuration=function(){var t=a.b.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),n=e._getOneEffectDuration({soundId:-1});return t(null,n),n},e.getAudioMixingCurrentPosition=function(){var t=a.b.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),n=e._getOneEffectCurrentPosition({soundId:-1},!0);return t(null,n),n},e.setAudioMixingPosition=function(t,n){var i=a.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});_e(t,"position",0,1e8),e._setOneEffectPosition({soundId:-1},t,i)},e.playEffect=function(t,n){var i=a.b.reportApiInvoke(e.sid,{callback:function(t){if(t)return n&&n(t);e.dispatchEvent({type:"effectPlayed"}),n&&n(null)},name:"Stream.playEffect",options:t});be(t,"options");var r=t.soundId,s=t.filePath,c=t.cycle;_e(r,"soundId",1,1e4),Ie(s,"filePath",0,Object(o.getParameter)("FILEPATH_LENMAX"),!1),!De(c)&&_e(c,"cycle"),e._playOneEffect(t,i)},e.stopEffect=function(t,n){var i=a.b.reportApiInvoke(e.sid,{callback:n,getStates:e._getOneEffectStates({soundId:t}),name:"Stream.stopEffect"});_e(t,"soundId",1,1e4),e._stopOneEffect({soundId:t},i)},e.stopAllEffects=function(t){var n=a.b.reportApiInvoke(e.sid,{callback:t,name:"Stream.stopAllEffect"}),i=!1,o=0,r=0,s=function(e){i||(e?(n(e),i=!0):o+=1,o===r&&(n(null),i=!0))};for(var c in e.audioMixing.sounds){var d=e.audioMixing.sounds[c];-1!==d.soundId&&(d.state!==e.audioMixing.states.BUSY&&d.state!==e.audioMixing.states.PAUSED||(r++,e._stopOneEffect({soundId:c},s)))}r||n(null)},e.preloadEffect=function(t,n,i){var r=a.b.reportApiInvoke(e.sid,{callback:i,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});_e(t,"soundId",1,1e4),Ie(n,"filePath",1,Object(o.getParameter)("FILEPATH_LENMAX"),!1),e._initSoundIfNotExists(t,n),e.audioMixing.buffer[n]?r(null):e.loadAudioBuffer(n,n,r)},e.unloadEffect=function(t,n){var i=a.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});_e(t,"soundId",1,1e4);var o=e.audioMixing.sounds[t];if(!o){var s="SOUND_NOT_EXISTS";return r.default.error(s,t),void i(s)}var c=o.options?o.options.filePath:o.filePath;if(c)delete e.audioMixing.buffer[c],delete e.audioMixing.sounds[t],i(null);else{var d="SOUND_BUFFER_NOT_FOUND";r.default.error(d,t),i(d)}},e.pauseEffect=function(t,n){var i=a.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return e._pauseOneEffect({soundId:t},i)},e.pauseAllEffects=function(t){var n=a.b.reportApiInvoke(e.sid,{callback:t,name:"Stream.pauseAllEffects"}),i=!1,o=0,r=0,s=function(e){i||(e?(n(e),i=!0):o+=1,o===r&&(n(null),i=!0))};for(var c in e.audioMixing.sounds)"-1"!==c&&e.audioMixing.sounds[c].state===e.audioMixing.states.BUSY&&(r++,e._pauseOneEffect({soundId:c},s));r||n(null)},e.resumeEffect=function(t,n){_e(t,"soundId",1,1e4);var i=a.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return e._resumeOneEffect({soundId:t},i)},e.resumeAllEffects=function(t){var n=a.b.reportApiInvoke(e.sid,{callback:t,name:"Stream.resumeAllEffects"}),i=!1,o=0,r=0,s=function(e){i||(e?(n(e),i=!0):o+=1,o===r&&(n(null),i=!0))};for(var c in e.audioMixing.sounds)"-1"!==c&&e.audioMixing.sounds[c].state===e.audioMixing.states.PAUSED&&(r++,e._resumeOneEffect({soundId:c},s));r||n(null)},e.getEffectsVolume=function(){var t=[];for(var n in e.audioMixing.sounds){var i=e.audioMixing.sounds[n];i&&"-1"!==n&&t.push({soundId:parseInt(n),volume:i.volume})}return t},e.setEffectsVolume=function(t,n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:n});for(var o in _e(t,"volume",0,100),e.audioMixing.defaultVolume=t,e.audioMixing.sounds){var r=e.audioMixing.sounds[o];"-1"!==o&&(r.volume=t)}e._flushAudioMixingMuteStatus(),i(null)},e.setVolumeOfEffect=function(t,n,i){var o=a.b.reportApiInvoke(e.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:i});_e(t,"soundId",0,1e4),_e(n,"volume",0,100),e._initSoundIfNotExists(t),e.audioMixing.sounds[t].volume=n,e._flushAudioMixingMuteStatus(),o(null)}}(t),function(e,t){e.videoConstraint={},t.cameraId&&(e.videoConstraint.deviceId={exact:t.cameraId}),e.videoSize&&(e.videoConstraint.width=e.videoSize[0],e.videoConstraint.height=e.videoSize[1]),Object(f.isLegacyChrome)()||(e.videoConstraint.frameRate={ideal:30,max:30}),e.audioConstraint={},t.microphoneId&&(e.audioConstraint.deviceId={exact:t.microphoneId}),Object(f.isLegacyChrome)()||e.audioProcessing&&(void 0!==e.audioProcessing.AGC&&(Object(f.isFireFox)()?e.audioConstraint.autoGainControl=e.audioProcessing.AGC:Object(f.isChrome)()&&(e.audioConstraint.googAutoGainControl=e.audioProcessing.AGC,e.audioConstraint.googAutoGainControl2=e.audioProcessing.AGC)),void 0!==e.audioProcessing.AEC&&(e.audioConstraint.echoCancellation=e.audioProcessing.AEC),void 0!==e.audioProcessing.ANS&&(Object(f.isFireFox)()?e.audioConstraint.noiseSuppression=e.audioProcessing.ANS:Object(f.isChrome)()&&(e.audioConstraint.googNoiseSuppression=e.audioProcessing.ANS))),e.screenConstraint={},t.sourceId&&(e.screenConstraint.sourceId=t.sourceId),t.extensionId&&Object(f.isChrome)()?(e.screenConstraint.extensionId=t.extensionId,e.screenConstraint.mandatory={chromeMediaSource:"desktop",maxWidth:e.screenAttributes.width,maxHeight:e.screenAttributes.height,maxFrameRate:e.screenAttributes.maxFr,minFrameRate:e.screenAttributes.minFr}):(e.screenConstraint.mediaSource="screen",e.screenConstraint.width=e.screenAttributes.width,e.screenConstraint.height=e.screenAttributes.height,e.screenConstraint.frameRate={ideal:e.screenAttributes.maxFr,max:e.screenAttributes.maxFr}),t.mediaSource&&(e.screenConstraint.mediaSource=t.mediaSource),e.setVideoResolution=function(n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});if(!(n instanceof Array)){var o=xe(n+="");return o&&o.video?(e.videoConstraint=h()(e.videoConstraint,{width:{ideal:o.video.width},height:{ideal:o.video.height}}),t.attributes.resolution=o.attributes.resolution,(s=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0])&&s.applyConstraints?(r.default.debug("setVideoResolution applyConstraints",e.videoConstraint),s.applyConstraints(e.videoConstraint).then(i).catch(i)):i(),!0):(i("NO_PROFILE_".concat(n)),!1)}var s,c=n[0],d=n[1];e.videoConstraint=h()(e.videoConstraint,{width:{ideal:c},height:{ideal:d}}),t.attributes.resolution="".concat(c,"x").concat(d),(s=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0])&&s.applyConstraints?(r.default.debug("setVideoResolution applyConstraints",e.videoConstraint),s.applyConstraints(e.videoConstraint).then(i).catch(i)):i()},e.setVideoFrameRate=function(n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});if(Object(f.isFireFox)())return i("FIREFOX_NOT_SUPPORTED"),!1;if("object"===ye()(n)&&n instanceof Array&&n.length>1){e.videoConstraint=h()(e.videoConstraint,{frameRate:{ideal:n[0],max:n[1]}}),t.attributes.minFrameRate=n[0],t.attributes.maxFrameRate=n[1];var o=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0];return o&&o.applyConstraints?(r.default.debug("setVideoFrameRate applyConstraints",e.videoConstraint),o.applyConstraints(e.videoConstraint).then(i).catch(i)):i(),!0}return i("INVALID_PARAM_".concat(JSON.stringify(n))),!1},e.setVideoBitRate=function(n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return"object"===ye()(n)&&n instanceof Array&&n.length>1?(t.attributes.minVideoBW=n[0],t.attributes.maxVideoBW=n[1],e.connectionSpec&&(e.connectionSpec.minVideoBW=n[0],e.connectionSpec.maxVideoBW=n[1]),e.pc&&e.pc.renegotiate&&e.pc.renegotiate(),i(),!0):(i("INVALID_PARAM_".concat(JSON.stringify(n))),!1)},e.setScreenBitRate=function(n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return"object"===ye()(n)&&n instanceof Array&&n.length>1?(t.screenAttributes.minVideoBW=n[0],t.screenAttributes.maxVideoBW=n[1],i(),!0):(i("INVALID_PARAM_".concat(JSON.stringify(n))),!1)},e.setScreenProfile=function(t){var n=a.b.reportApiInvoke(e.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});Se(t,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]);var i=xe(t);return i&&i.screen?(e.screenConstraint.mandatory?(e.screenConstraint.mandatory.maxWidth=i.screen.width,e.screenConstraint.mandatory.maxHeight=i.screen.height,i.screen.frameRate&&i.screen.frameRate.min&&i.screen.frameRate.max&&(e.screenConstraint.mandatory.minFrameRate=i.screen.frameRate.min,e.screenConstraint.mandatory.maxFrameRate=i.screen.frameRate.max)):e.screenConstraint=h()(e.screenConstraint,i.screen),e.screenAttributes.width=i.screen.width,e.screenAttributes.height=i.screen.height,e.screenAttributes.minFr=i.screen.frameRate.min,e.screenAttributes.maxFr=i.screen.frameRate.max,n(),!0):(n("NO_SCREEN_PROFILE_".concat(JSON.stringify(t))),!1)},e.setVideoProfileCustom=function(t){var n=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});e.setVideoResolution(t[0]),e.setVideoFrameRate([t[1],t[1]]),e.setVideoBitRate([t[2],t[2]]),n()},e.setVideoProfileCustomPlus=function(n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});e.videoConstraint.width=n.width,e.videoConstraint.height=n.height,t.attributes.resolution="".concat(n.width,"x").concat(n.height),e.setVideoFrameRate([n.framerate,n.framerate]),e.setVideoBitRate([n.bitrate,n.bitrate]),i()},e.setVideoProfile=function(n){var i=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"}),o=xe(n);if(!o){var s="Invalid Profile ".concat(n);throw new Error(s)}if(e.profile=n,o&&o.video){e.profile=o.profileName,e.videoConstraint=h()(e.videoConstraint,o.video),e.connectionSpec&&o.attributes.maxVideoBW&&(e.connectionSpec.minVideoBW=o.attributes.minVideoBW,e.connectionSpec.maxVideoBW=o.attributes.maxVideoBW),Object(f.isEdge)()&&(e.videoConstraint.frameRate.max=60),Object(f.isFireFox)()&&(e.videoConstraint.frameRate={ideal:30,max:30}),t.attributes=h()(t.attributes,o.attributes),e.pc&&e.pc.renegotiate&&e.pc.renegotiate();var c=e.stream&&e.stream.getVideoTracks&&e.stream.getVideoTracks()[0];return c&&c.applyConstraints?(r.default.debug("setVideoProfile applyConstraints",e.videoConstraint),c.applyConstraints(e.videoConstraint).then((function(t){i(t),Object(me.h)(e.stream,(function(t,n){e.videoWidth=t,e.videoHeight=n}),(function(t){r.default.warning("[".concat(e.streamId,"] vsResHack failed: "),t)}))})).catch(i)):i(),!0}return i("INVALID_VIDEO_PROFILE_".concat(n)),!1},e.setAudioProfile=function(t){var n=a.b.reportApiInvoke(e.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});Se(t,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),e.audioProfile=t;var i=Pe(t);return e.highQuality=i.highQuality,e.stereo=i.stereo,e.speech=i.speech,e.lowQuality=i.lowQuality,e.stereo&&Object(f.isChrome)()&&(e.audioConstraint.googAutoGainControl=!1,e.audioConstraint.googAutoGainControl2=!1,e.audioConstraint.echoCancellation=!1,e.audioConstraint.googNoiseSuppression=!1),n(),!0},e.setVideoEncoderConfiguration=function(t){be(t,"config");var n=a.b.reportApiInvoke(e.sid,{name:"Stream.setVideoEncoderConfiguration",options:t,tag:"tracer"});t.resolution&&(_e(t.resolution.width,"config.resolution.width"),_e(t.resolution.height,"config.resolution.height"),e.setVideoResolution([t.resolution.width,t.resolution.height])),t.frameRate&&(_e(t.frameRate.min,"config.frameRate.min"),_e(t.frameRate.max,"config.frameRate.max"),e.setVideoFrameRate([t.frameRate.min,t.frameRate.max])),t.bitrate&&(_e(t.bitrate.min,"config.bitrate.min",1,1e7),_e(t.bitrate.max,"config.bitrate.max",1,1e7),e.setVideoBitRate([t.bitrate.min,t.bitrate.max])),n()},e.getSupportedProfile=function(t){var n=a.b.reportApiInvoke(e.sid,{name:"Stream.getSupportedProfile",options:arguments,tag:"tracer",callback:t});if(!e.local){var i="ONLY_LOCAL_STREAM_SUPPORTED";return r.default.error(i),n(i)}if(!e.stream)return i="STREAM_NOT_INIT",r.default.error(i),n(i);if(!e.stream.getVideoTracks)return i="TRACK_NOT_SUPPORT",r.default.error(i),n(i);var o=e.stream.getVideoTracks()[0];if(!o)return i="NO_VIDEO_TRACK_FOUND",r.default.error(i),n(i);if(!o.getCapabilities)return i="GETCAPABILITY_NOT_SUPPORT",r.default.error(i),n(i);var s=o.getCapabilities();return n(null,Me(s))}}(t,e),t.on("collectStats",(function(e){e.promises.push(t._getPCStats(e.interval)),e.promises.push(new Promise((function(e){var n={};t.pc&&t.pc.isSubscriber?null!==window.navigator.userAgent.match("Firefox")&&(ge(n,"videoReceiveResolutionHeight",t.videoHeight),ge(n,"videoReceiveResolutionWidth",t.videoWidth)):t.pc&&!t.pc.isSubscriber&&((Object(f.isSafari)()||Object(f.isFireFox)())&&(ge(n,"videoSendResolutionHeight",t.videoHeight),ge(n,"videoSendResolutionWidth",t.videoWidth)),(Object(f.isSafari)()||Object(f.isFireFox)())&&t.uplinkStats&&ge(n,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),e(n)}))),e.promises.push(new Promise((function(e){var n={};return t.traffic_stats&&t.pc&&t.pc.isSubscriber?(ge(n,"accessDelay",t.traffic_stats.access_delay),ge(n,"endToEndDelay",t.traffic_stats.e2e_delay),ge(n,"videoReceiveDelay",t.traffic_stats.video_delay),ge(n,"audioReceiveDelay",t.traffic_stats.audio_delay)):t.traffic_stats&&t.pc&&!t.pc.isSubscriber&&ge(n,"accessDelay",t.traffic_stats.access_delay),e(n)})))})),t.getId=function(){return t.streamId},t.getUserId=function(){return t.userId},t.setUserId=function(e){var n=a.b.reportApiInvoke(t.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});t.userId&&r.default.warning("[".concat(t.streamId,"] Stream.userId ").concat(t.userId," => ").concat(e)),t.userId=e,n()},t.getAttributes=function(){return e.screen?t.screenAttributes:e.attributes},t.hasAudio=function(){return t.audio},t.hasVideo=function(){return t.video},t.hasScreen=function(){return t.screen},t.isVideoOn=function(){return(t.hasVideo()||t.hasScreen())&&!t.userMuteVideo},t.isAudioOn=function(){return t.hasAudio()&&!t.userMuteAudio},t.init=function(i,o){var s=a.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return o&&o(e);i&&i(t)},name:"Stream.init",options:arguments,tag:"tracer"}),c=((new Date).getTime(),arguments[2]);if(void 0===c&&(c=2),!0===t.initialized)return s({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(!0!==t.local)return s({type:"warning",msg:"STREAM_NOT_LOCAL"});t.videoSource?t.videoName="videoSource":t.video&&(t.videoName=ve.searchDeviceNameById(e.cameraId)||"default"),t.audioSource?t.audioName="audioSource":t.audio&&(t.audioName=ve.searchDeviceNameById(e.microphoneId)||"default"),t.screen&&(t.screenName=e.extensionId||"default");try{if(e.audio||e.video||e.screen||e.videoSource||e.audioSource){r.default.debug("[".concat(t.streamId,"] Requested access to local media"));var d={streamId:t.streamId};e.videoSource?d.videoSource=e.videoSource:e.screen?d.screen=t.screenConstraint:e.video&&(d.video=t.videoConstraint),e.audioSource?d.audioSource=e.audioSource:e.audio&&(d.audio=t.audioConstraint),fe(d,(function(i){d.screen&&r.default.debug("[".concat(t.streamId,"] User has granted access to screen sharing")),(d.video||d.audio)&&r.default.debug("[".concat(t.streamId,"] User has granted access to local media")),t.dispatchEvent({type:"accessAllowed"}),t.stream=i,t.initialized=!0,t.reloadDeviceName(),t.hasVideo()&&Object(me.h)(i,(function(e,n){t.videoWidth=e,t.videoHeight=n}),(function(e){r.default.warning("[".concat(t.streamId,"] vsResHack failed: "),e)})),e.screen&&t.stream&&t.stream.getVideoTracks()[0]&&(t.stream.getVideoTracks()[0].onended=function(){t.dispatchEvent({type:"stopScreenSharing"})}),t.stream&&t.stream.getTracks&&t.stream.getTracks().forEach((function(e){e&&!e.onended&&(e.onended=n)})),s()}),(function(e){var n={type:"error",info:null};switch(e&&(n.msg=e.name||e.code||e,e.message&&(n.info=e.message),e.code&&(n.info?n.info+=". "+e.code:n.info=" "+e.code),e.constraint&&(n.info?n.info+=". Constraint: "+e.constraint:n.info="constraint: "+e.constraint)),n.msg){case"Starting video failed":case"TrackStartError":if(t.videoConstraint&&(delete t.videoConstraint.width,delete t.videoConstraint.height),c>0)return void setTimeout((function(){t.init((function(e){return s(e)}),s,c-1)}),1);n.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":n.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":n.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":n.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":t.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":n.msg="CONSTRAINT_NOT_SATISFIED";break;default:n.msg||(n.msg="UNDEFINED")}var i="Media access ".concat(n.msg).concat(n.info?": "+n.info:"");r.default.error("[".concat(t.streamId,"] "),i),s(n)}))}else s({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(e){r.default.error("[".concat(t.streamId,"] Stream init: "),e),s({type:"error",msg:e.message||e})}},t.reloadDeviceName=function(){if(t.stream){if(t.stream.getVideoTracks){var e=t.stream.getVideoTracks()[0];e&&e.label&&(t.videoName=e.label)}if(t.stream.getAudioTracks){var n=t.stream.getAudioTracks()[0];n&&n.label&&(t.audioName=n.label)}}},t.close=function(){var e=a.b.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(r.default.debug("[".concat(t.streamId,"] Close stream with id"),t.streamId),void 0!==t.stream){var n=t.stream.getTracks();for(var i in n)n.hasOwnProperty(i)&&n[i].stop();t.stream=void 0}Object(f.isSafari)()&&t.pc&&t.pc.peerConnection&&t.pc.peerConnection.removeTrack&&t.pc.peerConnection.getSenders&&t.pc.peerConnection.getSenders().forEach((function(e){e&&(r.default.debug("[".concat(t.streamId,"] Remove Track"),e),t.pc.peerConnection.removeTrack(e))})),t.initialized=!1,t._onAudioMute=void 0,t._onAudioUnmute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,t.lowStream&&t.lowStream.close(),e()},t.enableAudio=function(){var e,n=a.b.reportApiInvoke(t.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});return r.default.deprecate("[".concat(t.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead")),t.userMuteAudio||r.default.warning("[".concat(t.streamId,"] User already enableAudio")),t.userMuteAudio=!1,n(null,e=!t.peerMuteAudio&&t._unmuteAudio()),e},t.disableAudio=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});r.default.deprecate("[".concat(t.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead")),t.userMuteAudio&&r.default.warning("[".concat(t.streamId,"] User already disableAudio")),t.userMuteAudio=!0;var n=t._muteAudio();return e(null,n),n},t.enableVideo=function(){var e,n=a.b.reportApiInvoke(t.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});return r.default.deprecate("[".concat(t.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead")),t.userMuteVideo||r.default.warning("[".concat(t.streamId,"] User already enableVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),n(null,e=!t.peerMuteVideo&&t._unmuteVideo()),e},t.disableVideo=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});r.default.deprecate("[".concat(t.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead")),t.userMuteVideo&&r.default.warning("[".concat(t.streamId,"] User already disableVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var n=t._muteVideo();return e(null,n),n},t.unmuteAudio=function(){var e,n=a.b.reportApiInvoke(t.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"});return t.userMuteAudio||r.default.warning("[".concat(t.streamId,"] User already unmuteAudio")),t.userMuteAudio=!1,n(null,e=!t.peerMuteAudio&&t._unmuteAudio()),e},t.muteAudio=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"});t.userMuteAudio&&r.default.warning("[".concat(t.streamId,"] User already muteAudio")),t.userMuteAudio=!0;var n=t._muteAudio();return e(null,n),n},t.unmuteVideo=function(){var e,n=a.b.reportApiInvoke(t.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"});return t.userMuteVideo||r.default.warning("[".concat(t.streamId,"] User already unmuteVideo")),t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1),n(null,e=!t.peerMuteVideo&&t._unmuteVideo()),e},t.muteVideo=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"});t.userMuteVideo&&r.default.warning("[".concat(t.streamId,"] User already muteVideo")),t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0);var n=t._muteVideo();return e(null,n),n},t._unmuteAudio=function(){return r.default.debug("[".concat(t.streamId,"] Unmuted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!1),!(!t.hasAudio()||!t.initialized||void 0===t.stream||!0===t.stream.getAudioTracks()[0].enabled||(t._onAudioUnmute&&t._onAudioUnmute(),t.pc&&(t.pc.isAudioMute=!1),t.stream.getAudioTracks()[0].enabled=!0,0))},t._isAudioMuted=function(){if(t.stream&&t.hasAudio()){var e=t.stream.getAudioTracks();return e.length>0&&!e[0].enabled}return!1},t._muteAudio=function(){return r.default.debug("[".concat(t.streamId,"] Muted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!0),!!(t.hasAudio()&&t.initialized&&void 0!==t.stream&&t.stream.getAudioTracks()[0].enabled)&&(t._onAudioMute&&t._onAudioMute(),t.pc&&(t.pc.isAudioMute=!0),t.stream.getAudioTracks()[0].enabled=!1,t.sid&&a.b.audioSendingStopped(t.sid,{succ:!0,reason:"muteAudio"}),!0)},t._unmuteVideo=function(){return r.default.debug("[".concat(t.streamId,"] Unmuted video stream with id"),t.streamId),!(!t.initialized||void 0===t.stream||!t.stream.getVideoTracks().length||!0===t.stream.getVideoTracks()[0].enabled||(t._onVideoUnmute&&t._onVideoUnmute(),t.pc&&(t.pc.isVideoMute=!1),t.stream.getVideoTracks()[0].enabled=!0,t.lowStream&&t.lowStream._unmuteVideo(),0))},t._muteVideo=function(){return r.default.debug("[".concat(t.streamId,"] Muted video stream with id"),t.streamId),!!(t.initialized&&void 0!==t.stream&&t.stream.getVideoTracks().length&&t.stream.getVideoTracks()[0].enabled)&&(t._onVideoMute&&t._onVideoMute(),t.pc&&(t.pc.isVideoMute=!0),t.stream.getVideoTracks()[0].enabled=!1,t.lowStream&&t.lowStream._muteVideo(),t.sid&&a.b.videoSendingStopped(t.sid,{succ:!0,reason:"muteVideo"}),!0)},t.addTrack=function(i){var o=a.b.reportApiInvoke(t.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(t.pc&&t.pc.addTrack(i,t.stream),"audio"==i.kind){t._cleanupAudioMixing();var r=new MediaStream;t.userMuteAudio&&(i.enabled=!1),r.addTrack(i);var s=t.stream.getVideoTracks()[0];s&&(r.addTrack(s),t.audio=!0,e.audio=!0),t.stream=r,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream)}else t.userMuteVideo&&(i.enabled=!1),t.stream.addTrack(i),t.video=!0,e.video=!0;i.onended||(i.onended=n),o()},t.removeTrack=function(n){var i=a.b.reportApiInvoke(t.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});t.pc&&t.pc.removeTrack(n,t.stream),t.stream.removeTrack(n),t._cleanupAudioMixing(),"audio"===n.kind?(t.audio=!1,e.audio=!1):(t.video=!1,e.video=!1),t.audioLevelHelper=null,"live"==n.readyState&&(n.stop(),r.default.debug("[".concat(t.streamId,"] Track ").concat(n.kind," Stopped"))),i()},t.setAudioOutput=function(e,n,i){var o=a.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return Ce(e,1,255)?(t.audioOutput=e,t.player?void t.player.setAudioOutput(e,(function(){return o()}),o):o()):(r.default.error("[".concat(t.streamId,"] setAudioOutput Invalid Parameter"),e),o(O))},t.play=function(e,n,i){"function"==typeof n&&(i=n,n=null),r.default.debug("[".concat(t.streamId,"] play()."),e,n);var o=a.b.reportApiInvoke(t.sid,{name:"Stream.play",options:arguments,tag:"tracer",callback:i});if(Ie(e,"elementID"),De(n)||(De(n.fit)||Se(n.fit,"fit",["cover","contain"]),De(n.muted)||Ee(n.muted,"muted")),t.player)r.default.warning("[".concat(t.streamId,"] Stream.play(): Stream is already playing. Fallback to resume stream")),t.resume().then((function(){o(null)})).catch(o);else{t.elementID=e,t.playOptions=n,!t.local||t.video||t.screen?t.player=new ne({id:t.getId(),stream:t,elementID:e,options:n}):t.hasAudio()&&(t.player=new ne({id:t.getId(),stream:t,elementID:e,options:n}));var s={audio:null,video:null};t.on("player-status-change",(function e(n){if(s[n.mediaType]=n,s.audio&&s.video)if(t.removeEventListener("player-status-change",e),s.video.isErrorState||s.audio.isErrorState){var i=s.video.isErrorState?s.video:s.audio;o({isErrorState:!0,status:i.status,reason:i.reason,video:s.video,audio:s.audio})}else"aborted"===s.video.status&&"aborted"===s.audio.status?o({status:"aborted",reason:"stop",video:s.video,audio:s.audio}):o(null)})),t.audioOutput&&t.player.setAudioOutput(t.audioOutput),void 0!==t.audioLevel&&t.player.setAudioVolume(t.audioLevel),t._flushAudioMixingMuteStatus(!1)}},t.stop=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});r.default.debug("[".concat(t.streamId,"] Stop stream player with id "),t.streamId),t.player?(t.player.destroy(),delete t.player):r.default.error("[".concat(t.streamId,"] Stream.stop(): Stream is not playing")),t._flushAudioMixingMuteStatus(!0),e()},t.isPlaying=function(){return!!t.player},t.isPaused=function(){return!(!t.player||!(t.player.video&&t.player.video.paused&&t.player.mediaElemExists(t.player.video)||t.player.audio&&t.player.audio.paused&&t.player.mediaElemExists(t.player.audio)))},t.resume=function(){var e,n;return t.player?(t.player.video&&t.player.video.play&&(e=t.player.video.play()),e=e||Promise.resolve(),t.player.audio&&t.player.audio.play&&(n=t.player.audio.play()),n=n||Promise.resolve(),Promise.all([e,n])):Promise.reject("NO_PLAYER_FOUND")},t.getVideoTrack=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getVideoTracks){var n=t.stream.getVideoTracks()[0];if(n)return r.default.info("[".concat(t.streamId,"] getVideoTrack"),n),e(),n}r.default.info("[".concat(t.streamId,"] getVideoTrack None")),e(null,"getVideoTrack None")},t.getAudioTrack=function(){var e=a.b.reportApiInvoke(t.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getAudioTracks){var n=t.stream.getAudioTracks()[0];if(n)return r.default.info("[".concat(t.streamId,"] getAudioTracks"),n),e(),n}r.default.info("[".concat(t.streamId,"] getAudioTracks None")),e(null,"getAudioTracks None")},t._replaceMediaStreamTrack=function(e,n,i){if(t.stream){if("video"==e.kind){if(a=t.stream.getVideoTracks()[0])return t.userMuteVideo&&(e.enabled=!1),t.stream.removeTrack(a),t.stream.addTrack(e),r.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(e.kind," SUCCESS")),"live"==a.readyState&&(a.stop(),r.default.debug("[".concat(t.streamId,"] Track ").concat(a.kind," Stopped"))),n&&n();var o="MEDIASTREAM_TRACK_NOT_FOUND";return r.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(e.kind)),i(o)}if("audio"==e.kind){var a;if(a=t.stream.getAudioTracks()[0]){t.userMuteAudio&&(e.enabled=!1);var s=new MediaStream;s.addTrack(e);var c=t.stream&&t.stream.getVideoTracks()[0];return c&&s.addTrack(c),t.stream=s,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream),r.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack SUCCESS")),"live"==a.readyState&&(a.stop(),r.default.debug("[".concat(t.streamId,"] Track ").concat(a.kind," Stopped"))),n&&n()}return o="MEDIASTREAM_TRACK_NOT_FOUND",r.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(e.kind)),i(o)}return o="INVALID_TRACK_TYPE",r.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(o," ").concat(e.kind)),i&&i(o)}return o="NO_STREAM_FOUND",r.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(o)),i&&i(o)},t.replaceTrack=function(e,i,o){var s=a.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return o&&o(e);i&&i(t)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return e&&e.kind?(t._cleanupAudioMixing(),e.onended||(e.onended=n),t.pc&&t.pc.hasSender&&t.pc.hasSender(e.kind)?void t.pc.replaceTrack(e,(function(){return r.default.debug("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(e.kind," SUCCESS")),t._replaceMediaStreamTrack(e,(function(e){return s(null,e)}),s)}),(function(n){return r.default.error("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(e.kind," Failed ").concat(n)),s(n)})):t._replaceMediaStreamTrack(e,(function(e){return s(null,e)}),s)):s("INVALID_TRACK")},t.setAudioVolume=function(e){var n=a.b.reportApiInvoke(t.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});_e(e,"level",0,100),t.audioLevel=e,t.player&&t.player.setAudioVolume(e),n()},t.getStats=function(e,n,i){var o={type:"collectStats",promises:[],interval:i};t.dispatchEvent(o),Promise.all(o.promises).then((function(n){for(var i={},o=n.length-1;o>=0;o--){var r=n[o];h()(i,r)}e&&setTimeout(e.bind(t,i),0)})).catch((function(e){n&&setTimeout(n.bind(t,e),0)}))},t._getPCStats=function(e){return new Promise((function(n,i){if(!t.pc||"established"!==t.pc.state||!t.pc.getStats)return i("PEER_CONNECTION_NOT_ESTABLISHED");t.pc.getStats((function(e){if(!t.pc||"established"!==t.pc.state||!t.pc.getStats)return i("PEER_CONNECTION_STATE_CHANGE");var o=t.pc.isSubscriber?function(e){var t={};return e.forEach((function(e){e.id&&(-1===e.id.indexOf("recv")&&-1===e.id.indexOf("inbound_rtp")&&-1===e.id.indexOf("inbound-rtp")&&-1===e.id.indexOf("InboundRTP")||("audio"===e.mediaType?(ge(t,"audioReceiveBytes",e.bytesReceived),ge(t,"audioReceivePackets",e.packetsReceived),ge(t,"audioReceivePacketsLost",e.packetsLost)):(ge(t,"videoReceiveBytes",e.bytesReceived),ge(t,"videoReceivePacketsLost",e.packetsLost),ge(t,"videoReceivePackets",e.packetsReceived),ge(t,"videoReceiveFrameRate",e.googFrameRateReceived),ge(t,"videoReceiveDecodeFrameRate",e.googFrameRateDecoded),ge(t,"videoReceiveResolutionWidth",e.googFrameWidthReceived),ge(t,"videoReceiveResolutionHeight",e.googFrameHeightReceived))))})),t}(e):function(e){var t={};return e.forEach((function(e){e.id&&(-1===e.id.indexOf("send")&&-1===e.id.indexOf("outbound_rtp")&&-1===e.id.indexOf("OutboundRTP")||("audio"===e.mediaType?(ge(t,"audioSendBytes",e.bytesSent),ge(t,"audioSendPackets",e.packetsSent),ge(t,"audioSendPacketsLost",e.packetsLost)):(ge(t,"videoSendBytes",e.bytesSent),ge(t,"videoSendPackets",e.packetsSent),ge(t,"videoSendPacketsLost",e.packetsLost),ge(t,"videoSendFrameRate",e.googFrameRateSent),ge(t,"videoSendResolutionWidth",e.googFrameWidthSent),ge(t,"videoSendResolutionHeight",e.googFrameHeightSent))))})),t}(e);return n(o)}),e)})).then((function(e){return t.pc.isSubscriber?(Object(f.isFireFox)()||Object(f.isSafari)())&&(e.videoReceiveResolutionHeight&&"0"!==e.videoReceiveResolutionHeight||e.videoReceiveResolutionWidth&&"0"!==e.videoReceiveResolutionWidth||(ge(e,"videoReceiveResolutionHeight",t.videoHeight),ge(e,"videoReceiveResolutionWidth",t.videoWidth))):((Object(f.isSafari)()||Object(f.isFireFox)())&&(e.videoSendResolutionHeight&&"0"!==e.videoSendResolutionHeight||e.videoSendResolutionWidth&&"0"!==e.videoSendResolutionWidth||(ge(e,"videoSendResolutionHeight",t.videoHeight),ge(e,"videoSendResolutionWidth",t.videoWidth))),(Object(f.isSafari)()||Object(f.isFireFox)())&&t.uplinkStats&&ge(e,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),Promise.resolve(e)}))},t.getAudioLevel=function(){if(t.audioLevelHelper)return t.audioLevelHelper.getAudioLevel();if(t.stream){if(0!==t.stream.getAudioTracks().length)return t.audioLevelHelper=new me.a(t.stream),t.audioLevelHelper.getAudioLevel();r.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no audio trace in stream"))}else r.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no stream exist"))},t.setVideoProfile("480P"),t._switchVideoDevice=function(e,n,i){if(e===t.cameraId)return n&&n();var o={video:h()({},t.videoConstraint,{deviceId:{exact:e}}),audio:!1};r.default.debug("[".concat(t.streamId,"] ").concat(o)),fe(o,(function(o){try{var r=function(){t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID,t.playOptions)),t.cameraId=e,t.videoConstraint.deviceId={exact:e},t.userMuteVideo&&(t.stream.getVideoTracks()[0].enabled=!1),n&&n()};Object(f.isSafari)()?t.replaceTrack(o.getVideoTracks()[0],r,i):(t.removeTrack(t.stream.getVideoTracks()[0]),t.addTrack(o.getVideoTracks()[0]),r())}catch(e){return i&&i(e)}}),(function(e){return i&&i(e)}))},t._switchAudioDevice=function(e,n,i){if(e===t.microphoneId)return n&&n();var o={video:!1,audio:h()({},t.audioConstraint,{deviceId:{exact:e}})};r.default.debug("[".concat(t.streamId,"] "),o),fe(o,(function(o){var r=function(){t._cleanupAudioMixing(),t.userMuteAudio&&(t.stream.getAudioTracks()[0].enabled=!1),t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID)),t.microphoneId=e,t.audioConstraint.deviceId={exact:e},n&&n()};try{Object(f.isSafari)()?t.replaceTrack(o.getAudioTracks()[0],r,i):(t.removeTrack(t.stream.getAudioTracks()[0]),t.addTrack(o.getAudioTracks()[0]),r())}catch(e){return i&&i(e)}}),(function(e){return i&&i(e)}))},t.switchDevice=function(e,n,i,o){var s=a.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return o&&o(e);i&&i(t)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});Ie(n,"deviceId");var c=function(){return t.inSwitchDevice=!1,s()},d=function(e){t.inSwitchDevice=!1,r.default.error("[".concat(t.streamId,"] "),e),s(e)};if(t.inSwitchDevice)return s("Device switch is in process.");if(t.inSwitchDevice=!0,!t.local)return d("Only the local stream can switch the device.");if(t.screen&&"video"===e)return d("The device cannot be switched during screen-sharing.");if(t.videoSource||t.audioSource)return d("The device cannot be switched when using videoSource or audioSource.");if(t.lowStream)return d("The device cannot be switched when using lowstream.");var u=!1;for(var l in t.audioMixing.sounds)if(t.audioMixing.sounds[l].state!==t.audioMixing.states.IDLE){u=!0;break}if(t.audioMixing.audioContextInited&&u)return d("The device cannot be switched when using audio Mixing.");ve.getDeviceById(n,(function(){if("video"===e)t._switchVideoDevice(n,c,d);else{if("audio"!==e)return d("Invalid type.");t._switchAudioDevice(n,c,d)}}),(function(){return d("The device does not exist.")}))},t},Ve=n(14),je=["live","rtc","web","interop","h264_interop","web-only"],Fe=["vp8","h264"],Be=["aes-128-xts","aes-256-xts","aes-128-ecb"],Ue=function(e){e&&e.apply(this,[].slice.call(arguments,1))},We=n(6),Ge=function(e,t){var n={connect:function(){t.host=e,n.signal=function(e){var t=s();return t.needReconnect=!0,t.isTimeout=!1,t.isInit=!0,t.sendbytes=0,t.recvbytes=0,t.startTime=Date.now(),t.lastMsgTime=null,t.clientId=e.clientId,t.hostIndex=0,t.requestID=0,e.host instanceof Array?t.host=e.host:t.host=[e.host],t.getSendBytes=function(){return t.sendbytes},t.getRecvBytes=function(){return t.recvbytes},t.getDuration=function(){return Math.ceil((Date.now()-t.startTime)/1e3)},t.getURL=function(){return t.connection.url},t.reconnect=function(){t.isInit=!0,t.creatConnection()},t.connectNext=function(){t.isInit=!0,++t.hostIndex,r.default.debug("["+t.clientId+"] Gateway length:"+t.host.length+" current index:"+t.hostIndex),t.hostIndex>=t.host.length?t.dispatchEvent(l({type:"recover"})):t.creatConnection()},t.replaceHost=function(e){t.host=e||t.host,t.hostIndex=0,t.creatConnection()},t.creatConnection=function(){t.needReconnect=!0,r.default.debug("["+t.clientId+"] start connect:"+t.host[t.hostIndex]),t.lts=(new Date).getTime(),t.connection=new WebSocket("wss://"+t.host[t.hostIndex]),t.connection.onopen=function(e){r.default.debug("["+t.clientId+"] websockect opened: "+t.host[t.hostIndex]),t.needReconnect=!0,t.isTimeout=!1,t.isInit=!1,t.sendbytes=0,t.recvbytes=0,t.startTime=Date.now(),Object(We.d)(),clearTimeout(t.timeoutCheck),t.dispatchEvent(l({type:"onopen",event:e,socket:t}))},t.connection.onmessage=function(e){t.recvbytes+=Object(me.e)(e.data);var n=JSON.parse(e.data);t.lastMsgTime=Date.now(),n.hasOwnProperty("_id")?t.dispatchEvent(l({type:n._id,msg:n})):n.hasOwnProperty("_type")&&t.dispatchSocketEvent(l({type:n._type,msg:n.message}))},t.connection.onclose=function(n){t.needReconnect?t.isTimeout||t.isInit?(r.default.debug("["+t.clientId+"] websockect connect timeout"),a.b.joinGateway(e.sid,{lts:t.lts,succ:!1,ec:"timeout",addr:t.connection.url}),t.connectNext()):t.dispatchEvent(l({type:"disconnect",event:n})):(r.default.debug("["+t.clientId+"] websockect closeed"),Ue(e.onFailure,n),clearTimeout(t.timeoutCheck),t.dispatchEvent(l({type:"close",event:n})),t.connection.onopen=void 0,t.connection.onclose=void 0,t.connection.onerror=void 0,t.connection.onmessage=void 0,t.connection=void 0)},t.connection.onerror=function(e){},setTimeout((function(){t.connection&&t.connection.readyState!=WebSocket.OPEN&&(t.isTimeout=!0,t.connection.close())}),5e3)},t.creatConnection(),t.sendMessage=function(e,n){if(t.connection&&t.connection.readyState==WebSocket.OPEN){var i=JSON.stringify(e);t.sendbytes+=Object(me.e)(i),t.connection.send(i)}else n({error:"Gateway not connected"})},t.disconnect=function(){t.needReconnect=!0,t.connection.close()},t.close=function(){t.needReconnect=!1,t.connection.onclose=void 0,t.connection.close()},t.sendSignalCommand=function(e,n){e._id="_request_"+t.requestID,t.requestID+=1,"publish_stats"!==e._type&&"subscribe_stats"!==e._type&&"publish_stats_low"!==e._type&&t.on(e._id,(function(i){i.msg&&n&&n(i.msg._result,i.msg.message),delete t.dispatcher.eventListeners[e._id]})),t.sendMessage(e,(function(e){e.reason="NOT_CONNECTED",n&&n(e.reason,e)}))},t}(t),n.on=n.signal.on,n.dispatchEvent=n.signal.dispatchEvent,n.signal.on("onopen",(function(e){n.signal.onEvent=function(e){n.dispatchEvent(l({type:e.event,msg:e}))},n.dispatchEvent(l({type:"connect",msg:e}))})),n.signal.on("onError",(function(e){var t=e.msg;onError(t.code,"error")}))},getLastMsgTime:function(){return n.signal&&n.signal.lastMsgTime},getSendBytes:function(){return n.signal.getSendBytes()},getRecvBytes:function(){return n.signal.getRecvBytes()},getDuration:function(){return n.signal.getDuration()},disconnect:function(){n.signal.disconnect()},close:function(){n.signal.close()},getURL:function(){return n.signal.getURL()},reconnect:function(){n.signal.reconnect()},connectNext:function(){n.signal.connectNext()},replaceHost:function(e){n.signal.replaceHost(e)},emitSimpleMessage:function(e,t){n.signal.sendSignalCommand(e,t)}};return n.connect(),n},He=n(10),ze=n.n(He),qe=n(15),Je=n.n(qe),Ke=function(e,t,n){var i={service_name:"webrtc_proxy",json_body:JSON.stringify(t)};Object(We.c)(e,i,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}),{"X-Packet-Service-Type":0,"X-Packet-URI":61})},Ye=function(e){if(!e||[]instanceof Array==0)return[];var t=[];return e.forEach((function(e){var n;e.address&&e.tcp?(e.address.match(/^[\.\:\d]+$/)?n="".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(r.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),n="".concat(e.address,":").concat(e.tcp)),t.push(n)):r.default.error("["+joinInfo.clientId+"] Invalid address format ",e)})),t},Xe={},Qe=function(e,t,n,i){var o=(new Date).getTime(),s="";t.multiIP&&t.multiIP.gateway_ip&&(s={vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]});var c={flag:4,ts:+new Date,key:t.appId,cname:t.cname,sid:t.sid,detail:{},uid:t.uid||0};s&&(c.detail[5]=JSON.stringify(s)),Object(We.c)(e+"".concat(-1===e.indexOf("?")?"?":"&","action=wrtc_gateway"),c,(function(s){try{var c=JSON.parse(s).res,d=c.code}catch(e){var u="requestChooseServer failed with unexpected body "+s;return r.default.error("["+joinInfo.clientId+"]",u),i(u)}if(d){var l=b[c.code]||d;return a.b.joinChooseServer(t.sid,{lts:o,succ:!1,csAddr:e,serverList:null,ec:l}),i("Get server node failed ["+l+"]",e,l)}var p=[],f=[".agora.io",".agoraio.cn"],m=0;if(e.indexOf(f[1])>-1&&(m=1),c.addresses.forEach((function(e){var t;e.ip&&e.port?(e.ip.match(/^[\.\:\d]+$/)?t="webrtc-".concat(e.ip.replace(/[^\d]/g,"-")).concat(f[m++%f.length],":").concat(e.port):(r.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),t="".concat(e.ip,":").concat(e.port)),p.push(t)):r.default.error("["+joinInfo.clientId+"] Invalid address format ",e)})),!p.length)return r.default.error("["+joinInfo.clientId+"] Empty Address response",c),l="EMPTY_ADDRESS_RESPONSE",a.b.joinChooseServer(t.sid,{lts:o,succ:!1,csAddr:e,serverList:null,ec:l}),i("Get server node failed ["+l+"]",e,l);var g={gateway_addr:p,uid:c.uid,cid:c.cid,uni_lbs_ip:c.detail};return n(g,e)}),(function(e,n){"timeout"===e.type?(a.b.joinChooseServer(t.sid,{lts:o,succ:!1,csAddr:n,serverList:null,ec:"timeout"}),i("Connect choose server timeout",n)):a.b.joinChooseServer(t.sid,{lts:o,succ:!1,csAddr:n,serverList:null,ec:"server_wrong"})}),{"X-Packet-Service-Type":0,"X-Packet-URI":44})},$e=function(e,t,n){var i=!1,s=null,c=1,d=1,u=null,l=e.clientId;Xe[l]=!0;var p=function t(n,d){if(!i){var p=!1,m=!1,g=[],v=f.getBrowserInfo()||{};(function(e,t){var n=h()({},e),i=Object(o.getParameter)("WEBCS_DOMAIN").concat(Object(o.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")),r=[],a=!1;(i=i.map((function(e){return n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1"):"https://".concat(e,"/api/v1")}))).map((function(e){!function(e,t,n){var i={flag:64,cipher_method:0,timeout:1e3,features:t};Object(We.c)(e,i,(function(e){try{var t=JSON.parse(e);n&&n(null,t)}catch(e){n&&n(e)}n&&n(null,e)}),(function(e){n&&n(e)}),{"X-Packet-Service-Type":0,"X-Packet-URI":54})}(e,n,(function(e,n){a||(e?(r.push(e),r.length>=i.length&&t&&t("ALL_REQUEST_FAILED")):(a=!0,t&&t(null,n)))}))}))})({device:v.name,system:v.os,vendor:e.appId,version:o.VERSION,cname:e.cname,sid:e.sid,session_id:Object(a.a)(),detail:"",proxyServer:n},(function(t,n){m=!0;try{var i=Object.keys(n.test_tags)[0],o=JSON.parse(n.test_tags[i]);u=o[1]}catch(e){u=null}a.b.reportApiInvoke(e.sid,{name:"_config-distribute-request",options:{err:t,res:n}})(),p&&d&&d(g,u)})),function(e,t,n){for(var i=(new Date).getTime(),s=!1,c=!0,d=function(n,o){if(s)a.b.joinChooseServer(e.sid,{lts:i,succ:!0,csAddr:o,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null},!1);else{if(clearTimeout(g),s=!0,r.default.debug("["+e.clientId+"] Get gateway address:",n.gateway_addr),e.proxyServer){for(var c=n.gateway_addr,d=0;d<c.length;d++){var u=c[d].split(":");n.gateway_addr[d]=e.proxyServer+"/ws/?h="+u[0]+"&p="+u[1]}r.default.debug("["+e.clientId+"] Get gateway address:",n.gateway_addr)}t(n),a.b.joinChooseServer(e.sid,{lts:i,succ:!0,csAddr:o,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null},!0)}},u=function(t,i,o){c&&(r.default.error("["+e.clientId+"]",t,i,o),o&&-1===E.indexOf(o)&&(c=!1,n(o)))},l=Object(o.getParameter)("WEBCS_DOMAIN"),p=0;p<l.length;++p){var f;if("string"==typeof l[p]){var m=l[p];f=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1"),r.default.debug("["+e.clientId+"] "+"Connect to choose_server: ".concat(f)),Qe(f,e,d,u)}else r.default.error("["+e.clientId+"] Invalid Host",l[p])}var g=setTimeout((function(){if(!s)for(var t=Object(o.getParameter)("WEBCS_DOMAIN_BACKUP_LIST"),n=0;n<t.length;++n)if("string"==typeof t[n]){var i=t[n];f=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(i+"/api/v1"):"https://".concat(i,"/api/v1"),r.default.debug("["+e.clientId+"] "+"Connect to backup_choose_server: ".concat(f)),Qe(f,e,d,u)}else r.default.error("["+e.clientId+"] Invalid Host",t[n])}),1e3);setTimeout((function(){!s&&c&&n()}),Object(o.getParameter)("WEBCS_BACKUP_CONNECT_TIMEOUT"))}(e,(function(e){i=!0,p=!0,g=e,clearTimeout(s),m&&d&&d(g,u)}),(function(i){i?r.default.info("["+e.clientId+"] Join failed: "+i):Xe[l]&&(r.default.debug("["+e.clientId+"] Request gateway list will be restart in "+c+"s"),s=setTimeout((function(){t(n,d)}),1e3*c),c=c>=3600?3600:2*c)}))}};e.useProxyServer?function n(){!function(e,t){!function(e,t){var n=!1,i=0,s={command:"convergeAllocateEdge",sid:e.sid,appId:e.appId,token:e.token,uid:e.uid,cname:e.cname,ts:Math.floor(Date.now()/1e3),version:o.VERSION,seq:0,requestId:1};Object(o.getParameter)("PROXY_CS").map((function(c){var d=(new Date).getTime();Ke("https://"+c+"/api/v1",s,(function(s,u){if(s)return r.default.debug("["+e.clientId+"] Request proxy server failed: ",s),i++,a.b.requestProxyAppCenter(e.sid,{lts:d,succ:!1,APAddr:c,workerManagerList:null,ec:JSON.stringify(s),response:JSON.stringify({err:s,res:u})}),void(i>=Object(o.getParameter)("PROXY_CS").length&&t&&t("Get proxy server failed: request all failed"));if(!n)if((u=JSON.parse(u)).json_body){var l=JSON.parse(u.json_body);if(r.default.debug("["+e.clientId+"] App return:",l.servers),200!==l.code)s="Get proxy server failed: response code ["+l.code+"], reason [ "+l.reason+"]",r.default.debug("["+e.clientId+"] "+s),a.b.requestProxyAppCenter(e.sid,{lts:d,succ:!1,APAddr:c,workerManagerList:null,ec:s,response:JSON.stringify({err:s,res:u})});else{n=!0;var p=Ye(l.servers);a.b.requestProxyAppCenter(e.sid,{lts:d,succ:!0,APAddr:c,workerManagerList:JSON.stringify(p),ec:null,response:JSON.stringify({res:u})}),t&&t(null,p)}}else r.default.debug("["+e.clientId+"] Get proxy server failed: no json_body"),a.b.requestProxyAppCenter(e.sid,{lts:d,succ:!1,APAddr:c,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:u})})}))}))}(e,(function(n,i){if(n)return t&&t(n);r.default.debug("["+e.clientId+"] getProxyServerList: ",i),function(e,t,n){var i=!1,o=0,s={command:"request",gatewayType:"http",appId:e.appId,cname:e.cname,uid:e.uid+"",sdkVersion:"2.3.1",sid:e.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:e.appId,cname:e.cname,uid:e.uid+"",sid:e.sid}};t.map((function(c){var d=(new Date).getTime();!function(e,t,n){Object(We.c)(e,t,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}))}("https://"+c+":4000/v2/machine",s,(function(s,u){if(s)return r.default.debug("["+e.clientId+"] Request worker manager failed: ",s),o++,a.b.requestProxyWorkerManager(e.sid,{lts:d,succ:!1,workerManagerAddr:c,ec:JSON.stringify(s),response:JSON.stringify({res:u})}),void(o>=t.length&&n&&n("requeet worker manager server failed: request failed"));if(!i){if(!(u=JSON.parse(u)).serverResponse)return n&&n("requeet worker manager server failed: serverResponse is undefined");i=!0,a.b.requestProxyWorkerManager(e.sid,{lts:d,succ:!0,workerManagerAddr:c,ec:JSON.stringify(s),response:JSON.stringify({res:u})}),n&&n(null,{address:c,serverResponse:u.serverResponse})}}))}))}(e,i,t)}))}(e,(function(i,o){if(i){if(r.default.debug("["+e.clientId+"]",i),!Xe[l])return;return r.default.debug("["+e.clientId+"] Request proxy will be restart in "+d+"s"),s=setTimeout((function(){n()}),1e3*d),void(d=d>=3600?3600:2*d)}clearTimeout(s);var c=o.address;e.proxyServer=c,e.turnServer={url:o.address,tcpport:o.serverResponse.tcpport||"3433",udpport:o.serverResponse.udpport||"3478",username:o.serverResponse.username||"test",credential:o.serverResponse.password||"111111",forceturn:!0},e.turnServer.tcpport+="",e.turnServer.udpport+="",a.b.setProxyServer(c),r.default.setProxyServer(c),p(c,t)}))}():p(null,t)},Ze=function(e,t){var n=Date.now(),i={sid:t.sid,opid:10,appid:t.appId,string_uid:t.stringUid};return new Promise((function(o,s){Object(We.c)(e+"".concat(-1===e.indexOf("?")?"?":"&","action=stringuid"),i,(function(c){try{var d=JSON.parse(c),u=d.code}catch(o){var l="requestUserAccount failed with unexpected body "+c;return r.default.error("["+t.clientId+"]",l),s({retryable:!0,info:l,url:e}),void a.b.reqUserAccount(i.sid,{lts:n,success:!1,serverAddress:e,stringUid:i.stringUid,uid:null,extend:c,errorCode:"BODY_NOT_JSON"})}if(u){var p=_[d.code%1e4]||"REQ_ACCOUNT_ERR_".concat(u);return a.b.reqUserAccount(i.sid,{lts:n,success:!1,serverAddress:e,stringUid:i.stringUid,uid:null,errorCode:p,extend:i}),s({retryable:!1,info:l="Get String Uid Failed ["+p+"]",url:e,error:p})}var f=d.uid;if(!(f>0&&f<Math.pow(2,32)))return r.default.error("["+t.clientId+"] "+"Invalid Uint Uid ".concat(t.stringUid," => ").concat(f),d),p="INVALID_UINT_UID_".concat(f),a.b.reqUserAccount(i.sid,{lts:n,success:!1,serverAddress:e,stringUid:i.stringUid,uid:null,errorCode:p,extend:i}),s({retryable:!0,error:p,info:"Get String Uid failed ["+p+"]",url:e});o({uid:f,url:e}),a.b.reqUserAccount(i.sid,{lts:n,success:!0,serverAddress:e,stringUid:i.stringUid,uid:f,errorCode:null,extend:i})}),(function(e,t){if("timeout"===e.type){var o="USER_ACCOUNT_TIMEOUT";a.b.reqUserAccount(i.sid,{lts:n,success:!1,serverAddress:t,stringUid:i.stringUid,uid:null,errorCode:o,extend:i}),s({retryable:!0,info:o,url:t})}else{var r="USER_ACCOUNT_SERVER_WRONG_".concat(e.type);a.b.reqUserAccount(i.sid,{lts:n,success:!1,serverAddress:t,stringUid:i.stringUid,uid:null,errorCode:r,extend:i}),s({retryable:!0,info:r,url:t})}}),{"X-Packet-Service-Type":0,"X-Packet-URI":72})}))},et=function(e){Date.now();var t,n=Object(o.getParameter)("ACCOUNT_REGISTER"),a=!1,s=Object(o.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT"),c=null,d=null,u=new Promise(function(){var u=Je()(ze.a.mark((function u(l,p){var f,m,g;return ze.a.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:c=l,d=p,t=0;case 3:if(!(t<Object(o.getParameter)("ACCOUNT_REGISTER_RETRY_COUNT_MAX"))){u.next=33;break}if(!a){u.next=6;break}return u.abrupt("return");case 6:return f=n[t%n.length],m=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(n[i]+"/api/v1"):"https://".concat(f,"/api/v1"),u.prev=8,u.delegateYield(ze.a.mark((function t(){var n;return ze.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ze(m,e);case 2:if(n=t.sent,!a){t.next=5;break}return t.abrupt("return",{v:void 0});case 5:a=!0,setTimeout((function(){r.default.debug("Get UserAccount Successfully",n),c(n)}),0);case 7:case"end":return t.stop()}}),t,this)}))(),"t0",10);case 10:if(g=u.t0,"object"!==ye()(g)){u.next=13;break}return u.abrupt("return",g.v);case 13:u.next=30;break;case 15:if(u.prev=15,u.t1=u.catch(8),!a){u.next=19;break}return u.abrupt("return");case 19:if(!u.t1.retryable){u.next=27;break}return(s=Math.ceil(s*Object(o.getParameter)("ACCOUNT_REGISTER_RETRY_RATIO")))>Object(o.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")&&(s=Object(o.getParameter)("ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX")),r.default.error("".concat(u.t1.info," ").concat(u.t1.url," Will Fetch User Account in ").concat(s/1e3," seconds")),u.next=25,new Promise((function(e){setTimeout(e,s)}));case 25:u.next=30;break;case 27:r.default.error("Get UserAccount Error: ".concat(u.t1.info," ").concat(u.t1.url),u.t1.error),a=!0,d(u.t1);case 30:t++,u.next=3;break;case 33:case"end":return u.stop()}}),u,this,[[8,15]])})));return function(e,t){return u.apply(this,arguments)}}());return u.cancel=function(){a||(a=!0,d({info:"Request Cancelled",retryable:!1}))},u.isFinished=function(){return a},u},tt={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},nt={googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_rem",googTypingNoiseState:"A_tns",totalSamplesDuration:"A_sd",googAdaptationChanges:"A_ac",googBandwidthLimitedResolution:"A_blr",googCpuLimitedResolution:"A_clr",googEncodeUsagePercent:"A_eup",googHasEnteredLowResolution:"A_helr",googActualEncBitrate:"A_aeb",googAvailableReceiveBandwidth:"A_arb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googTargetEncBitrate:"A_teb",googCaptureStartNtpTimeMs:"A_csnt",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sder",googSecondaryDiscardedRate:"A_sdir",googSpeechExpandRate:"A_ser",googFrameHeightReceived:"A_fhr",googInterframeDelayMax:"A_ifdm",googMinPlayoutDelayMs:"A_mpdm",aecDivergentFilterFraction:"A_dff",codecImplementationName:"A_cin",googEchoCancellationReturnLoss:"A_ecl",googEchoCancellationReturnLossEnhancement:"A_ece"},it={};for(var ot in nt){var rt=nt[ot];nt[rt]&&console.error("Key Conflict: ".concat(ot)),it[rt]=ot}var at=function(e){return nt[e]||e},st=function e(t){var n=!1,i=function(e){return{_type:"control",message:e}},c=function(e){var t={};return Object.keys(e).forEach((function(n){t[at(n)]=e[n]})),{_type:"subscribe_related_stats",options:t}},m=function(e,t,n){return{_type:"publish",options:e,sdp:t,p2pid:n}},g=e.DISCONNECTED,v=e.CONNECTING,y=e.CONNECTED,S=e.DISCONNECTING,b=g,_=s();Object.defineProperty(_,"state",{set:function(t){var n=b;b=t,n!==t&&_.dispatchEvent({type:"connection-state-change",prevState:e.connetionStateMap[n],curState:e.connetionStateMap[t]})},get:function(){return b}}),_.socket=void 0,_.state=g,_.mode=t.mode,_.role=t.role,_.codec=t.codec,_.config={},_.timers={},_.timer_counter={},_.localStreams={},_.remoteStreams={},_.attemps=1,_.p2p_attemps=1,_.audioLevel={},_.activeSpeaker=void 0,_.reconnectMode="retry",_.rejoinAttempt=0,_.hasChangeBGPAddress=!1,_.traffic_stats={},_.clientId=t.clientId,_.pingpongCounter=0,_.p2ps=new Map,_.liveStreams=new Map,_.injectLiveStreams=new Map,_.remoteStreamsInChannel=new Set,_.inChannelInfo={joinAt:null,duration:0};var E=Ue;_.p2pCounter=Object(me.g)(1e5),_.generateP2PId=function(){return++_.p2pCounter},_.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},_.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},_.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},_.configPublisher=function(e){_.config=e},_.getGatewayInfo=function(e,t){A({_type:"gateway_info"},e,t)},_.setClientRole=function(e,t){r.default.debug("[".concat(_.clientId,"] setClientRole to ").concat(e));var n=a.b.reportApiInvoke(_.joinInfo.sid,{name:"_setClientRole",callback:t});A(function(e){return{_type:"set_client_role",message:e}}(e),(function(){_.role=e,_.dispatchEvent({type:"client-role-changed",role:e}),n&&n(null,{role:e})}),(function(t){var i=t&&t.code?t.code:0,o=C[i];if("ERR_ALREADY_IN_USE"===o)return n&&n(null);o||(o="UNKNOW_ERROR_".concat(i)),r.default.error("set Client role error to "+e+": "+o),n&&n(o)}))},_.join=function(e,n,i,s){e.useProxyServer&&(_.hasChangeBGPAddress=!0);var c=(new Date).getTime(),d=e.uid;if(_.inChannelInfo.joinAt&&(_.inChannelInfo.duration+=c-_.inChannelInfo.joinAt),_.inChannelInfo.joinAt=c,_.state!==v)return r.default.error("[".concat(_.clientId,"] GatewayClient.join Failed: state "),_.state),s&&s(k),void a.b.joinGateway(e.sid,{lts:c,succ:!1,ec:k,addr:null});if(null!=d&&parseInt(d)!==d)return r.default.error("[".concat(_.clientId,"] Input uid is invalid")),_.state=g,s&&s(O),void a.b.joinGateway(e.sid,{lts:c,succ:!1,ec:O,addr:null});var u=ct.register(_,{uid:d,cname:e&&e.cname});if(u)return _.state=g,s&&s(u),void a.b.joinGateway(e.sid,{lts:c,succ:!1,ec:u,addr:null});_.joinInfo=h()({},e),_.uid=d,_.key=n,_.pingpongCounter=0,R(e,(function(n){var d,u;_.state=y,r.default.debug("[".concat(_.clientId,"] Connected to gateway server")),_.pingTimer=setInterval((function(){var e=Object(o.getParameter)("PING_PONG_TIME_OUT");if(++_.pingpongCounter>=e){var t=Date.now();r.default.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-_.socket.getLastMsgTime(),"ms")),_.socket&&_.socket.getLastMsgTime()&&t-_.socket.getLastMsgTime()>Object(o.getParameter)("WEBSOCKET_TIMEOUT_MIN")&&(_.pingpongCounter=0,_.socket.close(),_.socket.dispatchEvent(l({type:"disconnect",event:{msg:"PING_PONG_TIME_OUT"}})))}var n=Date.now();A({_type:"ping"},(function(){_.pingpongCounter=0;var e=Date.now()-n;A({_type:"signal_stats",message:{pingpongElapse:e}},(function(){}),(function(e){}))}),(function(e){}))}),3e3),A((d=_.role,u={appId:t.appId,key:_.key,channel:_.joinInfo.cname,uid:_.uid,version:o.VERSION,browser:navigator.userAgent,mode:_.mode,codec:_.codec,role:d,config:_.config,processId:Object(a.a)()},_.joinInfo.hasOwnProperty("stringUid")&&(u.stringUid=_.joinInfo.stringUid),{_type:"join1",message:u}),(function(t){if(a.b.joinGateway(e.sid,{lts:c,succ:!0,ec:null,vid:t.vid,addr:_.socket.getURL()}),_.rejoinAttempt=0,i&&i(t.uid),_.dispatchEvent({type:"join"}),_.leaveOnConnected){r.default.info("[".concat(_.clientId,"] Calling Leave() once joined"));var n=_.leaveOnConnected;_.leaveOnConnected=null,_.leave(n.onSuccess,n.onFailure)}}),(function(t){if(r.default.error("[".concat(_.clientId,"] User join failed [").concat(t,"]")),tt[t]&&_.rejoinAttempt<4){if(_._doWithAction(tt[t],i,s),_.leaveOnConnected){r.default.error("[".concat(_.clientId,"] Calling Leave() once joined: Join Failed"));var n=_.leaveOnConnected;_.leaveOnConnected=null,n.onFailure(j)}}else s&&s(t);a.b.joinGateway(e.sid,{lts:c,succ:!1,ec:t,addr:_.socket.getURL()})}))}),(function(t){r.default.error("[".concat(_.clientId,"] User join failed [").concat(t,"]")),s&&s(t),a.b.joinGateway(e.sid,{lts:c,succ:!1,ec:t,addr:_.socket.getURL()})})),clearInterval(_.timers.trafficStats),_.timers.trafficStats=setInterval((function(){A({_type:"traffic_stats"},(function(e){_.traffic_stats=e;var t=_.joinInfo.stringUid,n=_.localStreams[d]||_.localStreams[t];n&&(n.traffic_stats={access_delay:e.access_delay}),e.peer_delay&&e.peer_delay.forEach((function(t){var n=_.remoteStreams[t.peer_uid];n&&(n.traffic_stats={access_delay:e.access_delay,e2e_delay:t.e2e_delay,audio_delay:t.audio_delay,video_delay:t.video_delay})}))}))}),3e3),_.resetAudioVolumeIndication()},_.leave=function(e,t){switch(_.state){case g:return r.default.debug("[".concat(_.clientId,"] Client Already in DISCONNECTED status")),void E(e);case S:return r.default.error("[".concat(_.clientId,"] Client Already in DISCONNECTING status")),void E(t,k);case v:return _.leaveOnConnected?(r.default.error("[".concat(_.clientId,"] Client.leave() already called")),void E(t,k)):(r.default.debug("[".concat(_.clientId,"] Client connecting. Waiting for Client Fully Connected(And leave)")),void(_.leaveOnConnected={onSuccess:e,onFailure:t}))}var n=ct.unregister(_);if(n)r.default.error("[".concat(_.clientId,"] "),n);else{for(var i in _.state=S,clearInterval(_.pingTimer),_.timers)_.timers.hasOwnProperty(i)&&clearInterval(_.timers[i]);for(var i in _.inChannelInfo.joinAt&&(_.inChannelInfo.duration+=Date.now()-_.inChannelInfo.joinAt,_.inChannelInfo.joinAt=null),A({_type:"leave"},(function(t){_.socket.close(),_.socket=void 0,r.default.info("[".concat(_.clientId,"] Leave channel success")),_.state=g,e&&e(t)}),(function(e){r.default.error("[".concat(_.clientId,"] Leave Channel Failed"),e),_.state=y,t&&t(e)})),_.localStreams)if(_.localStreams.hasOwnProperty(i)){var o=_.localStreams[i];delete _.localStreams[i],void 0!==o.pc&&(o.pc.close(),o.pc=void 0)}G()}},_.publish=function(e,t,n,o){var s=(new Date).getTime(),c=!1;if(e.publishLTS=s,"object"!==ye()(e)||null===e)return r.default.error("[".concat(_.clientId,"] Invalid local stream")),o&&o(D),void a.b.publish(_.joinInfo.sid,{lts:s,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:D});if(null===e.stream&&void 0===e.url)return r.default.error("[".concat(_.clientId,"] Invalid local media stream")),o&&o(D),void a.b.publish(_.joinInfo.sid,{lts:s,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:D});if(_.state!==y)return r.default.error("[".concat(_.clientId,"] User is not in the session")),o&&o(k),void a.b.publish(_.joinInfo.sid,{lts:s,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:k});var d=e.getAttributes()||{};if(e.local&&void 0===_.localStreams[e.getId()]&&(e.hasAudio()||e.hasVideo()||e.hasScreen())){var l=_.generateP2PId();if(_.p2ps.set(l,e),e.p2pId=l,void 0!==e.url)x(m({state:"url",audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes(),mode:_.mode},e.url),(function(t,n){"success"===t?(e.getUserId()!==n&&e.setUserId(n),_.localStreams[n]=e,e.onClose=function(){_.unpublish(e)}):r.default.error("[".concat(_.clientId,"] Publish local stream failed"),t)}));else{_.localStreams[e.getId()]=e,e.connectionSpec={callback:function(d){r.default.debug("[".concat(_.clientId,"] SDP exchange in publish : send offer --  "),JSON.parse(d)),x(m({state:"offer",id:e.getId(),audio:e.hasAudio(),video:e.hasVideo()||e.hasScreen(),attributes:e.getAttributes(),streamType:t.streamType,dtx:e.DTX,hq:e.highQuality,lq:e.lowQuality,stereo:e.stereo,speech:e.speech,mode:_.mode,codec:_.codec,p2pid:l,turnip:_.joinInfo.turnServer.url,turnport:Number(_.joinInfo.turnServer.udpport),turnusername:_.joinInfo.turnServer.username,turnpassword:_.joinInfo.turnServer.credential},d),(function(p,f){if("error"===p)return r.default.error("[".concat(_.clientId,"] Publish local stream failed")),o&&o(F),void a.b.publish(_.joinInfo.sid,{lts:s,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,localSDP:d,ec:F});e.pc.onsignalingmessage=function(n){e.pc.onsignalingmessage=function(){},x(m({state:"ok",id:e.getId(),audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),streamType:t.streamType,attributes:e.getAttributes(),mode:_.mode},n)),e.getUserId()!==f.id&&e.setUserId(f.id),r.default.info("[".concat(_.clientId,"] Local stream published with uid"),f.id),e.onClose=function(){_.unpublish(e)},e._onAudioUnmute=function(){A(i({action:"audio-out-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoUnmute=function(){A(i({action:"video-out-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onAudioMute=function(){A(i({action:"audio-out-off",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoMute=function(){A(i({action:"video-out-off",streamId:e.getId()}),(function(){}),(function(){}))},e.getId()===e.getUserId()&&(e.isAudioOn()||e.hasAudio()&&(r.default.debug("[".concat(_.clientId,"] local stream audio mute")),e._onAudioMute()),e.isVideoOn()||(e.hasVideo()||e.hasScreen())&&(r.default.debug("[".concat(_.clientId,"] local stream video mute")),e._onVideoMute()))},e.pc.oniceconnectionstatechange=function(t){if("failed"===t){if(null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()]+"_RelatedStats")),r.default.error("[".concat(_.clientId,"] Publisher connection is lost -- streamId: ").concat(e.getId(),", p2pId: ").concat(l)),_.p2ps.delete(l),r.default.debug("[".concat(_.clientId,"] publish p2p failed: "),_.p2ps),!c)return c=!0,a.b.publish(_.joinInfo.sid,{lts:s,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:V}),_.dispatchEvent(u({type:"pubP2PLost",stream:e})),o&&o(V);_.dispatchEvent(u({type:"pubP2PLost",stream:e}))}else if("connected"===t&&(r.default.debug("[".concat(_.clientId,"] publish p2p connected: "),_.p2ps),!c))return c=!0,a.b.publish(_.joinInfo.sid,{lts:s,succ:!0,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:null}),n&&n()},r.default.debug("[".concat(_.clientId,"] SDP exchange in publish : receive answer --  "),JSON.parse(p)),e.pc.processSignalingMessage(p)}))},audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),isSubscriber:!1,stunServerUrl:_.stunServerUrl,turnServer:_.joinInfo.turnServer,maxAudioBW:d.maxAudioBW,minVideoBW:d.minVideoBW,maxVideoBW:d.maxVideoBW,mode:_.mode,codec:_.codec,isVideoMute:e.userMuteVideo||e.peerMuteVideo,isAudioMute:e.userMuteAudio||e.peerMuteAudio,maxFrameRate:e.attributes.maxFrameRate,clientId:_.clientId},e.pc=pe(e.connectionSpec),e.pc.addStream(e.stream),r.default.debug("[".concat(_.clientId,"] PeerConnection add stream :"),e.stream),e.pc.onnegotiationneeded=function(t){x(m({state:"negotiation",p2pid:l},t),(function(t,n){e.pc.processSignalingMessage(t)}))},_.timers[e.getId()]=setInterval((function(){var t=0;e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id&&!/_recv$/.test(n.id)&&!/^time$/.test(n.id)&&e.getUserId())if(-1===n.id.indexOf("outbound_rtp")&&-1===n.id.indexOf("OutboundRTP")||"video"!==n.mediaType||(n.googFrameWidthSent=e.videoWidth+"",n.googFrameHeightSent=e.videoHeight+""),e.getId()==e.getUserId()){var i=200*t;t++,setTimeout((function(){var e,t;A((e=n,t={},Object.keys(e).forEach((function(n){t[at(n)]=e[n]})),{_type:"publish_stats",options:{stats:t},sdp:null}),null,null)}),i)}else i=200*t,t++,setTimeout((function(){var e,t;A((e=n,t={},Object.keys(e).forEach((function(n){t[at(n)]=e[n]})),{_type:"publish_stats_low",options:{stats:t},sdp:null}),null,null)}),i)}))}))}),3e3);var p=function(){e&&e.pc&&e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats((function(t){var n,i;e.getId()===e.getUserId()?A((n=t,i={},Object.keys(n).forEach((function(e){i[at(e)]=n[e]})),{_type:"publish_related_stats",options:i}),null,null):A(function(e){var t={};return Object.keys(e).forEach((function(n){t[at(n)]=e[n]})),{_type:"publish_related_stats_low",options:t}}(t),null,null)}))};p(),_.timers[e.getId()+"_RelatedStats"]=setInterval(p,1e3)}}},_.unpublish=function(e,t,n,i){return"object"!==ye()(e)||null===e?(r.default.error("[".concat(_.clientId,"] Invalid local stream")),void E(i,D)):_.state!==y?(r.default.error("[".concat(_.clientId,"] User not in the session")),void E(i,k)):(null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()+"_RelatedStats"])),void(void 0!==_.socket?e.local&&void 0!==_.localStreams[e.getId()]?(delete _.localStreams[e.getId()],A((o=e.getUserId(),a=t.streamType,{_type:"unpublish",message:o,streamType:a})),(e.hasAudio()||e.hasVideo()||e.hasScreen())&&void 0===e.url&&void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e._onAudioMute=void 0,e._onAudioUnute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,_.p2ps.delete(e.p2pId),n&&n()):(r.default.error("[".concat(_.clientId,"] Invalid local stream")),E(i,D)):(r.default.error("[".concat(_.clientId,"] User not in the session")),E(i,k))));var o,a},_.subscribe=function(e,t,n){var s=(new Date).getTime();e.subscribeLTS=s;var l=!1;if(r.default.info("[".concat(_.clientId,"] Gatewayclient ").concat(_.uid," Subscribe ").concat(e.getId(),": ").concat(JSON.stringify(e.subscribeOptions))),"object"!==ye()(e)||null===e)return r.default.error("[".concat(_.clientId,"] Invalid remote stream")),n&&n(N),void a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:N});if(_.state!==y&&(r.default.error("[".concat(_.clientId,"] User is not in the session")),!l))return l=!0,a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:k}),n&&n(k);if(!e.local&&_.remoteStreams.hasOwnProperty(e.getId()))if(e.hasAudio()||e.hasVideo()||e.hasScreen()){var p=_.generateP2PId();_.p2ps.set(p,e),e.p2pId=p,e.pc=pe({callback:function(t){r.default.debug("[".concat(_.clientId,"] SDP exchange in subscribe : send offer --  "),JSON.parse(t));var i=h()({streamId:e.getId(),video:!0,audio:!0,mode:_.mode,codec:_.codec,p2pid:p,turnip:_.joinInfo.turnServer.url,turnport:Number(_.joinInfo.turnServer.udpport),turnusername:_.joinInfo.turnServer.username,turnpassword:_.joinInfo.turnServer.credential,tcc:Object(o.getParameter)("SUBSCRIBE_TCC")},e.subscribeOptions);x({_type:"subscribe",options:i,sdp:t,p2pid:void 0},(function(t){if("error"===t)return r.default.error("[".concat(_.clientId,"] Subscribe remote stream failed, closing stream "),e.getId()),e.close(),n&&n(B),void a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:B});r.default.debug("[".concat(_.clientId,"] SDP exchange in subscribe : receive answer --  "),JSON.parse(t)),e.pc.processSignalingMessage(t)}))},nop2p:!0,audio:!0,video:!0,screen:e.hasScreen(),isSubscriber:!0,stunServerUrl:_.stunServerUrl,turnServer:_.joinInfo.turnServer,isVideoMute:e.userMuteVideo,isAudioMute:e.userMuteAudio,uid:e.getId(),clientId:_.clientId}),e.pc.onaddstream=function(t,n){if(e._onAudioUnmute=function(){A(i({action:"audio-in-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onAudioMute=function(){A(i({action:"audio-in-off",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoUnmute=function(){A(i({action:"video-in-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoMute=function(){A(i({action:"video-in-off",streamId:e.getId()}),(function(){}),(function(){}))},"ontrack"===n&&"video"===t.track.kind||"onaddstream"===n){r.default.info("[".concat(_.clientId,"] Remote stream subscribed with uid "),e.getId());var o=_.remoteStreams[e.getId()];if(_.remoteStreams[e.getId()].stream="onaddstream"===n?t.stream:t.streams[0],_.remoteStreams[e.getId()].hasVideo()){if(Object(f.isFireFox)()||Object(f.isSafari)()){var a=_.remoteStreams[e.getId()].stream;Object(me.h)(a,(function(t,n){e.videoWidth=t,e.videoHeight=n}),(function(e){return r.default.warning("[".concat(_.clientId,"] vsResHack failed: ")+e)}))}}else{var s=_.remoteStreams[e.getId()];s.peerMuteVideo=!0,_._adjustPCMuteStatus(s)}o&&o.isPlaying()&&o.elementID&&(r.default.debug("[".concat(_.clientId,"] Reload Player ").concat(o.elementID," StreamId ").concat(o.getId())),e.audioOutput=o.audioOutput,o.stop(),e.play(o.elementID,o.playOptions)),delete e.audioLevelHelper;var c=d({type:"stream-subscribed",stream:_.remoteStreams[e.getId()]});_.dispatchEvent(c)}},_.timers[e.getId()]=setInterval((function(){var t=0;e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id){if(/_send$/.test(n.id)||/^time$/.test(n.id)||/^bweforvideo$/.test(n.id))return;-1===n.id.indexOf("inbound_rtp")&&-1===n.id.indexOf("inbound-rtp")||"video"!==n.mediaType||(n.googFrameWidthReceived=e.videoWidth+"",n.googFrameHeightReceived=e.videoHeight+"");var i=200*t;t++;var o=e.getId();setTimeout((function(){var e,t,i;x((e=o,t=n,i={},Object.keys(t).forEach((function(e){i[at(e)]=t[e]})),{_type:"subscribe_stats",options:{id:e,stats:i},sdp:null}),null,null)}),i)}}))}))}),3e3),_.timers[e.getId()+"_RelatedStats"]=setInterval((function(){e&&e.pc&&(e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats((function(e){A(c(e),null,null)})),e.pc.getAudioRelatedStats&&e.pc.getAudioRelatedStats((function(e){A(c(e),null,null)})))}),1e3),_.audioLevel[e.getId()]=0,_.timers[e.getId()+"audio"]=setInterval((function(){_.hasListeners("active-speaker")&&e&&e.pc&&"established"===e.pc.state&&e.pc.getStats&&e.pc.getStats((function(t){t.forEach((function(t){if("audio"===t.mediaType){if(t.audioOutputLevel>5e3)for(var n in _.audioLevel[e.getId()]<20&&(_.audioLevel[e.getId()]+=1),_.audioLevel)n!==""+e.getId()&&_.audioLevel[n]>0&&(_.audioLevel[n]-=1);var i=Object.keys(_.audioLevel).sort((function(e,t){return _.audioLevel[t]-_.audioLevel[e]}));if(_.activeSpeaker!==i[0]){var o=u({type:"active-speaker",uid:i[0]});_.dispatchEvent(o),_.activeSpeaker=i[0],r.default.debug("[".concat(_.clientId,"] Update active speaker: ").concat(_.activeSpeaker))}}}))}),50)}),50),e.pc.oniceconnectionstatechange=function(i){if("failed"===i)null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()]+"audio")),r.default.error("[".concat(_.clientId,"] Subscriber connection is lost -- streamId: ").concat(e.getId(),", p2pId: ").concat(p)),r.default.debug("[".concat(_.clientId,"] subscribe p2p failed: "),_.p2ps),l||(l=!0,n&&n(V),a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:V})),_.remoteStreams[e.getId()]&&_.p2ps.has(p)&&(_.p2ps.delete(p),_.dispatchEvent(u({type:"subP2PLost",stream:e})));else if("connected"===i&&(r.default.debug("[".concat(_.clientId,"] subscribe p2p connected: "),_.p2ps),!l)){l=!0,a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!0,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:null}),_._adjustPCMuteStatus(e);var o=!1,c=setInterval((function(){e.pc?e.pc.getStats((function(t){t.forEach((function(t){-1!==t.id.indexOf("recv")&&"audio"===t.mediaType&&parseInt(t.googDecodingNormal)>0&&(o||(o=!0,_.dispatchEvent({type:"first-audio-frame-decode",stream:e}),clearInterval(c),a.b.reportApiInvoke(_.joinInfo.sid,{name:"firstAudioDecode"})(null,{elapse:Date.now()-e.subscribeLTS})))}))}),100):clearInterval(c)}),100),d=!1,f=setInterval((function(){e.pc?e.pc.getStats((function(t){t.forEach((function(t){-1===t.id.indexOf("recv")&&-1===t.id.indexOf("inbound_rtp")&&-1===t.id.indexOf("inbound-rtp")&&-1===t.id.indexOf("InboundRTP")||"video"===t.mediaType&&(t.framesDecoded>0||t.googFramesDecoded>0)&&(d||(d=!0,_.dispatchEvent({type:"first-video-frame-decode",stream:e}),clearInterval(f),e.firstFrameTime=(new Date).getTime()-e.subscribeLTS,a.b.firstRemoteFrame(_.joinInfo.sid,{lts:(new Date).getTime(),peerid:e.getId(),succ:!0,width:+t.googFrameWidthReceived,height:+t.googFrameHeightReceived})))}))}),100):clearInterval(f)}),100);return e.sid=_.joinInfo.sid,t&&t()}}}else r.default.error("[".concat(_.clientId,"] Invalid remote stream")),l||(l=!0,n&&n(N),a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:N}));else r.default.error("[".concat(_.clientId,"] No such remote stream")),l||(l=!0,n&&n(W),a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:W}))},_.subscribeChange=function(e,t,n){var i,o,s=Date.now();r.default.info("[".concat(_.clientId,"] Gatewayclient ").concat(_.uid," SubscribeChange ").concat(e.getId(),": ").concat(JSON.stringify(e.subscribeOptions))),_._adjustPCMuteStatus(e),A((i=e.getId(),o=e.subscribeOptions,{_type:"subscribe_change",options:h()({streamId:i},o)}),(function(i){if("error"===i)return r.default.error("[".concat(_.clientId,"] Subscribe Change Failed ").concat(e.getId())),void E(n,"SUBSCRIBE_CHANGE_FAILED");var o=d({type:"stream-subscribe-changed",stream:_.remoteStreams[e.getId()]});a.b.subscribe(_.joinInfo.sid,{lts:s,succ:!0,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:null}),_.dispatchEvent(o),t&&t()}),n)},_._adjustPCMuteStatus=function(e){!e.local&&e.pc&&e.pc.peerConnection.getReceivers&&e.pc.peerConnection.getReceivers().forEach((function(t){if(t&&t.track&&"audio"===t.track.kind){var n=!e.userMuteAudio&&!e.peerMuteAudio;e.subscribeOptions&&!e.subscribeOptions.audio&&(n=!1),t.track.enabled=!!n}else if(t&&t.track&&"video"===t.track.kind){var i=!e.userMuteVideo&&!e.peerMuteVideo;e.subscribeOptions&&!e.subscribeOptions.video&&(i=!1),t.track.enabled=!!i}}))},_.unsubscribe=function(e,t,n){if("object"!==ye()(e)||null===e)return r.default.error("[".concat(_.clientId,"] Invalid remote stream")),void E(n,N);if(_.state!==y)return r.default.error("[".concat(_.clientId,"] User is not in the session")),void E(n,k);if(null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()]+"audio")),null!=_.audioLevel[e.getId()]&&delete _.audioLevel[e.getId()],null!=_.timer_counter[e.getId()]&&delete _.timer_counter[e.getId()],_.remoteStreams.hasOwnProperty(e.getId())){if(!_.socket)return r.default.error("[".concat(_.clientId,"] User is not in the session")),void E(n,k);if(e.local)return r.default.error("[".concat(_.clientId,"] Invalid remote stream")),void E(n,N);e.close(),A({_type:"unsubscribe",message:e.getId()},(function(i){if("error"===i)return r.default.error("[".concat(_.clientId,"] Unsubscribe remote stream failed ").concat(e.getId())),void E(n,U);void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e._onAudioMute=void 0,e._onAudioUnute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,delete e.subscribeOptions,_.p2ps.delete(e.p2pId),r.default.info("[".concat(_.clientId,"] Unsubscribe stream success")),t&&t()}),n)}else E(n,W)},_.setRemoteVideoStreamType=function(e,t){if(r.default.debug("[".concat(_.clientId,"] Switching remote video stream ").concat(e.getId()," to ").concat(t)),"object"===ye()(e)&&null!==e)if(_.state===y){if(!e.local){switch(t){case _.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case _.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case _.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}A(function(e,t){return{_type:"switchVideoStream",message:{id:e,type:t}}}(e.getId(),t),null,null)}}else r.default.error("[".concat(_.clientId,"] User is not in the session"));else r.default.error("[".concat(_.clientId,"] Invalid remote stream"))},_.renewToken=function(e,t,n){e?_.key?_.state!==y?(r.default.debug("[".concat(_.clientId,"] Client is not connected. Trying to rejoin")),_.key=e,_.rejoin(),t&&t()):(r.default.debug("[".concat(_.clientId,"] renewToken from ").concat(_.key," to ").concat(e)),A(function(e){return{_type:"renew_token",message:{token:e}}}(e),t,n)):(r.default.error("[".concat(_.clientId,"] Client is previously joined without token")),n&&n(O)):(r.default.error("[".concat(_.clientId,"] Invalid Token ").concat(e)),n&&n(O))},_.setStreamFallbackOption=function(e,t){if(r.default.debug("[".concat(_.clientId,"] Set stream fallback option ").concat(e.getId()," to ").concat(t)),"object"===ye()(e)&&null!==e)if(_.state===y){if(!e.local){switch(t){case _.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case _.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case _.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}A(function(e,t){return{_type:"setFallbackOption",message:{id:e,type:t}}}(e.getId(),t),null,null)}}else r.default.error("[".concat(_.clientId,"] User is not in the session"));else r.default.error("[".concat(_.clientId,"] Invalid remote stream"))},_.startLiveStreaming=function(e,t){_.liveStreams.set(e,t),r.default.debug("[".concat(_.clientId,"] Start live streaming ").concat(e," ").concat(t," ").concat(t)),_.state===y?A(function(e,t){return{_type:"start_live_streaming",message:{url:e,transcodingEnabled:t}}}(e,t),null,null):r.default.error("[".concat(_.clientId,"] User is not in the session"))},_.stopLiveStreaming=function(e){r.default.debug("[".concat(_.clientId,"] Stop live streaming ").concat(e)),_.state===y?(_.liveStreams.delete(e),A(function(e){return{_type:"stop_live_streaming",message:{url:e}}}(e),null,null)):r.default.error("[".concat(_.clientId,"] User is not in the session"))},_.setLiveTranscoding=function(e){Object(me.d)(e)&&(_.transcoding=e,r.default.debug("[".concat(_.clientId,"] Set live transcoding "),e),_.state===y?A(function(e){return{_type:"set_live_transcoding",message:{transcoding:e}}}(e),null,null):r.default.error("[".concat(_.clientId,"] User is not in the session")))},_.addInjectStreamUrl=function(e,t){_.injectLiveStreams.set(e,t),r.default.debug("[".concat(_.clientId,"] Add inject stream url ").concat(e," config "),t),_.state===y?A(function(e,t){return{_type:"add_inject_stream_url",message:{url:e,config:t}}}(e,t),null,null):r.default.error("[".concat(_.clientId,"] User is not in the session"))},_.removeInjectStreamUrl=function(e){r.default.debug("[".concat(_.clientId,"] Remove inject stream url ").concat(e)),_.state===y?(_.injectLiveStreams.delete(e),A(function(e){return{_type:"remove_inject_stream_url",message:{url:e}}}(e),null,null)):r.default.error("[".concat(_.clientId,"] User is not in the session"))},_.enableAudioVolumeIndicator=function(e,t){_.audioVolumeIndication.enabled=!0,_.audioVolumeIndication.interval=e,_.audioVolumeIndication.smooth=t,_.resetAudioVolumeIndication()},_.resetAudioVolumeIndication=function(){if(clearInterval(_.timers.audioVolumeIndication),clearInterval(_.timers.audioVolumeSampling),_.audioVolumeIndication.enabled&&_.audioVolumeIndication.interval){var e=Math.floor(1e3*_.audioVolumeIndication.smooth/100);_.timers.audioVolumeSampling=setInterval((function(){_.audioVolumeSampling||(_.audioVolumeSampling={});var t={};for(var n in _.remoteStreams){var i=_.remoteStreams[n];if(i.stream&&i.hasAudio()){var o=i.getAudioLevel();o>0&&o<1&&(o*=100);var r=_.audioVolumeSampling[n]||[];for(r.push(o);r.length>e;)r.shift();t[n]=r}}_.audioVolumeSampling=t}),100),_.timers.audioVolumeIndication=setInterval((function(){var e=[];for(var t in _.remoteStreams)if(_.audioVolumeSampling&&_.audioVolumeSampling[t]){var n=_.audioVolumeSampling[t],i=0;n.forEach((function(e){i+=e}));var o={uid:t,level:Math.floor(i/n.length)};o.level&&e.push(o)}var a=e.sort((function(e,t){return e.level-t.level}));r.default.debug("[".concat(_.clientId,"] volume-indicator "),JSON.stringify(a)),_.audioVolumeIndication.sortedAudioVolumes=a;var s=u({type:"volume-indicator",attr:a});_.dispatchEvent(s)}),_.audioVolumeIndication.interval)}},_.closeGateway=function(){r.default.debug("[".concat(_.clientId,"] close gateway")),_.state=g,_.socket.close(),T()};var T=function(){for(var e in _.timers)_.timers.hasOwnProperty(e)&&clearInterval(_.timers[e]);for(var e in _.remoteStreams)if(_.remoteStreams.hasOwnProperty(e)){var t=_.remoteStreams[e],n=u({type:"stream-removed",uid:t.getId(),stream:t});_.dispatchEvent(n)}_.p2ps.clear(),G(),M(),clearInterval(_.pingTimer)};_.rejoin=function(){_.socket&&(clearInterval(_.pingTimer),_.socket.close(),_.socket=void 0),_.state=v,w()};var w=function(e,t){_.dispatchEvent(u({type:"rejoin-start"})),e=e||function(e){r.default.info("[".concat(_.clientId,"] User ").concat(e," is re-joined to ").concat(_.joinInfo.cname)),_.dispatchEvent(u({type:"rejoin"})),_.liveStreams&&_.liveStreams.size&&_.liveStreams.forEach((function(e,t){e&&_.setLiveTranscoding(_.transcoding),_.startLiveStreaming(t,e)})),_.injectLiveStreams&&_.injectLiveStreams.size&&_.injectLiveStreams.forEach((function(e,t){_.addInjectStreamUrl(t,e)}))},t=t||function(e){r.default.error("[".concat(_.clientId,"] Re-join to channel failed "),e),_.dispatchEvent(d({type:"error",reason:e}))},_.key?(++_.rejoinAttempt,_.join(_.joinInfo,_.key,e,t)):r.default.error("[".concat(_.clientId,"] Connection recover failed [Invalid channel key]"))},R=function(e,t,i){var o;_.onConnect=t,_.socket?(_.dispatchEvent({type:"reconnect"}),"retry"===_.reconnectMode?(r.default.debug("[".concat(_.clientId,"] Retry current gateway")),_.socket.reconnect()):"tryNext"===_.reconnectMode?(r.default.debug("[".concat(_.clientId,"] Try next gateway")),_.socket.connectNext()):"recover"===_.reconnectMode&&(r.default.debug("[".concat(_.clientId,"] Recover gateway")),r.default.debug("[".concat(_.clientId,"] Try to reconnect choose server and get gateway list again ")),$e(_.joinInfo,(function(e){_.socket.replaceHost(e.gateway_addr)})))):(o=e.gatewayAddr,_.socket=Ge(o,{sid:_.joinInfo.sid,clientId:_.clientId}),_.socket.on("onUplinkStats",(function(e){_.OutgoingAvailableBandwidth=e.uplink_available_bandwidth,_.localStreams[_.uid]&&(_.localStreams[_.uid].uplinkStats=e)})),_.socket.on("connect",(function(){_.dispatchEvent({type:"connected"}),_.attemps=1,A(function(e){var t=e;return e.uni_lbs_ip&&(t=h()(e,{wanip:e.uni_lbs_ip,hasChange:_.hasChangeBGPAddress})),{_type:"token",message:t}}(e),_.onConnect,i)})),_.socket.on("recover",(function(){_.state=v,r.default.debug("[".concat(_.clientId,"] Try to reconnect choose server and get gateway list again ")),$e(_.joinInfo,(function(e){_.socket.replaceHost(e.gateway_addr)}))})),_.socket.on("disconnect",(function(e){if(_.state!==g){_.state=g;var t=d({type:"error",reason:L});if(_.dispatchEvent(t),0===_.p2ps.size?_.reconnectMode="tryNext":_.reconnectMode="retry",T(),1!=n){var i,o=(i=_.attemps,1e3*Math.min(30,Math.pow(2,i)-1));r.default.error("[".concat(_.clientId,"] Disconnect from server [").concat(JSON.stringify(e),"], attempt to recover [#").concat(_.attemps,"] after ").concat(o/1e3," seconds")),setTimeout((function(){_.attemps++,_.state=v,w()}),o)}}})),_.socket.on("onAddAudioStream",(function(e){if(r.default.info("[".concat(_.clientId,"] Newly added audio stream with uid ").concat(e.id)),_.joinInfo.stringUid&&"string"!=typeof e.id&&r.default.error("StringUID is Mixed with UintUID"),_.remoteStreamsInChannel.has(e.id)||_.remoteStreamsInChannel.add(e.id),void 0===_.remoteStreams[e.id]){var t=Le({streamID:e.id,local:!1,audio:e.audio,video:e.video,screen:e.screen,attributes:e.attributes});t.peerMuteVideo=!0,_.remoteStreams[e.id]=t;var n=d({type:"stream-added",stream:t});_.dispatchEvent(n)}})),_.socket.on("onUpdateStream",(function(e){var t=_.remoteStreams[e.id];if(_.joinInfo.stringUid&&"string"!=typeof e.id&&r.default.error("StringUID is Mixed with UintUID"),t){delete e.id,t.audio=e.audio,t.video=e.video,t.screen=e.screen,t.pc&&_._adjustPCMuteStatus(t);var n=d({type:"stream-updated",stream:t});_.dispatchEvent(n)}else r.default.debug("[".concat(_.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(e.id))})),_.socket.on("onAddVideoStream",(function(e){if(r.default.info("[".concat(_.clientId,"] Newly added remote stream with uid ").concat(e.id,".")),_.joinInfo.stringUid&&"string"!=typeof e.id&&r.default.error("StringUID is Mixed with UintUID"),_.remoteStreamsInChannel.has(e.id)||_.remoteStreamsInChannel.add(e.id),void 0===_.remoteStreams[e.id]){var t=Le({streamID:e.id,local:!1,audio:e.audio,video:e.video,screen:e.screen,attributes:e.attributes});_.remoteStreams[e.id]=t;var n=d({type:"stream-added",stream:t});_.dispatchEvent(n)}else{var i=_.remoteStreams[e.id];if(i.peerMuteVideo=!1,i.video=!0,void 0!==i.stream){if((t=_.remoteStreams[e.id]).pc&&_._adjustPCMuteStatus(t),r.default.info("[".concat(_.clientId,"] Stream changed: enable video ").concat(e.id)),t.isPlaying()){var o=t.player.elementID;t.stop(),t.play(o,t.playOptions)}}else i.p2pId?_.remoteStreams[e.id].video=!0:(t=Le({streamID:e.id,local:!1,audio:!0,video:!0,screen:!1,attributes:e.attributes}),_.remoteStreams[e.id]=t,r.default.info("[".concat(_.clientId,"] Stream changed: modify video ").concat(e.id)))}})),_.socket.on("onRemoveStream",(function(e){_.remoteStreamsInChannel.has(e.id)&&_.remoteStreamsInChannel.delete(e.id);var t=_.remoteStreams[e.id];if(t){delete _.remoteStreams[e.id];var n=d({type:"stream-removed",stream:t});_.dispatchEvent(n),t.close(),void 0!==t.pc&&(t.pc.close(),t.pc=void 0,_.p2ps.delete(t.p2pId))}else console.log("ERROR stream ",e.id," not found onRemoveStream ",e)})),_.socket.on("onPublishStream",(function(e){var t=_.localStreams[e.id],n=d({type:"streamPublished",stream:t});_.dispatchEvent(n)})),_.socket.on("mute_audio",(function(e){r.default.info("[".concat(_.clientId,"] rcv peer mute audio: ").concat(e.peerid));var t=u({type:"mute-audio",uid:e.peerid}),n=_.remoteStreams[e.peerid];n?(n.peerMuteAudio=!0,n.pc&&_._adjustPCMuteStatus(n)):r.default.debug("Ignoring event ".concat(e.type),e),_.dispatchEvent(t)})),_.socket.on("unmute_audio",(function(e){r.default.info("[".concat(_.clientId,"] rcv peer unmute audio: ").concat(e.peerid));var t=u({type:"unmute-audio",uid:e.peerid}),n=_.remoteStreams[e.peerid];n?(n.peerMuteAudio=!1,n.pc&&_._adjustPCMuteStatus(n)):r.default.debug("Ignoring event ".concat(e.type),e),_.dispatchEvent(t)})),_.socket.on("mute_video",(function(e){r.default.info("[".concat(_.clientId,"] rcv peer mute video: ").concat(e.peerid));var t=u({type:"mute-video",uid:e.peerid}),n=_.remoteStreams[e.peerid];n?(n.peerMuteVideo=!0,n.pc&&_._adjustPCMuteStatus(n)):r.default.debug("Ignoring event ".concat(e.type),e),_.dispatchEvent(t)})),_.socket.on("unmute_video",(function(e){r.default.info("[".concat(_.clientId,"] rcv peer unmute video: ").concat(e.peerid));var t=u({type:"unmute-video",uid:e.peerid}),n=_.remoteStreams[e.peerid];n?(n.peerMuteVideo=!1,n.pc&&_._adjustPCMuteStatus(n)):r.default.debug("Ignoring event ".concat(e.type),e),_.dispatchEvent(t)})),_.socket.on("user_banned",(function(e){r.default.info("[".concat(_.clientId,"] user banned uid: ").concat(e.id," error: ").concat(e.errcode));var t=u({type:"client-banned",uid:e.id,attr:e.errcode});_.dispatchEvent(t),n=!0})),_.socket.on("stream_fallback",(function(e){r.default.info("[".concat(_.clientId,"] stream fallback uid: ").concat(e.id," peerId: ").concat(e.peerid," type: ").concat(e.type));var t=u({type:"stream-fallback",uid:e.id,stream:e.peerid,attr:e.type});_.dispatchEvent(t)})),_.socket.on("stream_recover",(function(e){r.default.info("[".concat(_.clientId,"] stream recover uid: ").concat(e.id," peerId: ").concat(e.peerid," type: ").concat(e.type));var t=u({type:"stream-recover",uid:e.id,stream:e.peerid,attr:e.type});_.dispatchEvent(t)})),_.socket.on("onP2PLost",(function(e){r.default.debug("[".concat(_.clientId,"] p2plost: "),e,"p2ps:",_.p2ps);var t,n="DTLS failed";(t=_.localStreams[e.uid]||_.remoteStreams[e.uid])?(t.pc&&t.pc.offerCandidates&&0===t.pc.offerCandidates.length&&(n="NO_CANDIDATES_IN_OFFER"),"publish"===e.event&&a.b.publish(_.joinInfo.sid,{lts:t.publishLTS,succ:!1,audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:n}),"subscribe"===e.event&&a.b.subscribe(_.joinInfo.sid,{lts:t.subscribeLTS,succ:!1,video:t.subscribeOptions&&t.subscribeOptions.video,audio:t.subscribeOptions&&t.subscribeOptions.audio,peerid:e.uid+"",ec:n})):r.default.warning("P2PLost Stream Not found",e),r.default.debug("[".concat(_.clientId,"] p2plost:"),e.p2pid),(t=_.p2ps.get(e.p2pid))&&(_.p2ps.delete(e.p2pid),t.local?_.dispatchEvent(u({type:"pubP2PLost",stream:t,attr:n})):_.remoteStreams[t.getId()]&&_.dispatchEvent(u({type:"subP2PLost",stream:t,attr:n})))})),_.socket.on("onTokenPrivilegeWillExpire",(function(e){r.default.debug("[".concat(_.clientId,"] Received Message onTokenPrivilegeWillExpire")),_.dispatchEvent(u({type:"onTokenPrivilegeWillExpire"}))})),_.socket.on("onTokenPrivilegeDidExpire",(function(){r.default.warning("[".concat(_.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),_.closeGateway(),_.dispatchEvent(u({type:"onTokenPrivilegeDidExpire"}))})),_._doWithAction=function(e,t,n){"tryNext"===e?function(e,t){r.default.debug("[".concat(_.clientId,"] Connect next gateway")),_.state=g,_.socket.close(),T(),_.reconnectMode="tryNext",w(e,t)}(t,n):"retry"===e?function(e,t){r.default.debug("[".concat(_.clientId,"] Reconnect gateway")),_.state=g,_.socket.close(),T(),_.reconnectMode="retry",w(e,t)}(t,n):"quit"===e?(r.default.debug("[".concat(_.clientId,"] quit gateway")),_.state=g,_.socket.close(),T()):"recover"===e&&(r.default.debug("[".concat(_.clientId,"] Reconnect gateway")),_.state=g,_.socket.close(),T(),_.reconnectMode="recover",w())},_.socket.on("notification",(function(e){if(r.default.debug("[".concat(_.clientId,"] Receive notification: "),e),"ERR_JOIN_BY_MULTI_IP"===I[e.code])return _.dispatchEvent({type:"onMultiIP",arg:e});e.detail?_._doWithAction(tt[I[e.code]]):e.action&&_._doWithAction(e.action)})),_.socket.on("onPeerLeave",(function(e){var t=u({type:"peer-leave",uid:e.id});if(_.remoteStreamsInChannel.has(e.id)&&_.remoteStreamsInChannel.delete(e.id),_.remoteStreams.hasOwnProperty(e.id)&&(t.stream=_.remoteStreams[e.id]),_.dispatchEvent(t),_.remoteStreams.hasOwnProperty(e.id)){r.default.info("[".concat(_.clientId,"] closing stream on peer leave"),e.id);var n=_.remoteStreams[e.id];n.close(),delete _.remoteStreams[e.id],void 0!==n.pc&&(n.pc.close(),n.pc=void 0,_.p2ps.delete(n.p2pId))}_.timers.hasOwnProperty(e.id)&&(clearInterval(_.timers[e.id]),clearInterval(_.timers[e.id]+"_RelatedStats"),delete _.timers[e.id]),null!=_.audioLevel[e.id]&&delete _.audioLevel[e.id],null!=_.timer_counter[e.id]&&delete _.timer_counter[e.id]})),_.socket.on("onUplinkStats",(function(e){})),_.socket.on("liveStreamingStarted",(function(e){var t=p({type:"liveStreamingStarted",url:e.url});_.dispatchEvent(t)})),_.socket.on("liveStreamingFailed",(function(e){var t=p({type:"liveStreamingFailed",url:e.url});_.dispatchEvent(t)})),_.socket.on("liveStreamingStopped",(function(e){var t=p({type:"liveStreamingStopped",url:e.url});_.dispatchEvent(t)})),_.socket.on("liveTranscodingUpdated",(function(e){var t=p({type:"liveTranscodingUpdated",reason:e.reason});_.dispatchEvent(t)})),_.socket.on("streamInjectedStatus",(function(e){var t=p({type:"streamInjectedStatus",url:e.url,uid:e.uid,status:e.status});_.dispatchEvent(t)})),_.socket.on("onUserOnline",(function(e){_.joinInfo.stringUid&&"string"!=typeof e.id&&r.default.error("StringUID is Mixed with UintUID"),_.dispatchEvent({type:"peer-online",uid:e.id})})))},A=function(e,t,n){if(void 0===_.socket)return r.default.error("[".concat(_.clientId,"] No socket available")),void E(n,k);try{_.socket.emitSimpleMessage(e,(function(e,i){"success"===e?"function"==typeof t&&t(i):"function"==typeof n&&n(I[i]||i)}))}catch(t){r.default.error("[".concat(_.clientId,"] Socket emit message failed ").concat(JSON.stringify(e))),r.default.error("[".concat(_.clientId,"] "),t),E(n,P)}},x=function(e,t){if(void 0!==_.socket)try{_.socket.emitSimpleMessage(e,(function(e,n){t&&t(e,n)}))}catch(e){r.default.error("[".concat(_.clientId,"] Error in sendSimpleSdp [").concat(e,"]"))}else r.default.error("[".concat(_.clientId,"] Error in sendSimpleSdp [socket not ready]"))},M=function(){for(var e in _.localStreams)if(void 0!==_.localStreams[e]){var t=_.localStreams[e];delete _.localStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}},G=function(){for(var e in _.remoteStreamsInChannel.clear(),_.remoteStreams)if(_.remoteStreams.hasOwnProperty(e)){var t=_.remoteStreams[e];t.isPlaying()&&t.stop(),t.close(),delete _.remoteStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}};return _},ct={_gatewayClients:{},register:function(e,t){if(!t.uid){var n="NO_UID_PROVIDED";return r.default.error("[".concat(e.clientId,"] "),n,t),n}return t.cname?this._gatewayClients[t.cname]&&this._gatewayClients[t.cname][t.uid]&&this._gatewayClients[t.cname][t.uid]!==e?(n="UID_CONFLICT",r.default.error("[".concat(e.clientId,"] "),n,t),n):(r.default.debug("[".concat(e.clientId,"] register client Channel"),t.cname,"Uid",t.uid),this._gatewayClients[t.cname]||(this._gatewayClients[t.cname]={}),this._gatewayClients[t.cname][t.uid]=e,null):(n="NO_CHANNEL_PROVIDED",r.default.error("[".concat(e.clientId,"] "),n,t),n)},unregister:function(e){var t=e&&e.uid,n=e.joinInfo&&e.joinInfo.cname;if(!t||!n){var i="INVALID_GATEWAYCLIENT";return r.default.error("[".concat(e.clientId,"] "),i),i}if(this._gatewayClients[n]&&this._gatewayClients[n][t])return this._gatewayClients[n][t]!==e?(i="GATEWAYCLIENT_UID_CONFLICT",r.default.error("[".concat(e.clientId,"] "),i),i):(r.default.debug("[".concat(e.clientId,"] unregister client "),e.uid),delete this._gatewayClients[n][t],null);i="GATEWEAY_CLIENT_UNREGISTERED",r.default.error("[".concat(e.clientId,"] "),i)}};st.DISCONNECTED=0,st.CONNECTING=1,st.CONNECTED=2,st.DISCONNECTING=3,st.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"};var dt=st,ut=function(e){var t;switch(e){case"120p":case"120p_1":t=["120p_1","120p_1","120p_1"];break;case"120p_3":t=["120p_3","120p_3","120p_3"];break;case"180p":case"180p_1":t=["90p_1","90p_1","180p_1"];break;case"180p_3":t=["120p_3","120p_3","180p_3"];break;case"180p_4":t=["120p_1","120p_1","180p_4"];break;case"240p":case"240p_1":t=["120p_1","120p_1","240p_1"];break;case"240p_3":t=["120p_3","120p_3","240p_3"];break;case"240p_4":t=["120p_4","120p_4","240p_4"];break;case"360p":case"360p_1":case"360p_4":case"360p_9":case"360p_10":case"360p_11":t=["90p_1","90p_1","360p_1"];break;case"360p_3":case"360p_6":t=["120p_3","120p_3","360p_3"];break;case"360p_7":case"360p_8":t=["120p_1","120p_1","360p_7"];break;case"480p":case"480p_1":case"480p_2":case"480p_4":case"480p_10":t=["120p_1","120p_1","480p_1"];break;case"480p_3":case"480p_6":t=["120p_3","120p_3","480p_3"];break;case"480p_8":case"480p_9":t=["120p_4","120p_4","480p_8"];break;case"720p":case"720p_1":case"720p_2":case"720p_3":t=["90p_1","90p_1","720p_1"];break;case"720p_5":case"720p_6":t=["120p_1","120p_1","720p_5"];break;case"1080p":case"1080p_1":case"1080p_2":case"1080p_3":case"1080p_5":t=["90p_1","90p_1","1080p_1"];break;case"1440p":case"1440p_1":case"1440p_2":t=["90p_1","90p_1","1440p_1"];break;case"4k":case"4k_1":case"4k_3":t=["90p_1","90p_1","4k_1"];break;default:t=["120p_1","120p_1","360p_7"]}return Object(f.isOpera)()?[e,15,50]:Object(f.isFireFox)()?[t[1],15,100]:Object(f.isSafari)()?[t[2],15,50]:[t[0],15,50]},lt={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},pt={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},ft=function(e){var t={remoteStreamStorage:{},localStreamStorage:{}};return t.gatewayClient=e,t.checkAudioOutputLevel=function(e){return!(e&&parseInt(e.audioRecvBytesDelta)>0&&parseInt(e.audioDecodingNormalDelta)>0&&0===parseInt(e.audioOutputLevel))},t.checkAudioIntputLevel=function(e){return!e||0!==parseInt(e.audioInputLevel)},t.checkFramerateInput=function(e,t){if(!e||!t.attributes)return!0;var n=parseInt(t.attributes.maxFrameRate),i=parseInt(e.googFrameRateInput);return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)},t.checkFramerateSent=function(e){return!(e&&parseInt(e.googFrameRateInput)>5&&parseInt(e.googFrameRateSent)<=1)},t.checkSendVideoBitrate=function(e){return!e||0!==parseInt(e.videoSendBytesDelta)},t.checkSendAudioBitrate=function(e){return!e||0!==parseInt(e.audioSendBytesDelta)},t.checkVideoDecode=function(e){return!e||0===parseInt(e.videoRecvBytesDelta)||0!==parseInt(e.googFrameRateDecoded)},t.checkAudioDecode=function(e){return!e||0===parseInt(e.audioRecvBytesDelta)||0!==parseInt(e.audioDecodingNormalDelta)},t.record=function(e,n,i,o,r){i[e]||(i[e]={isPrevNormal:!0,record:[]});var a=i[e],s=t["check"+e](n,r);if(a.record.push(s),a.record.length>=5){a.isCurNormal=-1!==a.record.indexOf(!0);var c=pt[e];a.isPrevNormal&&!a.isCurNormal&&t.gatewayClient.dispatchEvent({type:"exception",code:c,msg:lt[c],uid:o}),!a.isPrevNormal&&a.isCurNormal&&t.gatewayClient.dispatchEvent({type:"exception",code:c+2e3,msg:lt[c+2e3],uid:o}),a.isPrevNormal=a.isCurNormal,a.record=[]}},t.setLocalStats=function(e){var n={};Object.keys(e).map((function(i){var o=e[i],r=t.gatewayClient.localStreams[parseInt(i)],a=t.localStreamStorage[i]||{};r&&r.hasVideo()&&(t.record("SendVideoBitrate",o.videoStats,a,i),t.record("FramerateInput",o.videoStats,a,i,r),t.record("FramerateSent",o.videoStats,a,i)),r&&r.hasAudio()&&(t.record("AudioIntputLevel",o.audioStats,a,i),t.record("SendAudioBitrate",o.audioStats,a,i)),n[i]=a})),t.localStreamStorage=n},t.setRemoteStats=function(n){var i={};Object.keys(n).map((function(o){var r=n[o],a=e.remoteStreams[o],s=t.remoteStreamStorage[o]||{};a&&a.hasVideo()&&a.isPlaying()&&t.record("VideoDecode",r.videoStats,s,o),a&&a.hasAudio()&&a.isPlaying()&&(t.record("AudioOutputLevel",r.audioStats,s,o),t.record("AudioDecode",r.audioStats,s,o)),i[o]=s})),t.remoteStreamStorage=i},t},mt=new function(){var e=s();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.type=null,e.lastConnectedAt=null,e.lastDisconnectedAt=null,e.lastTypeChangedAt=null,e.networkChangeTimer=null,e._init=function(t,n){if(e.state=e.states.INITING,navigator.connection&&navigator.connection.addEventListener){var i=e._getNetworkInfo();e.type=i&&i.type,e.state=e.states.INITED,t&&t()}else e.state=e.states.UNINIT,n&&n("DO_NOT_SUPPORT")},e._getNetworkInfo=function(){return navigator.connection},e._reloadNetworkInfo=function(){var t=e._getNetworkInfo(),n=t&&t.type||"UNSUPPORTED",i=Date.now();if(n!==e.type){e.lastTypeChangedAt=i,"none"==n?e.lastDisconnectedAt=i:"none"==e.type&&(e.lastConnectedAt=i),e.type=n;var o={type:"networkTypeChanged",networkType:n};e.dispatchEvent(o)}},e.getStats=function(t,n){var i={},o=e._getNetworkInfo();o&&(i.NetworkType=o.type||"UNSUPPORTED"),setTimeout((function(){t(i)}),0)},e._init((function(){navigator.connection.addEventListener("change",(function(){e._reloadNetworkInfo()})),e.networkChangeTimer=setInterval((function(){e._reloadNetworkInfo()}),5e3)}),(function(e){})),e},gt=function(e){var t={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServer:{},useProxyServer:!1};return t.mode=e.mode,t.clientId=Object(me.b)().slice(0,5),t.uintUid=null,e=h()({},e),t.aespassword=null,t.aesmode="none",t.hasPublished=!1,t.getConnectionState=function(){var n=a.b.reportApiInvoke(e.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),i=dt.connetionStateMap[t.gatewayClient.state];return n(),i},t.setClientRole=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{callback:i,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(Se(n,"setClientRole",["host","audience"]),"rtc"===t.mode){var s="RTC mode can not use setClientRole";return r.default.warning("[".concat(t.clientId,"] ").concat(s)),o&&o(s)}t.gatewayClient&&t.gatewayClient.state===dt.CONNECTED?("audience"===n&&(0===this.highStreamState?this._unpublish(this.highStream,(function(){o&&o(null,{role:n})}),(function(e){o&&o(e)})):t.gatewayClient.setClientRole("audience",o)),"host"===n&&t.gatewayClient.setClientRole("host",o)):(t.gatewayClient.role=n,o&&o(null,{role:n}))},t.getGatewayInfo=function(e){if(t.gatewayClient.state!==dt.CONNECTED){var n="Client is not in connected state";return r.default.error("[".concat(t.clientId,"] ").concat(n)),void e(n)}t.gatewayClient.getGatewayInfo((function(t){e(null,t)}),e)},t.renewToken=function(n,i,o){var s=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return o&&o(e);i&&i(t)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Re(n))throw new Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");return t.gatewayClient?t.key?(t.key=n,void t.gatewayClient.renewToken(n,(function(e){return s(null,e)}),s)):(r.default.error("[".concat(t.clientId,"] renewToken should not be called before user join")),s(k)):(r.default.error("[".concat(t.clientId,"] renewToken Failed. GatewayClient not Exist")),s(k))},t.setLowStreamParameter=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});be(n,"param");var o=n.width,s=n.height,c=n.framerate,d=n.bitrate;De(o)||_e(o,"width"),De(s)||_e(s,"height"),De(c)||_e(c,"framerate"),De(d)||_e(d,"bitrate",1,1e7),(!o&&s||o&&!s)&&r.default.warning("[".concat(t.clientId,"] The width and height parameters take effect only when both are set")),t.lowStreamParameter=n,i()},t.init=function(n,i,o){var s=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return o&&o(e);i&&i(t)},name:"Client.init",options:arguments,tag:"tracer"});Ie(n),Object(f.isChromeKernel)()&&Object(f.getChromeKernelVersion)()<=48?o?s(ee):Object(me.f)():(r.default.info("[".concat(t.clientId,"] Initializing AgoraRTC client, appId: ").concat(n,".")),e.appId=n,e.sessionId=Object(me.b)(),s())},t.setTurnServer=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==dt.DISCONNECTED)throw new Error("Set turn server before join channel");if(t.useProxyServer)throw new Error("You have already set the proxy");be(n,"turnServer");var o=n.turnServerURL,s=n.username,c=n.password,d=n.udpport,u=n.forceturn,l=n.tcpport;Ie(o,"turnServerURL"),Ie(s,"username"),Ie(c,"password"),Ie(d,"udpport"),De(u)||Ee(u,"forceturn"),t.turnServer.url=o,t.turnServer.udpport=d,t.turnServer.username=s,t.turnServer.credential=c,t.turnServer.forceturn=u||!1,De(l)||(Ie(l,"tcpport"),t.turnServer.tcpport=l,r.default.info("[".concat(t.clientId,"] Set turnserver tcpurl. ").concat(t.turnServer.url,":").concat(t.turnServer.tcpport))),r.default.info("[".concat(t.clientId,"] Set turnserver udpurl. ").concat(t.turnServer.url,":").concat(t.turnServer.udpport,",username: ").concat(t.turnServer.uername,",password: ").concat(t.turnServer.credential)),i()},t.setProxyServer=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==dt.DISCONNECTED)throw new Error("Set proxy server before join channel");if(!n)throw new Error("Do not set the proxyServer parameter as empty");if(t.useProxyServer)throw new Error("You have already set the proxy");Ie(n,"proxyServer"),t.proxyServer=n,a.b.setProxyServer(n),r.default.setProxyServer(n),i()},t.startProxyServer=function(){var n=a.b.reportApiInvoke(e.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==dt.DISCONNECTED)throw new Error("Start proxy server before join channel");if(t.proxyServer||t.turnServer.url)throw new Error("You have already set the proxy");t.useProxyServer=!0,n()},t.stopProxyServer=function(){var n=a.b.reportApiInvoke(e.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==dt.DISCONNECTED)throw new Error("Stop proxy server after leave channel");a.b.setProxyServer(),r.default.setProxyServer(),t.turnServer={},t.proxyServer=null,t.useProxyServer=!1,n()},t.setEncryptionSecret=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});Ie(n,"password"),t.aespassword=n,i()},t.setEncryptionMode=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(Ie(n,"encryptionMode"),-1===Be.indexOf(n))throw new Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb"');t.aesmode=n,i()},t.configPublisher=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});be(n,"config");var o=n.width,r=n.height,s=n.framerate,c=n.bitrate,d=n.publisherUrl;_e(o,"width"),_e(r,"height"),_e(s,"framerate"),_e(c,"bitrate",1,1e7),d&&Ie(d,"publisherUrl"),t.gatewayClient.configPublisher(n),i()},t.enableDualStream=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return"iOS"===Object(f.getBrowserOS)()?(a.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),o(G)):Object(f.isWeChatBrowser)()?(a.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),o(H)):(a.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!0}),t.isDualStream=!0,void(0===t.highStreamState?t._publishLowStream((function(e){return o(null,e)}),(function(e){r.default.warning("[".concat(t.clientId,"]"),e),o(Q)})):1===t.highStreamState?o(q):o(null)))},t.disableDualStream=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});a.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!1,succ:!0}),t.isDualStream=!1,0===t.highStreamState?t._unpublishLowStream((function(){t.highStream.lowStream=null,o()}),(function(e){r.default.warning("[".concat(t.clientId,"]"),e),o($)})):1===t.highStreamState?o(q):o()},t._createLowStream=function(e,n){if(t.highStream&&t.highStream.stream){var i=h()({},t.highStream.params);if(i.streamID+=1,i.audio=!1,i.video){var a=t.highStream.stream.getVideoTracks()[0];a?ve.getVideoCameraIdByLabel(a.label,(function(a){i.cameraId=a;var s=new Le(i);if(s.streamId=t.highStream.getId()+1,t.lowStreamParameter){var c=h()({},t.lowStreamParameter);if(!c.width||!c.height){var d=ut(t.highStream.profile),u=o.SUPPORT_RESOLUTION_LIST[d[0]];c.width=u[0],c.height=u[1]}c.framerate=c.framerate||5,c.bitrate=c.bitrate||50,(Object(f.isSafari)()||Object(f.isOpera)())&&(r.default.debug("[".concat(t.clientId,"] Shimming lowStreamParameter")),u=o.SUPPORT_RESOLUTION_LIST[t.highStream.profile],c.width=u[0],c.height=u[1]),s.setVideoProfileCustomPlus(c)}else s.setVideoProfileCustom(ut(t.highStream.profile));s.init((function(){t.highStream.lowStream=s,t.highStream.userMuteVideo&&s.muteVideo(),e&&e(s)}),n)}),n):n&&n(Y)}else n&&n(Y)}else n&&n(Y)},t._getLowStream=function(e,n){t.lowStream?e(t.lowStream):t._createLowStream((function(n){t.lowStream=n,e(t.lowStream)}),n)},t._publishLowStream=function(e,n){return 2!==t.lowStreamState?n&&n(J):t.highStream&&t.highStream.hasScreen()?n&&n(z):void t._getLowStream((function(i){t.lowStreamState=1,t.gatewayClient.publish(i,{streamType:1},(function(){t.lowStreamState=0,e&&e()}),(function(e){r.default.debug("[".concat(t.clientId,"] publish low stream failed")),n&&n(e)}))}),n)},t._unpublishLowStream=function(e,n){if(0!==t.lowStreamState)return n&&n(K);t.lowStream&&(t.gatewayClient.unpublish(t.lowStream,{streamType:1},(function(){}),(function(e){r.default.debug("[".concat(t.clientId,"] unpublish low stream failed")),n&&n(e)})),t.lowStream.close(),t.lowStream=null,t.lowStreamState=2,e&&e())},t.join=function(n,i,o,s,c){var d,u=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return c&&c(e);s&&s(t)},name:"Client.join",options:arguments,tag:"tracer"});if(n&&!Re(n))return r.default.warning("[".concat(t.clientId,"] Param channelKey should be string")),u(O);if(!ke(d=i)||!/^[a-zA-Z0-9!#$%&()+-:;<=.>?@[\]^_{}|~,\s]{1,64}$/.test(d))return r.default.error("Invalid Channel Name ".concat(i)),r.default.warning("[".concat(t.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),u(O);if("string"==typeof i&&""===i)return r.default.warning("[".concat(t.clientId,"] Param channel should not be empty")),u(O);if(o&&!Object(me.c)(o)&&!Ce(o,1,255))return r.default.error("Invalid UID ".concat(o," ").concat(ye()(o))),r.default.warning("[".concat(t.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")),u(O);if("string"==typeof o&&0==o.length)return r.default.warning("[".concat(t.clientId,"] String uid should not be empty")),u(O);if("string"==typeof o&&o.length>256)return r.default.warning("[".concat(t.clientId,"] Length of string uid should be less than 255")),u(O);t.highStream=null,t.lowStream=null,t.lowStreamParameter=null,t.isDualStream=!1,t.highStreamState=2,t.lowStreamState=2;var l={clientId:t.clientId,appId:e.appId,sid:e.sessionId,cname:i,uid:o,turnServer:t.turnServer,proxyServer:t.proxyServer,token:n||e.appId,useProxyServer:t.useProxyServer};if("string"==typeof o&&(l.stringUid=o,t.uintUid?(l.uid=t.uintUid,delete t.uintUid):l.uid=0),t.aespassword&&"none"!==t.aesmode&&h()(l,{aespassword:t.aespassword,aesmode:t.aesmode}),a.b.sessionInit(e.sessionId,{lts:(new Date).getTime(),cname:i,appid:e.appId,mode:e.mode,succ:!0}),t.onSuccess=function(e){t.rtcStatsCollector.startNetworkQualityTimer(),t.onSuccess=null,u(null,e)},t.onFailure=function(e){return u(e)},t.channel=i,t.gatewayClient.state!==dt.DISCONNECTED)return r.default.error("[".concat(t.clientId,"] Client already in connecting/connected state")),u(k),void a.b.joinGateway(e.sessionId,{lts:Date.now(),succ:!1,ec:k,addr:null});t.gatewayClient.state=dt.CONNECTING;var p=function(o,a){r.default.info("[".concat(t.clientId,"] Joining channel: ").concat(i)),t.gatewayClient.dispatchEvent({type:"config-distribute",config:a,joinInfo:l}),t.key=n||e.appId,l.cid=o.cid,l.uid||(l.uid=o.uid),l.clientId=t.clientId,o.uni_lbs_ip&&o.uni_lbs_ip[1]&&(l.uni_lbs_ip=o.uni_lbs_ip[1]),l.gatewayAddr=o.gateway_addr,t.joinInfo=l,t.gatewayClient.join(l,t.key,(function(e){r.default.info("[".concat(t.clientId,"] Join channel ").concat(i," success, join with uid: ").concat(e,".")),t.onSuccess=null,t.rtcStatsCollector.startNetworkQualityTimer(),u(null,e)}),(function(e){return u(e)}))};l.stringUid&&!l.uid?(self.userAccountReq&&!self.userAccountReq.isFinished()&&self.userAccountReq.cancel(),self.userAccountReq=et(l),self.userAccountReq.then((function(e){r.default.debug("getUserAccount Success ".concat(e.url," ").concat(l.stringUid," => ").concat(e.uid)),l.uid=e.uid,$e(l,p)})).catch((function(e){r.default.error("getUserAccount rejected",e),u(e)}))):$e(l,p)},t.renewChannelKey=function(n,i,o){var s=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return o&&o(e);i&&i(t)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});Ie(n,"key",1,2047),void 0===t.key?(r.default.error("[".concat(t.clientId,"] renewChannelKey should not be called before user join")),s(k)):(t.key=n,t.gatewayClient.key=n,t.gatewayClient.rejoin(),s())},t.leave=function(n,i){var s=!1,c=a.b.reportApiInvoke(e.sessionId,{callback:function(e,o){if(e)return i&&i(e);var r;r=t.clientId,Xe[r]=!1,t._renewSession(),t.rtcStatsCollector.clearNetworkQualityTimer(),n&&n(o)},name:"Client.leave",options:arguments,tag:"tracer"});r.default.info("[".concat(t.clientId,"] Leaving channel")),self.userAccountReq&&!self.userAccountReq.isFinished()&&(self.userAccountReq.cancel(),t.gatewayClient.state===dt.CONNECTING&&(t.gatewayClient.state=dt.DISCONNECTED)),t.gatewayClient.leave((function(e){s=!0,c(null,e)}),c),setTimeout((function(){s||(t.gatewayClient.socket&&(t.gatewayClient.socket.close(),t.gatewayClient.socket=null),t.gatewayClient.state=dt.DISCONNECTED,c(null,"LEAVE_MSG_TIMEOUT"))}),Object(o.getParameter)("LEAVE_MSG_TIMEOUT"))},t._renewSession=function(){var n=Object(me.b)();if(r.default.debug("renewSession ".concat(e.sessionId," => ").concat(n)),e.sessionId=n,t.joinInfo&&(t.joinInfo.sid=n),t.gatewayClient&&(t.gatewayClient.joinInfo&&(t.gatewayClient.joinInfo.sid=n),t.gatewayClient.localStreams))for(var i in t.gatewayClient.localStreams){var o=t.gatewayClient.localStreams[i];o&&(o.sid=n)}},t._publish=function(n,i,o){if(2!==t.highStreamState)return r.default.warning("[".concat(t.clientId,"] Can't publish stream when stream already publish ").concat(n.getId())),o&&o(x);r.default.info("[".concat(t.clientId,"] Publishing stream, uid ").concat(n.getId())),t.highStream=n,t.highStreamState=1,t.highStream.streamId=t.joinInfo.stringUid||t.joinInfo.uid,t.hasPublished=!1;var a=function(n,i,o){t.gatewayClient.publish(n,{streamType:0},(function(){n.sid=e.sessionId,t.highStreamState=0,r.default.info("[".concat(t.clientId,"] Publish success, uid: ").concat(n.getId())),t.isDualStream?t._publishLowStream((function(){i&&i()}),(function(e){r.default.warning("[".concat(t.clientId,"] "),e),i&&i()})):i&&i()}),o)};"audience"===t.gatewayClient.role&&"live"===t.mode?t.gatewayClient.setClientRole("host",(function(e){if(e)return o&&o(e);a(n,i,o)})):a(n,i,o)},t._unpublish=function(e,n,i){if(0!==t.highStreamState)return r.default.warning("[".concat(t.clientId,"] Can't unpublish stream when stream not publish")),i&&i(M);r.default.info("[".concat(t.clientId,"] Unpublish stream, uid ").concat(e.getId()));var o=function(e,n,i){t.isDualStream&&t.lowStream&&t._unpublishLowStream(null,i),t.gatewayClient.unpublish(e,{streamType:0},(function(){t.highStreamState=2,r.default.info("[".concat(t.clientId,"] Unpublish stream success, uid: ").concat(e.getId())),n&&n()}),(function(n){r.default.info("[".concat(t.clientId,"] Unpublish stream fail, uid: ").concat(e.getId())),i&&i(n)}))};"host"===t.gatewayClient.role&&"live"===t.mode?t.gatewayClient.setClientRole("audience",(function(t){if(t)return i&&i(t);o(e,n,i)})):o(e,n,i)},t.publish=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});2===t.highStreamState?t._publish(n,(function(e){return o(null,e)}),(function(e){return o(e)})):o(x)},t.unpublish=function(n,i,o){var r=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e);o&&o(t)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});0===t.highStreamState?t._unpublish(n,(function(e){return r(null,e)}),(function(e){return r(e)})):r(M)},t.subscribe=function(n,i,o){var s=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return o&&o(e)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:i,onFailure:!!o}});"function"==typeof i&&(o=i,i=null),be(n,"stream"),De(i)||(be(i,"options"),De(i.video)||Ee(i.video,"options.video"),De(i.audio)||Ee(i.audio,"options.audio"));var c={video:!0,audio:!0};if(!De(i)){if(Object(f.isSafari)()&&(!i.video||!i.audio)){var d="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return r.default.error("[".concat(t.clientId,"] "),d),void s(d)}if(!De(i.video)&&!we(i.video)||!De(i.audio)&&!we(i.audio)||!1===i.audio&&!1===i.video)return d="INVALID_PARAMETER ".concat(JSON.stringify(i)),r.default.error("[".concat(t.clientId,"] "),d),void s(d)}n.subscribeOptions?(h()(n.subscribeOptions,c,i),t.gatewayClient.subscribeChange(n,(function(e){return s(null,e)}),s)):(n.subscribeOptions=h()({},c,i),t.gatewayClient.subscribe(n,(function(e){return s(null,e)}),s))},t.unsubscribe=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});r.default.info("[".concat(t.clientId,"] Unsubscribe stream, uid: ").concat(n.getId())),t.gatewayClient.unsubscribe(n,(function(e){return o(null,e)}),o)},t.setRemoteVideoStreamType=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:i}});Se(i,"streamType",[0,1]),t.gatewayClient.setRemoteVideoStreamType(n,i),o()},t.setStreamFallbackOption=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:i}});Se(i,"fallbackType",[0,1,2]),t.gatewayClient.setStreamFallbackOption(n,i),o()},t.startLiveStreaming=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});Ie(n,"url"),De(i)||Ee(i,"transcodingEnabled"),t.gatewayClient.startLiveStreaming(n,i),o()},t.stopLiveStreaming=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"});Ie(n,"url"),t.gatewayClient.stopLiveStreaming(n),i()},t.setLiveTranscoding=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"});be(n,"transcoding");var o=n.width,r=n.height,s=n.videoBitrate,c=n.videoFramerate,d=n.lowLatency,u=n.audioSampleRate,l=n.audioBitrate,p=n.audioChannels,f=n.videoGop,m=n.videoCodecProfile,g=n.userCount,v=n.backgroundColor,y=n.transcodingUsers;if(De(o)||_e(o,"width"),De(r)||_e(r,"height"),De(s)||_e(s,"videoBitrate",1,1e6),De(c)||_e(c,"videoFramerate"),De(d)||Ee(d,"lowLatency"),De(u)||Se(u,"audioSampleRate",[32e3,44100,48e3]),De(l)||_e(l,"audioBitrate",1,128),De(p)||Se(p,"audioChannels",[1,2,3,4,5]),De(f)||_e(f,"videoGop"),De(m)||Se(m,"videoCodecProfile",[66,77,100]),De(g)||_e(g,"userCount",0,17),De(v)||_e(v,"backgroundColor",0,16777215),!De(y)){if(!(y instanceof Array))throw new Error("[transcodingUsers]: transcodingUsers should be Array");if(y.length>17)throw new Error("The length of transcodingUsers cannot greater than 17");y.map((function(e,t){if(!De(e.uid)&&!Object(me.c)(e.uid)&&!Ce(e.uid,1,255))throw new Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");if(De(e.x)||_e(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),De(e.y)||_e(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),De(e.width)||_e(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),De(e.height)||_e(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),De(e.zOrder)||_e(e.zOrder,"transcodingUser[".concat(t,"].zOrder"),0,100),!(De(e.alpha)||"number"==typeof e.alpha&&e.alpha<=1&&e.alpha>=0))throw new Error("transcodingUser[${index}].alpha: The value range is [0, 1]")}))}h()(vt,n),t.gatewayClient.setLiveTranscoding(vt),i()},t.addInjectStreamUrl=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{name:"Client.addInjectStreamUrl",options:arguments,tag:"tracer"});Ie(n,"url",1,255),be(i,"config"),!De(i&&i.width)&&_e(i.width,"config.width",0,1e4),!De(i&&i.height)&&_e(i.height,"config.height",0,1e4),!De(i&&i.videoGop)&&_e(i.videoGop,"config.videoGop",1,1e4),!De(i&&i.videoFramerate)&&_e(i.videoFramerate,"config.videoFramerate",1,1e4),!De(i&&i.videoBitrate)&&_e(i.videoBitrate,"config.videoBitrate",1,1e4),!De(i&&i.audioSampleRate)&&Se(i.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),!De(i&&i.audioBitrate)&&_e(i.audioBitrate,"config.audioBitrate",1,1e4),!De(i&&i.audioChannels)&&_e(i.audioChannels,"config.audioChannels",1,2),h()(ht,i),t.gatewayClient.addInjectStreamUrl(n,ht),o()},t.removeInjectStreamUrl=function(n){var i=a.b.reportApiInvoke(e.sessionId,{name:"Client.removeInjectStreamUrl",options:arguments,tag:"tracer"});Ie(n,"url",1,255),t.gatewayClient.removeInjectStreamUrl(n),i()},t.enableAudioVolumeIndicator=function(n,i){var o=a.b.reportApiInvoke(e.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});n=n||2e3,_e(i=i||3,"smooth",1,100),_e(n,"interval",50,1e5),t.audioVolumeIndication=t.audioVolumeIndication||{enabled:!0},t.audioVolumeIndication.interval=n,t.audioVolumeIndication.smooth=i,t.audioVolumeIndication={interval:n,smooth:i},r.default.info("[".concat(t.clientId,"] enableAudioVolumeIndicator interval ").concat(n," smooth ").concat(i)),t.gatewayClient.enableAudioVolumeIndicator(n,i),o()},t.getNetworkStats=function(e,n){return r.default.deprecate("[".concat(t.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),mt.getStats(e,n)},t.getSystemStats=function(e,t){return g.getStats(e,t)},t.getRecordingDevices=function(e,t){return ve.getRecordingDevices(e,t)},t.getPlayoutDevices=function(e,t){return ve.getPlayoutDevices(e,t)},t.getCameras=function(e,t){return ve.getCameras(e,t)},t.getRemoteAudioStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioStats(e,n)},t.getLocalAudioStats=function(e,n){return t.rtcStatsCollector.getLocalAudioStats(e,n)},t.getRemoteVideoStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoStats(e,n)},t.getLocalVideoStats=function(e,n){return t.rtcStatsCollector.getLocalVideoStats(e,n)},t._getRemoteVideoQualityStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoQualityStats(e,n)},t._getRemoteAudioQualityStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioQualityStats(e,n)},t.getTransportStats=function(e,n){return t.rtcStatsCollector.getTransportStats((function(t){return mt.getStats((function(n){var i=h()({},t,n);e&&e(i)}),n)}),n)},t.getSessionStats=function(e,n){return t.rtcStatsCollector.getSessionStats(e,n)},t.onNetworkQuality=function(){return t.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},e.clientId=t.clientId,t.gatewayClient=dt(e),t.on=t.gatewayClient.on,t.off=t.gatewayClient.removeEventListener,t.rtcStatsCollector=function(e){var t=s();return t.gatewayClient=e,t.exceptionMonitor=new ft(e),t.localStats={},t.remoteStats={},t.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},t.getRemoteAudioStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];ge(o,"End2EndDelay",r.peer_delay&&r.peer_delay.audio_delay),ge(o,"TransportDelay",r.peer_delay&&r.peer_delay.e2e_delay),ge(o,"PacketLossRate",r.peer_delay&&r.peer_delay.e2e_audio_lost_ratio_400ms),ge(o,"RecvLevel",r.audioStats&&r.audioStats.audioOutputLevel),ge(o,"RecvBitrate",r.audioRecvBitrate),ge(o,"CodecType",r.audioStats&&r.audioStats.googCodecName),ge(o,"MuteState",r.audioDisabled),ge(o,"TotalFreezeTime",r.audioStats&&r.audioStats.audioTotalFreezeTime),ge(o,"TotalPlayDuration",r.audioStats&&r.audioStats.audioTotalPlayDuration),n[i]=o}e&&e(n)},t.getLocalAudioStats=function(e){var n={};for(var i in t.localStats){var o={},r=t.localStats[i];ge(o,"RecordingLevel",r.audioStats&&r.audioStats.audioInputLevel),ge(o,"SendLevel",r.audioStats&&r.audioStats.totalAudioEnergy),ge(o,"SamplingRate",r.audioStats&&r.audioStats.totalSamplesDuration),ge(o,"SendBitrate",r.audioSendBitrate),ge(o,"CodecType",r.audioStats&&r.audioStats.googCodecName),ge(o,"MuteState",r.audioDisabled);var a=t.gatewayClient.localStreams[i];a&&a.isPlaying()&&ge(o,"MuteState",a.userMuteAudio?"1":"0"),n[i]=o}e&&e(n)},t.getRemoteVideoStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];ge(o,"End2EndDelay",r.peer_delay&&r.peer_delay.video_delay),ge(o,"TransportDelay",r.peer_delay&&r.peer_delay.e2e_delay),ge(o,"PacketLossRate",r.peer_delay&&r.peer_delay.e2e_video_lost_ratio_400ms),ge(o,"RecvBitrate",r.videoRecvBitrate),ge(o,"RecvResolutionWidth",r.videoStats&&r.videoStats.googFrameWidthReceived),ge(o,"RecvResolutionHeight",r.videoStats&&r.videoStats.googFrameHeightReceived),ge(o,"RenderResolutionWidth",r.videoStats&&r.videoStats.renderRemoteWidth),ge(o,"RenderResolutionHeight",r.videoStats&&r.videoStats.renderRemoteHeight),ge(o,"RenderFrameRate",r.videoStats&&r.videoStats.googFrameRateOutput),ge(o,"MuteState",r.videoDisabled),ge(o,"TotalFreezeTime",r.videoStats&&r.videoStats.videoTotalFreezeTime),ge(o,"TotalPlayDuration",r.videoStats&&r.videoStats.videoTotalPlayDuration),n[i]=o}e&&e(n)},t.getLocalVideoStats=function(e){var n={};for(var i in t.localStats){var o={},r=t.localStats[i];ge(o,"TargetSendBitrate",r.videoTargetSendBitrate),ge(o,"SendFrameRate",r.videoStats&&r.videoStats.googFrameRateSent),ge(o,"SendBitrate",r.videoSendBitrate),ge(o,"SendResolutionWidth",r.videoStats&&r.videoStats.googFrameWidthSent),ge(o,"SendResolutionHeight",r.videoStats&&r.videoStats.googFrameHeightSent),ge(o,"CaptureResolutionWidth",r.videoStats&&r.videoStats.googFrameWidthInput),ge(o,"CaptureResolutionHeight",r.videoStats&&r.videoStats.googFrameHeightInput),ge(o,"EncodeDelay",r.videoStats&&r.videoStats.googAvgEncodeMs),ge(o,"MuteState",r.videoDisabled),ge(o,"TotalFreezeTime",r.videoStats&&r.videoStats.videoTotalFreezeTime),ge(o,"TotalDuration",r.videoStats&&r.videoStats.videoTotalPlayDuration),ge(o,"CaptureFrameRate",r.videoStats&&r.videoStats.googFrameRateSent),r.videoStats.googFrameWidthInput||ge(o,"CaptureResolutionWidth",r.videoStats&&r.videoStats.renderLocalWidth),r.videoStats.googFrameHeightInput||ge(o,"CaptureResolutionHeight",r.videoStats&&r.videoStats.renderLocalHeight),n[i]=o,e&&e(n)}},t.getRemoteVideoQualityStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];ge(o,"videoReceiveDelay",r.videoStats&&r.videoStats.googCurrentDelayMs),ge(o,"VideoFreezeRate",r.videoStats&&r.videoStats.videoFreezeRate),ge(o,"FirstFrameTime",r.firstFrameTime),n[i]=o}e&&e(n)},t.getRemoteAudioQualityStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];ge(o,"audioReceiveDelay",r.audioStats&&r.audioStats.googCurrentDelayMs),ge(o,"AudioFreezeRate",r.videoStats&&r.videoStats.videoFreezeRate),n[i]=o}e&&e(n)},t.getTransportStats=function(e){var n={},i={},o=t.gatewayClient.traffic_stats,r=o.peer_delay;if(ge(n,"OutgoingAvailableBandwidth",t.gatewayClient.OutgoingAvailableBandwidth/1e3),ge(n,"RTT",o&&o.access_delay),r){var a=!0,s=!1,c=void 0;try{for(var d,u=r[Symbol.iterator]();!(a=(d=u.next()).done);a=!0){var l=d.value;l.downlink_estimate_bandwidth&&(i[l.peer_uid]=l.downlink_estimate_bandwidth/1e3+"")}}catch(e){s=!0,c=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw c}}}n.IncomingAvailableBandwidth=i,e&&e(n)},t.getSessionStats=function(e){var n={},i=t.gatewayClient.traffic_stats,o=t.gatewayClient.socket,r=0,a=0;for(var s in t.remoteStats)(c=t.remoteStats[s])&&c.videoStats&&c.videoStats.videoRecvBytesDelta&&(a+=parseInt(c.videoStats.videoRecvBytesDelta)),c&&c.audioStats&&c.audioStats.audioRecvBytesDelta&&(a+=parseInt(c.audioStats.audioRecvBytesDelta));for(var s in t.localStats){var c;(c=t.localStats[s])&&c.videoStats&&c.videoStats.videoSendBytesDelta&&(r+=parseInt(c.videoStats.videoSendBytesDelta)),c&&c.audioStats&&c.audioStats.audioSendBytesDelta&&(r+=parseInt(c.audioStats.audioSendBytesDelta))}var d=r+t.session.WSSendBytesDelta+t.session.HTTPSendBytesDelta,u=a+t.session.WSRecvBytesDelta+t.session.HTTPRecvBytesDelta,l=t.session.sendBytes+Object(We.b)(),p=t.session.recvBytes+Object(We.a)();t.gatewayClient.socket&&t.gatewayClient.socket.state===t.gatewayClient.CONNECTED&&(l+=o.getSendBytes(),p+=o.getRecvBytes());var f=1;i.peer_delay&&(f=i.peer_delay.length,f+=1),ge(n,"Duration",o.getDuration()),ge(n,"UserCount",f),ge(n,"SendBytes",l),ge(n,"RecvBytes",p),ge(n,"SendBitrate",8*d/1e3),ge(n,"RecvBitrate",8*u/1e3),e&&e(n)},t.isLocalVideoFreeze=function(e,t){var n=0,i=0;if(!e||!t)return!1;if(Object(f.isChrome)()||Object(f.isOpera)())n=e.googFrameRateInput,i=e.googFrameRateSent;else if(Object(f.isSafari)())n=parseInt(e.framerateMean),i=parseInt(e.framesEncoded)-parseInt(t.framesEncoded);else{if(!Object(f.isFireFox)())return!1;n=parseInt(e.framerateMean),i=parseInt(e.framesEncoded)-parseInt(t.framesEncoded)}return n>5&&i<3},t.isRemoteVideoFreeze=function(e,t){var n=0,i=0;if(!e||!t)return!1;if(Object(f.isChrome)()||Object(f.isOpera)())n=e.googFrameRateReceived,i=e.googFrameRateDecoded;else if(Object(f.isSafari)())n=e.framerateMean,i=parseInt(e.framesDecoded)-parseInt(t.framesDecoded);else{if(!Object(f.isFireFox)())return!1;n=parseInt(e.framesReceived)-parseInt(t.framesReceived),i=parseInt(e.framesDecoded)-parseInt(t.framesDecoded)}return n>5&&n<10&&i<3||n>10&&n<20&&i<4||n>20&&i<5},t.isAudioFreeze=function(e){if(Object(f.isChrome)()&&e){if(e.googDecodingPLC&&e.googDecodingPLCCNG&&e.googDecodingCTN)return(parseInt(e.googDecodingPLC)+parseInt(e.googDecodingPLCCNG))/parseInt(e.googDecodingCTN)>.2}else if((Object(f.isSafari)()||Object(f.isFireFox)())&&e.packetsLost&&e.packetsReceived)return parseInt(e.packetsLost)/(parseInt(e.packetsLost)+parseInt(e.packetsReceived))>.2;return!1},t.isAudioDecodeFailed=function(e){return!!((Object(f.isChrome)()||Object(f.isOpera)())&&e&&parseInt(e.bytesReceived)>0&&0===parseInt(e.googDecodingNormal))},t.startNetworkQualityTimer=function(){t.clearNetworkQualityTimer(),t.networkQualityTimer=setInterval((function(){if(t.gatewayClient.state!==dt.CONNECTED)t.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:0,downlinkNetworkQuality:0});else{var e=t.gatewayClient.traffic_stats;t.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:t.networkQualityTrans(e.uplink_network_quality),downlinkNetworkQuality:t.networkQualityTrans(e.downlink_network_quality)})}}),2e3)},t.clearNetworkQualityTimer=function(){t.networkQualityTimer&&clearInterval(t.networkQualityTimer)},t.networkQualityTrans=function(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0},t.getStatsTimer=setInterval((function(){var e=t.gatewayClient.traffic_stats,n=Date.now();t.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(t.localStats).length&&t.exceptionMonitor.setLocalStats(t.localStats),Object.keys(t.remoteStats).length&&t.exceptionMonitor.setRemoteStats(t.remoteStats);var i={};Object.keys(t.gatewayClient.remoteStreams).forEach((function(o){var r=t.gatewayClient.remoteStreams[o],a=t.remoteStats[o],s={id:o,updatedAt:n};i[o]=s,s.firstFrameTime=r.firstFrameTime,a?(s.audioTotalPlayDuration=a.audioTotalPlayDuration+1,s.audioTotalFreezeTime=a.audioTotalFreezeTime,s.isAudioFreeze=!1,s.isAudioDecodeFailed=!1,s.videoTotalPlayDuration=a.videoTotalPlayDuration+1,s.videoTotalFreezeTime=a.videoTotalFreezeTime,s.isVideoFreeze=!1):(s.audioTotalPlayDuration=1,s.audioTotalFreezeTime=0,s.videoTotalPlayDuration=1,s.videoTotalFreezeTime=0);var c=e&&e.peer_delay&&e.peer_delay.find((function(e){return e.peer_uid==o}));c&&(s.peer_delay=c),r&&(r.isPlaying()&&(s.audioDisabled=r.userMuteAudio||r.peerMuteAudio?"1":"0",s.videoDisabled=r.userMuteVideo||r.peerMuteVideo?"1":"0"),a&&a.peer_delay&&c&&a.peer_delay.stream_type!==c.stream_type&&t.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:o,streamType:c.stream_type}),r.pc&&"established"==r.pc.state&&r.pc.getStats((function(e){if(s.pcStats=e,s.audioStats=e.find((function(e){return"audio"==e.mediaType&&(e.id.indexOf("_recv")>-1||e.id.toLowerCase().indexOf("inbound")>-1)})),s.videoStats=e.find((function(e){return"video"==e.mediaType&&(e.id.indexOf("_recv")>-1||e.id.toLowerCase().indexOf("inbound")>-1)})),a&&a.audioStats&&s.audioStats){var n=parseInt(s.audioStats.bytesReceived)-parseInt(a.audioStats.bytesReceived),i=parseInt(s.audioStats.googDecodingNormal)-parseInt(a.audioStats.googDecodingNormal);if(s.audioStats.audioRecvBytesDelta=n,s.audioStats.audioDecodingNormalDelta=i,t.session.recvBytes+=n,isFinite(n)&&s.audioStats.timestamp){var o=s.audioStats.timestamp.getTime()-a.audioStats.timestamp.getTime();s.audioRecvBitrate=Math.floor(8*n/o)}t.isAudioFreeze(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.audioTotalFreezeTime++,s.isAudioFreeze=!0),t.isAudioDecodeFailed(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.isAudioDecodeFailed=!0),s.audioStats.audioTotalFreezeTime=s.audioTotalFreezeTime,s.audioStats.audioTotalPlayDuration=s.audioTotalPlayDuration,s.audioStats.audioFreezeRate=Math.ceil(100*s.audioTotalFreezeTime/s.audioTotalPlayDuration)}if(a&&a.videoStats&&s.videoStats){var c=parseInt(s.videoStats.bytesReceived)-parseInt(a.videoStats.bytesReceived);s.videoStats.videoRecvBytesDelta=c,t.session.recvBytes+=c,isFinite(c)&&s.videoStats.timestamp&&(o=s.videoStats.timestamp.getTime()-a.videoStats.timestamp.getTime(),s.videoRecvBitrate=Math.floor(8*c/o)),t.isRemoteVideoFreeze(s.videoStats,a.videoStats)&&(s.videoTotalFreezeTime++,s.isVideoFreeze=!0),s.videoStats.videoTotalFreezeTime=s.videoTotalFreezeTime,s.videoStats.videoTotalPlayDuration=s.videoTotalPlayDuration,s.videoStats.videoFreezeRate=Math.ceil(100*s.videoTotalFreezeTime/s.videoTotalPlayDuration),r.player&&r.player.video&&r.player.video.videoWidth&&r.player.video.videoHeight?(s.videoStats.renderRemoteWidth=r.player.video.videoWidth,s.videoStats.renderRemoteHeight=r.player.video.videoHeight):(s.videoStats.renderRemoteWidth=r.videoWidth||s.videoStats.googFrameWidthReceived,s.videoStats.renderRemoteHeight=r.videoHeight||s.videoStats.googFrameHeightReceived)}})))})),t.remoteStats=i;var o={};if(Object.keys(t.gatewayClient.localStreams).forEach((function(e){var i=t.gatewayClient.localStreams[e],r=t.localStats[e],a={id:e,updatedAt:n};o[e]=a,r?(a.videoTotalPlayDuration=r.videoTotalPlayDuration+1,a.videoTotalFreezeTime=r.videoTotalFreezeTime,a.isVideoFreeze=!1):(a.videoTotalPlayDuration=1,a.videoTotalFreezeTime=0),i&&(i.isPlaying()&&(a.audioDisabled=i.userMuteAudio?"1":"0",a.videoDisabled=i.userMuteVideo?"1":"0"),i.video&&i.attributes.maxVideoBW?a.videoTargetSendBitrate=i.attributes.maxVideoBW:i.video&&i.screenAttributes&&(a.videoTargetSendBitrate=i.screenAttributes.maxVideoBW),i.pc&&"established"==i.pc.state&&i.pc.getStats((function(e){if(a.pcStats=e.reverse(),a.audioStats=e.find((function(e){return"audio"==e.mediaType&&(e.id.indexOf("_send")>-1||e.id.toLowerCase().indexOf("outbound")>-1)})),a.videoStats=e.find((function(e){return"video"==e.mediaType&&(e.id.indexOf("_send")>-1||e.id.toLowerCase().indexOf("outbound")>-1)})),a.audioStats&&r&&r.audioStats){var n=parseInt(a.audioStats.bytesSent)-parseInt(r.audioStats.bytesSent);if(a.audioStats.audioSendBytesDelta=n,t.session.sendBytes+=n,isFinite(n)&&a.audioStats.timestamp){var o=a.audioStats.timestamp.getTime()-r.audioStats.timestamp.getTime();a.audioSendBitrate=Math.floor(8*n/o)}}if(a.videoStats&&r&&r.videoStats){var s=parseInt(a.videoStats.bytesSent)-parseInt(r.videoStats.bytesSent);a.videoStats.videoSendBytesDelta=s,t.session.sendBytes+=s,isFinite(s)&&a.videoStats.timestamp&&(o=a.videoStats.timestamp.getTime()-r.videoStats.timestamp.getTime(),a.videoSendBitrate=Math.floor(8*s/o)),t.isLocalVideoFreeze(a.videoStats,r.videoStats)&&(a.videoTotalFreezeTime++,a.isVideoFreeze=!0),a.videoStats.videoTotalFreezeTime=a.videoTotalFreezeTime,a.videoStats.videoTotalPlayDuration=a.videoTotalPlayDuration,a.videoStats.videoFreezeRate=Math.ceil(100*a.videoTotalFreezeTime/a.videoTotalPlayDuration),a.videoStats.renderLocalWidth=i.videoWidth||a.videoStats.googFrameWidthSent,a.videoStats.renderLocalHeight=i.videoHeight||a.videoStats.googFrameHeightSent}})))})),t.localStats=o,t.session.HTTPSendBytesDelta=Object(We.b)()-t.session.HTTPSendBytes,t.session.HTTPSendBytes=Object(We.b)(),t.session.HTTPRecvBytesDelta=Object(We.a)()-t.session.HTTPRecvBytes,t.session.HTTPRecvBytes=Object(We.a)(),t.gatewayClient.socket&&t.gatewayClient.socket.state===t.gatewayClient.CONNECTED){var r=t.gatewayClient.socket;t.session.WSSendBytesDelta=r.getSendBytes()-t.session.WSSendBytes,t.session.WSSendBytes=r.getSendBytes(),t.session.WSRecvBytesDelta=r.getRecvBytes()-t.session.WSRecvBytes,t.session.WSRecvBytes=r.getRecvBytes()}}),1e3),t.gatewayClient.on("join",(function(){t.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}})),t}(t.gatewayClient),t.configDistributManager=function(e){var t={};return t.client=e,t.client.on("config-distribute",(function(n){var i=n.joinInfo,r=n.config;if(r){De(r.uploadLog)||(Object(o.setParameter)("UPLOAD_LOG",r.uploadLog),a.b.reportApiInvoke(i.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:r.uploadLog}})()),De(r.dualStream)||(e.isDualStream=r.dualStream,a.b.reportApiInvoke(i.sid,{name:"_configDistribute",options:{feature:"dualStream",value:r.dualStream}})()),De(r.streamFallbackOption)||t.client.on("stream-subscribed",(function(e){var n=e.stream;n?(t.client.gatewayClient.setStreamFallbackOption(n,r.streamFallbackOption),a.b.reportApiInvoke(i.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:r.streamFallbackOption,streamId:n.getId()}})()):a.b.reportApiInvoke(i.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:r.streamFallbackOption,streamId:n.getId(),err:"invalid stream"}})()}));try{Object.keys(r).map((function(e){return Object(o.setParameter)(e,r[e])}))}catch(e){}}})),t}(t),De(e.turnServer)||t.setTurnServer(e.turnServer),De(e.proxyServer)||t.setProxyServer(e.proxyServer),"live"===t.mode&&(t.gatewayClient.role="audience"),"rtc"===t.mode&&(t.gatewayClient.role="host"),t.on("onMultiIP",(function(e){t.gatewayClient.closeGateway(),t.gatewayClient.socket=void 0,t.gatewayClient.hasChangeBGPAddress=!0,t.joinInfo.multiIP=e.arg.option,t.gatewayClient.state=dt.CONNECTING;var n=function(e){r.default.info("[".concat(t.clientId,"] Joining channel: ").concat(t.channel)),t.joinInfo.cid=e.cid,t.joinInfo.uid||(t.joinInfo.uid=e.uid),t.joinInfo.uni_lbs_ip=e.uni_lbs_ip,t.joinInfo.gatewayAddr=e.gateway_addr,t.onSuccess?t.gatewayClient.join(t.joinInfo,t.key,(function(e){r.default.info("[".concat(t.clientId,"] Join channel ").concat(t.channel," success"));var n=t.onSuccess;t.onSuccess=null,t.onFailure=null,n(e)}),t.onFailure):(t.gatewayClient.joinInfo=h()({},t.joinInfo),t.gatewayClient.rejoin())};t.joinInfo.stringUid&&!t.joinInfo.uid?(self.userAccountReq&&!self.userAccountReq.isFinished()&&self.userAccountReq.cancel(),self.userAccountReq=et(joinInfo),self.userAccountReq.then((function(e){r.default.error("getUserAccount Success ".concat(e.url," ").concat(joinInfo.stringUid," => ").concat(e.uid)),t.joinInfo.uid=e.uid,$e(t.joinInfo,n,t.onFailure)})).catch((function(e){r.default.error("getUserAccount rejected",e),t.onFailure(e)}))):$e(t.joinInfo,n,t.onFailure)})),t.on("rejoin-start",(function(){t._renewSession(),a.b.sessionInit(e.sessionId,{lts:(new Date).getTime(),extend:{rejoin:!0},cname:t.channel,appid:e.appId,mode:e.mode,succ:!0})})),t.on("recover",(function(){t._renewSession(),a.b.sessionInit(e.sessionId,{lts:(new Date).getTime(),extend:{recover:!0},cname:t.channel,appid:e.appId,mode:e.mode,succ:!0})})),t.on("rejoin",(function(){var e=2===t.highStreamState?2:0;if(t.onSuccess){var n=t.onSuccess;t.onSuccess=null,t.onFailure=null,n()}t.highStream&&0===e&&(r.default.info("[".concat(t.clientId,"] publish after rejoin")),t.highStreamState=2,t.lowStreamState=2,t.publish(t.highStream,(function(e){e&&r.default.info("[".concat(t.clientId,"] "),e)})))})),t.on("streamPublished",(function(e){t.hasPublished||(t.hasPublished=!0,t.gatewayClient.dispatchEvent(d({type:"stream-published",stream:e.stream})))})),t.on("pubP2PLost",(function(e){r.default.debug("[".concat(t.clientId,"] Start reconnect local peerConnection: ").concat(t.highStream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:t.highStream.getId()}),1===t.highStreamState&&(t.highStreamState=0,t.lowStreamState=0),t._unpublish(t.highStream,(function(){t._publish(t.highStream,(function(){r.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection success: ").concat(t.highStream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!0,reason:""})}),(function(e){r.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection failed: ").concat(e)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!1,reason:e})}))}),(function(e){r.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection failed: ").concat(e)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!1,reason:e})}))})),t.on("subP2PLost",(function(e){r.default.debug("[".concat(t.clientId,"] Start reconnect remote peerConnection: ").concat(e.stream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:e.stream.getId()}),t.gatewayClient.unsubscribe(e.stream,(function(){t.gatewayClient.subscribe(e.stream,(function(){r.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection success: ").concat(e.stream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:""})}),(function(n){r.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection failed: "),n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:n})}))}),(function(n){r.default.debug("[".concat(t.clientId,"] \" + 'Reconnect remote peerConnection failed: "),n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:n})}))})),mt.on("networkTypeChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=h()({},e,{type:"network-type-changed"});t.gatewayClient.dispatchEvent(n)})),ve.on("recordingDeviceChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=h()({},e,{type:"recording-device-changed"});t.gatewayClient.dispatchEvent(n)})),ve.on("playoutDeviceChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=h()({},e,{type:"playout-device-changed"});t.gatewayClient.dispatchEvent(n)})),ve.on("cameraChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=h()({},e,{type:"camera-changed"});t.gatewayClient.dispatchEvent(n)})),t.gatewayClient.on("streamTypeChange",(function(n){var i=h()({},n,{type:"stream-type-changed"});t.gatewayClient.dispatchEvent(i),a.b.reportApiInvoke(e.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(n))})),t},vt={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},ht={width:0,height:0,videoGop:30,videoFramerate:15,videoBitrate:400,audioSampleRate:44100,audioBitrate:48,audioChannels:1},yt=ve.getDevices,St=de,bt=JSON.parse(JSON.stringify(o.SUPPORT_RESOLUTION_LIST));t.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:vt,createClient:function(e){var t=a.b.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(e=h()({},e||{})).codec||(e.codec=function(e){switch(e){case"h264_interop":return"h264";default:return"vp8"}}(e.mode));var n=function(e){return-1===je.indexOf(e.mode)?T:-1===Fe.indexOf(e.codec)?w:"h264_interop"==e.mode&&"h264"!==e.codec&&R}(e);if(n)throw r.default.error("Invalid parameter setting MODE: ".concat(e.mode," CODEC: ").concat(e.codec," ERROR ").concat(n)),t(n),new Error(n);return r.default.info("Creating client, MODE: ".concat(e.mode," CODEC: ").concat(e.codec)),function(e){switch(e.mode){case"interop":case"h264_interop":e.mode="live";break;case"web-only":e.mode="rtc"}}(e),t(null,e),gt(e)},createStream:function(e){var t=a.b.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer"});be(e,"StreamSpec");var n=e.streamID,i=e.audio,o=e.video,s=e.screen,c=(e.audioSource,e.videoSource,e.cameraId),d=e.microphoneId,u=e.mirror,l=e.extensionId,p=e.mediaSource,f=e.audioProcessing;if(!De(n)&&!Object(me.c)(n)&&!Ce(n,1,255))throw new Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is Uint32");if(Ee(i,"audio"),Ee(o,"video"),De(s)||Ee(s,"screen"),De(c)||Ie(c,"cameraId",0,255,!1),De(d)||Ie(d,"microphoneId",0,255,!1),De(l)||Ie(l,"extensionId"),De(p)||Se(p,"mediaSource",["screen","application","window"]),De(u)||Ee(u,"mirror"),!De(f)){var m=f.AGC,g=f.AEC,v=f.ANS;De(m)||Ee(m,"AGC"),De(g)||Ee(g,"AEC"),De(v)||Ee(v,"ANS")}r.default.debug("Create stream");var h=Le(e);return t(),h},Logger:r.default,getDevices:yt,getScreenSources:St,getParameter:o.getParameter,setParameter:o.setParameter,checkSystemRequirements:function(){var e=a.b.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket,o=!!t&&!!n&&!!i,s=!1;r.default.debug(f.getBrowserInfo(),"isAPISupport:"+o),f.isChrome()&&f.getBrowserVersion()>=58&&"iOS"!==f.getBrowserOS()&&(s=!0),f.isFireFox()&&f.getBrowserVersion()>=56&&(s=!0),f.isOpera()&&f.getBrowserVersion()>=45&&(s=!0),f.isSafari()&&f.getBrowserVersion()>=11&&(s=!0),f.isEdge()&&(s=!0),(f.isWeChatBrowser()||f.isQQBrowser())&&"iOS"!==f.getBrowserOS()&&(s=!0),f.isSupportedPC()||f.isSupportedMobile()||(s=!1);var c=o&&s;return e(null,c),c},getSupportedCodec:Ve.getSupportedCodec,VERSION:o.VERSION,BUILD:o.BUILD,PROFILE_TABLE:bt,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2}}]).default},255:function(e,t,n){"use strict";t.__esModule=!0,t.WebZmRtc=void 0;var i=n(31),o=n(21);n(256);var r=n(257),a=null,s={};t.WebZmRtc=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="web zmrtc",i.loggerColor="darkmagenta",i._subscribeToStreams_=i._subscribeToStreams_.bind(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init=function(){var e=this;if(r.checkSystemRequirements())if(a)this.rtcCb({name:"error",data:{msg:"请不要重复实例化",code:this._code_enum_.MESSAGE_CODE_INIT}});else{var t=localStorage.getItem("ss.media.video_source_id"),n=localStorage.getItem("ss.media.audio_source_id");r.getDevices((function(i){if(i)for(var o=0;o<i.length;o++)e.logger("deviceId "+i[o].deviceId),i[o].deviceId===t&&(e.cameraId=t),i[o].deviceId===n&&(e.microphoneId=n);e.logger("cameraId,microphoneId:",e.cameraId,e.microphoneId);var r=Object.assign({},{audio:!0,video:!0,data:!0,videoSize:[320,240,320,240],videoFrameRate:[10,20]},{attributes:{uid:""+e.uid}});console.log("sOptions",r);var c=Erizo.Stream(r);s[e.uid]=c,(a=Erizo.Room({token:e.roomId})).addEventListener("room-connected",(function(t){e.logger("room-connected"),e.rtcCb({name:"room joined",data:{code:e._code_enum_.MESSAGE_CODE_ROOM}});!e.isWatcher&&a.publish(c,{metadata:{type:"publisher"},attr:{hahah:"true"}}),e._subscribeToStreams_(t.streams)})),a.addEventListener("room-disconnected",(function(t){e.logger("room-disconnected"),e.rtcCb({name:"leave channel",data:{code:e._code_enum_.MESSAGE_CODE_ROOM}})})),a.addEventListener("stream-subscribed",(function(t){e.logger("stream-subscribed",t);var n=t.stream,i=n.getAttributes()||{},o=(i.mobile,i.uid);s[o]=n,e.playById(o),e.rtcCb({name:"stream-subscribed",data:{uid:o,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),a.addEventListener("stream-added",(function(t){e.logger("stream-added"),e.rtcCb({name:"stream-added",data:{uid:t.stream&&t.stream.getID(),code:e._code_enum_.MESSAGE_CODE_STREAM}}),e._subscribeToStreams_([t.stream])})),a.addEventListener("stream-removed",(function(t){e.logger("stream-removed",t.stream);var n=t.stream.getAttributes()||{},i=(n.mobile,n.uid);e.rtcCb({name:"stream-removed",data:{uid:i,code:e._code_enum_.MESSAGE_CODE_STREAM}})})),a.addEventListener("stream-failed",(function(){e.logger("stream-failed"),e.rtcCb({name:"error",data:{msg:"流媒体传输失败",code:e._code_enum_.MESSAGE_CODE_STREAM}})})),c.addEventListener("access-accepted",(function(t){e.logger("access-accepted",t),a.connect(),e.playById(e.uid),e.rtcCb({name:"accessAllowed",data:{code:e._code_enum_.MESSAGE_CODE_STREAM}})})),c.addEventListener("access-denied",(function(t){e.logger("access-denied",t),a.connect(),e.rtcCb({name:"accessDenied",data:{code:e._code_enum_.MESSAGE_CODE_STREAM}})})),e.joinRoom()}))}else this.rtcCb({name:"error",data:{msg:"初始化失败浏览器不支持WebRTC",code:this._code_enum_.MESSAGE_CODE_INIT}})},t.prototype._subscribeToStreams_=function(e){var t=this,n=e.filter((function(e){return e}));for(var i in this.logger("subscribe-streams",n),n){var o=n[i];s[this.uid].getID()!==o.getID()&&(a.subscribe(o,{slideShowMode:!1,metadata:{type:"subscriber"}}),o.addEventListener("bandwidth-alert",(function(e){return t.logger(e)})))}},t.prototype.joinRoom=function(){var e=this.uid,t=this.roomId,n=this.isWatcher;this.logger("用户:"+e+" isWatcher:"+!!n+" 正在视图加入房间:"+t+"中..."),n?a.connect():s[e].init()},t.prototype.leaveRoom=function(){a&&a.disconnect()},t.prototype.playById=function(e){var t=this;(0,o.waitFor)((function(){return s[e]&&t.document.getElementById(""+e)})).then((function(){s[e].showing&&s[e].stop(),s[e].show(""+e)}))},t.prototype.disableVideo=function(e){var t=e.id,n=e.flag,i=s[t];n?i.muteVideo(!1):i.muteVideo(!0)},t.prototype.disableAudio=function(e){var t=e.id,n=(e.flag,s[t]);n.muteAudio()},t.prototype.hideVideoById=function(e){},t.prototype.showVideoById=function(e){},t}(i.RtcKit)},256:function(e,t,n){(function(e){try{var t=t||{};t.scope={},t.ASSUME_ES5=!1,t.ASSUME_NO_NATIVE_MAP=!1,t.ASSUME_NO_NATIVE_SET=!1,t.defineProperty=t.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)},t.getGlobal=function(t){return"undefined"!=typeof window&&window===t?t:void 0!==e&&null!=e?e:t},t.global=t.getGlobal(this),t.SYMBOL_PREFIX="jscomp_symbol_",t.initSymbol=function(){t.initSymbol=function(){},t.global.Symbol||(t.global.Symbol=t.Symbol)},t.Symbol=(n=0,function(e){return t.SYMBOL_PREFIX+(e||"")+n++}),t.initSymbolIterator=function(){t.initSymbol();var e=t.global.Symbol.iterator;e||(e=t.global.Symbol.iterator=t.global.Symbol("iterator")),"function"!=typeof Array.prototype[e]&&t.defineProperty(Array.prototype,e,{configurable:!0,writable:!0,value:function(){return t.arrayIterator(this)}}),t.initSymbolIterator=function(){}},t.arrayIterator=function(e){var n=0;return t.iteratorPrototype((function(){return n<e.length?{done:!1,value:e[n++]}:{done:!0}}))},t.iteratorPrototype=function(e){return t.initSymbolIterator(),(e={next:e})[t.global.Symbol.iterator]=function(){return this},e},t.makeIterator=function(e){t.initSymbolIterator();var n=e[Symbol.iterator];return n?n.call(e):t.arrayIterator(e)},t.arrayFromIterator=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n},t.arrayFromIterable=function(e){return e instanceof Array?e:t.arrayFromIterator(t.makeIterator(e))},t.iteratorFromArray=function(e,n){t.initSymbolIterator(),e instanceof String&&(e+="");var i=0,o={next:function(){if(i<e.length){var t=i++;return{value:n(t,e[t]),done:!1}}return o.next=function(){return{done:!0,value:void 0}},o.next()}};return o[Symbol.iterator]=function(){return o},o},t.polyfill=function(e,n,i,o){if(n){for(i=t.global,e=e.split("."),o=0;o<e.length-1;o++){var r=e[o];r in i||(i[r]={}),i=i[r]}(n=n(o=i[e=e[e.length-1]]))!=o&&null!=n&&t.defineProperty(i,e,{configurable:!0,writable:!0,value:n})}},t.polyfill("Array.prototype.keys",(function(e){return e||function(){return t.iteratorFromArray(this,(function(e){return e}))}}),"es6","es3"),t.findInternal=function(e,t,n){e instanceof String&&(e=String(e));for(var i=e.length,o=0;o<i;o++){var r=e[o];if(t.call(n,r,o,e))return{i:o,v:r}}return{i:-1,v:void 0}},t.polyfill("Array.prototype.find",(function(e){return e||function(e,n){return t.findInternal(this,e,n).v}}),"es6","es3"),t.owns=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.polyfill("WeakMap",(function(e){function n(e){t.owns(e,o)||t.defineProperty(e,o,{value:{}})}function i(e){var t=Object[e];t&&(Object[e]=function(e){return n(e),t(e)})}if(function(){if(!e||!Object.seal)return!1;try{var t=Object.seal({}),n=Object.seal({}),i=new e([[t,2],[n,3]]);return 2==i.get(t)&&3==i.get(n)&&(i.delete(t),i.set(n,4),!i.has(t)&&4==i.get(n))}catch(e){return!1}}())return e;var o="$jscomp_hidden_"+Math.random().toString().substring(2);i("freeze"),i("preventExtensions"),i("seal");var r=0,a=function(e){if(this.id_=(r+=Math.random()+1).toString(),e){t.initSymbol(),t.initSymbolIterator(),e=t.makeIterator(e);for(var n;!(n=e.next()).done;)n=n.value,this.set(n[0],n[1])}};return a.prototype.set=function(e,i){if(n(e),!t.owns(e,o))throw Error("WeakMap key fail: "+e);return e[o][this.id_]=i,this},a.prototype.get=function(e){return t.owns(e,o)?e[o][this.id_]:void 0},a.prototype.has=function(e){return t.owns(e,o)&&t.owns(e[o],this.id_)},a.prototype.delete=function(e){return!(!t.owns(e,o)||!t.owns(e[o],this.id_))&&delete e[o][this.id_]},a}),"es6","es3"),t.MapEntry=function(){},t.polyfill("Map",(function(e){if(!t.ASSUME_NO_NATIVE_MAP&&function(){if(!e||!e.prototype.entries||"function"!=typeof Object.seal)return!1;try{var n=Object.seal({x:4}),i=new e(t.makeIterator([[n,"s"]]));if("s"!=i.get(n)||1!=i.size||i.get({x:4})||i.set({x:4},"t")!=i||2!=i.size)return!1;var o=i.entries(),r=o.next();return!r.done&&r.value[0]==n&&"s"==r.value[1]&&!((r=o.next()).done||4!=r.value[0].x||"t"!=r.value[1]||!o.next().done)}catch(e){return!1}}())return e;t.initSymbol(),t.initSymbolIterator();var n=new WeakMap,i=function(e){if(this.data_={},this.head_=a(),this.size=0,e){e=t.makeIterator(e);for(var n;!(n=e.next()).done;)n=n.value,this.set(n[0],n[1])}};i.prototype.set=function(e,t){var n=o(this,e);return n.list||(n.list=this.data_[n.id]=[]),n.entry?n.entry.value=t:(n.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:e,value:t},n.list.push(n.entry),this.head_.previous.next=n.entry,this.head_.previous=n.entry,this.size++),this},i.prototype.delete=function(e){return!(!(e=o(this,e)).entry||!e.list)&&(e.list.splice(e.index,1),e.list.length||delete this.data_[e.id],e.entry.previous.next=e.entry.next,e.entry.next.previous=e.entry.previous,e.entry.head=null,this.size--,!0)},i.prototype.clear=function(){this.data_={},this.head_=this.head_.previous=a(),this.size=0},i.prototype.has=function(e){return!!o(this,e).entry},i.prototype.get=function(e){return(e=o(this,e).entry)&&e.value},i.prototype.entries=function(){return r(this,(function(e){return[e.key,e.value]}))},i.prototype.keys=function(){return r(this,(function(e){return e.key}))},i.prototype.values=function(){return r(this,(function(e){return e.value}))},i.prototype.forEach=function(e,t){for(var n,i=this.entries();!(n=i.next()).done;)n=n.value,e.call(t,n[1],n[0],this)},i.prototype[Symbol.iterator]=i.prototype.entries;var o=function(e,i){var o=i&&typeof i;"object"==o||"function"==o?n.has(i)?o=n.get(i):(o=""+ ++s,n.set(i,o)):o="p_"+i;var r=e.data_[o];if(r&&t.owns(e.data_,o))for(e=0;e<r.length;e++){var a=r[e];if(i!=i&&a.key!=a.key||i===a.key)return{id:o,list:r,index:e,entry:a}}return{id:o,list:r,index:-1,entry:void 0}},r=function(e,n){var i=e.head_;return t.iteratorPrototype((function(){if(i){for(;i.head!=e.head_;)i=i.previous;for(;i.next!=i.head;)return i=i.next,{done:!1,value:n(i)};i=null}return{done:!0,value:void 0}}))},a=function(){var e={};return e.previous=e.next=e.head=e},s=0;return i}),"es6","es3"),t.FORCE_POLYFILL_PROMISE=!1,t.polyfill("Promise",(function(e){function n(){this.batch_=null}function i(e){return e instanceof r?e:new r((function(t,n){t(e)}))}if(e&&!t.FORCE_POLYFILL_PROMISE)return e;n.prototype.asyncExecute=function(e){return null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_()),this.batch_.push(e),this},n.prototype.asyncExecuteBatch_=function(){var e=this;this.asyncExecuteFunction((function(){e.executeBatch_()}))};var o=t.global.setTimeout;n.prototype.asyncExecuteFunction=function(e){o(e,0)},n.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var e=this.batch_;this.batch_=[];for(var t=0;t<e.length;++t){var n=e[t];delete e[t];try{n()}catch(e){this.asyncThrow_(e)}}}this.batch_=null},n.prototype.asyncThrow_=function(e){this.asyncExecuteFunction((function(){throw e}))};var r=function(e){this.state_=0,this.result_=void 0,this.onSettledCallbacks_=[];var t=this.createResolveAndReject_();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}};r.prototype.createResolveAndReject_=function(){function e(e){return function(i){n||(n=!0,e.call(t,i))}}var t=this,n=!1;return{resolve:e(this.resolveTo_),reject:e(this.reject_)}},r.prototype.resolveTo_=function(e){if(e===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof r)this.settleSameAsPromise_(e);else{e:switch(typeof e){case"object":var t=null!=e;break e;case"function":t=!0;break e;default:t=!1}t?this.resolveToNonPromiseObj_(e):this.fulfill_(e)}},r.prototype.resolveToNonPromiseObj_=function(e){var t=void 0;try{t=e.then}catch(e){return void this.reject_(e)}"function"==typeof t?this.settleSameAsThenable_(t,e):this.fulfill_(e)},r.prototype.reject_=function(e){this.settle_(2,e)},r.prototype.fulfill_=function(e){this.settle_(1,e)},r.prototype.settle_=function(e,t){if(0!=this.state_)throw Error("Cannot settle("+e+", "+t|"): Promise already settled in state"+this.state_);this.state_=e,this.result_=t,this.executeOnSettledCallbacks_()},r.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var e=this.onSettledCallbacks_,t=0;t<e.length;++t)e[t].call(),e[t]=null;this.onSettledCallbacks_=null}};var a=new n;return r.prototype.settleSameAsPromise_=function(e){var t=this.createResolveAndReject_();e.callWhenSettled_(t.resolve,t.reject)},r.prototype.settleSameAsThenable_=function(e,t){var n=this.createResolveAndReject_();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},r.prototype.then=function(e,t){function n(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(e){o(e)}}:t}var i,o,a=new r((function(e,t){i=e,o=t}));return this.callWhenSettled_(n(e,i),n(t,o)),a},r.prototype.catch=function(e){return this.then(void 0,e)},r.prototype.callWhenSettled_=function(e,t){function n(){switch(i.state_){case 1:e(i.result_);break;case 2:t(i.result_);break;default:throw Error("Unexpected state: "+i.state_)}}var i=this;null==this.onSettledCallbacks_?a.asyncExecute(n):this.onSettledCallbacks_.push((function(){a.asyncExecute(n)}))},r.resolve=i,r.reject=function(e){return new r((function(t,n){n(e)}))},r.race=function(e){return new r((function(n,o){for(var r=t.makeIterator(e),a=r.next();!a.done;a=r.next())i(a.value).callWhenSettled_(n,o)}))},r.all=function(e){var n=t.makeIterator(e),o=n.next();return o.done?i([]):new r((function(e,t){function r(t){return function(n){a[t]=n,0==--s&&e(a)}}var a=[],s=0;do{a.push(void 0),s++,i(o.value).callWhenSettled_(r(a.length-1),t),o=n.next()}while(!o.done)}))},r}),"es6","es3"),t.polyfill("Object.assign",(function(e){return e||function(e,n){for(var i=1;i<arguments.length;i++){var o=arguments[i];if(o)for(var r in o)t.owns(o,r)&&(e[r]=o[r])}return e}}),"es6","es3");window.Erizo=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,n,i){var o,r,a=(o="",r=function(e){console.log.apply(console,[].concat(t.arrayFromIterable(e)))},{DEBUG:0,TRACE:1,INFO:2,WARNING:3,ERROR:4,NONE:5,setLogLevel:function(e){var t=e;e>a.NONE?t=a.NONE:e<a.DEBUG&&(t=a.DEBUG),a.logLevel=t},setOutputFunction:function(e){r=e},setLogPrefix:function(e){o=e},log:function(e,t){for(var n=[],i=1;i<arguments.length;++i)n[i-1]=arguments[i];if(i=o,!(e<a.logLevel))if(e===a.DEBUG?i+="DEBUG":e===a.TRACE?i+="TRACE":e===a.INFO?i+="INFO":e===a.WARNING?i+="WARNING":e===a.ERROR&&(i+="ERROR"),n=[i+": "].concat(n),void 0!==a.panel){i="";for(var s=0;s<n.length;s+=1)i+=n[s];a.panel.value=a.panel.value+"\n"+i}else r.apply(a,[n])},debug:function(e){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];a.log.apply(a,[].concat([a.DEBUG],t.arrayFromIterable(n)))},trace:function(e){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];a.log.apply(a,[].concat([a.TRACE],t.arrayFromIterable(n)))},info:function(e){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];a.log.apply(a,[].concat([a.INFO],t.arrayFromIterable(n)))},warning:function(e){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];a.log.apply(a,[].concat([a.WARNING],t.arrayFromIterable(n)))},error:function(e){for(var n=[],i=0;i<arguments.length;++i)n[i-0]=arguments[i];a.log.apply(a,[].concat([a.ERROR],t.arrayFromIterable(n)))}});n.a=a},function(e,t,n){n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return s}));var i=n(0),o=function(){var e={},t={};return e.addEventListener=function(e,n){void 0===t[e]&&(t[e]=[]),t[e].push(n)},e.removeEventListener=function(e,n){t[e]&&(-1!==(n=t[e].indexOf(n))&&t[e].splice(n,1))},e.dispatchEvent=function(e){if(!e||!e.type)throw Error("Undefined event");i.a.debug("Event: "+e.type);for(var n=t[e.type]||[],o=0;o<n.length;o+=1)n[o](e)},e.on=e.addEventListener,e.off=e.removeEventListener,e.emit=e.dispatchEvent,e},r=function(e){var t={};return t.type=e.type,t},a=function(e){var t=r(e);return t.streams=e.streams,t.message=e.message,t},s=function(e){var t=r(e);return t.stream=e.stream,t.msg=e.msg,t.bandwidth=e.bandwidth,t}},function(e,t,n){var i=n(1);t.a=function(){var e=Object(i.a)({});return e.url="",e}},function(e,t,n){(function(e){var i=n(12),o=n(13),r=n(14),a=n(0),s=103,c=function(){var t="none";return void 0!==e&&e.exports?t="fake":null!==window.navigator.userAgent.match("Firefox")?t="mozilla":null!==window.navigator.userAgent.match("Chrome")?(t="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(t="electron")):null!==window.navigator.userAgent.match("Safari")?t="safari":null!==window.navigator.userAgent.match("AppleWebKit")&&(t="safari"),t};t.a={GetUserMedia:function(t,n,i){n=void 0===n?function(){}:n,i=void 0===i?function(){}:i;var o,r=function(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t).catch(n)};t.screen?function(){switch(a.a.debug("Screen access requested"),c()){case"electron":a.a.debug("Screen sharing in Electron"),(o={}).video=t.video||{},o.video.mandatory=t.video.mandatory||{},o.video.mandatory.chromeMediaSource="screen",r(o,n,i);break;case"mozilla":a.a.debug("Screen sharing in Firefox"),o={},void 0!==t.video?(o.video=t.video,o.video.mediaSource="window"):o={audio:t.audio,video:{mediaSource:"window"}},r(o,n,i);break;case"chrome-stable":if(a.a.debug("Screen sharing in Chrome"),o={},t.desktopStreamId)o.video=t.video||{mandatory:{}},o.video.mandatory=o.video.mandatory||{},o.video.mandatory.chromeMediaSource="desktop",o.video.mandatory.chromeMediaSourceId=t.desktopStreamId,r(o,n,i);else{var e="okeephmleflklcdebijnponpabbmmgeo";t.extensionId&&(a.a.debug("extensionId supplied, using "+t.extensionId),e=t.extensionId),a.a.debug("Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(e,{getStream:!0},(function(e){void 0===e?(a.a.error("Access to screen denied"),i({code:"Access to screen denied"})):(e=e.streamId,void 0!==t.video.mandatory?(o.video=t.video,o.video.mandatory.chromeMediaSource="desktop",o.video.mandatory.chromeMediaSourceId=e):o={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}}},r(o,n,i))}))}catch(e){a.a.debug("Screensharing plugin is not accessible "),i({code:"no_plugin_present"})}}break;default:a.a.error("This browser does not support ScreenSharing")}}():void 0!==e&&e.exports?a.a.error("Video/audio streams not supported in erizofc yet"):(a.a.debug("Calling getUserMedia with config",t),r(t,n,i))},buildConnection:function(e){var t={};if(s+=1,e.sessionId=s,t.browser=c(),"fake"===t.browser)a.a.warning("Publish/subscribe video/audio streams not supported in erizofc yet"),t=Object(r.a)(e);else if("mozilla"===t.browser)a.a.debug("Firefox Stack"),t=Object(o.a)(e);else if("safari"===t.browser)a.a.debug("Safari using Firefox Stack"),t=Object(o.a)(e);else{if("chrome-stable"!==t.browser&&"electron"!==t.browser)throw a.a.error("No stack available for this browser"),Error("WebRTC stack not available");a.a.debug("Chrome Stable Stack"),t=Object(i.a)(e)}return t.updateSpec||(t.updateSpec=function(e,t){t=void 0===t?function(){}:t,a.a.error("Update Configuration not implemented in this browser"),t("unimplemented")}),t},getBrowser:c}}).call(t,n(11)(e))},function(e,t,n){var i=n(5),o=n(0);t.a=function(e){var t,n,r={};o.a.info("Starting Base stack",e),r.pcConfig={iceServers:[]},r.con={},void 0!==e.iceServers&&(r.pcConfig.iceServers=e.iceServers),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),e.remoteCandidates=[],e.localCandidates=[],e.remoteDescriptionSet=!1,r.mediaConstraints={offerToReceiveVideo:void 0!==e.video&&!1!==e.video,offerToReceiveAudio:void 0!==e.audio&&!1!==e.audio},r.peerConnection=new RTCPeerConnection(r.pcConfig,r.con);var a=function(e,t,n){o.a.error("message:",n,"in baseStack at",e),void 0!==t&&t("error")},s=function(e){o.a.info("Success in BaseStack",e)},c=function(n,o){t=o,n||(t.sdp=r.enableSimulcast(t.sdp)),t.sdp=i.a.setMaxBW(t.sdp,e),e.callback({type:t.type,sdp:t.sdp})},d=function(n){(t=n).sdp=i.a.setMaxBW(t.sdp,e),e.callback({type:t.type,sdp:t.sdp}),o.a.info("Setting local description p2p",t),r.peerConnection.setLocalDescription(t).then(s).catch(a)},u=function(t){t.sdp=i.a.setMaxBW(t.sdp,e),r.peerConnection.setRemoteDescription(t).then((function(){r.peerConnection.createAnswer(r.mediaConstraints).then(d).catch(a.bind(null,"createAnswer p2p",void 0)),e.remoteDescriptionSet=!0})).catch(a.bind(null,"process Offer",void 0))},l=function(s){o.a.info("Set remote and local description"),o.a.debug("Remote Description",s.sdp),o.a.debug("Local Description",t.sdp),s.sdp=i.a.setMaxBW(s.sdp,e),n=s,r.peerConnection.setLocalDescription(t).then((function(){r.peerConnection.setRemoteDescription(new RTCSessionDescription(s)).then((function(){for(e.remoteDescriptionSet=!0,o.a.info("Candidates to be added: ",e.remoteCandidates.length,e.remoteCandidates);0<e.remoteCandidates.length;)r.peerConnection.addIceCandidate(e.remoteCandidates.shift());for(o.a.info("Local candidates to send:",e.localCandidates.length);0<e.localCandidates.length;)e.callback({type:"candidate",candidate:e.localCandidates.shift()})})).catch(a.bind(null,"processAnswer",void 0))})).catch(a.bind(null,"processAnswer",void 0))};return r.peerConnection.onicecandidate=function(t){(t=t.candidate)?(t.candidate.match(/a=/)||(t.candidate="a="+t.candidate),t={sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate}):(o.a.info("Gathered all candidates. Sending END candidate"),t={sdpMLineIndex:-1,sdpMid:"end",candidate:"end"}),e.remoteDescriptionSet?e.callback({type:"candidate",candidate:t}):(e.localCandidates.push(t),o.a.info("Storing candidate: ",e.localCandidates.length,t))},r.peerConnection.onaddstream=function(e){r.onaddstream&&r.onaddstream(e)},r.peerConnection.onremovestream=function(e){r.onremovestream&&r.onremovestream(e)},r.peerConnection.oniceconnectionstatechange=function(e){r.oniceconnectionstatechange&&r.oniceconnectionstatechange(e.target.iceConnectionState)},r.enableSimulcast=function(e){return o.a.error("Simulcast not implemented"),e},r.close=function(){r.state="closed",r.peerConnection.close()},r.updateSpec=function(s,c){c=void 0===c?function(){}:c,(s.maxVideoBW||s.maxAudioBW)&&(s.maxVideoBW&&(o.a.debug("Maxvideo Requested:",s.maxVideoBW,"limit:",e.limitMaxVideoBW),s.maxVideoBW>e.limitMaxVideoBW&&(s.maxVideoBW=e.limitMaxVideoBW),e.maxVideoBW=s.maxVideoBW,o.a.debug("Result",e.maxVideoBW)),s.maxAudioBW&&(s.maxAudioBW>e.limitMaxAudioBW&&(s.maxAudioBW=e.limitMaxAudioBW),e.maxAudioBW=s.maxAudioBW),t.sdp=i.a.setMaxBW(t.sdp,e),s.Sdp||s.maxAudioBW?(o.a.debug("Updating with SDP renegotiation",e.maxVideoBW,e.maxAudioBW),r.peerConnection.setLocalDescription(t).then((function(){n.sdp=i.a.setMaxBW(n.sdp,e),r.peerConnection.setRemoteDescription(new RTCSessionDescription(n)).then((function(){e.remoteDescriptionSet=!0,e.callback({type:"updatestream",sdp:t.sdp})})).catch(a.bind(null,"updateSpec",void 0))})).catch(a.bind(null,"updateSpec",c))):(o.a.debug("Updating without SDP renegotiation, newVideoBW:",e.maxVideoBW,"newAudioBW:",e.maxAudioBW),e.callback({type:"updatestream",sdp:t.sdp}))),(s.minVideoBW||void 0!==s.slideShowMode||void 0!==s.muteStream||void 0!==s.qualityLayer)&&(o.a.debug("MinVideo Changed to ",s.minVideoBW),o.a.debug("SlideShowMode Changed to ",s.slideShowMode),o.a.debug("muteStream changed to ",s.muteStream),e.callback({type:"updatestream",config:s}))},r.createOffer=function(e){!0!==e&&(r.mediaConstraints={offerToReceiveVideo:!1,offerToReceiveAudio:!1}),o.a.debug("Creating offer",r.mediaConstraints),r.peerConnection.createOffer(r.mediaConstraints).then(c.bind(null,e)).catch(a.bind(null,"Create Offer",void 0))},r.addStream=function(e){r.peerConnection.addStream(e)},r.processSignalingMessage=function(t){if("offer"===t.type)u(t);else if("answer"===t.type)l(t);else if("candidate"===t.type)try{var n="object"==typeof t.candidate?t.candidate:JSON.parse(t.candidate);if("end"!==n.candidate){n.candidate=n.candidate.replace(/a=/g,""),n.sdpMLineIndex=parseInt(n.sdpMLineIndex,10);var i=new RTCIceCandidate(n);e.remoteDescriptionSet?r.peerConnection.addIceCandidate(i):e.remoteCandidates.push(i)}}catch(e){o.a.error("Error parsing candidate",t.candidate)}},r}},function(e,t,n){t.a={addSim:function(e){var t="a=ssrc-group:SIM";return e.forEach((function(e){t+=" "+e})),t+"\r\n"},addGroup:function(e,t){return"a=ssrc-group:FID "+e+" "+t+"\r\n"},addSpatialLayer:function(e,t,n,i,o,r){return"a=ssrc:"+o+" cname:"+e+"\r\na=ssrc:"+o+" msid:"+t+"\r\na=ssrc:"+o+" mslabel:"+n+"\r\na=ssrc:"+o+" label:"+i+"\r\na=ssrc:"+r+" cname:"+e+"\r\na=ssrc:"+r+" msid:"+t+"\r\na=ssrc:"+r+" mslabel:"+n+"\r\na=ssrc:"+r+" label:"+i+"\r\n"},setMaxBW:function(e,t){var n=e;if(t.video&&t.maxVideoBW){var i=(n=n.replace(/b=AS:.*\r\n/g,"")).match(/m=video.*\r\n/);null==i&&(i=n.match(/m=video.*\n/)),i&&0<i.length&&(e=i[0]+"b=AS:"+t.maxVideoBW+"\r\n",n=n.replace(i[0],e))}return t.audio&&t.maxAudioBW&&(null==(i=n.match(/m=audio.*\r\n/))&&(i=n.match(/m=audio.*\n/)),i&&0<i.length&&(e=i[0]+"b=AS:"+t.maxAudioBW+"\r\n",n=n.replace(i[0],e))),n},enableOpusNacks:function(e){var t=e.match(/a=rtpmap:(.*)opus.*\r\n/);return null!==t&&(e=e.replace(t[0],t[0]+"a=rtcp-fb:"+t[1]+"nack\r\n")),e}}},function(e,t,n){var i=n(1),o=n(3),r=n(17),a=n(19),s=n(0);t.a=function(e,t){var n=Object(i.a)(t);if(n.stream=t.stream,n.url=t.url,n.recording=t.recording,n.room=void 0,n.showing=!1,n.local=!1,n.video=t.video,n.audio=t.audio,n.screen=t.screen,n.videoSize=t.videoSize,n.videoFrameRate=t.videoFrameRate,n.extensionId=t.extensionId,n.desktopStreamId=t.desktopStreamId,n.audioMuted=!1,n.videoMuted=!1,n.Connection=void 0===e?o.a:e,!(void 0===n.videoSize||n.videoSize instanceof Array&&4===n.videoSize.length))throw Error("Invalid Video Size");void 0!==t.local&&!0!==t.local||(n.local=!0),n.getID=function(){return n.local&&!t.streamID?"local":t.streamID},n.getAttributes=function(){return t.attributes},n.setAttributes=function(e){n.local?n.emit(Object(i.d)({type:"internal-set-attributes",stream:n,attrs:e})):s.a.error("Failed to set attributes data. This Stream object has not been published.")},n.updateLocalAttributes=function(e){t.attributes=e},n.hasAudio=function(){return!1!==t.audio&&void 0!==t.audio},n.hasVideo=function(){return!1!==t.video&&void 0!==t.video},n.hasData=function(){return!1!==t.data&&void 0!==t.data},n.hasScreen=function(){return t.screen},n.hasMedia=function(){return t.audio||t.video||t.screen},n.isExternal=function(){return void 0!==n.url||void 0!==n.recording},n.sendData=function(e){n.local&&n.hasData()?n.emit(Object(i.d)({type:"internal-send-data",stream:n,msg:e})):s.a.error("Failed to send data. This Stream object has not been published.")},n.init=function(){try{if((t.audio||t.video||t.screen)&&void 0===t.url){s.a.info("Requested access to local media");var e=t.video;!0===e||!0===t.screen?(e=!0===e?{}:e,void 0!==n.videoSize&&(e.width={min:n.videoSize[0],max:n.videoSize[2]},e.height={min:n.videoSize[1],max:n.videoSize[3]}),void 0!==n.videoFrameRate&&(e.frameRate={min:n.videoFrameRate[0],max:n.videoFrameRate[1]})):!0===t.screen&&void 0===e&&(e=!0),n.Connection.GetUserMedia({video:e,audio:t.audio,fake:t.fake,screen:t.screen,extensionId:n.extensionId,desktopStreamId:n.desktopStreamId},(function(e){s.a.info("User has granted access to local media."),n.stream=e,n.dispatchEvent(Object(i.d)({type:"access-accepted"})),n.stream.getTracks().forEach((function(e){s.a.info("getTracks",e),e.onended=function(){n.stream.getTracks().forEach((function(e){e.onended=null}));var t=Object(i.d)({type:"stream-ended",stream:n,msg:e.kind});n.dispatchEvent(t)}}))}),(function(e){s.a.error("Failed to get access to local media. Error code was "+e.code+"."),e=Object(i.d)({type:"access-denied",msg:e}),n.dispatchEvent(e)}))}else{var o=Object(i.d)({type:"access-accepted"});n.dispatchEvent(o)}}catch(t){s.a.error("Failed to get access to local media. Error was "+t+"."),e=Object(i.d)({type:"access-denied",msg:t}),n.dispatchEvent(e)}},n.close=function(){n.local&&(void 0!==n.room&&n.room.unpublish(n),n.hide(),void 0!==n.stream&&n.stream.getTracks().forEach((function(e){e.onended=null,e.stop()})),n.stream=void 0)},n.play=function(e,t){t=t||{},n.elementID=e,n.hasVideo()||n.hasScreen()?void 0!==e&&(e=Object(r.a)({id:n.getID(),stream:n,elementID:e,options:t}),n.player=e,n.showing=!0):n.hasAudio()&&(e=Object(a.a)({id:n.getID(),stream:n,elementID:e,options:t}),n.player=e,n.showing=!0)},n.stop=function(){n.showing&&void 0!==n.player&&(n.player.destroy(),n.showing=!1)},n.show=n.play,n.hide=n.stop;var c=function(){if(void 0!==n.player&&void 0!==n.stream){var e=n.player.video,t=document.defaultView.getComputedStyle(e),i=parseInt(t.getPropertyValue("width"),10),o=parseInt(t.getPropertyValue("height"),10),r=parseInt(t.getPropertyValue("left"),10);t=parseInt(t.getPropertyValue("top"),10);var a="object"==typeof n.elementID&&"function"==typeof n.elementID.appendChild?n.elementID:document.getElementById(n.elementID),s=document.defaultView.getComputedStyle(a);a=parseInt(s.getPropertyValue("width"),10),s=parseInt(s.getPropertyValue("height"),10);var c=document.createElement("canvas");return c.id="testing",c.width=a,c.height=s,c.setAttribute("style","display: none"),c.getContext("2d").drawImage(e,r,t,i,o),c}return null};n.getVideoFrameURL=function(e){var t=c();return null!==t?e?t.toDataURL(e):t.toDataURL():null},n.getVideoFrame=function(){var e=c();return null!==e?e.getContext("2d").getImageData(0,0,e.width,e.height):null},n.checkOptions=function(e,t){!0===t?(e.video||e.audio||e.screen)&&(s.a.warning("Cannot update type of subscription"),e.video=void 0,e.audio=void 0,e.screen=void 0):!1===n.local&&(!0===e.video&&!1===n.hasVideo()&&(s.a.warning("Trying to subscribe to video when there is no video, won't subscribe to video"),e.video=!1),!0===e.audio&&!1===n.hasAudio()&&(s.a.warning("Trying to subscribe to audio when there is no audio, won't subscribe to audio"),e.audio=!1)),!1!==n.local||n.hasVideo()||!0!==e.slideShowMode||(s.a.warning("Cannot enable slideShowMode if it is not a video subscription, please check your parameters"),e.slideShowMode=!1)};var d=function(e){if(e=void 0===e?function(){}:e,n.room&&n.room.p2p)s.a.warning("muteAudio/muteVideo are not implemented in p2p streams"),e("error");else{if(n.stream)for(var t=0;t<n.stream.getVideoTracks().length;t+=1)n.stream.getVideoTracks()[t].enabled=!n.videoMuted;t={muteStream:{audio:n.audioMuted,video:n.videoMuted}},n.checkOptions(t,!0),n.pc.updateSpec(t,e)}};n.muteAudio=function(e,t){n.audioMuted=e,d(void 0===t?function(){}:t)},n.muteVideo=function(e,t){n.videoMuted=e,d(void 0===t?function(){}:t)},n._setStaticQualityLayer=function(e,t,i){i=void 0===i?function(){}:i,n.room&&n.room.p2p?(s.a.warning("setStaticQualityLayer is not implemented in p2p streams"),i("error")):(e={qualityLayer:{spatialLayer:e,temporalLayer:t}},n.checkOptions(e,!0),n.pc.updateSpec(e,i))},n._setDynamicQualityLayer=function(e){if(n.room&&n.room.p2p)s.a.warning("setDynamicQualityLayer is not implemented in p2p streams"),e("error");else{var t={qualityLayer:{spatialLayer:-1,temporalLayer:-1}};n.checkOptions(t,!0),n.pc.updateSpec(t,e)}};var u=function(e,t,i){!0!==t&&(t=!1),0<(e=(e="string"==typeof e?[e]:e)instanceof Array?e:[]).length&&n.room.sendControlMessage(n,"control",{name:"controlhandlers",enable:i,publisherSide:t,handlers:e})};return n.disableHandlers=function(e,t){u(e,t,!1)},n.enableHandlers=function(e,t){u(e,t,!0)},n.updateConfiguration=function(e,t){if(t=void 0===t?function(){}:t,void 0!==e)if(n.pc)if(n.checkOptions(e,!0),n.local)if(n.room.p2p)for(var i=0;i<n.pc.length;i+=1)n.pc[i].updateSpec(e,t);else n.pc.updateSpec(e,t);else n.pc.updateSpec(e,t);else t("This stream has no peerConnection attached, ignoring")},n}},function(e,t,n){var i=n(2),o=n(18);t.a=function(e){var t,n=Object(i.a)({});n.elementID=e.elementID,n.id=e.id,n.div=document.createElement("div"),n.div.setAttribute("id","bar_"+n.id),n.div.setAttribute("class","licode_bar"),n.bar=document.createElement("div"),n.bar.setAttribute("style","z-index: -1; width: 100%; height: 15%; max-height: 30px; position: absolute; bottom: 0; right: 0; background-color: rgba(255,255,255,0.62)"),n.bar.setAttribute("id","subbar_"+n.id),n.bar.setAttribute("class","licode_subbar"),n.link=document.createElement("a"),n.link.setAttribute("href","http://www.lynckia.com/"),n.link.setAttribute("class","licode_link"),n.link.setAttribute("target","_blank"),n.logo=document.createElement("img"),n.logo.setAttribute("style","width: 100%; height: 100%; max-width: 30px; position: absolute; top: 0; left: 2px;"),n.logo.setAttribute("class","licode_logo"),n.logo.setAttribute("alt","Lynckia"),n.logo.setAttribute("src",n.url+"/assets/star.svg");var r=function(e){var i=e;"block"!==e?i="none":clearTimeout(t),n.div.setAttribute("style","z-index: -1; width: 100%; height: 100%; position: relative; bottom: 0; right: 0; display: "+i)};return n.display=function(){},n.hide=function(){t=setTimeout(r,1)},document.getElementById(n.elementID).appendChild(n.div),n.div.appendChild(n.bar),n.bar.appendChild(n.link),n.link.appendChild(n.logo),e.stream.screen||void 0!==e.options&&void 0!==e.options.speaker&&!0!==e.options.speaker||(n.speaker=Object(o.a)({elementID:"subbar_"+n.id,id:n.id,stream:e.stream,media:e.media})),n.display(),n.hide(),n}},function(e,t){t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),e=n(10);var i=n(1),o=n(6),r=n(0);n(22),n(24),n={Room:e.a.bind(null,void 0,void 0),LicodeEvent:i.b,RoomEvent:i.c,StreamEvent:i.d,Stream:o.a.bind(null,void 0),Logger:r.a},t.default=n},function(e,n,i){var o=i(3),r=i(1),a=i(15),s=i(6),c=i(20),d=i(21),u=i(0);n.a=function(e,n,i){var l=Object(r.a)(i);l.remoteStreams=Object(c.a)(),l.localStreams=Object(c.a)(),l.recodeId=[],l.roomID="",l.state=0,l.p2p=!1,l.Connection=void 0===n?o.a:n;var p=Object(a.a)(e),f=l.remoteStreams,m=l.localStreams,g=0,v=function(e){e.stream&&(e.hide(),e.stop(),e.close(),delete e.stream),e.pc&&(e.local&&l.p2p?e.pc.forEach((function(t,n){t.close(),e.pc.remove(n)})):(e.pc.close(),delete e.pc))},h=function(e,t){0!==l.state&&e&&!e.failed&&(e.failed=!0,t=Object(r.d)({type:"stream-failed",msg:t||"Stream failed after connection",stream:e}),l.dispatchEvent(t),e.local?l.unpublish(e):l.unsubscribe(e))},y=function(e,t){u.a.info("Stream subscribed"),e.stream=t.stream,e=Object(r.d)({type:"stream-subscribed",stream:e}),l.dispatchEvent(e)},S=function(e,t){return{callback:function(n){p.sendSDP("signaling_message",{streamId:e.getID(),peerSocket:t,msg:n})},audio:e.hasAudio(),video:e.hasVideo(),iceServers:l.iceServers,maxAudioBW:e.maxAudioBW,maxVideoBW:e.maxVideoBW,limitMaxAudioBW:i.maxAudioBW,limitMaxVideoBW:i.maxVideoBW}},b=function(e,t,n){var o={callback:function(t){u.a.info("Sending message",t),p.sendSDP("signaling_message",{streamId:e.getID(),msg:t,browser:e.pc.browser},void 0,(function(){}))},nop2p:!0,audio:t.audio&&e.hasAudio(),video:t.video&&e.hasVideo(),maxAudioBW:t.maxAudioBW,maxVideoBW:t.maxVideoBW,limitMaxAudioBW:i.maxAudioBW,limitMaxVideoBW:i.maxVideoBW,iceServers:l.iceServers};return n||(o.simulcast=t.simulcast),o},I=function(e){var t=e.stream;e=e.msg,t.local?p.sendMessage("sendDataStream",{id:t.getID(),msg:e}):u.a.error("You can not send data through a remote stream")},_=function(e){var t=e.stream;e=e.attrs,t.local?(t.updateLocalAttributes(e),p.sendMessage("updateStreamAttributes",{id:t.getID(),attrs:e})):u.a.error("You can not update attributes in a remote stream")};e=function(e,n){n.args?e.apply(null,[].concat(t.arrayFromIterable(n.args))):e()};var E=function(e,t,n){return{state:e,data:t.hasData(),audio:t.hasAudio(),video:t.hasVideo(),screen:t.hasScreen(),attributes:t.getAttributes(),metadata:n.metadata,createOffer:n.createOffer}},C=function(e,t,n,i){i=void 0===i?function(){}:i,null===e?(u.a.error("Error when publishing the stream",n),i(void 0,n)):(u.a.info("Stream published"),t.getID=function(){return e},t.on("internal-send-data",I),t.on("internal-set-attributes",_),m.add(e,t),t.room=l,i(e))},T=function(e,t,n){n=void 0===n?function(){}:n,u.a.info("Publishing to Erizo Normally, is createOffer",t.createOffer);var i=E("erizo",e,t);i.minVideoBW=t.minVideoBW,i.scheme=t.scheme,p.sendSDP("publish",i,void 0,(function(i,o){C(i,e,o,void 0),function(e,t){e.pc=l.Connection.buildConnection(b(e,t)),e.pc.addStream(e.stream),e.pc.oniceconnectionstatechange=function(t){"failed"===t&&h(e)},t.createOffer||e.pc.createOffer()}(e,t),n(i)}))},w=function(e,t,n){n=void 0===n?function(){}:n,t.maxVideoBW=t.maxVideoBW||i.defaultVideoBW,t.maxVideoBW>i.maxVideoBW&&(t.maxVideoBW=i.maxVideoBW),t.audio=void 0===t.audio||t.audio,t.video=void 0===t.video||t.video,t.data=void 0===t.data||t.data,e.checkOptions(t);var o={streamId:e.getID(),audio:t.audio&&e.hasAudio(),video:t.video&&e.hasVideo(),data:t.data&&e.hasData(),browser:l.Connection.getBrowser(),createOffer:t.createOffer,metadata:t.metadata,slideShowMode:t.slideShowMode};p.sendSDP("subscribe",o,void 0,(function(i,o){null===i?(u.a.error("Error subscribing to stream ",o),n(void 0,o)):(u.a.info("Subscriber added"),function(e,t){e.pc=l.Connection.buildConnection(b(e,t,!0)),e.pc.onaddstream=y.bind(null,e),e.pc.oniceconnectionstatechange=function(t){"failed"===t&&h(e)},e.pc.createOffer(!0)}(e,t),n(!0))}))};return l.connect=function(){var e=d.a.decodeBase64(i.token);0!==l.state&&u.a.warning("Room already connected"),l.state=1,p.connect(JSON.parse(e),(function(e){var t=[],n=e.streams||[],o=e.id;l.p2p=e.p2p,l.iceServers=e.iceServers,l.state=2,i.defaultVideoBW=e.defaultVideoBW,i.maxVideoBW=e.maxVideoBW;for(var a=Object.keys(n),c=0;c<a.length;c+=1){var d=n[a[c]];e=Object(s.a)(l.Connection,{streamID:d.id,local:!1,audio:d.audio,video:d.video,data:d.data,screen:d.screen,attributes:d.attributes}),t.push(e),f.add(d.id,e)}l.roomID=o,u.a.info("Connected to room "+l.roomID),t=Object(r.c)({type:"room-connected",streams:t}),l.dispatchEvent(t)}),(function(e){u.a.error("Not Connected! Error: "+e),e=Object(r.c)({type:"room-error",message:e}),l.dispatchEvent(e)}))},l.disconnect=function(){u.a.debug("Disconnection requested");var e=Object(r.c)({type:"room-disconnected",message:"expected-disconnection"});l.dispatchEvent(e)},l.publish=function(e,t,n){n=void 0===n?function(){}:n,(t=void 0===t?{}:t).maxVideoBW=t.maxVideoBW||i.defaultVideoBW,t.maxVideoBW>i.maxVideoBW&&(t.maxVideoBW=i.maxVideoBW),void 0===t.minVideoBW&&(t.minVideoBW=0),t.minVideoBW>i.defaultVideoBW&&(t.minVideoBW=i.defaultVideoBW),t.simulcast=t.simulcast||!1,e&&e.local&&!e.failed&&!m.has(e.getID())?e.hasMedia()?e.isExternal()?function(e,t,n){if(n=void 0===n?function(){}:n,e.url)var i="url",o=e.url;else i="recording",o=e.recording;u.a.info("Checking publish options for",e.getID()),e.checkOptions(t),p.sendSDP("publish",E(i,e,t),o,(function(t,i){C(t,e,i,n)}))}(e,t,n):l.p2p?function(e,t,n){n=void 0===n?function(){}:n,e.maxAudioBW=t.maxAudioBW,e.maxVideoBW=t.maxVideoBW,p.sendSDP("publish",E("p2p",e,t),void 0,(function(t,i){C(t,e,i,n)}))}(e,t,n):T(e,t,n):e.hasData()&&function(e,t,n){n=void 0===n?function(){}:n,p.sendSDP("publish",E("data",e,t),void 0,(function(t,i){C(t,e,i,n)}))}(e,t,n):(u.a.error("Trying to publish invalid stream"),n(void 0,"Invalid Stream"))},l.startRecording=function(e,t){t=void 0===t?function(){}:t,void 0===e?(u.a.error("Trying to start recording on an invalid stream",e),t(void 0,"Invalid Stream")):(u.a.debug("Start Recording stream: "+e.getID()),p.sendMessage("startRecorder",{to:e.getID()},(function(e,n){null===e?(u.a.error("Error on start recording",n),t(void 0,n)):(u.a.info("Start recording",e),t(e))})))},l.startAllRecording=function(){f.forEach((function(e){u.a.debug("Start Room Recording stream: "+e.getID()),p.sendMessage("startRecorder",{to:e.getID()},(function(e,t){null===e?u.a.error("Error on start recording",t):(l.recodeId[g]=e,u.a.info("Start Room recording",e),g+=1)}))}))},l.stopRecording=function(e,t){t=void 0===t?function(){}:t,p.sendMessage("stopRecorder",{id:e},(function(n,i){null===n?(u.a.error("Error on stop recording",i),t(void 0,i)):(u.a.info("Stop recording",e),t(!0))}))},l.stopAllRecording=function(){for(var e=0;e<g;e+=1)u.a.debug("Stop Room Recording stream: "+l.recodeId[e]),p.sendMessage("stopRecorder",{id:l.recodeId[e]}),u.a.info("Stop All recording",l.recodeId[e]);g=0},l.unpublish=function(e,t){t=void 0===t?function(){}:t,e&&e.local?(p.sendMessage("unpublish",e.getID(),(function(n,i){null===n?(u.a.error("Error unpublishing stream",i),t(void 0,i)):(delete e.failed,u.a.info("Stream unpublished"),t(!0))})),e.room=void 0,e.hasMedia()&&!e.isExternal()&&v(e),m.remove(e.getID()),e.getID=function(){},e.off("internal-send-data",I),e.off("internal-set-attributes",_)):(u.a.error("Cannot unpublish, stream does not exist or is not local"),t(void 0,"Cannot unpublish, stream does not exist or is not local"))},l.sendControlMessage=function(e,t,n){e&&e.getID()&&(t={type:"control",action:n},p.sendSDP("signaling_message",{streamId:e.getID(),msg:t}))},l.subscribe=function(e,t,n){if(t=void 0===t?{}:t,n=void 0===n?function(){}:n,!e||e.local||e.failed)t="Error on subscribe",e?e.local?(u.a.warning("Cannot subscribe to local stream, you should subscribe to the remote version of your local stream"),t="Local copy of stream"):e.failed&&(u.a.warning("Cannot subscribe to failed stream."),t="Failed stream"):(u.a.warning("Cannot subscribe to invalid stream"),t="Invalid or undefined stream"),n(void 0,t);else{if(e.hasMedia())e.hasVideo()||e.hasScreen()||(t.video=!1),e.hasAudio()||(t.audio=!1),l.p2p?(p.sendSDP("subscribe",{streamId:e.getID(),metadata:t.metadata}),n(!0)):w(e,t,n);else{if(!e.hasData()||!1===t.data)return u.a.warning("There's nothing to subscribe to"),void n(void 0,"Nothing to subscribe to");!function(e,t,n){n=void 0===n?function(){}:n,p.sendSDP("subscribe",{streamId:e.getID(),data:t.data,metadata:t.metadata},void 0,(function(t,i){null===t?(u.a.error("Error subscribing to stream ",i),n(void 0,i)):(u.a.info("Stream subscribed"),t=Object(r.d)({type:"stream-subscribed",stream:e}),l.dispatchEvent(t),n(!0))}))}(e,t,n)}u.a.info("Subscribing to: "+e.getID())}},l.unsubscribe=function(e,t){t=void 0===t?function(){}:t,void 0!==p&&e&&!e.local&&p.sendMessage("unsubscribe",e.getID(),(function(n,i){null===n?t(void 0,i):(v(e),delete e.failed,t(!0))}),(function(){u.a.error("Error calling unsubscribe.")}))},l.getStreamStats=function(e,t){return t=void 0===t?function(){}:t,p?e?void p.sendMessage("getStreamStats",e.getID(),(function(e){e&&t(e)})):"Error getting stats - no stream":"Error getting stats - no socket"},l.getStreamsByAttribute=function(e,t){var n=[];return f.forEach((function(i){void 0!==i.getAttributes()&&i.getAttributes()[e]===t&&n.push(i)})),n},l.on("room-disconnected",(function(){l.state=0,p.state=p.DISCONNECTED,f.forEach((function(e,t){v(e),f.remove(t),e&&!e.failed&&(e=Object(r.d)({type:"stream-removed",stream:e}),l.dispatchEvent(e))})),f=Object(c.a)(),m.forEach((function(e,t){v(e),m.remove(t)})),m=Object(c.a)();try{p.disconnect()}catch(e){u.a.debug("Socket already disconnected")}p=void 0})),p.on("onAddStream",e.bind(null,(function(e){var t=Object(s.a)(l.Connection,{streamID:e.id,local:!1,audio:e.audio,video:e.video,data:e.data,screen:e.screen,attributes:e.attributes});t.room=l,f.add(e.id,t),e=Object(r.d)({type:"stream-added",stream:t}),l.dispatchEvent(e)}))),p.on("signaling_message_erizo",e.bind(null,(function(e){var t;(t=e.peerId?f.get(e.peerId):m.get(e.streamId))&&!t.failed&&t.pc.processSignalingMessage(e.mess)}))),p.on("signaling_message_peer",e.bind(null,(function(e){var t=m.get(e.streamId);t&&!t.failed?t.pc.get(e.peerSocket).processSignalingMessage(e.msg):((t=f.get(e.streamId)).pc||function(e,t){e.pc=l.Connection.buildConnection(S(e,t)),e.pc.onaddstream=y.bind(null,e),e.pc.oniceconnectionstatechange=function(t){"failed"===t&&h(e)}}(t,e.peerSocket),t.pc.processSignalingMessage(e.msg))}))),p.on("publish_me",e.bind(null,(function(e){!function(e,t){void 0===e.pc&&(e.pc=Object(c.a)());var n=l.Connection.buildConnection(S(e,t));e.pc.add(t,n),n.oniceconnectionstatechange=function(n){"failed"===n&&(e.pc.get(t).close(),e.pc.remove(t))},n.addStream(e.stream),n.createOffer()}(m.get(e.streamId),e.peerSocket)}))),p.on("onBandwidthAlert",e.bind(null,(function(e){if(u.a.info("Bandwidth Alert on",e.streamID,"message",e.message,"BW:",e.bandwidth),e.streamID){var t=f.get(e.streamID);t&&!t.failed&&(e=Object(r.d)({type:"bandwidth-alert",stream:t,msg:e.message,bandwidth:e.bandwidth}),t.dispatchEvent(e))}}))),p.on("onDataStream",e.bind(null,(function(e){var t=f.get(e.id);e=Object(r.d)({type:"stream-data",msg:e.msg,stream:t}),t.dispatchEvent(e)}))),p.on("onUpdateAttributeStream",e.bind(null,(function(e){var t=f.get(e.id),n=Object(r.d)({type:"stream-attributes-update",attrs:e.attrs,stream:t});t.updateLocalAttributes(e.attrs),t.dispatchEvent(n)}))),p.on("onRemoveStream",e.bind(null,(function(e){var t=m.get(e.id);t?h(t):(t=f.get(e.id),f.remove(e.id),v(t),e=Object(r.d)({type:"stream-removed",stream:t}),l.dispatchEvent(e))}))),p.on("disconnect",e.bind(null,(function(){if(u.a.info("Socket disconnected, lost connection to ErizoController"),0!==l.state){u.a.error("Unexpected disconnection from ErizoController");var e=Object(r.c)({type:"room-disconnected",message:"unexpected-disconnection"});l.dispatchEvent(e)}}))),p.on("connection_failed",e.bind(null,(function(e){if(e.streamId){var t="ICE Connection Failed on "+e.type+" "+e.streamId+" "+l.state;u.a.error(t),e="publish"===e.type?m.get(e.streamId):f.get(e.streamId),h(e,t)}}))),p.on("error",e.bind(null,(function(e){u.a.error("Cannot connect to erizo Controller"),e=Object(r.c)({type:"room-error",message:e}),l.dispatchEvent(e)}))),l}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){var i=n(4),o=n(5),r=n(0);t.a=function(e){r.a.info("Starting Chrome stable stack",e);var t=Object(i.a)(e);return t.enableSimulcast=function(t){var n=t;if(!e.video||!e.simulcast)return n;if(!(t=n.match(/a=ssrc-group:FID ([0-9]*) ([0-9]*)\r?\n/))||0>=t.length)return n;var i=e.simulcast.numSpatialLayers||2,r=parseInt(t[1],10),a=parseInt(t[2],10),s=n.match(new RegExp("a=ssrc:"+t[1]+" cname:(.*)\r?\n"))[1],c=n.match(new RegExp("a=ssrc:"+t[1]+" msid:(.*)\r?\n"))[1],d=n.match(new RegExp("a=ssrc:"+t[1]+" mslabel:(.*)\r?\n"))[1],u=n.match(new RegExp("a=ssrc:"+t[1]+" label:(.*)\r?\n"))[1];n.match(new RegExp("a=ssrc:"+t[1]+".*\r?\n","g")).forEach((function(e){n=n.replace(e,"")})),n.match(new RegExp("a=ssrc:"+t[2]+".*\r?\n","g")).forEach((function(e){n=n.replace(e,"")}));for(var l=[r],p=[a],f=1;f<i;f+=1)l.push(r+1e3*f),p.push(a+1e3*f);for(i=o.a.addSim(l),f=0;f<l.length;f+=1)r=l[f],a=p[f],i+=o.a.addGroup(r,a);for(f=0;f<l.length;f+=1)r=l[f],a=p[f],i+=o.a.addSpatialLayer(s,c,d,u,r,a);return n.replace(t[0],i+"a=x-google-flag:conference\r\n")},t}},function(e,t,n){var i=n(0),o=n(4);t.a=function(e){i.a.info("Starting Firefox stack");var t=Object(o.a)(e);return t.enableSimulcast=function(n){return e.video&&e.simulcast?(t.peerConnection.getSenders().forEach((function(e){"video"===e.track.kind&&(e.getParameters(),e.setParameters({encodings:[{rid:"spam",active:!0,priority:"high",maxBitrate:4e4,maxHeight:640,maxWidth:480},{rid:"egg",active:!0,priority:"medium",maxBitrate:1e4,maxHeight:320,maxWidth:240}]}))})),n):n},t}},function(e,t,n){var i=n(0);t.a=function(e){var t={pcConfig:{},peerConnection:{},desc:{},signalCallback:void 0,close:function(){i.a.info("Close FcStack")},createOffer:function(){i.a.debug("FCSTACK: CreateOffer")},addStream:function(e){i.a.debug("FCSTACK: addStream",e)},processSignalingMessage:function(e){i.a.debug("FCSTACK: processSignaling",e),void 0!==t.signalCallback&&t.signalCallback(e)},sendSignalingMessage:function(t){i.a.debug("FCSTACK: Sending signaling Message",t),e.callback(t)},setSignalingCallback:function(e){e=void 0===e?function(){}:e,i.a.debug("FCSTACK: Setting signalling callback"),t.signalCallback=e}};return t}},function(e,n,i){i.d(n,"a",(function(){return c})),e=i(16);var o=i.n(e),r=i(0),a=i(1),s=function(e,t){return(e=Object(a.b)({type:e})).args=t.args,e},c=function(e){var n=Object(a.a)(),i=function(){};t.initSymbol(),n.CONNECTED=Symbol("connected"),t.initSymbol(),n.DISCONNECTED=Symbol("disconnected"),n.state=n.DISCONNECTED,n.IO=void 0===e?o.a:e;var c,d=function(e,t){for(var i=[],o=1;o<arguments.length;++o)i[o-1]=arguments[o];n.emit(s(e,{args:i}))};return n.connect=function(e,o,r){o=void 0===o?i:o,r=void 0===r?i:r,(c=n.IO.connect((e.secure?"wss://":"ws://")+e.host,{reconnect:!1,secure:e.secure,forceNew:!0,transports:["websocket"],rejectUnauthorized:!1})).on("onAddStream",d.bind(n,"onAddStream")),c.on("signaling_message_erizo",d.bind(n,"signaling_message_erizo")),c.on("signaling_message_peer",d.bind(n,"signaling_message_peer")),c.on("publish_me",d.bind(n,"publish_me")),c.on("onBandwidthAlert",d.bind(n,"onBandwidthAlert")),c.on("onDataStream",d.bind(n,"onDataStream")),c.on("onUpdateAttributeStream",d.bind(n,"onUpdateAttributeStream")),c.on("onRemoveStream",d.bind(n,"onRemoveStream")),c.on("disconnect",d.bind(n,"disconnect")),c.on("connection_failed",d.bind(n,"connection_failed")),c.on("error",d.bind(n,"error")),n.sendMessage("token",e,(function(e){for(var i=[],r=0;r<arguments.length;++r)i[r-0]=arguments[r];n.state=n.CONNECTED,o.apply(null,[].concat(t.arrayFromIterable(i)))}),r)},n.disconnect=function(){n.state=n.DISCONNECTED,c.disconnect()},n.sendMessage=function(e,t,o,a){o=void 0===o?i:o,a=void 0===a?i:a,n.state===n.DISCONNECTED&&"token"!==e?r.a.error("Trying to send a message over a disconnected Socket"):c.emit(e,t,(function(e,t){"success"===e?o(t):"error"===e?a(t):o(e,t)}))},n.sendSDP=function(e,t,o,a){a=void 0===a?i:a,n.state===n.DISCONNECTED?r.a.error("Trying to send a message over a disconnected Socket"):c.emit(e,t,o,(function(e,t){a(e,t)}))},n}},function(e,n,i){e.exports=function(e){function t(i){if(n[i])return n[i].exports;var o=n[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,n,i){function o(e,t){var n;"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),t=t||{};var i=(e=a(e)).source,o=e.id,s=e.path;return s=u[o]&&s in u[o].nsps,t.forceNew||t["force new connection"]||!1===t.multiplex||s?(d("ignoring socket cache for %s",i),n=c(i,t)):(u[o]||(d("new io instance for %s",i),u[o]=c(i,t)),n=u[o]),e.query&&!t.query&&(t.query=e.query),n.socket(e.path,t)}t.initSymbol(),t.initSymbol(),t.initSymbolIterator();var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return t.initSymbol(),t.initSymbol(),t.initSymbol(),e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(1),s=i(7),c=i(13),d=i(3)("socket.io-client");e.exports=n=o;var u=n.managers={};n.protocol=s.protocol,n.connect=o,n.Manager=i(13),n.Socket=i(39)},function(e,t,n){(function(t){var i=n(2),o=n(3)("socket.io-client:url");e.exports=function(e,n){var r=e;return n=n||t.location,null==e&&(e=n.protocol+"//"+n.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(o("protocol-less url %s",e),e=void 0!==n?n.protocol+"//"+e:"https://"+e),o("parse %s",e),r=i(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/",e=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host,r.id=r.protocol+"://"+e+":"+r.port,r.href=r.protocol+"://"+e+(n&&n.port===r.port?"":":"+r.port),r}}).call(t,function(){return this}())},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,i="source protocol authority userInfo user password host port relative path directory file query anchor".split(" ");e.exports=function(e){var t=e,o=e.indexOf("["),r=e.indexOf("]");-1!=o&&-1!=r&&(e=e.substring(0,o)+e.substring(o,r).replace(/:/g,";")+e.substring(r,e.length)),e=n.exec(e||"");for(var a={},s=14;s--;)a[i[s]]=e[s]||"";return-1!=o&&-1!=r&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t,n){(function(i){function o(){try{var e=t.storage.debug}catch(e){}return!e&&void 0!==i&&"env"in i&&(e=i.env.DEBUG),e}(t=e.exports=n(5)).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?"%c":"")+this.namespace+(n?" %c":" ")+e[0]+(n?"%c ":" ")+"+"+t.humanize(this.diff),n){n="color: "+this.color,e.splice(1,0,n,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))})),e.splice(o,0,n)}},t.save=function(e){try{null==e?t.storage.removeItem("debug"):t.storage.debug=e}catch(e){}},t.load=o,t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)};var r=t;if("undefined"!=typeof chrome&&void 0!==chrome.storage)var a=chrome.storage.local;else e:{try{a=window.localStorage;break e}catch(e){}a=void 0}r.storage=a,t.colors="lightseagreen forestgreen goldenrod dodgerblue darkorchid crimson".split(" "),t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},t.enable(o())}).call(t,n(4))},function(e,t){function n(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(u===setTimeout)return setTimeout(e,0);if((u===n||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function r(e){if(l===clearTimeout)return clearTimeout(e);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function a(){m&&p&&(m=!1,p.length?f=p.concat(f):g=-1,f.length&&s())}function s(){if(!m){var e=o(a);m=!0;for(var t=f.length;t;){for(p=f,f=[];++g<t;)p&&p[g].run();g=-1,t=f.length}p=null,m=!1,r(e)}}function c(e,t){this.fun=e,this.array=t}function d(){}e=e.exports={};try{var u="function"==typeof setTimeout?setTimeout:n}catch(e){u=n}try{var l="function"==typeof clearTimeout?clearTimeout:i}catch(e){l=i}var p,f=[],m=!1,g=-1;e.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new c(e,t)),1!==f.length||m||o(s)},c.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.prependListener=d,e.prependOnceListener=d,e.listeners=function(e){return[]},e.binding=function(e){throw Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(e){throw Error("process.chdir is not supported")},e.umask=function(){return 0}},function(e,t,n){function i(e){function n(){if(n.enabled){var e=+new Date;n.diff=e-(o||e),n.prev=o,o=n.curr=e;var i=Array(arguments.length);for(e=0;e<i.length;e++)i[e]=arguments[e];i[0]=t.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var r=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,(function(e,o){return"%%"===e?e:(r++,"function"==typeof(o=t.formatters[o])&&(e=o.call(n,i[r]),i.splice(r,1),r--),e)})),t.formatArgs.call(n,i),(n.log||t.log||console.log.bind(console)).apply(n,i)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=function(e){var n,i=0;for(n in e)i=(i<<5)-i+e.charCodeAt(n),i|=0;return t.colors[Math.abs(i)%t.colors.length]}(e),"function"==typeof t.init&&t.init(n),n}var o;(t=e.exports=i.debug=i.default=i).coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable("")},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=("string"==typeof e?e:"").split(/[\s,]+/),i=n.length,o=0;o<i;o++)n[o]&&("-"===(e=n[o].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){var n,i=0;for(n=t.skips.length;i<n;i++)if(t.skips[i].test(e))return!1;for(i=0,n=t.names.length;i<n;i++)if(t.names[i].test(e))return!0;return!1},t.humanize=n(6),t.names=[],t.skips=[],t.formatters={}},function(e,t){function n(e){if(!(100<(e=String(e)).length)&&(e=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return t*c;case"days":case"day":case"d":return t*s;case"hours":case"hour":case"hrs":case"hr":case"h":return t*a;case"minutes":case"minute":case"mins":case"min":case"m":return t*r;case"seconds":case"second":case"secs":case"sec":case"s":return t*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function i(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var o=1e3,r=60*o,a=60*r,s=24*a,c=365.25*s;e.exports=function(e,t){t=t||{};var c=typeof e;if("string"===c&&0<e.length)return n(e);if("number"===c&&!1===isNaN(e))return t.long?i(e,s,"day")||i(e,a,"hour")||i(e,r,"minute")||i(e,o,"second")||e+" ms":e>=s?Math.round(e/s)+"d":e>=a?Math.round(e/a)+"h":e>=r?Math.round(e/r)+"m":e>=o?Math.round(e/o)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},function(e,t,n){function i(){}function o(e){var n=""+e.type;return t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(n+=e.nsp+","),null!=e.id&&(n+=e.id),null!=e.data&&(n+=JSON.stringify(e.data)),c("encoded %j as %s",e,n),n}function r(){this.reconstructor=null}function a(e){this.reconPack=e,this.buffers=[]}function s(){return{type:t.ERROR,data:"parser error"}}var c=n(3)("socket.io-parser");e=n(8);var d=n(9),u=n(11),l=n(12);t.protocol=4,t.types="CONNECT DISCONNECT EVENT ACK ERROR BINARY_EVENT BINARY_ACK".split(" "),t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=i,t.Decoder=r,i.prototype.encode=function(e,n){e.type!==t.EVENT&&e.type!==t.ACK||!d(e.data)||(e.type=e.type===t.EVENT?t.BINARY_EVENT:t.BINARY_ACK),c("encoding packet %j",e),t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?function(e,t){u.removeBlobs(e,(function(e){var n=u.deconstructPacket(e);e=o(n.packet),(n=n.buffers).unshift(e),t(n)}))}(e,n):n([e=o(e)])},e(r.prototype),r.prototype.add=function(e){if("string"==typeof e){var n,i=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])e=s();else{if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(n="";"-"!==e.charAt(++i)&&(n+=e.charAt(i),i!=e.length););if(n!=Number(n)||"-"!==e.charAt(i))throw Error("Illegal attachments");o.attachments=Number(n)}if("/"===e.charAt(i+1))for(o.nsp="";++i&&","!==(n=e.charAt(i))&&(o.nsp+=n,i!==e.length););else o.nsp="/";if(""!==(n=e.charAt(i+1))&&Number(n)==n){for(o.id="";++i;){if(null==(n=e.charAt(i))||Number(n)!=n){--i;break}if(o.id+=e.charAt(i),i===e.length)break}o.id=Number(o.id)}if(e.charAt(++i)){e:{i=e.substr(i);try{o.data=JSON.parse(i)}catch(e){i=s();break e}i=o}o=i}c("decoded %s as %j",e,o),e=o}t.BINARY_EVENT===e.type||t.BINARY_ACK===e.type?(this.reconstructor=new a(e),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",e)):this.emit("decoded",e)}else{if(!l(e)&&!e.base64)throw Error("Unknown type: "+e);if(!this.reconstructor)throw Error("got binary data when not reconstructing a packet");(e=this.reconstructor.takeBinaryData(e))&&(this.reconstructor=null,this.emit("decoded",e))}},r.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},a.prototype.takeBinaryData=function(e){return this.buffers.push(e),this.buffers.length===this.reconPack.attachments?(e=u.reconstructPacket(this.reconPack,this.buffers),this.finishedReconstruction(),e):null},a.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){function i(e){if(e){for(var t in i.prototype)e[t]=i.prototype[t];return e}}e.exports=i,i.prototype.on=i.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},i.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},i.prototype.off=i.prototype.removeListener=i.prototype.removeAllListeners=i.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i,o=0;o<n.length;o++)if((i=n[o])===t||i.fn===t){n.splice(o,1);break}return this},i.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var i=0,o=(n=n.slice(0)).length;i<o;++i)n[i].apply(this,t);return this},i.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},i.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){(function(t){var i=n(10),o=Object.prototype.toString,r="function"==typeof t.Blob||"[object BlobConstructor]"===o.call(t.Blob),a="function"==typeof t.File||"[object FileConstructor]"===o.call(t.File);e.exports=function e(n){if(!n||"object"!=typeof n)return!1;if(i(n)){for(var o=0,s=n.length;o<s;o++)if(e(n[o]))return!0;return!1}if("function"==typeof t.Buffer&&t.Buffer.isBuffer&&t.Buffer.isBuffer(n)||"function"==typeof t.ArrayBuffer&&n instanceof ArrayBuffer||r&&n instanceof Blob||a&&n instanceof File)return!0;if(n.toJSON&&"function"==typeof n.toJSON&&1===arguments.length)return e(n.toJSON(),!0);for(o in n)if(Object.prototype.hasOwnProperty.call(n,o)&&e(n[o]))return!0;return!1}}).call(t,function(){return this}())},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(e){function i(e,t){if(!e)return e;if(a(e)){var n={_placeholder:!0,num:t.length};return t.push(e),n}if(r(e)){n=Array(e.length);for(var o=0;o<e.length;o++)n[o]=i(e[o],t);return n}if("object"==typeof e&&!(e instanceof Date)){for(o in n={},e)n[o]=i(e[o],t);return n}return e}function o(e,t){if(!e)return e;if(e&&e._placeholder)return t[e.num];if(r(e))for(var n=0;n<e.length;n++)e[n]=o(e[n],t);else if("object"==typeof e)for(n in e)e[n]=o(e[n],t);return e}var r=n(10),a=n(12),s=Object.prototype.toString,c="function"==typeof e.Blob||"[object BlobConstructor]"===s.call(e.Blob),d="function"==typeof e.File||"[object FileConstructor]"===s.call(e.File);t.deconstructPacket=function(e){var t=[];return e.data=i(e.data,t),e.attachments=t.length,{packet:e,buffers:t}},t.reconstructPacket=function(e,t){return e.data=o(e.data,t),e.attachments=void 0,e},t.removeBlobs=function(e,t){var n=0,i=e;!function e(o,s,u){if(!o)return o;if(c&&o instanceof Blob||d&&o instanceof File){n++;var l=new FileReader;l.onload=function(){u?u[s]=this.result:i=this.result,--n||t(i)},l.readAsArrayBuffer(o)}else if(r(o))for(l=0;l<o.length;l++)e(o[l],l,o);else if("object"==typeof o&&!a(o))for(l in o)e(o[l],l,o)}(i),n||t(i)}}).call(t,function(){return this}())},function(e,t){(function(t){e.exports=function(e){return t.Buffer&&t.Buffer.isBuffer(e)||t.ArrayBuffer&&e instanceof ArrayBuffer}}).call(t,function(){return this}())},function(e,n,i){function o(e,t){if(!(this instanceof o))return new o(e,t);e&&"object"===(void 0===e?"undefined":r(e))&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new f({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],e=t.parser||c,this.encoder=new e.Encoder,this.decoder=new e.Decoder,(this.autoConnect=!1!==t.autoConnect)&&this.open()}t.initSymbol(),t.initSymbol(),t.initSymbolIterator();var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return t.initSymbol(),t.initSymbol(),t.initSymbol(),e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(14),s=i(39);n=i(8);var c=i(7),d=i(41),u=i(42),l=i(3)("socket.io-client:manager"),p=i(37),f=i(43),m=Object.prototype.hasOwnProperty;e.exports=o,o.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)m.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},o.prototype.updateSocketIds=function(){for(var e in this.nsps)m.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},o.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},n(o.prototype),o.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},o.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},o.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},o.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},o.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},o.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},o.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},o.prototype.open=o.prototype.connect=function(e,t){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri);var n=this.engine=a(this.uri,this.opts),i=this;this.readyState="opening",this.skipReconnect=!1;var o=d(n,"open",(function(){i.onopen(),e&&e()}));if(t=d(n,"error",(function(t){if(l("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var n=Error("Connection error");n.data=t,e(n)}else i.maybeReconnectOnOpen()})),!1!==this._timeout){var r=this._timeout;l("connect attempt will timeout after %d",r);var s=setTimeout((function(){l("connect attempt timed out after %d",r),o.destroy(),n.close(),n.emit("error","timeout"),i.emitAll("connect_timeout",r)}),r);this.subs.push({destroy:function(){clearTimeout(s)}})}return this.subs.push(o),this.subs.push(t),this},o.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(d(e,"data",u(this,"ondata"))),this.subs.push(d(e,"ping",u(this,"onping"))),this.subs.push(d(e,"pong",u(this,"onpong"))),this.subs.push(d(e,"error",u(this,"onerror"))),this.subs.push(d(e,"close",u(this,"onclose"))),this.subs.push(d(this.decoder,"decoded",u(this,"ondecoded")))},o.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},o.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},o.prototype.ondata=function(e){this.decoder.add(e)},o.prototype.ondecoded=function(e){this.emit("packet",e)},o.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},o.prototype.socket=function(e,t){function n(){~p(o.connecting,i)||o.connecting.push(i)}var i=this.nsps[e];if(!i){i=new s(this,e,t),this.nsps[e]=i;var o=this;i.on("connecting",n),i.on("connect",(function(){i.id=o.generateId(e)})),this.autoConnect&&n()}return i},o.prototype.destroy=function(e){~(e=p(this.connecting,e))&&this.connecting.splice(e,1),this.connecting.length||this.close()},o.prototype.packet=function(e){l("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(n){for(var i=0;i<n.length;i++)t.engine.write(n[i],e.options);t.encoding=!1,t.processPacketQueue()})))},o.prototype.processPacketQueue=function(){if(0<this.packetBuffer.length&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},o.prototype.cleanup=function(){l("cleanup");for(var e=this.subs.length,t=0;t<e;t++)this.subs.shift().destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},o.prototype.close=o.prototype.disconnect=function(){l("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},o.prototype.onclose=function(e){l("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},o.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();l("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout((function(){e.skipReconnect||(l("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(l("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(l("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(n)}})}},o.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){e.exports=n(15)},function(e,t,n){e.exports=n(16),e.exports.parser=n(23)},function(e,t,n){(function(t){function i(e,n){if(!(this instanceof i))return new i(e,n);n=n||{},e&&"object"==typeof e&&(n=e,e=null),e?(e=d(e),n.hostname=e.host,n.secure="https"===e.protocol||"wss"===e.protocol,n.port=e.port,e.query&&(n.query=e.query)):n.host&&(n.hostname=d(n.host).host),this.secure=null!=n.secure?n.secure:t.location&&"https:"===location.protocol,n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.agent=n.agent||!1,this.hostname=n.hostname||(t.location?location.hostname:"localhost"),this.port=n.port||(t.location&&location.port?location.port:this.secure?443:80),this.query=n.query||{},"string"==typeof this.query&&(this.query=l.decode(this.query)),this.upgrade=!1!==n.upgrade,this.path=(n.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!n.forceJSONP,this.jsonp=!1!==n.jsonp,this.forceBase64=!!n.forceBase64,this.enablesXDR=!!n.enablesXDR,this.timestampParam=n.timestampParam||"t",this.timestampRequests=n.timestampRequests,this.transports=n.transports||["polling","websocket"],this.transportOptions=n.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=n.policyPort||843,this.rememberUpgrade=n.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=n.onlyBinaryUpgrades,this.perMessageDeflate=!1!==n.perMessageDeflate&&(n.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=n.pfx||null,this.key=n.key||null,this.passphrase=n.passphrase||null,this.cert=n.cert||null,this.ca=n.ca||null,this.ciphers=n.ciphers||null,this.rejectUnauthorized=void 0===n.rejectUnauthorized||n.rejectUnauthorized,this.forceNode=!!n.forceNode,(e="object"==typeof t&&t).global===e&&(n.extraHeaders&&0<Object.keys(n.extraHeaders).length&&(this.extraHeaders=n.extraHeaders),n.localAddress&&(this.localAddress=n.localAddress)),this.pingTimeoutTimer=this.pingIntervalTimer=this.pingTimeout=this.pingInterval=this.upgrades=this.id=null,this.open()}var o=n(17),r=n(8),a=n(3)("engine.io-client:socket"),s=n(37),c=n(23),d=n(2),u=n(38),l=n(31);e.exports=i,i.priorWebsocketSuccess=!1,r(i.prototype),i.protocol=c.protocol,i.Socket=i,i.Transport=n(22),i.transports=n(17),i.parser=n(23),i.prototype.createTransport=function(e){a('creating transport "%s"',e);var t,n=this.query,i={};for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i.EIO=c.protocol,i.transport=e,n=this.transportOptions[e]||{},this.id&&(i.sid=this.id),new o[e]({query:i,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0})},i.prototype.open=function(){if(this.rememberUpgrade&&i.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))var e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(e){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},i.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},i.prototype.probe=function(e){function t(){if(p.onlyBinaryUpgrades){var t=!this.supportsBinary&&p.transport.supportsBinary;l=l||t}l||(a('probe transport "%s" opened',e),u.send([{type:"ping",data:"probe"}]),u.once("packet",(function(t){l||("pong"===t.type&&"probe"===t.data?(a('probe transport "%s" pong',e),p.upgrading=!0,p.emit("upgrading",u),u&&(i.priorWebsocketSuccess="websocket"===u.name,a('pausing current transport "%s"',p.transport.name),p.transport.pause((function(){l||"closed"!==p.readyState&&(a("changing transport and sending upgrade packet"),d(),p.setTransport(u),u.send([{type:"upgrade"}]),p.emit("upgrade",u),u=null,p.upgrading=!1,p.flush())})))):(a('probe transport "%s" failed',e),(t=Error("probe error")).transport=u.name,p.emit("upgradeError",t)))})))}function n(){l||(l=!0,d(),u.close(),u=null)}function o(t){var i=Error("probe error: "+t);i.transport=u.name,n(),a('probe transport "%s" failed because of error: %s',e,t),p.emit("upgradeError",i)}function r(){o("transport closed")}function s(){o("socket closed")}function c(e){u&&e.name!==u.name&&(a('"%s" works - aborting "%s"',e.name,u.name),n())}function d(){u.removeListener("open",t),u.removeListener("error",o),u.removeListener("close",r),p.removeListener("close",s),p.removeListener("upgrading",c)}a('probing transport "%s"',e);var u=this.createTransport(e,{probe:1}),l=!1,p=this;i.priorWebsocketSuccess=!1,u.once("open",t),u.once("error",o),u.once("close",r),this.once("close",s),this.once("upgrading",c),u.open()},i.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",i.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},i.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(u(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},i.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},i.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},i.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},i.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},i.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},i.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},i.prototype.write=i.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},i.prototype.sendPacket=function(e,t,n,i){"function"==typeof t&&(i=t,t=void 0),"function"==typeof n&&(i=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState&&((n=n||{}).compress=!1!==n.compress,e={type:e,data:t,options:n},this.emit("packetCreate",e),this.writeBuffer.push(e),i&&this.once("flush",i),this.flush())},i.prototype.close=function(){function e(){i.onClose("forced close"),a("socket closing - telling transport to close"),i.transport.close()}function t(){i.removeListener("upgrade",t),i.removeListener("upgradeError",t),e()}function n(){i.once("upgrade",t),i.once("upgradeError",t)}if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var i=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():e()})):this.upgrading?n():e()}return this},i.prototype.onError=function(e){a("socket error %j",e),i.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},i.prototype.onClose=function(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(a('socket close with reason: "%s"',e),clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)},i.prototype.filterUpgrades=function(e){for(var t=[],n=0,i=e.length;n<i;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}}).call(t,function(){return this}())},function(e,t,n){(function(e){var i=n(18),o=n(20),r=n(34),a=n(35);t.polling=function(t){var n=!1,a=!1,s=!1!==t.jsonp;if(e.location&&(a="https:"===location.protocol,(n=location.port)||(n=a?443:80),n=t.hostname!==location.hostname||n!==t.port,a=t.secure!==a),t.xdomain=n,t.xscheme=a,"open"in new i(t)&&!t.forceJSONP)return new o(t);if(!s)throw Error("JSONP disabled");return new r(t)},t.websocket=a}).call(t,function(){return this}())},function(e,t,n){(function(t){var i=n(19);e.exports=function(e){var n=e.xdomain,o=e.xscheme;e=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!n||i))return new XMLHttpRequest}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!o&&e)return new XDomainRequest}catch(e){}if(!n)try{return new(t[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(e){}}}).call(t,function(){return this}())},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(t){e.exports=!1}},function(e,t,n){(function(t){function i(){}function o(e){if(c.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,t.location){var n="https:"===location.protocol,i=location.port;i||(i=n?443:80),this.xd=e.hostname!==t.location.hostname||i!==e.port,this.xs=e.secure!==n}}function r(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}function a(){for(var e in r.requests)r.requests.hasOwnProperty(e)&&r.requests[e].abort()}var s=n(18),c=n(21),d=n(8),u=n(32),l=n(3)("engine.io-client:polling-xhr");e.exports=o,e.exports.Request=r,u(o,c),o.prototype.supportsBinary=!0,o.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new r(e)},o.prototype.doWrite=function(e,t){e=this.request({method:"POST",data:e,isBinary:"string"!=typeof e&&void 0!==e});var n=this;e.on("success",t),e.on("error",(function(e){n.onError("xhr post error",e)})),this.sendXhr=e},o.prototype.doPoll=function(){l("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},d(r.prototype),r.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var n=this.xhr=new s(e),i=this;try{l("xhr open %s: %s",this.method,this.uri),n.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var o in n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(o)&&n.setRequestHeader(o,this.extraHeaders[o])}catch(e){}if("POST"===this.method)try{this.isBinary?n.setRequestHeader("Content-type","application/octet-stream"):n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(e){}try{n.setRequestHeader("Accept","*/*")}catch(e){}"withCredentials"in n&&(n.withCredentials=!0),this.requestTimeout&&(n.timeout=this.requestTimeout),this.hasXDR()?(n.onload=function(){i.onLoad()},n.onerror=function(){i.onError(n.responseText)}):n.onreadystatechange=function(){if(2===n.readyState){try{var e=n.getResponseHeader("Content-Type")}catch(e){}"application/octet-stream"===e&&(n.responseType="arraybuffer")}4===n.readyState&&(200===n.status||1223===n.status?i.onLoad():setTimeout((function(){i.onError(n.status)}),0))},l("xhr data %s",this.data),n.send(this.data)}catch(e){return void setTimeout((function(){i.onError(e)}),0)}t.document&&(this.index=r.requestsCount++,r.requests[this.index]=this)},r.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},r.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},r.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},r.prototype.cleanup=function(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=i:this.xhr.onreadystatechange=i,e)try{this.xhr.abort()}catch(e){}t.document&&delete r.requests[this.index],this.xhr=null}},r.prototype.onLoad=function(){try{try{var e=this.xhr.getResponseHeader("Content-Type")}catch(e){}var t="application/octet-stream"===e&&this.xhr.response||this.xhr.responseText}catch(e){this.onError(e)}null!=t&&this.onData(t)},r.prototype.hasXDR=function(){return void 0!==t.XDomainRequest&&!this.xs&&this.enablesXDR},r.prototype.abort=function(){this.cleanup()},r.requestsCount=0,r.requests={},t.document&&(t.attachEvent?t.attachEvent("onunload",a):t.addEventListener&&t.addEventListener("beforeunload",a,!1))}).call(t,function(){return this}())},function(e,t,n){function i(e){var t=e&&e.forceBase64;d&&!t||(this.supportsBinary=!1),o.call(this,e)}var o=n(22),r=n(31),a=n(23);t=n(32);var s=n(33),c=n(3)("engine.io-client:polling");e.exports=i;var d=null!=new(n(18))({xdomain:!1}).responseType;t(i,o),i.prototype.name="polling",i.prototype.doOpen=function(){this.poll()},i.prototype.pause=function(e){function t(){c("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var i=0;this.polling&&(c("we are currently polling - waiting to pause"),i++,this.once("pollComplete",(function(){c("pre-pause polling complete"),--i||t()}))),this.writable||(c("we are currently writing - waiting to pause"),i++,this.once("drain",(function(){c("pre-pause writing complete"),--i||t()})))}else t()},i.prototype.poll=function(){c("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},i.prototype.onData=function(e){var t=this;c("polling got data %s",e),a.decodePayload(e,this.socket.binaryType,(function(e,n,i){return"opening"===t.readyState&&t.onOpen(),"close"===e.type?(t.onClose(),!1):void t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():c('ignoring poll - transport state "%s"',this.readyState))},i.prototype.doClose=function(){function e(){c("writing close packet"),t.write([{type:"close"}])}var t=this;"open"===this.readyState?(c("transport open - closing"),e()):(c("transport not open - deferring close"),this.once("open",e))},i.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,n)}))},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=s()),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}var o=n(23);t=n(8),e.exports=i,t(i.prototype),i.prototype.onError=function(e,t){return(e=Error(e)).type="TransportError",e.description=t,this.emit("error",e),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){e=o.decodePacket(e,this.socket.binaryType),this.onPacket(e)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,n){(function(e){function i(e,t,n){var i=Array(e.length);n=c(e.length,n);for(var o=function(e,n,o){t(n,(function(t,n){i[e]=n,o(t,i)}))},r=0;r<e.length;r++)o(r,e[r],n)}var o,r=n(24),a=n(9),s=n(25),c=n(26),d=n(27);e&&e.ArrayBuffer&&(o=n(29));var u="undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),l="undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent),p=u||l;t.protocol=3;var f=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},m=r(f),g={type:"error",data:"parser error"},v=n(30);t.encodePacket=function(n,i,o,r){"function"==typeof i&&(r=i,i=!1),"function"==typeof o&&(r=o,o=null);var a=void 0===n.data?void 0:n.data.buffer||n.data;if(e.ArrayBuffer&&a instanceof ArrayBuffer){if(i){for(o=n.data,i=new Uint8Array(o),(o=new Uint8Array(1+o.byteLength))[0]=f[n.type],n=0;n<i.length;n++)o[n+1]=i[n];n=r(o.buffer)}else n=t.encodeBase64Packet(n,r);return n}return v&&a instanceof e.Blob?(i?p?n=function(e,n,i){if(!n)return t.encodeBase64Packet(e,i);var o=new FileReader;return o.onload=function(){e.data=o.result,t.encodePacket(e,n,!0,i)},o.readAsArrayBuffer(e.data)}(n,i,r):((i=new Uint8Array(1))[0]=f[n.type],n=r(n=new v([i.buffer,n.data]))):n=t.encodeBase64Packet(n,r),n):a&&a.base64?r("b"+t.packets[n.type]+n.data.data):(i=f[n.type],void 0!==n.data&&(i+=o?d.encode(String(n.data),{strict:!1}):String(n.data)),r(""+i))},t.encodeBase64Packet=function(n,i){var o="b"+t.packets[n.type];if(v&&n.data instanceof e.Blob){var r=new FileReader;return r.onload=function(){var e=r.result.split(",")[1];i(o+e)},r.readAsDataURL(n.data)}try{var a=String.fromCharCode.apply(null,new Uint8Array(n.data))}catch(e){n=new Uint8Array(n.data),a=Array(n.length);for(var s=0;s<n.length;s++)a[s]=n[s];a=String.fromCharCode.apply(null,a)}return o+=e.btoa(a),i(o)},t.decodePacket=function(e,n,i){if(void 0===e)return g;if("string"==typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),n);if(n=i){n=e;try{n=d.decode(n,{strict:!1})}catch(e){n=!1}n=!1===(e=n)}return n?g:(i=e.charAt(0),Number(i)==i&&m[i]?1<e.length?{type:m[i],data:e.substring(1)}:{type:m[i]}:g)}return i=new Uint8Array(e)[0],e=s(e,1),v&&"blob"===n&&(e=new v([e])),{type:m[i],data:e}},t.decodeBase64Packet=function(e,t){var n=m[e.charAt(0)];return o?(e=o.decode(e.substr(1)),"blob"===t&&v&&(e=new v([e])),{type:n,data:e}):{type:n,data:{base64:!0,data:e.substr(1)}}},t.encodePayload=function(e,n,o){"function"==typeof n&&(o=n,n=null);var r=a(e);return n&&r?v&&!p?t.encodePayloadAsBlob(e,o):t.encodePayloadAsArrayBuffer(e,o):e.length?void i(e,(function(e,i){t.encodePacket(e,!!r&&n,!1,(function(e){i(null,e.length+":"+e)}))}),(function(e,t){return o(t.join(""))})):o("0:")},t.decodePayload=function(e,n,i){if("string"!=typeof e)return t.decodePayloadAsBinary(e,n,i);var o;if("function"==typeof n&&(i=n,n=null),""===e)return i(g,0,1);for(var r,a,s="",c=0,d=e.length;c<d;c++){var u=e.charAt(c);if(":"===u){if(""===s||s!=(r=Number(s))||s!=(a=e.substr(c+1,r)).length)return i(g,0,1);if(a.length){if(o=t.decodePacket(a,n,!1),g.type===o.type&&g.data===o.data)return i(g,0,1);if(!1===i(o,c+r,d))return}c+=r,s=""}else s+=u}return""!==s?i(g,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,n){return e.length?void i(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){return n(null,e)}))}),(function(e,t){e=t.reduce((function(e,t){var n;return e+(n="string"==typeof t?t.length:t.byteLength).toString().length+n+2}),0);var i=new Uint8Array(e),o=0;return t.forEach((function(e){var t="string"==typeof e,n=e;if(t){n=new Uint8Array(e.length);for(var r=0;r<e.length;r++)n[r]=e.charCodeAt(r);n=n.buffer}for(i[o++]=t?0:1,e=n.byteLength.toString(),r=0;r<e.length;r++)i[o++]=parseInt(e[r]);for(i[o++]=255,n=new Uint8Array(n),r=0;r<n.length;r++)i[o++]=n[r]})),n(i.buffer)})):n(new ArrayBuffer(0))},t.encodePayloadAsBlob=function(e,n){i(e,(function(e,n){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"==typeof e){for(var i=new Uint8Array(e.length),o=0;o<e.length;o++)i[o]=e.charCodeAt(o);e=i.buffer,t[0]=0}i=(e instanceof ArrayBuffer?e.byteLength:e.size).toString();var r=new Uint8Array(i.length+1);for(o=0;o<i.length;o++)r[o]=parseInt(i[o]);r[i.length]=255,v&&(e=new v([t.buffer,r.buffer,e]),n(null,e))}))}),(function(e,t){return n(new v(t))}))},t.decodePayloadAsBinary=function(e,n,i){"function"==typeof n&&(i=n,n=null);for(var o=[];0<e.byteLength;){for(var r=new Uint8Array(e),a=0===r[0],c="",d=1;255!==r[d];d++){if(310<c.length)return i(g,0,1);c+=r[d]}if(e=s(e,2+c.length),c=parseInt(c),r=s(e,0,c),a)try{r=String.fromCharCode.apply(null,new Uint8Array(r))}catch(e){for(a=new Uint8Array(r),r="",d=0;d<a.length;d++)r+=String.fromCharCode(a[d])}o.push(r),e=s(e,c)}var u=o.length;o.forEach((function(e,o){i(t.decodePacket(e,n,!0),o,u)}))}}).call(t,function(){return this}())},function(e,t){e.exports=Object.keys||function(e){var t,n=[],i=Object.prototype.hasOwnProperty;for(t in e)i.call(e,t)&&n.push(t);return n}},function(e,t){e.exports=function(e,t,n){var i=e.byteLength;if(t=t||0,n=n||i,e.slice)return e.slice(t,n);if(0>t&&(t+=i),0>n&&(n+=i),n>i&&(n=i),t>=i||t>=n||0===i)return new ArrayBuffer(0);e=new Uint8Array(e),i=new Uint8Array(n-t);for(var o=0;t<n;t++,o++)i[o]=e[t];return i.buffer}},function(e,t){function n(){}e.exports=function(e,t,i){function o(e,n){if(0>=o.count)throw Error("after called too many times");--o.count,e?(r=!0,t(e),t=i):0!==o.count||r||t(null,n)}var r=!1;return i=i||n,o.count=e,0===e?t():o}},function(e,t,n){var i;(function(e,t){!function(t){function n(e){for(var t,n,i=[],o=0,r=e.length;o<r;)55296<=(t=e.charCodeAt(o++))&&56319>=t&&o<r?56320==(64512&(n=e.charCodeAt(o++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),o--):i.push(t);return i}function o(e,t){if(55296<=e&&57343>=e){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function r(){if(d>=c)throw Error("Invalid byte index");var e=255&s[d];if(d++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function a(e){var t,n;if(d>c)throw Error("Invalid byte index");if(d==c)return!1;if(t=255&s[d],d++,0==(128&t))return t;if(192==(224&t)){if(128<=(n=(31&t)<<6|r()))return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if(2048<=(n=(15&t)<<12|r()<<6|r()))return o(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&65536<=(n=(7&t)<<18|r()<<12|r()<<6|r())&&1114111>=n)return n;throw Error("Invalid UTF-8 detected")}"object"==typeof e&&e&&e.exports;var s,c,d,u=String.fromCharCode;void 0===(i={version:"2.1.2",encode:function(e,t){t=!1!==(t=t||{}).strict;for(var i=(e=n(e)).length,r=-1,a="";++r<i;){var s=e[r],c=t;if(0==(4294967168&s))c=u(s);else{var d="";0==(4294965248&s)?d=u(s>>6&31|192):0==(4294901760&s)?(o(s,c)||(s=65533),d=u(s>>12&15|224),d+=u(s>>6&63|128)):0==(4292870144&s)&&(d=u(s>>18&7|240),d+=u(s>>12&63|128),d+=u(s>>6&63|128)),c=d+u(63&s|128)}a+=c}return a},decode:function(e,t){var i;for(t=!1!==(t=t||{}).strict,s=n(e),c=s.length,d=0,e=[];!1!==(i=a(t));)e.push(i);i=e.length;for(var o=-1,r="";++o<i;)65535<(t=e[o])&&(r+=u((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=u(t);return r}})||(e.exports=i)}()}).call(t,n(28)(e),function(){return this}())},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children=[],e.webpackPolyfill=1),e}},function(e,t){!function(){for(var e=new Uint8Array(256),n=0;64>n;n++)e["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charCodeAt(n)]=n;t.encode=function(e){var t=new Uint8Array(e),n=t.length,i="";for(e=0;e<n;e+=3)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[e]>>2],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[e])<<4|t[e+1]>>4],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[e+1])<<2|t[e+2]>>6],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[e+2]];return 2==n%3?i=i.substring(0,i.length-1)+"=":1==n%3&&(i=i.substring(0,i.length-2)+"=="),i},t.decode=function(t){var n=.75*t.length,i=t.length,o=0;"="===t[t.length-1]&&(n--,"="===t[t.length-2]&&n--);var r=new ArrayBuffer(n),a=new Uint8Array(r);for(n=0;n<i;n+=4){var s=e[t.charCodeAt(n)],c=e[t.charCodeAt(n+1)],d=e[t.charCodeAt(n+2)],u=e[t.charCodeAt(n+3)];a[o++]=s<<2|c>>4,a[o++]=(15&c)<<4|d>>2,a[o++]=(3&d)<<6|63&u}return r}}()},function(e,t){(function(t){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var i=n.buffer;if(n.byteLength!==i.byteLength){var o=new Uint8Array(n.byteLength);o.set(new Uint8Array(i,n.byteOffset,n.byteLength)),i=o.buffer}e[t]=i}}}var i,o=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder;try{var r=2===new Blob(["hi"]).size}catch(e){r=!1}if(i=r)try{i=2===new Blob([new Uint8Array([1,2])]).size}catch(e){i=!1}var a=o&&o.prototype.append&&o.prototype.getBlob;e.exports=r?i?t.Blob:function(e,t){return n(e),new Blob(e,t||{})}:a?function(e,t){t=t||{};var i=new o;n(e);for(var r=0;r<e.length;r++)i.append(e[r]);return t.type?i.getBlob(t.type):i.getBlob()}:void 0}).call(t,function(){return this}())},function(e,t){t.encode=function(e){var t,n="";for(t in e)e.hasOwnProperty(t)&&(n.length&&(n+="&"),n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n},t.decode=function(e){for(var t={},n=0,i=(e=e.split("&")).length;n<i;n++){var o=e[n].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t){function n(e){var t="";do{t=r[e%a]+t,e=Math.floor(e/a)}while(0<e);return t}function i(){var e=n(+new Date);return e!==o?(c=0,o=e):e+"."+n(c++)}for(var o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),a=64,s={},c=0,d=0;d<a;d++)s[r[d]]=d;i.encode=n,i.decode=function(e){var t=0;for(d=0;d<e.length;d++)t=t*a+s[e.charAt(d)];return t},e.exports=i},function(e,t,n){(function(t){function i(){}function o(e){r.call(this,e),this.query=this.query||{},s||(t.___eio||(t.___eio=[]),s=t.___eio),this.index=s.length;var n=this;s.push((function(e){n.onData(e)})),this.query.j=this.index,t.document&&t.addEventListener&&t.addEventListener("beforeunload",(function(){n.script&&(n.script.onerror=i)}),!1)}var r=n(21),a=n(32);e.exports=o;var s,c=/\n/g,d=/\\n/g;a(o,r),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),r.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},o.prototype.doWrite=function(e,t){function n(){i(),t()}function i(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(e){r.onError("jsonp polling iframe removal error",e)}try{o=document.createElement('<iframe src="javascript:0" name="'+r.iframeId+'">')}catch(e){(o=document.createElement("iframe")).name=r.iframeId,o.src="javascript:0"}o.id=r.iframeId,r.form.appendChild(o),r.iframe=o}var o,r=this;if(!this.form){var a=document.createElement("form"),s=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;a.className="socketio",a.style.position="absolute",a.style.top="-1000px",a.style.left="-1000px",a.target=u,a.method="POST",a.setAttribute("accept-charset","utf-8"),s.name="d",a.appendChild(s),document.body.appendChild(a),this.form=a,this.area=s}this.form.action=this.uri(),i(),e=e.replace(d,"\\\n"),this.area.value=e.replace(c,"\\n");try{this.form.submit()}catch(e){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&n()}:this.iframe.onload=n}}).call(t,function(){return this}())},function(e,t,n){(function(t){function i(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=u&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(p=l),o.call(this,e)}var o=n(22),r=n(23),a=n(31),s=n(32),c=n(33),d=n(3)("engine.io-client:websocket"),u=t.WebSocket||t.MozWebSocket;if("undefined"==typeof window)try{var l=n(36)}catch(e){}var p=u;p||"undefined"!=typeof window||(p=l),e.exports=i,s(i,o),i.prototype.name="websocket",i.prototype.supportsBinary=!0,i.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,n={agent:this.agent,perMessageDeflate:this.perMessageDeflate};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(n.headers=this.extraHeaders),this.localAddress&&(n.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket?t?new p(e,t):new p(e):new p(e,t,n)}catch(e){return this.emit("error",e)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},i.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},i.prototype.write=function(e){var n=this;this.writable=!1;for(var i=e.length,o=0,a=i;o<a;o++)!function(e){r.encodePacket(e,n.supportsBinary,(function(o){if(!n.usingBrowserWebSocket){var r={};e.options&&(r.compress=e.options.compress),n.perMessageDeflate&&("string"==typeof o?t.Buffer.byteLength(o):o.length)<n.perMessageDeflate.threshold&&(r.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(o):n.ws.send(o,r)}catch(e){d("websocket closed before onclose event")}--i||(n.emit("flush"),setTimeout((function(){n.writable=!0,n.emit("drain")}),0))}))}(e[o])},i.prototype.onClose=function(){o.prototype.onClose.call(this)},i.prototype.doClose=function(){void 0!==this.ws&&this.ws.close()},i.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=a.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},i.prototype.check=function(){return!(!p||"__initialize"in p&&this.name===i.prototype.name)}}).call(t,function(){return this}())},function(e,t){},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var i=0;i<e.length;++i)if(e[i]===t)return i;return-1}},function(e,t){(function(t){var n=/^[\],:{}\s]*$/,i=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,s=/\s+$/;e.exports=function(e){return"string"==typeof e&&e?(e=e.replace(a,"").replace(s,""),t.JSON&&JSON.parse?JSON.parse(e):n.test(e.replace(i,"@").replace(o,"]").replace(r,""))?new Function("return "+e)():void 0):null}}).call(t,function(){return this}())},function(e,n,i){function o(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}t.initSymbol(),t.initSymbol(),t.initSymbolIterator();var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return t.initSymbol(),t.initSymbol(),t.initSymbol(),e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=i(7);n=i(8);var s=i(40),c=i(41),d=i(42),u=i(3)("socket.io-client:socket"),l=i(31);e.exports=o;var p={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},f=n.prototype.emit;n(o.prototype),o.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[c(e,"open",d(this,"onopen")),c(e,"packet",d(this,"onpacket")),c(e,"close",d(this,"onclose"))]}},o.prototype.open=o.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},o.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},o.prototype.emit=function(e){if(p.hasOwnProperty(e))return f.apply(this,arguments),this;var t=s(arguments),n={type:a.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),delete this.flags,this},o.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},o.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===r(this.query)?l.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:a.CONNECT,query:e})}else this.packet({type:a.CONNECT})},o.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},o.prototype.onpacket=function(e){if(e.nsp===this.nsp)switch(e.type){case a.CONNECT:this.onconnect();break;case a.EVENT:case a.BINARY_EVENT:this.onevent(e);break;case a.ACK:case a.BINARY_ACK:this.onack(e);break;case a.DISCONNECT:this.ondisconnect();break;case a.ERROR:this.emit("error",e.data)}},o.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?f.apply(this,t):this.receiveBuffer.push(t)},o.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var i=s(arguments);u("sending ack %j",i),t.packet({type:a.ACK,id:e,data:i})}}},o.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},o.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},o.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)f.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},o.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},o.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},o.prototype.close=o.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:a.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},o.prototype.compress=function(e){return this.flags=this.flags||{},this.flags.compress=e,this}},function(e,t){e.exports=function(e,t){for(var n=[],i=(t=t||0)||0;i<e.length;i++)n[i-t]=e[i];return n}},function(e,t){e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw Error("bind() requires a function");var i=n.call(arguments,2);return function(){return t.apply(e,i.concat(n.call(arguments)))}}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=0<e.jitter&&1>=e.jitter?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}}])},function(e,t,n){var i=n(2),o=n(7),r=n(0);t.a=function(e){var t=Object(i.a)({});t.id=e.id,t.stream=e.stream.stream,t.elementID=e.elementID;var n=function(e,n,i,o){(o?1/e*n>i:1/e*n<i)?(t.video.style.width=n+"px",t.video.style.height=1/e*n+"px",t.video.style.top=-(1/e*n/2-i/2)+"px",t.video.style.left="0px"):(t.video.style.height=i+"px",t.video.style.width=e*i+"px",t.video.style.left=-(e*i/2-n/2)+"px",t.video.style.top="0px")};return t.destroy=function(){t.video.pause(),delete t.resizer,t.parentNode.removeChild(t.div)},t.resize=function(){var i=t.container.offsetWidth,o=t.container.offsetHeight;e.stream.screen||!1===e.options.crop?n(16/9,i,o,!1):(i!==t.containerWidth||o!==t.containerHeight)&&n(4/3,i,o,!0),t.containerWidth=i,t.containerHeight=o},r.a.debug("Creating URL from stream "+t.stream),t.streamUrl=(window.URL||webkitURL).createObjectURL(t.stream),t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("class","licode_player"),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"),!1!==e.options.loader&&(t.loader=document.createElement("img"),t.loader.setAttribute("style","width: 16px; height: 16px; position: absolute; top: 50%; left: 50%; margin-top: -8px; margin-left: -8px"),t.loader.setAttribute("id","back_"+t.id),t.loader.setAttribute("class","licode_loader"),t.loader.setAttribute("src",t.url+"/assets/loader.gif")),t.video=document.createElement("video"),t.video.setAttribute("id","stream"+t.id),t.video.setAttribute("class","licode_stream"),t.video.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.video.setAttribute("autoplay","autoplay"),e.stream.local&&(t.video.volume=0),t.container=void 0!==t.elementID?"object"==typeof t.elementID&&"function"==typeof t.elementID.appendChild?t.elementID:document.getElementById(t.elementID):document.body,t.container.appendChild(t.div),t.parentNode=t.div.parentNode,t.loader&&t.div.appendChild(t.loader),t.div.appendChild(t.video),t.containerWidth=0,t.containerHeight=0,!1!==e.options.resizer&&(t.resizer=L.ResizeSensor(t.container,t.resize),t.resize()),!1!==e.options.bar?(t.bar=Object(o.a)({elementID:"player_"+t.id,id:t.id,stream:e.stream,media:t.video,options:e.options}),t.div.onmouseover=function(){t.bar.display()},t.div.onmouseout=function(){t.bar.hide()}):t.media=t.video,t.video.src=t.streamUrl,t}},function(e,t,n){var i=n(2);t.a=function(e){var t=Object(i.a)({}),n=50;if(t.elementID=e.elementID,t.media=e.media,t.id=e.id,t.stream=e.stream,t.div=document.createElement("div"),t.div.setAttribute("style","width: 40%; height: 100%; max-width: 32px; position: absolute; right: 0;z-index:0;"),t.icon=document.createElement("img"),t.icon.setAttribute("id","volume_"+t.id),t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.icon.setAttribute("style","width: 80%; height: 100%; position: absolute;"),t.div.appendChild(t.icon),t.icon.onclick=function(){t.media.muted?(t.media.muted=!1,t.icon.setAttribute("src",t.url+"/assets/sound48.png"),t.stream.local?t.stream.stream.getAudioTracks()[0].enabled=!0:(t.picker.value=n,t.media.volume=t.picker.value/100)):(t.media.muted=!0,t.icon.setAttribute("src",t.url+"/assets/mute48.png"),t.stream.local?t.stream.stream.getAudioTracks()[0].enabled=!1:(n=t.picker.value,t.picker.value=0,t.media.volume=0))},!t.stream.local){t.picker=document.createElement("input"),t.picker.setAttribute("id","picker_"+t.id),t.picker.type="range",t.picker.min=0,t.picker.max=100,t.picker.step=10,t.picker.value=n,t.picker.setAttribute("orient","vertical"),t.div.appendChild(t.picker),t.media.volume=t.picker.value/100,t.media.muted=!1,t.picker.oninput=function(){0<t.picker.value?(t.media.muted=!1,t.icon.setAttribute("src",t.url+"/assets/sound48.png")):(t.media.muted=!0,t.icon.setAttribute("src",t.url+"/assets/mute48.png")),t.media.volume=t.picker.value/100};var o=function(e){t.picker.setAttribute("style","background: transparent; width: 32px;\n                                         height: 100px; position: absolute; bottom: 90%;\n                                         z-index: 1; right: 0px; -webkit-appearance: slider-vertical;\n                                         bottom: "+t.div.offsetHeight+"px; display: "+e)};t.div.onmouseover=function(){o("block")},t.div.onmouseout=function(){o("none")},o("none")}return document.getElementById(t.elementID).appendChild(t.div),t}},function(e,t,n){var i=n(2),o=n(7),r=n(0);t.a=function(e){var t=Object(i.a)({});if(t.id=e.id,t.stream=e.stream.stream,t.elementID=e.elementID,r.a.debug("Creating URL from stream "+t.stream),t.streamUrl=(window.URL||webkitURL).createObjectURL(t.stream),t.audio=document.createElement("audio"),t.audio.setAttribute("id","stream"+t.id),t.audio.setAttribute("class","licode_stream"),t.audio.setAttribute("style","width: 100%; height: 100%; position: absolute"),t.audio.setAttribute("autoplay","autoplay"),e.stream.local&&(t.audio.volume=0),void 0!==t.elementID){t.destroy=function(){t.audio.pause(),t.parentNode.removeChild(t.div)};t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),t.div.setAttribute("class","licode_player"),t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),t.container="object"==typeof t.elementID&&"function"==typeof t.elementID.appendChild?t.elementID:document.getElementById(t.elementID),t.container.appendChild(t.div),t.parentNode=t.div.parentNode,t.div.appendChild(t.audio),!1!==e.options.bar?(t.bar=Object(o.a)({elementID:"player_"+t.id,id:t.id,stream:e.stream,media:t.audio,options:e.options}),t.div.onmouseover=function(){t.bar.display()},t.div.onmouseout=function(){t.bar.hide()}):t.media=t.audio}else t.destroy=function(){t.audio.pause(),t.parentNode.removeChild(t.audio)},document.body.appendChild(t.audio),t.parentNode=document.body;return t.audio.src=t.streamUrl,t}},function(e,t,n){t.a=function(){var e={},t={};return e.add=function(e,n){t[e]=n},e.get=function(e){return t[e]},e.has=function(e){return void 0!==t[e]},e.forEach=function(e){for(var n=Object.keys(t),i=0;i<n.length;i+=1){var o=n[i];e(t[o],o)}},e.keys=function(){return Object.keys(t)},e.remove=function(e){delete t[e]},e}},function(e,t,n){e=function(){for(var e,t,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),i=[],o=0;o<n.length;o+=1)i[n[o]]=o;var r=function(){if(!e||t>=e.length)return-1;var n=255&e.charCodeAt(t);return t+=1,n},a=function(){if(!e)return-1;for(;;){if(t>=e.length)return-1;var n=e.charAt(t);if(t+=1,i[n])return i[n];if("A"===n)return 0}},s=function(e){return 1===(e=e.toString(16)).length&&(e="0"+e),unescape("%"+e)};return{encodeBase64:function(i){var o;e=i,t=0,i="";var a=Array(3),s=0;for(o=!1;!o&&-1!==(a[0]=r());)a[1]=r(),a[2]=r(),i+=n[a[0]>>2],-1!==a[1]?(i+=n[a[0]<<4&48|a[1]>>4],-1!==a[2]?(i+=n[a[1]<<2&60|a[2]>>6],i+=n[63&a[2]]):(i+=n[a[1]<<2&60],i+="=",o=!0)):(i+=n[a[0]<<4&48],i+="=",i+="=",o=!0),76<=(s+=4)&&(i+="\n",s=0);return i},decodeBase64:function(n){var i;e=n,t=0,n="";var o=Array(4);for(i=!1;!i&&-1!==(o[0]=a())&&-1!==(o[1]=a());)o[2]=a(),o[3]=a(),n+=s(o[0]<<2&255|o[1]>>4),-1!==o[2]?(n+=s(o[1]<<4&255|o[2]>>2),-1!==o[3]?n+=s(o[2]<<6&255|o[3]):i=!0):i=!0;return n}}}(),t.a=e},function(e,t,n){t=n(8),e.exports=t.adapter=n(23)},function(e,t,n){(function(t){e.exports=function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){if(r)return r(a,!0);throw(s=Error("Cannot find module '"+a+"'")).code="MODULE_NOT_FOUND",s}s=n[a]={exports:{}},t[a][0].call(s.exports,(function(e){var n=t[a][1][e];return o(n||e)}),s,s.exports,e,t,n,i)}return n[a].exports}for(var r=!1,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},i.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"}))},i.matchPrefix=function(e,t){return i.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},i.parseCandidate=function(e){for(var t={foundation:(e=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(e[1],10),protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],port:parseInt(e[5],10),type:e[7]},n=8;n<e.length;n+=2)switch(e[n]){case"raddr":t.relatedAddress=e[n+1];break;case"rport":t.relatedPort=parseInt(e[n+1],10);break;case"tcptype":t.tcpType=e[n+1];break;default:t[e[n]]=e[n+1]}return t},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){e=e.substr(9).split(" ");var t={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),t.name=e[0],t.clockRate=parseInt(e[1],10),t.numChannels=3===e.length?parseInt(e[2],10):1,t},i.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},i.parseExtmap=function(e){return e=e.substr(9).split(" "),{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t[(e=n[i].trim().split("="))[0].trim()]=e[1];return t},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach((function(t){i.push(t+"="+e.parameters[t])})),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){return{type:(e=e.substr(e.indexOf(" ")+1).split(" ")).shift(),parameter:e.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return-1<i?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},i.getMid=function(e){if(e=i.matchPrefix(e,"a=mid:")[0])return e.substr(6)},i.parseFingerprint=function(e){return{algorithm:(e=e.substr(14).split(" "))[0].toLowerCase(),value:e[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},i.getIceParameters=function(e,t){return{usernameFragment:(e=(e=i.splitLines(e)).concat(i.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:e.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),o=3;o<n.length;o++){var r=n[o],a=i.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(a){a=i.parseRtpMap(a);var s=i.matchPrefix(e,"a=fmtp:"+r+" ");switch(a.parameters=s.length?i.parseFmtp(s[0]):{},a.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(i.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(i.parseExtmap(e))})),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=0<t.codecs.length?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)}));var o=0;return t.codecs.forEach((function(e){e.maxptime>o&&(o=e.maxptime)})),0<o&&(n+="a=maxptime:"+o+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach((function(e){n+=i.writeExtmap(e)})),n},i.parseRtpEncodingParameters=function(e){var t,n=[],o=i.parseRtpParameters(e),r=-1!==o.fecMechanisms.indexOf("RED"),a=-1!==o.fecMechanisms.indexOf("ULPFEC"),s=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=0<s.length&&s[0].ssrc;0<(s=i.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return(e=e.split(" ")).shift(),e.map((function(e){return parseInt(e,10)}))}))).length&&1<s[0].length&&s[0][0]===c&&(t=s[0][1]),o.codecs.forEach((function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}},n.push(e),r&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(e)))})),0===n.length&&c&&n.push({ssrc:c});var d=i.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?950*parseInt(d[0].substr(5),10)-16e3:void 0,n.forEach((function(e){e.maxBitrate=d}))),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];return n&&(t.cname=n.value,t.ssrc=n.ssrc),n=i.matchPrefix(e,"a=rtcp-rsize"),t.reducedSize=0<n.length,t.compound=0===n.length,e=i.matchPrefix(e,"a=rtcp-mux"),t.mux=0<e.length,t},i.parseMsid=function(e){var t=i.matchPrefix(e,"a=msid:");return 1===t.length?{stream:(e=t[0].substr(7).split(" "))[0],track:e[1]}:0<(e=i.matchPrefix(e,"a=ssrc:").map((function(e){return i.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}))).length?{stream:(e=e[0].value.split(" "))[0],track:e[1]}:void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e){return"v=0\r\no=thisisadapterortc "+(e||i.generateSessionId())+" 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,o){return t=i.writeRtpDescription(e.kind,t),t+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),t+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),t+="a=mid:"+e.mid+"\r\n",t=e.direction?t+"a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?t+"a=sendrecv\r\n":e.rtpSender?t+"a=sendonly\r\n":e.rtpReceiver?t+"a=recvonly\r\n":t+"a=inactive\r\n",e.rtpSender&&(t=t+"a="+(n="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n")+"a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+n,e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+n,t+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")),t+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(t+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),t},i.getDirection=function(e,t){e=i.splitLines(e);for(var n=0;n<e.length;n++)switch(e[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return e[n].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.exports=i},{}],2:[function(e,n,i){i=void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},e=e("./adapter_factory.js"),n.exports=e({window:i.window})},{"./adapter_factory.js":3}],3:[function(e,t,n){t.exports=function(t){t=t&&t.window;var n=e("./utils"),i=n.log,o=n.detectBrowser(t),r={browserDetails:o,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings},a=e("./chrome/chrome_shim")||null,s=e("./edge/edge_shim")||null,c=e("./firefox/firefox_shim")||null,d=e("./safari/safari_shim")||null;switch(o.browser){case"chrome":if(!a||!a.shimPeerConnection){i("Chrome shim is not included in this adapter release.");break}i("adapter.js shimming chrome."),r.browserShim=a,a.shimGetUserMedia(t),a.shimMediaStream(t),n.shimCreateObjectURL(t),a.shimSourceObject(t),a.shimPeerConnection(t),a.shimOnTrack(t),a.shimGetSendersWithDtmf(t);break;case"firefox":if(!c||!c.shimPeerConnection){i("Firefox shim is not included in this adapter release.");break}i("adapter.js shimming firefox."),r.browserShim=c,c.shimGetUserMedia(t),n.shimCreateObjectURL(t),c.shimSourceObject(t),c.shimPeerConnection(t),c.shimOnTrack(t);break;case"edge":if(!s||!s.shimPeerConnection){i("MS edge shim is not included in this adapter release.");break}i("adapter.js shimming edge."),r.browserShim=s,s.shimGetUserMedia(t),n.shimCreateObjectURL(t),s.shimPeerConnection(t),s.shimReplaceTrack(t);break;case"safari":if(!d){i("Safari shim is not included in this adapter release.");break}i("adapter.js shimming safari."),r.browserShim=d,n.shimCreateObjectURL(t),d.shimRTCIceServerUrls(t),d.shimCallbacksAPI(t),d.shimLocalStreamsAPI(t),d.shimRemoteStreamsAPI(t),d.shimGetUserMedia(t);break;default:i("Unsupported browser!")}return r}},{"./chrome/chrome_shim":4,"./edge/edge_shim":6,"./firefox/firefox_shim":9,"./safari/safari_shim":11,"./utils":12}],4:[function(e,t,n){var i=e("../utils.js"),o=i.log;t.exports={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(t){var n=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=t),this.addEventListener("addstream",this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(i){var o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track.id===i.track.id})):{track:i.track},r=new Event("track");r.track=i.track,r.receiver=o,r.streams=[t.stream],n.dispatchEvent(r)})),t.stream.getTracks().forEach(function(i){var o=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find((function(e){return e.track.id===i.id})):{track:i},r=new Event("track");r.track=i,r.receiver=o,r.streams=[t.stream],this.dispatchEvent(r)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var t=e.RTCPeerConnection.prototype.addStream,n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.addTrack||(e.RTCPeerConnection.prototype.addTrack=function(t,n){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var o=[].slice.call(arguments,1);if(1!==o.length||!o[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(i._senders=i._senders||[],i._senders.find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");return i._streams=i._streams||{},(o=i._streams[n.id])?(o.addTrack(t),i.removeStream(o)):(o=new e.MediaStream([t]),i._streams[n.id]=o),i.addStream(o),o={track:t,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===t.kind?i.createDTMFSender(t):null),this._dtmf}},i._senders.push(o),o}),e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],t.apply(n,[e]),e.getTracks().forEach((function(e){n._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&(this._dtmf="audio"===e.kind?n.createDTMFSender(e):null),this._dtmf}})}))},e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],n.apply(t,[e]),e.getTracks().forEach((function(e){var n=t._senders.find((function(t){return t.track===e}));n&&t._senders.splice(t._senders.indexOf(n),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var i=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=i.apply(e,[]);return t.forEach((function(t){t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&(this._dtmf="audio"===this.track.kind?this._pc.createDTMFSender(this.track):null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",(function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})),e.addEventListener("removetrack",(function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}))):this.src=""}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var r=e.iceServers[o];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),(r=JSON.parse(JSON.stringify(r))).urls=r.url,i.push(r)):i.push(e.iceServers[o])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,o=arguments;if(0<arguments.length&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};return 2<=arguments.length?r.apply(this,[function(e){o[1](s(a(e)))},arguments[0]]):new Promise((function(e,t){r.apply(i,[function(t){e(s(a(t)))},t])})).then(t,n)},51>t.version&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,i=new Promise((function(i,o){n.apply(t,[e[0],i,o])}));return 2>e.length?i:i.then((function(){e[1].apply(null,[])}),(function(t){3<=e.length&&e[2].apply(null,[t])}))}})),52>t.version&&["createOffer","createAnswer"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(1>arguments.length||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise((function(i,o){n.apply(e,[i,o,t])}))}return n.apply(this,arguments)}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}));var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},shimGetUserMedia:e("./getusermedia")}},{"../utils.js":12,"./getusermedia":5}],5:[function(e,t,n){var i=e("../utils.js"),o=i.log;t.exports=function(e){var t=i.detectBrowser(e),n=e&&e.navigator,r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var r={};"number"==typeof i.ideal?(r[o("min",n)]=i.ideal,t.optional.push(r),(r={})[o("max",n)]=i.ideal):r[o("",n)]=i.ideal,t.optional.push(r)}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){var s=e.video.facingMode;if(s=s&&("object"==typeof s?s:{ideal:s}),a=61>t.version,!(!s||"user"!==s.exact&&"environment"!==s.exact&&"user"!==s.ideal&&"environment"!==s.ideal||n.mediaDevices.getSupportedConstraints&&n.mediaDevices.getSupportedConstraints().facingMode&&!a)){if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal)var c=["back","rear"];else"user"!==s.exact&&"user"!==s.ideal||(c=["front"]);if(c)return n.mediaDevices.enumerateDevices().then((function(t){var n=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return c.some((function(t){return-1!==e.label.toLowerCase().indexOf(t)}))}));return!n&&t.length&&-1!==c.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=s.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=r(e.video),o("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},s=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};n.getUserMedia=function(e,t,i){a(e,(function(e){n.webkitGetUserMedia(e,t,(function(e){i(s(e))}))}))};var c=function(e){return new Promise((function(t,i){n.getUserMedia(e,t,i)}))};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise((function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources((function(e){t(e.map((function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}})))}))}))},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return d(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(s(e))}))}))}}else n.mediaDevices.getUserMedia=function(e){return c(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":12}],6:[function(e,t,n){var i=e("../utils"),o=e("./rtcpeerconnection_shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=i.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),15025>t.version)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCPeerConnection=o(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":12,"./getusermedia":7,"./rtcpeerconnection_shim":8}],7:[function(e,t,n){t.exports=function(e){var t=(e=e&&e.navigator).mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(e){return t(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],8:[function(e,t,n){function i(e){var t=e.filter((function(e){return"audio"===e.kind})),n=e.filter((function(e){return"video"===e.kind}));for(e=[];t.length||n.length;)t.length&&e.push(t.shift()),n.length&&e.push(n.shift());return e}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},o=function(e,t,n,o){return e=i(e.parameters.apt,n),t=i(t.parameters.apt,o),e&&t&&e.name.toLowerCase()===t.name.toLowerCase()};return e.codecs.forEach((function(i){for(var r=0;r<t.codecs.length;r++){var a=t.codecs[r];if(i.name.toLowerCase()===a.name.toLowerCase()&&i.clockRate===a.clockRate&&("rtx"!==i.name.toLowerCase()||!i.parameters||!a.parameters.apt||o(i,a,e.codecs,t.codecs))){(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(i.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter((function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var i=0;i<t.headerExtensions.length;i++){var o=t.headerExtensions[i];if(e.uri===o.uri){n.headerExtensions.push(o);break}}})),n}function r(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}var a=e("sdp");t.exports=function(e,t){var n=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=o[e].bind(o)})),this.needNegotiation=!1,this.canTrickleIceCandidates=this.ondatachannel=this.onnegotiationneeded=this.onicegatheringstatechange=this.oniceconnectionstatechange=this.onsignalingstatechange=this.onremovestream=this.ontrack=this.onaddstream=this.onicecandidate=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return i.localStreams},this.getRemoteStreams=function(){return i.remoteStreams},this.localDescription=new e.RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new e.RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceGatheringState=this.iceConnectionState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},n&&n.iceTransportPolicy)switch(n.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=n.iceTransportPolicy}this.usingBundle=n&&"max-bundle"===n.bundlePolicy,n&&n.iceServers&&(this.iceOptions.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o="string"==typeof i;return o&&(i=[i]),i=i.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&14393<=t:n=!0})),delete e.url,e.urls=o?i[0]:i,!!i.length}return!1}))}(n.iceServers,t)),this._config=n||{},this.transceivers=[],this._localIceCandidatesBuffer=[],this._sdpSessionId=a.generateSessionId()};return n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},n.prototype._emitBufferedCandidates=function(){var e=this,t=a.splitSections(e.localDescription.sdp);this._localIceCandidatesBuffer.forEach((function(n){if(n.candidate&&0!==Object.keys(n.candidate).length)t[n.candidate.sdpMLineIndex+1]+="a="+n.candidate.candidate+"\r\n";else for(var i=1;i<t.length;i++)-1===t[i].indexOf("\r\na=end-of-candidates\r\n")&&(t[i]+="a=end-of-candidates\r\n");e.localDescription.sdp=t.join(""),e.dispatchEvent(n),null!==e.onicecandidate&&e.onicecandidate(n),!n.candidate&&"complete"!==e.iceGatheringState&&e.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}))&&"complete"!==e.iceGatheringStateChange&&(e.iceGatheringState="complete",e._emitGatheringStateChange())})),this._localIceCandidatesBuffer=[]},n.prototype.getConfiguration=function(){return this._config},n.prototype._createTransceiver=function(e){var t=0<this.transceivers.length;return e={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0},this.usingBundle&&t?(e.iceTransport=this.transceivers[0].iceTransport,e.dtlsTransport=this.transceivers[0].dtlsTransport):(t=this._createIceAndDtlsTransports(),e.iceTransport=t.iceTransport,e.dtlsTransport=t.dtlsTransport),this.transceivers.push(e),e},n.prototype.addTrack=function(t,n){for(var i,o=0;o<this.transceivers.length;o++)this.transceivers[o].track||this.transceivers[o].kind!==t.kind||(i=this.transceivers[o]);return i||(i=this._createTransceiver(t.kind)),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),this._maybeFireNegotiationNeeded(),i.rtpSender},n.prototype.addStream=function(e){var n=this;if(15025<=t)this.localStreams.push(e),e.getTracks().forEach((function(t){n.addTrack(t,e)}));else{var i=e.clone();e.getTracks().forEach((function(e,t){var n=i.getTracks()[t];e.addEventListener("enabled",(function(e){n.enabled=e.enabled}))})),i.getTracks().forEach((function(e){n.addTrack(e,i)})),this.localStreams.push(i)}this._maybeFireNegotiationNeeded()},n.prototype.removeStream=function(e){-1<(e=this.localStreams.indexOf(e))&&(this.localStreams.splice(e,1),this._maybeFireNegotiationNeeded())},n.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},n.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},n.prototype._createIceGatherer=function(t,n){var i=this,o=new e.RTCIceGatherer(i.iceOptions);return o.onlocalcandidate=function(e){var r=new Event("icecandidate");r.candidate={sdpMid:t,sdpMLineIndex:n};var s=e.candidate;switch((e=!s||0===Object.keys(s).length)?void 0===o.state&&(o.state="completed"):(s.component=1,r.candidate.candidate=a.writeCandidate(s)),(s=a.splitSections(i.localDescription.sdp))[r.candidate.sdpMLineIndex+1]=e?s[r.candidate.sdpMLineIndex+1]+"a=end-of-candidates\r\n":s[r.candidate.sdpMLineIndex+1]+"a="+r.candidate.candidate+"\r\n",i.localDescription.sdp=s.join(""),s=(i._pendingOffer?i._pendingOffer:i.transceivers).every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})),i.iceGatheringState){case"new":e||i._localIceCandidatesBuffer.push(r),e&&s&&i._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":i._emitBufferedCandidates(),e||(i.dispatchEvent(r),null===i.onicecandidate)||i.onicecandidate(r),s&&(i.dispatchEvent(new Event("icecandidate")),null!==i.onicecandidate&&i.onicecandidate(new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},o},n.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer),(t=this.transceivers[e].iceTransport)&&(delete t.onicestatechange,delete this.transceivers[e].iceTransport),(t=this.transceivers[e].dtlsTransport)&&(delete t.ondtlssttatechange,delete t.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,n,i){var r=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:a.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),i&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&15019>t&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),r.encodings=e.recvEncodingParameters,r.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},n.prototype.setLocalDescription=function(t){var n=this;if(!r("setLocalDescription",t.type,this.signalingState)){var i=Error("Can not set local "+t.type+" in state "+this.signalingState);return i.name="InvalidStateError",2<arguments.length&&"function"==typeof arguments[2]&&e.setTimeout(arguments[2],0,i),Promise.reject(i)}if("offer"===t.type){if(this._pendingOffer){var s=(i=a.splitSections(t.sdp)).shift();i.forEach((function(e,t){e=a.parseRtpParameters(e),n._pendingOffer[t].localCapabilities=e})),this.transceivers=this._pendingOffer,delete this._pendingOffer}}else if("answer"===t.type){i=a.splitSections(n.remoteDescription.sdp),s=i.shift();var c=0<a.matchPrefix(s,"a=ice-lite").length;i.forEach((function(e,t){var i=n.transceivers[t],r=i.iceGatherer,d=i.iceTransport,u=i.dtlsTransport,l=i.localCapabilities,p=i.remoteCapabilities;if(!a.isRejected(e)&&!i.isDatachannel){var f=a.getIceParameters(e,s);e=a.getDtlsParameters(e,s),c&&(e.role="server"),n.usingBundle&&0!==t||(d.start(r,f,c?"controlling":"controlled"),u.start(e)),t=o(l,p),n._transceive(i,0<t.codecs.length,!1)}}))}switch(this.localDescription={type:t.type,sdp:t.sdp},t.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+t.type+'"')}var d=1<arguments.length&&"function"==typeof arguments[1];if(d){var u=arguments[1];e.setTimeout((function(){u(),"new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),n._emitBufferedCandidates()}),0)}return(i=Promise.resolve()).then((function(){d||("new"===n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),e.setTimeout(n._emitBufferedCandidates.bind(n),500))})),i},n.prototype.setRemoteDescription=function(n){var i=this;if(!r("setRemoteDescription",n.type,this.signalingState)){var o=Error("Can not set remote "+n.type+" in state "+this.signalingState);return o.name="InvalidStateError",2<arguments.length&&"function"==typeof arguments[2]&&e.setTimeout(arguments[2],0,o),Promise.reject(o)}var s={},c=[],d=(o=a.splitSections(n.sdp)).shift(),u=0<a.matchPrefix(d,"a=ice-lite").length,l=0<a.matchPrefix(d,"a=group:BUNDLE ").length;this.usingBundle=l;var p=a.matchPrefix(d,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!p&&0<=p.substr(14).split(" ").indexOf("trickle"),o.forEach((function(o,r){var p=a.splitLines(o),f=a.getKind(o),m=a.isRejected(o),g=p[0].substr(2).split(" ")[2];p=a.getDirection(o,d);var v=a.parseMsid(o),h=a.getMid(o)||a.generateIdentifier();if("application"===f&&"DTLS/SCTP"===g)i.transceivers[r]={mid:h,isDatachannel:!0};else{var y=a.parseRtpParameters(o);if(!m){var S=a.getIceParameters(o,d),b=a.getDtlsParameters(o,d);b.role="client"}g=a.parseRtpEncodingParameters(o);var I=a.parseRtcpParameters(o),_=0<a.matchPrefix(o,"a=end-of-candidates",d).length;if(o=a.matchPrefix(o,"a=candidate:").map((function(e){return a.parseCandidate(e)})).filter((function(e){return"1"===e.component||1===e.component})),("offer"===n.type||"answer"===n.type)&&!m&&l&&0<r&&i.transceivers[r]&&(i._disposeIceAndDtlsTransports(r),i.transceivers[r].iceGatherer=i.transceivers[0].iceGatherer,i.transceivers[r].iceTransport=i.transceivers[0].iceTransport,i.transceivers[r].dtlsTransport=i.transceivers[0].dtlsTransport,i.transceivers[r].rtpSender&&i.transceivers[r].rtpSender.setTransport(i.transceivers[0].dtlsTransport),i.transceivers[r].rtpReceiver&&i.transceivers[r].rtpReceiver.setTransport(i.transceivers[0].dtlsTransport)),"offer"!==n.type||m){if("answer"===n.type&&!m){f=(m=i.transceivers[r]).iceGatherer;var E=m.iceTransport,C=m.dtlsTransport;w=m.rtpReceiver,h=m.sendEncodingParameters,T=m.localCapabilities,i.transceivers[r].recvEncodingParameters=g,i.transceivers[r].remoteCapabilities=y,i.transceivers[r].rtcpParameters=I,(u||_)&&o.length&&E.setRemoteCandidates(o),l&&0!==r||(E.start(f,S,"controlling"),C.start(b)),i._transceive(m,"sendrecv"===p||"recvonly"===p,"sendrecv"===p||"sendonly"===p),!w||"sendrecv"!==p&&"sendonly"!==p?delete m.rtpReceiver:(S=w.track,v?(s[v.stream]||(s[v.stream]=new e.MediaStream),s[v.stream].addTrack(S),c.push([S,w,s[v.stream]])):(s.default||(s.default=new e.MediaStream),s.default.addTrack(S),c.push([S,w,s.default])))}}else{(m=i.transceivers[r]||i._createTransceiver(f)).mid=h,m.iceGatherer||(m.iceGatherer=l&&0<r?i.transceivers[0].iceGatherer:i._createIceGatherer(h,r)),!_||l&&0!==r||m.iceTransport.setRemoteCandidates(o);var T=e.RTCRtpReceiver.getCapabilities(f);if(15019>t&&(T.codecs=T.codecs.filter((function(e){return"rtx"!==e.name}))),h=[{ssrc:1001*(2*r+2)}],"sendrecv"===p||"sendonly"===p){var w=new e.RTCRtpReceiver(m.dtlsTransport,f);S=w.track,v?(s[v.stream]||(s[v.stream]=new e.MediaStream,Object.defineProperty(s[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(S,"id",{get:function(){return v.track}}),s[v.stream].addTrack(S),c.push([S,w,s[v.stream]])):(s.default||(s.default=new e.MediaStream),s.default.addTrack(S),c.push([S,w,s.default]))}m.localCapabilities=T,m.remoteCapabilities=y,m.rtpReceiver=w,m.rtcpParameters=I,m.sendEncodingParameters=h,m.recvEncodingParameters=g,i._transceive(i.transceivers[r],!1,"sendrecv"===p||"sendonly"===p)}}})),this.remoteDescription={type:n.type,sdp:n.sdp},n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}return Object.keys(s).forEach((function(t){var n=s[t];if(n.getTracks().length){i.remoteStreams.push(n);var o=new Event("addstream");o.stream=n,i.dispatchEvent(o),null!==i.onaddstream&&e.setTimeout((function(){i.onaddstream(o)}),0),c.forEach((function(t){var o=t[0],r=t[1];if(n.id===t[2].id){var a=new Event("track");a.track=o,a.receiver=r,a.streams=[n],i.dispatchEvent(a),null!==i.ontrack&&e.setTimeout((function(){i.ontrack(a)}),0)}}))}})),e.setTimeout((function(){i&&i.transceivers&&i.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),1<arguments.length&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),Promise.resolve()},n.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e,e=new Event("signalingstatechange"),this.dispatchEvent(e),null!==this.onsignalingstatechange&&this.onsignalingstatechange(e)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),null!==t.onnegotiationneeded&&t.onnegotiationneeded(e)}}),0))},n.prototype._updateConnectionState=function(){var e={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};this.transceivers.forEach((function(t){e[t.iceTransport.state]++,e[t.dtlsTransport.state]++})),e.connected+=e.completed;var t="new";0<e.failed?t="failed":0<e.connecting||0<e.checking?t="connecting":0<e.disconnected?t="disconnected":0<e.new?t="new":(0<e.connected||0<e.completed)&&(t="connected"),t!==this.iceConnectionState&&(this.iceConnectionState=t,t=new Event("iceconnectionstatechange"),this.dispatchEvent(t),null!==this.oniceconnectionstatechange)&&this.oniceconnectionstatechange(t)},n.prototype.createOffer=function(){var n,o=this;if(this._pendingOffer)throw Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?n=arguments[0]:3===arguments.length&&(n=arguments[2]);var r=this.transceivers.filter((function(e){return"audio"===e.kind})).length,s=this.transceivers.filter((function(e){return"video"===e.kind})).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(r=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(s=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(this.transceivers.forEach((function(e){"audio"===e.kind?0>--r&&(e.wantReceive=!1):"video"===e.kind&&0>--s&&(e.wantReceive=!1)}));0<r||0<s;)0<r&&(this._createTransceiver("audio"),r--),0<s&&(this._createTransceiver("video"),s--);var c=i(this.transceivers),d=a.writeSessionBoilerplate(this._sdpSessionId);return c.forEach((function(n,i){var r=n.track,s=n.kind,d=a.generateIdentifier();n.mid=d,n.iceGatherer||(n.iceGatherer=o.usingBundle&&0<i?c[0].iceGatherer:o._createIceGatherer(d,i)),d=e.RTCRtpSender.getCapabilities(s),15019>t&&(d.codecs=d.codecs.filter((function(e){return"rtx"!==e.name}))),d.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")}));var u=[{ssrc:1001*(2*i+1)}];r&&15019<=t&&"video"===s&&(u[0].rtx={ssrc:1001*(2*i+1)+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,s)),n.localCapabilities=d,n.sendEncodingParameters=u})),"max-compat"!==this._config.bundlePolicy&&(d+="a=group:BUNDLE "+c.map((function(e){return e.mid})).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",c.forEach((function(e,t){d+=a.writeMediaSection(e,e.localCapabilities,"offer",e.stream),d+="a=rtcp-rsize\r\n"})),this._pendingOffer=c,n=new e.RTCSessionDescription({type:"offer",sdp:d}),arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,n),Promise.resolve(n)},n.prototype.createAnswer=function(){var n=a.writeSessionBoilerplate(this._sdpSessionId);this.usingBundle&&(n+="a=group:BUNDLE "+this.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),this.transceivers.forEach((function(e,i){var r;e.isDatachannel?n+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n":(e.stream&&("audio"===e.kind?r=e.stream.getAudioTracks()[0]:"video"===e.kind&&(r=e.stream.getVideoTracks()[0]),r&&15019<=t&&"video"===e.kind&&(e.sendEncodingParameters[0].rtx={ssrc:1001*(2*i+2)+1})),!(i=o(e.localCapabilities,e.remoteCapabilities)).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,n+=a.writeMediaSection(e,i,"answer",e.stream),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(n+="a=rtcp-rsize\r\n"))}));var i=new e.RTCSessionDescription({type:"answer",sdp:n});return arguments.length&&"function"==typeof arguments[0]&&e.setTimeout(arguments[0],0,i),Promise.resolve(i)},n.prototype.addIceCandidate=function(t){if(t){var n=t.sdpMLineIndex;if(t.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===t.sdpMid){n=i;break}var o=this.transceivers[n];if(o){if("tcp"===(i=0<Object.keys(t.candidate).length?a.parseCandidate(t.candidate):{}).protocol&&(0===i.port||9===i.port)||i.component&&"1"!==i.component&&1!==i.component)return Promise.resolve();o.iceTransport.addRemoteCandidate(i),(o=a.splitSections(this.remoteDescription.sdp))[n+1]+=(i.type?t.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=o.join("")}}else for(n=0;n<this.transceivers.length;n++)if(this.transceivers[n].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return 1<arguments.length&&"function"==typeof arguments[1]&&e.setTimeout(arguments[1],0),Promise.resolve()},n.prototype.getStats=function(){var t=[];this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(n){e[n]&&t.push(e[n].getStats())}))}));var n=1<arguments.length&&"function"==typeof arguments[1]&&arguments[1];return new Promise((function(i){var o=new Map;Promise.all(t).then((function(t){t.forEach((function(e){Object.keys(e).forEach((function(t){var n=e[t];e[t].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[n.type]||n.type,o.set(t,e[t])}))})),n&&e.setTimeout(n,0,o),i(o)}))}))},n}},{sdp:1}],9:[function(e,t,n){var i=e("../utils");t.exports={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,i){if(38>t.version&&n&&n.iceServers){for(var o=[],r=0;r<n.iceServers.length;r++){var a=n.iceServers[r];if(a.hasOwnProperty("urls"))for(var s=0;s<a.urls.length;s++){var c={url:a.urls[s]};0===a.urls[s].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),o.push(c)}else o.push(n.iceServers[r])}n.iceServers=o}return new e.mozRTCPeerConnection(n,i)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}}));var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,i){return r.apply(this,[e||null]).then((function(e){if(48>t.version&&(e=function(e){var t=new Map;return Object.keys(e).forEach((function(n){t.set(n,e[n]),t[n]=e[n]})),t}(e)),53>t.version&&!n)try{e.forEach((function(e){e.type=o[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))}))}return e})).then(n,i)}}},shimGetUserMedia:e("./getusermedia")}},{"../utils":12,"./getusermedia":10}],10:[function(e,t,n){var i=e("../utils"),o=i.log;t.exports=function(e){var t=i.detectBrowser(e),n=e&&e.navigator;e=e&&e.MediaStreamTrack;var r=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},a=function(e,i,a){var s=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};o[n]="number"==typeof i.ideal?{min:i.ideal,max:i.ideal}:i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[n]}}})),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),38>t.version&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=s(e.audio)),e.video&&(e.video=s(e.video)),o("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,i,(function(e){a(r(e))}))};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(e){return new Promise((function(t,n){a(e,t,n)}))},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise((function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},41>t.version){var s=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return s().then(void 0,(function(e){if("NotFoundError"===e.name)return[];throw e}))}}if(49>t.version){var c=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return c(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("The object can not be found here.","NotFoundError");return t}),(function(e){return Promise.reject(r(e))}))}}if(!(55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},u=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),u(e)},e&&e.prototype.getSettings){var l=e.prototype.getSettings;e.prototype.getSettings=function(){var e=l.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(e&&e.prototype.applyConstraints){var p=e.prototype.applyConstraints;e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),p.apply(this,[e])}}}n.getUserMedia=function(e,i,o){if(44>t.version)return a(e,i,o);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,o)}}},{"../utils":12}],11:[function(e,t,n){var i=e("../utils");t.exports={shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=(e=e.RTCPeerConnection.prototype).createOffer,n=e.createAnswer,i=e.setLocalDescription,o=e.setRemoteDescription,r=e.addIceCandidate;e.createOffer=function(e,n){var i=t.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return n?(i.then(e,n),Promise.resolve()):i},e.createAnswer=function(e,t){var i=n.apply(this,[2<=arguments.length?arguments[2]:arguments[0]]);return t?(i.then(e,t),Promise.resolve()):i};var a=function(e,t,n){return e=i.apply(this,[e]),n?(e.then(t,n),Promise.resolve()):e};e.setLocalDescription=a,a=function(e,t,n){return e=o.apply(this,[e]),n?(e.then(t,n),Promise.resolve()):e},e.setRemoteDescription=a,a=function(e,t,n){return e=r.apply(this,[e]),n?(e.then(t,n),Promise.resolve()):e},e.addIceCandidate=a}},shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach((function(n){n.id===e&&(t=n)})),this._remoteStreams&&this._remoteStreams.forEach((function(n){n.id===e&&(t=n)})),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach((function(i){t.call(n,i,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,i=e.getTracks();this.getSenders().forEach((function(e){-1!==i.indexOf(e.track)&&n.removeTrack(e)}))}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];this._remoteStreams||(this._remoteStreams=[]),0<=this._remoteStreams.indexOf(t)||(this._remoteStreams.push(t),(t=new Event("addstream")).stream=e.streams[0],this.dispatchEvent(t))}.bind(this))}}))},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var o=[],r=0;r<e.iceServers.length;r++){var a=e.iceServers[r];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,o.push(a)):o.push(e.iceServers[r])}e.iceServers=o}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}},{"../utils":12}],12:[function(e,t,n){var i=!0,o=!0,r={disableLog:function(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(i=e)?"adapter.js logging disabled":"adapter.js logging enabled"},disableWarnings:function(e){return"boolean"!=typeof e?Error("Argument type: "+typeof e+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){"object"!=typeof window||i||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)},deprecated:function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){return(e=e.match(t))&&e.length>=n&&parseInt(e[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};return void 0!==e&&e.navigator?(t.mozGetUserMedia?(n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1)):t.webkitGetUserMedia?e.webkitRTCPeerConnection?(n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2)):t.userAgent.match(/Version\/(\d+).(\d+)/)?(n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)):n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.":t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/)?(n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2)):t.mediaDevices&&t.userAgent.match(/AppleWebKit\/(\d+)\./)?(n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)):n.browser="Not a supported browser.",n):(n.browser="Not a browser.",n)},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype){var n=t.createObjectURL.bind(t),i=t.revokeObjectURL.bind(t),o=new Map,a=0;t.createObjectURL=function(e){if(console.log("getTracks",e),"getTracks"in e){var t="polyblob:"+ ++a;return o.set(t,e),r.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){i(e),o.delete(e)};var s=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return s.get.apply(this)},set:function(e){return this.srcObject=o.get(e)||null,s.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=o.get(arguments[1])||null),c.apply(this,arguments)}}}};t.exports={log:r.log,deprecated:r.deprecated,disableLog:r.disableLog,disableWarnings:r.disableWarnings,extractVersion:r.extractVersion,shimCreateObjectURL:r.shimCreateObjectURL,detectBrowser:r.detectBrowser.bind(r)}},{}]},{},[2])(2)}).call(t,n(8))},function(e,t,n){n(25)(n(26))},function(e,t){e.exports=function(e){"undefined"!=typeof execScript?execScript(e):eval.call(null,e)}},function(e,t){e.exports="/* globals $$, jQuery, Elements, document, window, L */\n\n/**\n* Copyright 2013 Marc J. Schmidt. See the LICENSE file at the top-level\n* directory of this distribution and at\n* https://github.com/marcj/css-element-queries/blob/master/LICENSE.\n*/\nthis.L = this.L || {};\n\n/**\n * @param {HTMLElement} element\n * @param {String}      prop\n * @returns {String|Number}\n */\nL.GetComputedStyle = (computedElement, prop) => {\n  if (computedElement.currentStyle) {\n    return computedElement.currentStyle[prop];\n  } else if (window.getComputedStyle) {\n    return window.getComputedStyle(computedElement, null).getPropertyValue(prop);\n  }\n  return computedElement.style[prop];\n};\n\n  /**\n   *\n   * @type {Function}\n   * @constructor\n   */\nL.ElementQueries = function ElementQueries() {\n      /**\n       *\n       * @param element\n       * @returns {Number}\n       */\n  function getEmSize(element = document.documentElement) {\n    const fontSize = L.GetComputedStyle(element, 'fontSize');\n    return parseFloat(fontSize) || 16;\n  }\n\n      /**\n       *\n       * @copyright https://github.com/Mr0grog/element-query/blob/master/LICENSE\n       *\n       * @param element\n       * @param value\n       * @param units\n       * @returns {*}\n       */\n  function convertToPx(element, originalValue) {\n    let vh;\n    let vw;\n    let chooser;\n    const units = originalValue.replace(/[0-9]*/, '');\n    const value = parseFloat(originalValue);\n    switch (units) {\n      case 'px':\n        return value;\n      case 'em':\n        return value * getEmSize(element);\n      case 'rem':\n        return value * getEmSize();\n              // Viewport units!\n              // According to http://quirksmode.org/mobile/tableViewport.html\n              // documentElement.clientWidth/Height gets us the most reliable info\n      case 'vw':\n        return (value * document.documentElement.clientWidth) / 100;\n      case 'vh':\n        return (value * document.documentElement.clientHeight) / 100;\n      case 'vmin':\n      case 'vmax':\n        vw = document.documentElement.clientWidth / 100;\n        vh = document.documentElement.clientHeight / 100;\n        chooser = Math[units === 'vmin' ? 'min' : 'max'];\n        return value * chooser(vw, vh);\n      default:\n        return value;\n              // for now, not supporting physical units (since they are just a set number of px)\n              // or ex/ch (getting accurate measurements is hard)\n    }\n  }\n\n      /**\n       *\n       * @param {HTMLElement} element\n       * @constructor\n       */\n  function SetupInformation(element) {\n    this.element = element;\n    this.options = [];\n    let i;\n    let j;\n    let option;\n    let width = 0;\n    let height = 0;\n    let value;\n    let actualValue;\n    let attrValues;\n    let attrValue;\n    let attrName;\n\n          /**\n           * @param option {mode: 'min|max', property: 'width|height', value: '123px'}\n           */\n    this.addOption = (newOption) => {\n      this.options.push(newOption);\n    };\n\n    const attributes = ['min-width', 'min-height', 'max-width', 'max-height'];\n\n          /**\n           * Extracts the computed width/height and sets to min/max- attribute.\n           */\n    this.call = () => {\n              // extract current dimensions\n      width = this.element.offsetWidth;\n      height = this.element.offsetHeight;\n\n      attrValues = {};\n\n      for (i = 0, j = this.options.length; i < j; i += 1) {\n        option = this.options[i];\n        value = convertToPx(this.element, option.value);\n\n        actualValue = option.property === 'width' ? width : height;\n        attrName = `${option.mode}-${option.property}`;\n        attrValue = '';\n\n        if (option.mode === 'min' && actualValue >= value) {\n          attrValue += option.value;\n        }\n\n        if (option.mode === 'max' && actualValue <= value) {\n          attrValue += option.value;\n        }\n\n        if (!attrValues[attrName]) attrValues[attrName] = '';\n        if (attrValue && (` ${attrValues[attrName]} `)\n                                            .indexOf(` ${attrValue} `) === -1) {\n          attrValues[attrName] += ` ${attrValue}`;\n        }\n      }\n\n      for (let k = 0; k < attributes.length; k += 1) {\n        if (attrValues[attributes[k]]) {\n          this.element.setAttribute(attributes[k],\n                                                attrValues[attributes[k]].substr(1));\n        } else {\n          this.element.removeAttribute(attributes[k]);\n        }\n      }\n    };\n  }\n\n      /**\n       * @param {HTMLElement} element\n       * @param {Object}      options\n       */\n  function setupElement(originalElement, options) {\n    const element = originalElement;\n    if (element.elementQueriesSetupInformation) {\n      element.elementQueriesSetupInformation.addOption(options);\n    } else {\n      element.elementQueriesSetupInformation = new SetupInformation(element);\n      element.elementQueriesSetupInformation.addOption(options);\n      element.sensor = new L.ResizeSensor(element, () => {\n        element.elementQueriesSetupInformation.call();\n      });\n    }\n    element.elementQueriesSetupInformation.call();\n    return element;\n  }\n\n      /**\n       * @param {String} selector\n       * @param {String} mode min|max\n       * @param {String} property width|height\n       * @param {String} value\n       */\n  function queueQuery(selector, mode, property, value) {\n    let query;\n    if (document.querySelectorAll) query = document.querySelectorAll.bind(document);\n    if (!query && typeof $$ !== 'undefined') query = $$;\n    if (!query && typeof jQuery !== 'undefined') query = jQuery;\n\n    if (!query) {\n      throw new Error('No document.querySelectorAll, jQuery or Mootools\\'s $$ found.');\n    }\n\n    const elements = query(selector) || [];\n    for (let i = 0, j = elements.length; i < j; i += 1) {\n      elements[i] = setupElement(elements[i], {\n        mode,\n        property,\n        value,\n      });\n    }\n  }\n\n  const regex = /,?([^,\\n]*)\\[[\\s\\t]*(min|max)-(width|height)[\\s\\t]*[~$^]?=[\\s\\t]*\"([^\"]*)\"[\\s\\t]*]([^\\n\\s{]*)/mgi;  // jshint ignore:line\n\n      /**\n       * @param {String} css\n       */\n  function extractQuery(originalCss) {\n    let match;\n    const css = originalCss.replace(/'/g, '\"');\n    while ((match = regex.exec(css)) !== null) {\n      if (match.length > 5) {\n        queueQuery(match[1] || match[5], match[2], match[3], match[4]);\n      }\n    }\n  }\n\n      /**\n       * @param {CssRule[]|String} rules\n       */\n  function readRules(originalRules) {\n    let selector = '';\n    let rules = [];\n    if (!originalRules) {\n      return;\n    }\n    if (typeof originalRules === 'string') {\n      rules = originalRules.toLowerCase();\n      if (rules.indexOf('min-width') !== -1 || rules.indexOf('max-width') !== -1) {\n        extractQuery(rules);\n      }\n    } else {\n      for (let i = 0, j = rules.length; i < j; i += 1) {\n        if (rules[i].type === 1) {\n          selector = rules[i].selectorText || rules[i].cssText;\n          if (selector.indexOf('min-height') !== -1 ||\n                          selector.indexOf('max-height') !== -1) {\n            extractQuery(selector);\n          } else if (selector.indexOf('min-width') !== -1 ||\n                                 selector.indexOf('max-width') !== -1) {\n            extractQuery(selector);\n          }\n        } else if (rules[i].type === 4) {\n          readRules(rules[i].cssRules || rules[i].rules);\n        }\n      }\n    }\n  }\n\n      /**\n       * Searches all css rules and setups the event listener\n       * to all elements with element query rules..\n       */\n  this.init = () => {\n    const styleSheets = document.styleSheets || [];\n    for (let i = 0, j = styleSheets.length; i < j; i += 1) {\n      readRules(styleSheets[i].cssText ||\n                        styleSheets[i].cssRules ||\n                        styleSheets[i].rules);\n    }\n  };\n};\n\nfunction init() {\n  (new L.ElementQueries()).init();\n}\n\nif (window.addEventListener) {\n  window.addEventListener('load', init, false);\n} else {\n  window.attachEvent('onload', init);\n}\n\n  /**\n   * Iterate over each of the provided element(s).\n   *\n   * @param {HTMLElement|HTMLElement[]} elements\n   * @param {Function}                  callback\n   */\nfunction forEachElement(elements, callback = () => {}) {\n  const elementsType = Object.prototype.toString.call(elements);\n  const isCollectionTyped = (elementsType === '[object Array]' ||\n          (elementsType === '[object NodeList]') ||\n          (elementsType === '[object HTMLCollection]') ||\n          (typeof jQuery !== 'undefined' && elements instanceof jQuery) || // jquery\n          (typeof Elements !== 'undefined' && elements instanceof Elements) // mootools\n      );\n  let i = 0;\n  const j = elements.length;\n  if (isCollectionTyped) {\n    for (; i < j; i += 1) {\n      callback(elements[i]);\n    }\n  } else {\n    callback(elements);\n  }\n}\n  /**\n   * Class for dimension change detection.\n   *\n   * @param {Element|Element[]|Elements|jQuery} element\n   * @param {Function} callback\n   *\n   * @constructor\n   */\nL.ResizeSensor = function ResizeSensor(element, callback = () => {}) {\n      /**\n       *\n       * @constructor\n       */\n  function EventQueue() {\n    let q = [];\n    this.add = (ev) => {\n      q.push(ev);\n    };\n\n    let i;\n    let j;\n    this.call = () => {\n      for (i = 0, j = q.length; i < j; i += 1) {\n        q[i].call();\n      }\n    };\n\n    this.remove = (ev) => {\n      const newQueue = [];\n      for (i = 0, j = q.length; i < j; i += 1) {\n        if (q[i] !== ev) newQueue.push(q[i]);\n      }\n      q = newQueue;\n    };\n\n    this.length = () => q.length;\n  }\n\n      /**\n       *\n       * @param {HTMLElement} element\n       * @param {Function}    resized\n       */\n  function attachResizeEvent(htmlElement, resized) {\n    // Only used for the dirty checking, so the event callback count is limted\n    //  to max 1 call per fps per sensor.\n    // In combination with the event based resize sensor this saves cpu time,\n    // because the sensor is too fast and\n    // would generate too many unnecessary events.\n    const customRequestAnimationFrame = window.requestAnimationFrame ||\n    window.mozRequestAnimationFrame ||\n    window.webkitRequestAnimationFrame ||\n    function delay(fn) {\n      return window.setTimeout(fn, 20);\n    };\n\n    const newElement = htmlElement;\n    if (!newElement.resizedAttached) {\n      newElement.resizedAttached = new EventQueue();\n      newElement.resizedAttached.add(resized);\n    } else if (newElement.resizedAttached) {\n      newElement.resizedAttached.add(resized);\n      return;\n    }\n\n    newElement.resizeSensor = document.createElement('div');\n    newElement.resizeSensor.className = 'resize-sensor';\n    const style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; ' +\n                      'overflow: hidden; z-index: -1; visibility: hidden;';\n    const styleChild = 'position: absolute; left: 0; top: 0; transition: 0s;';\n\n    newElement.resizeSensor.style.cssText = style;\n    newElement.resizeSensor.innerHTML =\n              `<div class=\"resize-sensor-expand\" style=\"${style}\">` +\n                  `<div style=\"${styleChild}\"></div>` +\n              '</div>' +\n              `<div class=\"resize-sensor-shrink\" style=\"${style}\">` +\n                  `<div style=\"${styleChild} width: 200%; height: 200%\"></div>` +\n              '</div>';\n    newElement.appendChild(newElement.resizeSensor);\n\n    if (L.GetComputedStyle(newElement, 'position') === 'static') {\n      newElement.style.position = 'relative';\n    }\n\n    const expand = newElement.resizeSensor.childNodes[0];\n    const expandChild = expand.childNodes[0];\n    const shrink = newElement.resizeSensor.childNodes[1];\n\n    const reset = () => {\n      expandChild.style.width = `${100000}px`;\n      expandChild.style.height = `${100000}px`;\n\n      expand.scrollLeft = 100000;\n      expand.scrollTop = 100000;\n\n      shrink.scrollLeft = 100000;\n      shrink.scrollTop = 100000;\n    };\n\n    reset();\n    let dirty = false;\n\n    const dirtyChecking = () => {\n      if (!newElement.resizedAttached) return;\n\n      if (dirty) {\n        newElement.resizedAttached.call();\n        dirty = false;\n      }\n\n      customRequestAnimationFrame(dirtyChecking);\n    };\n\n    customRequestAnimationFrame(dirtyChecking);\n    let lastWidth;\n    let lastHeight;\n    let cachedWidth;\n    let cachedHeight; // useful to not query offsetWidth twice\n\n    const onScroll = () => {\n      if ((cachedWidth = newElement.offsetWidth) !== lastWidth ||\n                (cachedHeight = newElement.offsetHeight) !== lastHeight) {\n        dirty = true;\n\n        lastWidth = cachedWidth;\n        lastHeight = cachedHeight;\n      }\n      reset();\n    };\n\n    const addEvent = (el, name, cb) => {\n      if (el.attachEvent) {\n        el.attachEvent(`on${name}`, cb);\n      } else {\n        el.addEventListener(name, cb);\n      }\n    };\n\n    addEvent(expand, 'scroll', onScroll);\n    addEvent(shrink, 'scroll', onScroll);\n  }\n\n  forEachElement(element, (elem) => {\n    attachResizeEvent(elem, callback);\n  });\n\n  this.detach = (ev) => {\n    L.ResizeSensor.detach(element, ev);\n  };\n};\n\nL.ResizeSensor.detach = (element, ev) => {\n  forEachElement(element, (elem) => {\n    const elementItem = elem;\n    if (elementItem.resizedAttached && typeof ev === 'function') {\n      elementItem.resizedAttached.remove(ev);\n      if (elementItem.resizedAttached.length()) return;\n    }\n    if (elementItem.resizeSensor) {\n      if (elementItem.contains(elementItem.resizeSensor)) {\n        elementItem.removeChild(elementItem.resizeSensor);\n      }\n      delete elementItem.resizeSensor;\n      delete elementItem.resizedAttached;\n    }\n  });\n};\n"}]).default}catch(e){console&&console.log&&console.log("eval erizo.js error:",e)}var n}).call(this,n(22))},257:function(e,t,n){
/*! AgoraRTC|BUILD v2.6.1-0-g01b3be9 */
window,e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=17)}([function(e,t,n){"use strict";n.r(t);var i=n(6),o=n.n(i),r=n(5),a=n(3),s=n(1),c=0,d="free",u=[],l=[],p=0;setInterval((function(){Object(a.getParameter)("UPLOAD_LOG")&&f.info("console log upload")}),9e5);var f=function(){var e,t,n,i,f,m,g="https://".concat(Object(a.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v1"),v=["DEBUG","INFO","WARNING","ERROR","NONE"],h=0,y=function e(t){d="uploading",setTimeout((function(){!function(e,t,n){var i;Array.isArray(e)||(e=[e]),e=e.map((function(e){return{log_item_id:c++,log_level:e.log_level,payload_str:e.payload}})),i={sdk_version:a.VERSION,process_id:Object(s.a)(),payload:JSON.stringify(e)};try{Object(r.c)(g,i,(function(e){"OK"===e?t&&t():n&&n()}),(function(e){n&&n()}),{withCredentials:!0})}catch(e){n&&n()}}(t,(function(){p=0,0!==u.length?(l=u.length<10?u.splice(0,u.length):u.splice(0,10),e(l)):d="free"}),(function(){setTimeout((function(){e(l)}),p++<2?200:1e4)}))}),3e3)};t=function(){for(var t=[0],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},n=function(){for(var t=[1],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},i=function(){for(var t=[2],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)},f=function(){for(var t=[3],n=0;n<arguments.length;n++)t.push(arguments[n]);e.apply(this,t)};var S={};return m=function(e){S[e]||(i.apply(void 0,arguments),S[e]=!0)},{DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4,enableLogUpload:function(){Object(a.setParameter)("UPLOAD_LOG",!0)},disableLogUpload:function(){Object(a.setParameter)("UPLOAD_LOG",!1)},setProxyServer:function(e){g=e?"https://".concat(e,"/ls/?h=").concat(Object(a.getParameter)("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Object(a.getParameter)("LOG_UPLOAD_SERVER"),"/upload/v1")},setLogLevel:function(e){e>4?e=4:e<0&&(e=0),h=e},log:e=function(){var e,t=arguments[0],n=arguments;if(n[0]=(e=new Date).toTimeString().split(" ")[0]+":"+e.getMilliseconds()+" Agora-SDK ["+(v[t]||"DEFAULT")+"]:",function(e,t){if(Object(a.getParameter)("UPLOAD_LOG"))try{t=Array.prototype.slice.call(t);var n="";t.forEach((function(e){"object"===o()(e)&&(e=JSON.stringify(e)),n=n+e+" "})),u.push({payload:n,log_level:e}),"free"===d&&(l=u.length<10?u.splice(0,u.length):u.splice(0,10),y(l))}catch(e){}}(t,n),!(t<h))switch(t){case 0:case 1:console.log.apply(console,n);break;case 2:console.warn.apply(console,n);break;case 3:console.error.apply(console,n);break;default:return void console.log.apply(console,n)}},debug:t,info:n,warning:i,deprecate:m,error:f}}();t.default=f},function(e,t,n){"use strict";var i=n(9),o=n.n(i),r=n(4),a=n.n(r),s=n(3),c=n(0),d=n(5),u=n(11),l=n.n(u);n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return m}));var p={eventType:null,sid:null,lts:null,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},f=null,m=function(){return f||(f="process-"+l()(),c.default.info("processId: "+f)),f},g=function(){var e={list:{}};e.url=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6080/events/message"),e.urlBackup=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6080/events/message"),e.setProxyServer=function(t){t?(e.url=Object(d.e)()?"https://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6443&d=events/message"):"http://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),"&p=6080&d=events/message"),e.urlBackup=Object(d.e)()?"https://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6443&d=events/message"):"http://".concat(t,"/rs/?h=").concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),"&p=6080&d=events/message"),c.default.debug("reportProxyServerURL: ".concat(e.url)),c.default.debug("reportProxyServerBackupURL: ".concat(e.urlBackup))):(e.url=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_DOMAIN"),":6080/events/message"),e.urlBackup=Object(d.e)()?"https://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6443/events/message"):"http://".concat(Object(s.getParameter)("EVENT_REPORT_BACKUP_DOMAIN"),":6080/events/message"))},e.sessionInit=function(t,n){var i=a()({},p);i.startTime=+new Date,i.sid=t,i.cname=n.cname,e.list[t]=i;var o=a()({},{willUploadConsoleLog:Object(s.getParameter)("UPLOAD_LOG")},n.extend),r=a()({},i);r.eventType="session_init",r.appid=n.appid,r.browser=navigator.userAgent,r.build=s.BUILD,r.lts=+new Date,r.elapse=r.lts-r.startTime,r.extend=JSON.stringify(o),r.mode=n.mode,r.process=m(),r.success=n.succ,r.version=s.VERSION,delete r.startTime,e.send({type:"io.agora.pb.Wrtc.Session",data:r}),e._flushInvokeReport(t)},e.joinChooseServer=function(t,n,i){n.uid&&(e.list[t].uid=parseInt(n.uid)),n.cid&&(e.list[t].cid=parseInt(n.cid));var o=a()({},e.list[t]);o.eventType="join_choose_server";var r=n.lts;o.lts=Date.now(),o.eventElapse=o.lts-r,o.chooseServerAddr=n.csAddr,o.errorCode=n.ec,o.elapse=o.lts-o.startTime,o.success=n.succ,o.chooseServerAddrList=JSON.stringify(n.serverList),delete o.startTime,e.send({type:"io.agora.pb.Wrtc.JoinChooseServer",data:o})},e.joinGateway=function(t,n){n.vid&&(e.list[t].vid=n.vid);var i=a()({},e.list[t]),o=n.lts;i.eventType="join_gateway",i.lts=Date.now(),i.gatewayAddr=n.addr,i.success=n.succ,i.errorCode=n.ec,i.elapse=i.lts-i.startTime,i.eventElapse=i.lts-o,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.JoinGateway",data:i})},e.publish=function(t,n){var i=a()({},e.list[t]);i.eventType="publish";var o=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.success=n.succ,i.errorCode=n.ec,n.videoName&&(i.videoName=n.videoName),n.audioName&&(i.audioName=n.audioName),n.screenName&&(i.screenName=n.screenName),delete i.startTime,e.send({type:"io.agora.pb.Wrtc.Publish",data:i}),e._flushInvokeReport(t)},e.subscribe=function(t,n){var i=a()({},e.list[t]);i.eventType="subscribe";var o=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.errorCode=n.ec,i.success=n.succ,isFinite(n.peerid)?i.peer=n.peerid:i.peerSuid=""+n.peerid,"boolean"==typeof n.video&&(i.video=n.video),"boolean"==typeof n.audio&&(i.audio=n.audio),delete i.startTime,e.send({type:"io.agora.pb.Wrtc.Subscribe",data:i}),e._flushInvokeReport(t)},e.firstRemoteFrame=function(t,n){var i=a()({},e.list[t]);i.eventType="first_remote_frame";var o=n.lts;i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.width=n.width,i.height=n.height,i.success=n.succ,i.errorCode=n.ec,isFinite(n.peerid)?i.peer=n.peerid:i.peerSuid=""+n.peerid,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.FirstFrame",data:i})},e.streamSwitch=function(t,n){var i=a()({},e.list[t]);i.eventType="stream_switch",i.lts=Date.now(),i.isDual=n.isdual,i.elapse=i.lts-i.startTime,i.success=i.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.StreamSwitch",data:i})},e.audioSendingStopped=function(t,n){var i=a()({},e.list[t]);i.eventType="audio_sending_stopped",i.lts=Date.now(),i.elapse=i.lts-i.startTime,i.reason=n.reason,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.AudioSendingStopped",data:i})},e.videoSendingStopped=function(t,n){var i=a()({},e.list[t]);i.eventType="video_sending_stopped",i.lts=Date.now(),i.elapse=i.lts-i.startTime,i.reson=n.reason,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.VideoSendingStopped",data:i})},e.requestProxyAppCenter=function(t,n){var i=a()({},e.list[t]),o=n.lts;i.eventType="request_proxy_appcenter",i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.extend=n.extend+"",i.APAddr=n.APAddr,i.workerManagerList=n.workerManagerList,i.response=n.response,i.errorCode=n.ec,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.RequestProxyAppCenter",data:i})},e.requestProxyWorkerManager=function(t,n){var i=a()({},e.list[t]),o=n.lts;i.eventType="request_proxy_worker_manager",i.lts=Date.now(),i.eventElapse=i.lts-o,i.elapse=i.lts-i.startTime,i.extend=n.extend,i.workerManagerAddr=n.workerManagerAddr,i.response=n.response,i.errorCode=n.ec,i.success=n.succ,delete i.startTime,e.send({type:"io.agora.pb.Wrtc.RequestProxyWorkerManager",data:i})};var t=0;return e.reportApiInvoke=function(e,n){var i=n.tag,r=n.name,a=n.getStates,s=n.options,c=n.timeout,d=void 0===c?6e4:c,u=n.callback,l=n.reportResult,p=void 0===l||l,f=Date.now(),m=0,v=t++,h=function(){return o()({tag:i,invokeId:v,sid:e,name:r,apiInvokeTime:f,options:s},a&&{states:(t=a(),Object.keys(t).reduce((function(e,n){var i=e;return null!=t[n]&&(i[n]=t[n]),i}),{}))});var t},y=setTimeout((function(){g._sendApiInvoke(o()({},h(),{error:"API_INVOKE_TIMEOUT",success:!1}))}),d);return function(e,t){if(clearTimeout(y),++m>1&&(e="EXECUTOR_INVOKE_".concat(m)),e)return g._sendApiInvoke(o()({},h(),{success:!1,error:e},a&&{states:a()})),u&&u(e);g._sendApiInvoke(o()({},h(),{success:!0},p&&{result:t},a&&{states:a()})),u&&u(null,t)}},e._cachedItems=[],e._cacheInvokeReport=function(t){t.lts||(t.lts=Date.now()),e._cachedItems.push(t),e._cachedItems.length>50&&e._cachedItems.shift()},e._flushInvokeReport=function(t){if(e._cachedItems.length){var n=e._cachedItems;e._cachedItems=[],c.default.debug("Flush cached event reporting:",n.length),n.forEach((function(n,i){n.sid=t,setTimeout((function(){e._sendApiInvoke(n)}),5e3+500*i)}))}},e._sendApiInvoke=function(t){var n=t.tag,i=t.invokeId,r=t.sid,a=t.name,c=t.result,d=t.states,u=t.options,l=t.error,p=t.success,f=t.apiInvokeTime,m=t.lts,g=Object(s.getParameter)("NOT_REPORT_EVENT");if(!(n&&g instanceof Array&&g.includes(n)))if(e.list[r]){var v=e.list[r],h=v.startTime,y=v.cname,S=v.uid,b=v.cid,I=(m=m||Date.now())-h,_=m-f,E=o()({invokeId:i,sid:r,cname:y,cid:b,lts:m,uid:S,success:p,elapse:I,apiName:a,execElapse:_},void 0!==u&&{options:JSON.stringify(u)},void 0!==d&&{execStates:JSON.stringify(d)},void 0!==l&&{errorCode:JSON.stringify(l)},void 0!==c&&{execResult:JSON.stringify(c)});e.send({type:"io.agora.pb.Wrtc.ApiInvoke",data:E})}else e._cacheInvokeReport(arguments[0])},e.send=function(t){try{Object(d.c)(e.url,t,null,(function(n){Object(d.c)(e.urlBackup,t,null,(function(e){}),{timeout:1e4})}),{timeout:1e4})}catch(e){}},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"getBrowserInfo",(function(){return v})),n.d(t,"getBrowserVersion",(function(){return p})),n.d(t,"getBrowserOS",(function(){return f})),n.d(t,"isChrome",(function(){return o})),n.d(t,"isSafari",(function(){return r})),n.d(t,"isFireFox",(function(){return a})),n.d(t,"isOpera",(function(){return s})),n.d(t,"isQQBrowser",(function(){return c})),n.d(t,"isWeChatBrowser",(function(){return d})),n.d(t,"isSupportedPC",(function(){return u})),n.d(t,"isSupportedMobile",(function(){return l})),n.d(t,"getChromeKernelVersion",(function(){return g})),n.d(t,"isChromeKernel",(function(){return m}));var i,o=function(){var e=v();return e.name&&"Chrome"===e.name},r=function(){var e=v();return e.name&&"Safari"===e.name},a=function(){var e=v();return e.name&&"Firefox"===e.name},s=function(){var e=v();return e.name&&"OPR"===e.name},c=function(){var e=v();return e.name&&"QQBrowser"===e.name},d=function(){var e=v();return e.name&&"MicroMessenger"===e.name},u=function(){var e=f();return"Linux"===e||"Mac OS X"===e||"Mac OS"===e||-1!==e.indexOf("Windows")},l=function(){var e=f();return"Android"===e||"iOS"===e},p=function(){return v().version},f=function(){return v().os},m=function(){return!!navigator.userAgent.match(/chrome\/[\d]./i)},g=function(){var e=navigator.userAgent.match(/chrome\/[\d]./i);return e&&e[0]&&e[0].split("/")[1]},v=(i=function(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];"Chrome"===n[1]&&null!=(e=t.match(/(OPR(?=\/))\/?(\d+)/i))&&(n=e),"Safari"===n[1]&&null!=(e=t.match(/version\/(\d+)/i))&&(n[2]=e[1]),~t.toLowerCase().indexOf("qqbrowser")&&null!=(e=t.match(/(qqbrowser(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("micromessenger")&&null!=(e=t.match(/(micromessenger(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("edge")&&null!=(e=t.match(/(edge(?=\/))\/?(\d+)/i))&&(n=e),~t.toLowerCase().indexOf("trident")&&null!=(e=/\brv[ :]+(\d+)/g.exec(t)||[])&&(n=[null,"IE",e[1]]);var i=void 0,o=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var r in o){var a=o[r];if(a.r.test(navigator.userAgent)){i=a.s;break}}return{name:n[1],version:n[2],os:i}}(),function(){return i})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUILD="v2.6.1-0-g01b3be9",t.VERSION="2.6.1",t.SUPPORT_RESOLUTION_LIST={"90p_1":[160,90],"120p_1":[160,120],"120p_3":[120,120],"120p_4":[212,120],"180p_1":[320,180],"180p_3":[180,180],"180p_4":[240,180],"240p_1":[320,240],"240p_3":[240,240],"240p_4":[424,240],"360p_1":[640,360],"360p_3":[360,360],"360p_4":[640,360],"360p_6":[360,360],"360p_7":[480,360],"360p_8":[480,360],"360p_9":[640,360],"360p_10":[640,360],"360p_11":[640,360],"480p_1":[640,480],"480p_2":[640,480],"480p_3":[480,480],"480p_4":[640,480],"480p_6":[480,480],"480p_8":[848,480],"480p_9":[848,480],"480p_10":[640,480],"720p_1":[1280,720],"720p_2":[1280,720],"720p_3":[1280,720],"720p_5":[960,720],"720p_6":[960,720],"1080p_1":[1920,1080],"1080p_2":[1920,1080],"1080p_3":[1920,1080],"1080p_5":[1920,1080],"1440p_1":[2560,1440],"1440p_2":[2560,1440],"4k_1":[3840,2160],"4k_3":[3840,2160]};const i={WEBCS_DOMAIN:["ap-web-1.agora.io","ap-web-2.agoraio.cn"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-3.agora.io","ap-web-4.agoraio.cn"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"webcollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"webcollector-2.agoraio.cn",WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,HTTP_CONNECT_TIMEOUT:5e3,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],FILEPATH_LENMAX:255};t.setParameter=(e,t)=>void 0!==i[e]&&(i[e]=t,!0),t.getParameter=e=>void 0!==i[e]?i[e]:null},function(e,t){function n(){return e.exports=n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n.apply(this,arguments)}e.exports=n},function(e,t,n){"use strict";n.d(t,"c",(function(){return u})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return d}));var i=n(3),o=n(7),r=0,a=0,s=function(){return r},c=function(){return a},d=function(){r=0,a=0},u=function(e,t,n,s,c){var d=new XMLHttpRequest;if(d.timeout=t.timeout||Object(i.getParameter)("HTTP_CONNECT_TIMEOUT"),d.open("POST",e,!0),d.setRequestHeader("Content-type","application/json; charset=utf-8"),c)for(var u in c)"withCredentials"==u?d.withCredentials=!0:d.setRequestHeader(u,c[u]);d.onload=function(e){a+=Object(o.e)(d.responseText),n&&n(d.responseText)},d.onerror=function(t){s&&s(t,e)},d.ontimeout=function(t){s&&s(t,e)};var l=JSON.stringify(t);r+=Object(o.e)(l),d.send(l)},l=function(){return"https:"==document.location.protocol}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=i=function(e){return n(e)}:e.exports=i=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},i(t)}e.exports=i},function(e,t,n){"use strict";n.d(t,"d",(function(){return v})),n.d(t,"b",(function(){return f})),n.d(t,"a",(function(){return p})),n.d(t,"h",(function(){return m})),n.d(t,"c",(function(){return g})),n.d(t,"g",(function(){return y})),n.d(t,"f",(function(){return b})),n.d(t,"e",(function(){return S}));var i=n(6),o=n.n(i),r=n(2),a=n(0),s=n(11),c=n.n(s),d=n(10),u=n(8),l=null,p=function(e){return this.audioContext=(l||(l=Object(d.a)()),l),this.sourceNode=e.otWebkitAudioSource||this.audioContext.createMediaStreamSource(e),this.analyser=this.audioContext.createAnalyser(),this.timeDomainData=new Uint8Array(this.analyser.frequencyBinCount),this.sourceNode.connect(this.analyser),this.getAudioLevel=function(){if(this.analyser){this.analyser.getByteTimeDomainData(this.timeDomainData);for(var e=0,t=0;t<this.timeDomainData.length;t++)e=Math.max(e,Math.abs(this.timeDomainData[t]-128));return e/128}return a.default.warning("can't find analyser in audioLevelHelper"),0},this};function f(){return c()().replace(/-/g,"").toUpperCase()}var m=function(e,t,n){try{var i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.setAttribute("playsinline",""),i.setAttribute("style","position: absolute; top: 0; left: 0; width:1px; high:1px;"),document.body.appendChild(i),i.addEventListener("playing",(function(e){r.isFireFox()?i.videoWidth&&(t(i.videoWidth,i.videoHeight),document.body.removeChild(i)):(t(i.videoWidth,i.videoHeight),document.body.removeChild(i))})),Object(u.c)(i,e)}catch(e){n(e)}},g=function(e){return"number"==typeof e&&0<=e&&e<=4294967295},v=function(e){var t=["lowLatency","userConfigExtraInfo","transcodingUsers"];for(var n in e)if("lowLatency"===n&&"boolean"!=typeof e[n]||"userConfigExtraInfo"===n&&"object"!==o()(e[n])||"transcodingUsers"===n&&!h(e[n])||!~t.indexOf(n)&&"number"!=typeof e[n])throw new Error("Param ["+n+"] is inValid");return!0},h=function(e){for(var t=0;t<e.length;t++)for(var n in e[t])if("number"!=typeof e[t][n])throw new Error("Param user["+t+"] - ["+n+"] is inValid");return!0},y=function(e){isNaN(e)&&(e=1e3);var t=+new Date,n=(t=(9301*t+49297)%233280)/233280;return Math.ceil(n*e)},S=function(e){var t=encodeURIComponent(e).match(/%[89ABab]/g);return e.length+(t?t.length:0)},b=function(){if(!document.getElementById("agora-ban-tip")){var e=document.createElement("div");e.id="agora-ban-tip",e.style="position: absolute; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #fff;",document.querySelector("body").prepend(e);var t=document.createElement("div");t.style="background: #000; width: 346px; height: 116px; z-index: 100000; opacity: 0.6; border-radius: 10px; box-shadow: 0 2px 4px #000;",e.append(t);var n=document.createElement("div");n.style="height: 76px; display: flex; justify-content: center; align-items: center;";var i=document.createElement("span");i.style="height: 28px; width: 28px; color: #000; text-align: center; line-height: 30px; background: #fff; border-radius: 50%; font-weight: 600; font-size: 20px;margin-right: 5px;",i.innerText="!";var o=document.createElement("span");o.innerText="This browser does not support webRTC",n.append(i),n.append(o);var r=document.createElement("div");r.style="height: 38px; display: flex; border-top: #fff 1px solid; justify-content: center; align-items: center;",r.innerText="OK",t.append(n),t.append(r),r.onclick=function(){var e=document.getElementById("agora-ban-tip");e.parentNode.removeChild(e)}}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return u}));var i,o=n(6),r=n.n(o),a=null,s=null,c=null,d=null,u=null,l=null,p={addStream:null},f=function(){},m=function(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n])};if("object"==("undefined"==typeof window?"undefined":r()(window))?(u=!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype?function(e,t){e.srcObject=t}:function(e,t){"mozSrcObject"in e?e.mozSrcObject=t:(e._srcObject=t,e.src=t?URL.createObjectURL(t):null)},a=window.navigator&&window.navigator.getUserMedia):u=function(e,t){e.srcObject=t},s=function(e,t){u(e,t)},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){for(var g in f("This appears to be Firefox"),c=m(navigator.userAgent,/Firefox\/([0-9]+)\./,1),l=mozRTCPeerConnection,p)p[g]=l.prototype[g];if(d=function(e,t){if(c<38&&e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];if(o.hasOwnProperty("urls"))for(var r=0;r<o.urls.length;r++){var a={url:o.urls[r]};0===o.urls[r].indexOf("turn")&&(a.username=o.username,a.credential=o.credential),n.push(a)}else n.push(e.iceServers[i])}e.iceServers=n}var s=new l(e,t);for(var d in p)s[d]=p[d];return s},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),a=function(e,t,n){var i=function(e){if("object"!==r()(e)||e.require)return e;var t=[];return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i=e[n]="object"===r()(e[n])?e[n]:{ideal:e[n]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(n),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[n]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof i.ideal?o[n]={min:i.ideal,max:i.ideal}:o[n]=i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[n]}}})),t.length&&(e.require=t),e};return c<38&&(f("spec: "+JSON.stringify(e)),e.audio&&(e.audio=i(e.audio)),e.video&&(e.video=i(e.video)),f("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:S,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise((function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])}))},c<41){var v=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return v().then(void 0,(function(e){if("NotFoundError"===e.name)return[];throw e}))}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){for(var g in f("This appears to be Chrome"),c=m(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),l=webkitRTCPeerConnection,p)p[g]=l.prototype[g];d=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new l(e,t);for(var i in p)n[i]=p[i];var o=n.getStats.bind(n);return n.getStats=function(e,t,n){var i=this,r=arguments;if(arguments.length>0&&"function"==typeof e)return o(e,t);var a=function(e){var t={};return e.result().forEach((function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach((function(t){n[t]=e.stat(t)})),t[n.id]=n})),t};return arguments.length>=2?o.apply(this,[function(e){r[1](a(e))},arguments[0]]):new Promise((function(t,n){1===r.length&&null===e?o.apply(i,[function(e){t.apply(null,[a(e)])},n]):o.apply(i,[t,n])}))},n},["createOffer","createAnswer"].forEach((function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===r()(arguments[0])){var n=1===arguments.length?arguments[0]:void 0;return new Promise((function(i,o){t.apply(e,[i,o,n])}))}return t.apply(this,arguments)}})),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise((function(i,o){t.apply(n,[e[0],function(){i(),e.length>=2&&e[1].apply(null,[])},function(t){o(t),e.length>=3&&e[2].apply(null,[t])}])}))}}));var h=function(e){if("object"!==r()(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===r()(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var a={};"number"==typeof i.ideal?(a[o("min",n)]=i.ideal,t.optional.push(a),(a={})[o("max",n)]=i.ideal,t.optional.push(a)):(a[o("",n)]=i.ideal,t.optional.push(a))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",n)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,n)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(a=function(e,t,n){return e.audio&&(e.audio=h(e.audio)),e.video&&(e.video=h(e.video)),f("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=a,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:S,enumerateDevices:function(){return new Promise((function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources((function(n){e(n.map((function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}})))}))}))}}),navigator.mediaDevices.getUserMedia){var y=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return f("spec:   "+JSON.stringify(e)),e.audio=h(e.audio),e.video=h(e.video),f("chrome: "+JSON.stringify(e)),y(e)}}else navigator.mediaDevices.getUserMedia=function(e){return S(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){f("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){f("Dummy mediaDevices.removeEventListener called.")}),s=function(e,t){c>=43?u(e,t):void 0!==e.src?e.src=t?URL.createObjectURL(t):null:f("Error attaching stream to element.")}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(f("This appears to be Edge"),c=m(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2)):f("Browser does not appear to be WebRTC-capable");else f("This does not appear to be a browser");function S(e){return new Promise((function(t,n){a(e,t,n)}))}try{Object.defineProperty({},"version",{set:function(e){c=e}})}catch(e){}d?i=d:"undefined"!=typeof window&&(i=window.RTCPeerConnection)},function(e,t,n){var i=n(15);e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},o=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),o.forEach((function(t){i(e,t,n[t])}))}return e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var i=window.AudioContext||window.webkitAudioContext,o=function(){if(i)return new i;throw new Error("AUDIO_CONTEXT_NOT_SUPPORTED")}},function(e,t,n){var i=n(13),o=n(14);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||i)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[r+s]=a[s];return t||o(a)}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,s)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(16),r=n(2),a=n(0);t.getSupportedCodec=e=>i(this,void 0,void 0,(function*(){const t={video:[],audio:[]};if("undefined"==typeof window){const e="NOT_BROWSER_ENV";return a.default.error(`getSupportedCodec: ${e}`),Promise.reject(e)}{let n;try{n=o.createRTCPeerConnection({iceServers:[]})}catch(e){return a.default.error("Failed to init RTCPeerConnection",e),Promise.reject(e)}if(n){if(e&&e.stream){let t;e.stream.getTracks&&n.addTrack?e.stream.getTracks().forEach(t=>{n.addTrack(t,e.stream)}):n.addStream(e.stream),t=r.isSafari()||r.isFireFox()?yield n.createOffer():yield new Promise((e,t)=>{n.createOffer(e,t)}),n.close();const i=t.sdp;return s(i)}{const e={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}};let t;(r.isSafari()||r.isFireFox()||r.isWeChatBrowser())&&n.addTransceiver?(n.addTransceiver("audio"),n.addTransceiver("video"),t=yield n.createOffer()):t=yield new Promise((t,i)=>{const o=setTimeout(()=>{i("CREATEOFFER_TIMEOUT")},3e3);n.createOffer(e=>{clearTimeout(o),t(e)},e=>{clearTimeout(o),i(e)},e)}),n.close();const i=t.sdp;return s(i)}}return a.default.warning("getSupportedCodec: no RTCPeerConnection constructor is detected"),Promise.resolve(t)}}));const s=e=>{const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ opus/i)&&t.audio.push("OPUS"),Promise.resolve(t)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,o=n;return[o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]]].join("")}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i="object"==typeof window&&window.RTCPeerConnection,o="object"==typeof window&&window.webkitRTCPeerConnection,r="object"==typeof window&&window.mozRTCPeerConnection;t.createRTCPeerConnection=e=>{const t=i||o||r;return t?new t(e):null}},function(e,t,n){"use strict";n.r(t);var i=n(3),o=n(0),r=n(1),a=function(){var e={dispatcher:{}};return e.dispatcher.eventListeners={},e.addEventListener=function(t,n){void 0===e.dispatcher.eventListeners[t]&&(e.dispatcher.eventListeners[t]=[]),e.dispatcher.eventListeners[t].push(n)},e.hasListeners=function(t){return!(!e.dispatcher.eventListeners[t]||!e.dispatcher.eventListeners[t].length)},e.on=e.addEventListener,e.removeEventListener=function(t,n){var i;-1!==(i=e.dispatcher.eventListeners[t].indexOf(n))&&e.dispatcher.eventListeners[t].splice(i,1)},e.dispatchEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t)},e.dispatchSocketEvent=function(t){var n;for(n in e.dispatcher.eventListeners[t.type])e.dispatcher.eventListeners[t.type]&&e.dispatcher.eventListeners[t.type].hasOwnProperty(n)&&"function"==typeof e.dispatcher.eventListeners[t.type][n]&&e.dispatcher.eventListeners[t.type][n](t.msg)},e},s=function(e){var t={};return t.type=e.type,t},c=function(e){var t=s(e);return t.stream=e.stream,t.reason=e.reason,t.msg=e.msg,t},d=function(e){var t=s(e);return t.uid=e.uid,t.attr=e.attr,t.stream=e.stream,t},u=function(e){var t=s(e);return t.msg=e.msg,t},l=function(e){var t=s(e);return t.url=e.url,t.uid=e.uid,t.status=e.status,t.reason=e.reason,t},p=n(2),f=function(){};f.prototype.set=function(e,t){["BatteryLevel"].indexOf(e)>-1&&(this[e]=t)};var m=new function(){var e=a();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.batteryManager=null,e._init=function(t,n){e.state=e.states.INITING,navigator.getBattery?navigator.getBattery().then((function(n){e.batteryManager=n,t&&setTimeout((function(){t()}),0)})).catch((function(e){o.default.debug("navigator.getBattery is disabled",e),t&&t()})):(e.state=e.states.INITED,t&&t())},e._getBatteryStats=function(){var t={};return e.batteryManager&&e.batteryManager.level?t.BatteryLevel=Math.floor(100*e.batteryManager.level):t.BatteryLevel="UNSUPPORTED",t},e.getStats=function(t,n){var i=new f,o=e._getBatteryStats();o&&o.BatteryLevel&&i.set("BatteryLevel",o.BatteryLevel),t&&t(i)},e._init(),e},g=n(6),v=n.n(g),h=n(4),y=n.n(h),S=n(8),b={101100:"NO_FLAG_SET",101101:"FLAG_SET_BUT_EMPTY",101102:"INVALID_FALG_SET",101203:"NO_SERVICE_AVIABLE",0:"OK_CODE",5:"INVALID_VENDOR_KEY",7:"INVALID_CHANNEL_NAME",8:"INTERNAL_ERROR",9:"NO_AUTHORIZED",10:"DYNAMIC_KEY_TIMEOUT",11:"NO_ACTIVE_STATUS",13:"DYNAMIC_KEY_EXPIRED",14:"STATIC_USE_DYANMIC_KEY",15:"DYNAMIC_USE_STATIC_KEY"},I={2e3:"ERR_NO_VOCS_AVAILABLE",2001:"ERR_NO_VOS_AVAILABLE",2002:"ERR_JOIN_CHANNEL_TIMEOUT",2003:"WARN_REPEAT_JOIN",2004:"ERR_JOIN_BY_MULTI_IP",101:"ERR_INVALID_VENDOR_KEY",102:"ERR_INVALID_CHANNEL_NAME",103:"WARN_NO_AVAILABLE_CHANNEL",104:"WARN_LOOKUP_CHANNEL_TIMEOUT",105:"WARN_LOOKUP_CHANNEL_REJECTED",106:"WARN_OPEN_CHANNEL_TIMEOUT",107:"WARN_OPEN_CHANNEL_REJECTED",108:"WARN_REQUEST_DEFERRED",109:"ERR_DYNAMIC_KEY_TIMEOUT",110:"ERR_NO_AUTHORIZED",111:"ERR_VOM_SERVICE_UNAVAILABLE",112:"ERR_NO_CHANNEL_AVAILABLE_CODE",113:"ERR_TOO_MANY_USERS",114:"ERR_MASTER_VOCS_UNAVAILABLE",115:"ERR_INTERNAL_ERROR",116:"ERR_NO_ACTIVE_STATUS",117:"ERR_INVALID_UID",118:"ERR_DYNAMIC_KEY_EXPIRED",119:"ERR_STATIC_USE_DYANMIC_KE",120:"ERR_DYNAMIC_USE_STATIC_KE",2:"K_TIMESTAMP_EXPIRED",3:"K_CHANNEL_PERMISSION_INVALID",4:"K_CERTIFICATE_INVALID",5:"K_CHANNEL_NAME_EMPTY",6:"K_CHANNEL_NOT_FOUND",7:"K_TICKET_INVALID",8:"K_CHANNEL_CONFLICTED",9:"K_SERVICE_NOT_READY",10:"K_SERVICE_TOO_HEAVY",14:"K_UID_BANNED",15:"K_IP_BANNED",16:"K_CHANNEL_BANNED"},_=["NO_SERVICE_AVIABLE"],E={19:"ERR_ALREADY_IN_USE",10:"ERR_TIMEDOUT",3:"ERR_NOT_READY",9:"ERR_NO_PERMISSION",0:"UNKNOW_ERROR"},C="INVALID_CLIENT_MODE",T="INVALID_CLIENT_CODEC",w="CLIENT_MODE_CODEC_MISMATCH",R="WEB_API_NOT_SUPPORTED",A="INVALID_PARAMETER",O="INVALID_OPERATION",k="INVALID_LOCAL_STREAM",D="INVALID_REMOTE_STREAM",N="STREAM_ALREADY_PUBLISHED",x="STREAM_NOT_YET_PUBLISHED",M="SOCKET_ERROR",P="SOCKET_DISCONNECTED",L="PEERCONNECTION_FAILED",V="JOIN_CHANNEL_FAILED",j="PUBLISH_STREAM_FAILED",F="SUBSCRIBE_STREAM_FAILED",B="UNSUBSCRIBE_STREAM_FAILED",U="NO_SUCH_REMOTE_STREAM",W="IOS_NOT_SUPPORT",G="WECHAT_NOT_SUPPORT",H="SHARING_SCREEN_NOT_SUPPORT",z="STILL_ON_PUBLISHING",q="LOW_STREAM_ALREADY_PUBLISHED",J="LOW_STREAM_ALREADY_PUBLISHED",K="HIGH_STREAM_NOT_VIDEO_TRACE",Y="NOT_FIND_DEVICE_BY_LABEL",X="ENABLE_DUALSTREAM_FAILED",Q="DISABLE_DUALSTREAM_FAILED",$="PLAYER_NOT_FOUND",Z="BAD_ENVIRONMENT",ee=function(e){var t=function(e){var t=a();return t.url=".",t}();t.id=e.id,t.fit=e.options&&e.options.fit,"contain"!==t.fit&&"cover"!==t.fit&&(t.fit=null),t.url=e.url,t.stream=e.stream.stream,t.elementID=e.elementID,t.setAudioOutput=function(e,n,i){var r=t.video||t.audio;return r?r.setSinkId?void r.setSinkId(e).then((function(){return o.default.debug("["+t.id+"] "+"video ".concat(t.id," setAudioOutput ").concat(e," SUCCESS")),r==t.video&&t.audio?t.audio.setSinkId(e):Promise.resolve()})).then((function(){return o.default.debug("["+t.id+"] "+"audio ".concat(t.id," setAudioOutput ").concat(e," SUCCESS")),n&&n()})).catch((function(e){return o.default.error("["+t.id+"] VideoPlayer.setAudioOutput",e),i&&i(e)})):(o.default.error("["+t.id+"] ",R),i&&i(R)):(o.default.error("["+t.id+"] ",$),i&&i($))},t.destroy=function(){Object(S.c)(t.video,null),Object(S.c)(t.audio,null),t.video.pause(),delete t.resizer,document.getElementById(t.div.id)&&t.parentNode.contains(t.div)&&t.parentNode.removeChild(t.div)},t.div=document.createElement("div"),t.div.setAttribute("id","player_"+t.id),e.stream.video?t.div.setAttribute("style","width: 100%; height: 100%; position: relative; background-color: black; overflow: hidden;"):t.div.setAttribute("style","width: 100%; height: 100%; position: relative; overflow: hidden;"),t.video=document.createElement("video"),t.video.setAttribute("id","video"+t.id),e.stream.local&&!e.stream.screen?e.stream.mirror?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; transform: rotateY(180deg); object-fit: ".concat(t.fit||"cover",";")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):e.stream.video?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"cover",";")):e.stream.screen?t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; object-fit: ".concat(t.fit||"contain")):t.video.setAttribute("style","width: 100%; height: 100%; position: absolute; display: none; object-fit: ".concat(t.fit||"cover"));var n={autoplay:!0,muted:!!e.stream.local||!(!p.isSafari()&&"iOS"!==p.getBrowserOS())&&"video_element_muted",playsinline:!0,controls:!(!p.isSafari()&&"iOS"!==p.getBrowserOS()||e.stream.local),volume:null},i=y()({},n,e.options);if(!0!==i.muted||i.volume||(i.volume=0),i.autoplay&&t.video.setAttribute("autoplay",""),!0!==i.muted&&"video_element_muted"!==i.muted||(t.video.setAttribute("muted",""),t.video.muted=!0),i.playsinline&&t.video.setAttribute("playsinline",""),i.controls&&t.video.setAttribute("controls",""),Number.isFinite(i.volume)&&(t.video.volume=i.volume),t.audio=document.createElement("audio"),t.audio.setAttribute("id","audio"+t.id),i.autoplay&&t.audio.setAttribute("autoplay",""),!0===i.muted&&t.audio.setAttribute("muted",""),!0===i.muted&&(t.audio.muted=!0),i.playsinline&&t.audio.setAttribute("playsinline",""),Number.isFinite(i.volume)&&(t.audio.volume=i.volume),void 0!==t.elementID?(document.getElementById(t.elementID).appendChild(t.div),t.container=document.getElementById(t.elementID)):(document.body.appendChild(t.div),t.container=document.body),t.parentNode=t.div.parentNode,t.video.addEventListener("playing",(function(e){!function e(){t.video.videoWidth*t.video.videoHeight>4?o.default.debug("["+t.id+"] video dimensions:",t.video.videoWidth,t.video.videoHeight):setTimeout(e,50)}()})),e.stream.hasVideo()||e.stream.hasScreen())t.div.appendChild(t.video),t.div.appendChild(t.audio),Object(S.b)(t.video,e.stream.stream),Object(S.b)(t.audio,e.stream.stream);else if(!1!==i.muted&&"video_element_muted"!==i.muted||(t.video.removeAttribute("muted"),t.video.muted=!1,t.div.appendChild(t.video)),window.MediaStream&&p.isSafari()){var r=new MediaStream(e.stream.stream.getAudioTracks());Object(S.c)(t.video,r)}else Object(S.c)(t.video,e.stream.stream);return t.setAudioVolume=function(e){var n=parseInt(e)/100;isFinite(n)&&(n<0?n=0:n>1&&(n=1),t.video&&(t.video.volume=n),t.audio&&(t.audio.volume=n))},t},te=function(e){var t={},n=S.a;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.pc_config={iceServers:[{url:"stun:webcs.agora.io:3478"}]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map((function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,url:e.url})})):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103;try{t.pc_config.sdpSemantics="plan-b",t.peerConnection=new n(t.pc_config,t.con)}catch(e){delete t.pc_config.sdpSemantics,t.peerConnection=new n(t.pc_config,t.con)}t.peerConnection.onicecandidate=function(e){var n,i,r,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),r=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout((function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),1e3)),null===i&&null===r&&null===a||void 0!==t.ice||(o.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+r),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},o.default.debug("["+t.clientId+']Created webkitRTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".');var i=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},r=function(n){var i,r;if(e.minVideoBW&&e.maxVideoBW){r=(i=n.match(/m=video.*\r\n/))[0]+"b=AS:"+e.maxVideoBW+"\r\n";var a=0,s=0;"h264"===e.codec?(a=n.search(/a=rtpmap:(\d+) H264\/90000\r\n/),s=n.search(/H264\/90000\r\n/)):"vp8"===e.codec&&(a=n.search(/a=rtpmap:(\d+) VP8\/90000\r\n/),s=n.search(/VP8\/90000\r\n/)),-1!==a&&-1!==s&&s-a>10&&(r=r+"a=fmtp:"+n.slice(a+9,s-1)+" x-google-min-bitrate="+e.minVideoBW+"\r\n"),n=n.replace(i[0],r),o.default.debug("["+t.clientId+"]Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)}return e.maxAudioBW&&(r=(i=n.match(/m=audio.*\r\n/))[0]+"b=AS:"+e.maxAudioBW+"\r\n",n=n.replace(i[0],r)),n};return t.processSignalingMessage=function(e){var n,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=r(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(n={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=r(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))},t.getVideoRelatedStats=function(e){t.peerConnection.getStats(null,(function(n){Object.keys(n).forEach((function(i){var o=n[i];t.isSubscriber?"video"===o.mediaType&&o.id&&~o.id.indexOf("recv")&&e&&e({mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:o.googFrameRateReceived,frameRateDecoded:o.googFrameRateDecoded,bytesReceived:o.bytesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost}):"video"===o.mediaType&&o.id&&~o.id.indexOf("send")&&e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:o.googFrameRateInput,frameRateSent:o.googFrameRateSent,googRtt:o.googRtt})}))}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats(null,(function(n){Object.keys(n).forEach((function(i){var o=n[i];t.isSubscriber&&"audio"===o.mediaType&&o.id&&~o.id.indexOf("recv")&&e&&e({mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:parseInt(o.googDecodingPLC)+parseInt(o.googDecodingPLCCNG)+"",frameReceived:o.googDecodingCTN,googJitterReceived:o.googJitterReceived,bytesReceived:o.bytesReceived,packetsReceived:o.packetsReceived,packetsLost:o.packetsLost})}))}))},t.getStatsRate=function(e){t.getStats((function(t){e(t)}))},t.getStats=function(e){t.peerConnection.getStats(null,(function(n){var i=[],o=[],r=null;Object.keys(n).forEach((function(e){var t=n[e];o.push(t),"ssrc"!==t.type&&"VideoBwe"!==t.type||(r=t.timestamp,i.push(t))})),i.push({id:"time",startTime:t.connectedTime,timestamp:r||new Date}),e(i,o)}))},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){t.peerConnection.removeTrack(t.peerConnection.getSenders().find((function(t){return t.track==e})))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var e;if(t.actionNeeded){if("new"===t.state||"established"===t.state)t.peerConnection.createOffer((function(e){if(e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();o.default.debug("["+t.clientId+"]Not sending a new offer")}),(function(e){o.default.debug("["+t.clientId+"]peer connection create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;o.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){o.default.debug("["+t.clientId+"]peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;e=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&(t.onaddstream(e,"ontrack"),t.peerConnection.onaddstream=null)},t.peerConnection.onaddstream=function(e){t.onaddstream&&(t.onaddstream(e,"onaddstream"),t.peerConnection.ontrack=null)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.peerConnection.onnegotiationneeded=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then((function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),e.sdp=i(e.sdp),e.sdp=r(e.sdp),t.peerConnection.setLocalDescription(e)})).then((function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)})).catch((function(e){console.log("createOffer error: ",e)}))},t.onaddstream=null,t.onremovestream=null,t.onnegotiationneeded=null,t.state="new",t.markActionNeeded(),t},ne=null,ie=function(){try{ne=window.require("electron")}catch(e){}return ne},oe=function(e){var t=r.b.reportApiInvoke(null,{callback:e,name:"getScreenSources",options:arguments,tag:"tracer"}),n=ie();if(!n)return t&&t("electron is null");n.desktopCapturer.getSources({types:["window","screen"]},(function(e,n){if(e)return t&&t(e);t&&t(null,n)}))},re=function(e,t,n){var i=t.attributes.width;t={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:t.attributes.height,maxWidth:i,maxFrameRate:t.attributes.maxFr,minFrameRate:t.attributes.minFr}}},navigator.webkitGetUserMedia(t,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}))},ae=oe,se=re,ce=103,de=function(e){var t={};if(t.clientId=e.clientId,e.session_id=ce+=1,"undefined"!=typeof window&&window.navigator)if(null!==window.navigator.userAgent.match("Firefox"))t.browser="mozilla",t=p.getBrowserVersion()>=66?function(e){var t={},n=(mozRTCPeerConnection,mozRTCSessionDescription),i=!1;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.pc_config={iceServers:[]},e.iceServers instanceof Array?e.iceServers.map((function(e){0===e.url.indexOf("stun:")&&t.pc_config.iceServers.push({url:e.url})})):(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay"))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0},t.roapSessionId=103,t.peerConnection=new S.a(t.pc_config),o.default.debug("["+t.clientId+']safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.peerConnection.onicecandidate=function(e){var n,i,r,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),r=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout((function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),1e3)),null===i&&null===r&&null===a||void 0!==t.ice||(o.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+r),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},t.checkMLineReverseInSDP=function(e){return!(!~e.indexOf("m=audio")||!~e.indexOf("m=video"))&&e.indexOf("m=audio")>e.indexOf("m=video")},t.reverseMLineInSDP=function(e){var t=e.split("m=audio"),n=t[1].split("m=video"),i="m=video"+n[1],o="m=audio"+n[0];return t[0]+i+o},t.processSignalingMessage=function(e){var i,r=JSON.parse(e);t.incomingMessage=r,"new"===t.state?"OFFER"===r.messageType?(r.sdp=u(r.sdp),i={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===r.messageType?(r.sdp=u(r.sdp),r.sdp=r.sdp.replace(/ generation 0/g,""),r.sdp=r.sdp.replace(/ udp /g," UDP "),-1!==r.sdp.indexOf("a=group:BUNDLE")?(r.sdp=r.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),r.sdp=r.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),r.sdp=r.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(r.sdp=r.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),r.sdp=r.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),i={sdp:r.sdp,type:"answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e)})),t.sendOK(),t.state="established"):"pr-answer"===r.messageType?(i={sdp:r.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)}))):"offer"===r.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===r.messageType?(i={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state))};var r={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},a={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},s={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},c={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},d=0;t.getVideoRelatedStats=function(e){t.peerConnection.getStats().then((function(n){var i=!0,o=!1,r=void 0;try{for(var a,s=n.values()[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;if(t.isSubscriber){if(("inbound-rtp"===c.type||"inboundrtp"===c.type)&&"video"===c.mediaType){if(!t.lastReport)return void(t.lastReport=c);e&&e({browser:"firefox",mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:c.framerateMean+"",frameRateDecoded:c.framesDecoded-t.lastReport.framesDecoded+"",bytesReceived:c.bytesReceived+"",packetsReceived:c.packetsReceived+"",packetsLost:c.packetsLost+""}),t.lastReport=c}}else if(("outbound-rtp"===c.type||"outboundrtp"===c.type)&&"video"===c.mediaType){if(!t.lastReport)return void(t.lastReport=c);e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:c.framerateMean+"",frameRateSent:c.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=c}}}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){var i=!0,o=!1,r=void 0;try{for(var a,s=n.values()[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var c=a.value;t.isSubscriber&&("inbound-rtp"!==c.type&&"inboundrtp"!==c.type||"audio"!==c.mediaType||e&&e({browser:"firefox",mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:c.packetsLost+"",frameReceived:c.packetsReceived+"",googJitterReceived:c.jitter+"",bytesReceived:c.bytesReceived+"",packetsReceived:c.packetsReceived+"",packetsLost:c.packetsLost+""}))}}catch(e){o=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){"inbound-rtp"!==e.type&&"inboundrtp"!==e.type||"video"!==e.mediaType||e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-d)/3).toString(),d=e.googFramesDecoded)})),e(t)}))},t.getStats=function(e){t.peerConnection.getStats().then((function(n){var i=[],o=!0,d=!1,u=void 0;try{for(var l,p=n.values()[Symbol.iterator]();!(o=(l=p.next()).done);o=!0){var f=l.value;i.push(f),"outbound-rtp"!==f.type&&"outboundrtp"!==f.type||"video"!==f.mediaType||-1!==f.id.indexOf("rtcp")||(a.id=f.id,a.type=f.type,a.mediaType=f.mediaType,a.bytesSent=f.bytesSent?f.bytesSent+"":"0",a.packetsSent=f.packetsSent?f.packetsSent+"":"0",a.googPlisReceived=f.pliCount?f.pliCount+"":"0",a.googNacksReceived=f.nackCount?f.nackCount+"":"0",a.googFirsReceived=f.firCount?f.firCount+"":"0",a.googFrameRateSent=f.framerateMean?f.framerateMean+"":"0"),"outbound-rtp"!==f.type&&"outboundrtp"!==f.type||"audio"!==f.mediaType||-1!==f.id.indexOf("rtcp")||(r.id=f.id,r.type=f.type,r.mediaType=f.mediaType,r.bytesSent=f.bytesSent?f.bytesSent+"":"0",r.packetsSent=f.packetsSent?f.packetsSent+"":"0"),"inbound-rtp"!==f.type&&"inboundrtp"!==f.type||"audio"!==f.mediaType||f.isRemote||-1!==f.id.indexOf("rtcp")||(s.id=f.id,s.type=f.type,s.mediaType=f.mediaType,s.bytesReceived=f.bytesReceived?f.bytesReceived+"":"0",s.packetsLost=f.packetsLost?f.packetsLost+"":"0",s.packetsReceived=f.packetsReceived?f.packetsReceived+"":"0",s.googJitterReceived=f.jitter?f.jitter+"":"0"),"inbound-rtp"!==f.type&&"inboundrtp"!==f.type||"video"!==f.mediaType||f.isRemote||-1!==f.id.indexOf("rtcp")||(c.id=f.id,c.type=f.type,c.mediaType=f.mediaType,c.bytesReceived=f.bytesReceived?f.bytesReceived+"":"0",c.googFrameRateReceived=f.framerateMean?f.framerateMean+"":"0",c.googFramesDecoded=f.framesDecoded?f.framesDecoded+"":"0",c.packetsLost=f.packetsLost?f.packetsLost+"":"0",c.packetsReceived=f.packetsReceived?f.packetsReceived+"":"0",c.googJitterBufferMs=f.jitter?f.jitter+"":"0",c.googNacksSent=f.nackCount?f.nackCount+"":"0",c.googPlisSent=f.pliCount?f.pliCount+"":"0",c.googFirsSent=f.firCount?f.firCount+"":"0"),-1!==f.id.indexOf("outbound_rtcp_video")&&(a.packetsLost=f.packetsLost?f.packetsLost+"":"0")}}catch(e){d=!0,u=e}finally{try{o||null==p.return||p.return()}finally{if(d)throw u}}var m=[a,r,s,c];m.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(m,i)}),(function(e){o.default.error("["+t.clientId+"]"+e)}))},t.addStream=function(e){i=!0,t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)i&&(t.mediaConstraints=void 0),t.peerConnection.createOffer((function(e){if(e.sdp=u(e.sdp),e.sdp=e.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();o.default.debug("["+t.clientId+"]Not sending a new offer")}),(function(e){o.default.debug("["+t.clientId+"]Ups! create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;o.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(){o.default.debug("["+t.clientId+"]Ups! Something went wrong")}));else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;var e=t.peerConnection.localDescription.sdp;t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var u=function(t){var n;if(e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0)){var i=n[0]+"b=TIAS:"+1e3*e.maxVideoBW+"\r\n";t=t.replace(n[0],i)}return e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0)&&(i=n[0]+"b=TIAS:"+1e3*e.maxAudioBW+"\r\n",t=t.replace(n[0],i)),t};return t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e):function(e){var t={},n=(mozRTCPeerConnection,mozRTCSessionDescription),i=!1;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.pc_config={iceServers:[]},e.iceServers instanceof Array?e.iceServers.map((function(e){0===e.url.indexOf("stun:")&&t.pc_config.iceServers.push({url:e.url})})):(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:"turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay"))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={offerToReceiveAudio:e.audio,offerToReceiveVideo:e.video,mozDontOfferDataChannel:!0},t.roapSessionId=103,t.peerConnection=new S.a(t.pc_config),o.default.debug("["+t.clientId+']safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.peerConnection.onicecandidate=function(e){var n,i,r,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),r=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout((function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),1e3)),null===i&&null===r&&null===a||void 0!==t.ice||(o.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+r),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1},t.checkMLineReverseInSDP=function(e){return!(!~e.indexOf("m=audio")||!~e.indexOf("m=video"))&&e.indexOf("m=audio")>e.indexOf("m=video")},t.reverseMLineInSDP=function(e){var t=e.split("m=audio"),n=t[1].split("m=video"),i="m=video"+n[1],o="m=audio"+n[0];return t[0]+i+o},t.processSignalingMessage=function(e){var i,r=JSON.parse(e);t.incomingMessage=r,"new"===t.state?"OFFER"===r.messageType?(r.sdp=u(r.sdp),i={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===r.messageType?(r.sdp=u(r.sdp),r.sdp=r.sdp.replace(/ generation 0/g,""),r.sdp=r.sdp.replace(/ udp /g," UDP "),-1!==r.sdp.indexOf("a=group:BUNDLE")?(r.sdp=r.sdp.replace(/a=group:BUNDLE audio video/,"a=group:BUNDLE sdparta_0 sdparta_1"),r.sdp=r.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),r.sdp=r.sdp.replace(/a=mid:video/,"a=mid:sdparta_1")):(r.sdp=r.sdp.replace(/a=mid:audio/,"a=mid:sdparta_0"),r.sdp=r.sdp.replace(/a=mid:video/,"a=mid:sdparta_0")),i={sdp:r.sdp,type:"answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e)})),t.sendOK(),t.state="established"):"pr-answer"===r.messageType?(i={sdp:r.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)}))):"offer"===r.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===r.messageType?(i={sdp:r.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new n(i),(function(){o.default.debug("["+t.clientId+"]setRemoteDescription succeeded")}),(function(e){o.default.info("["+t.clientId+"]setRemoteDescription failed: "+e.name)})),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+r.messageType+" in state "+t.state))};var r={id:"",type:"",mediaType:"opus",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},a={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0"},s={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},c={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0",googFramesDecoded:"0"},d=0;t.getVideoRelatedStats=function(e){t.peerConnection.getStats().then((function(n){Object.keys(n).forEach((function(i){var o=n[i];if(t.isSubscriber){if("inboundrtp"===o.type&&"video"===o.mediaType){if(!t.lastReport)return void(t.lastReport=o);e&&e({browser:"firefox",mediaType:"video",peerId:t.uid,isVideoMute:t.isVideoMute,frameRateReceived:o.framerateMean+"",frameRateDecoded:o.framesDecoded-t.lastReport.framesDecoded+"",bytesReceived:o.bytesReceived+"",packetsReceived:o.packetsReceived+"",packetsLost:o.packetsLost+""}),t.lastReport=o}}else if("outboundrtp"===o.type&&"video"===o.mediaType){if(!t.lastReport)return void(t.lastReport=o);e&&e({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:o.framerateMean+"",frameRateSent:o.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=o}}))}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){Object.keys(n).forEach((function(i){var o=n[i];t.isSubscriber&&"inboundrtp"===o.type&&"audio"===o.mediaType&&e&&e({browser:"firefox",mediaType:"audio",peerId:t.uid,isAudioMute:t.isAudioMute,frameDropped:o.packetsLost+"",frameReceived:o.packetsReceived+"",googJitterReceived:o.jitter+"",bytesReceived:o.bytesReceived+"",packetsReceived:o.packetsReceived+"",packetsLost:o.packetsLost+""})}))}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){"inboundrtp"===e.type&&"video"===e.mediaType&&e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-d)/3).toString(),d=e.googFramesDecoded)})),e(t)}))},t.getStats=function(e){t.peerConnection.getStats().then((function(n){var i=[];Object.keys(n).forEach((function(e){var t=n[e];i.push(t),"outboundrtp"===t.type&&"video"===t.mediaType&&-1===t.id.indexOf("rtcp")&&(a.id=t.id,a.type=t.type,a.mediaType=t.mediaType,a.bytesSent=t.bytesSent?t.bytesSent+"":"0",a.packetsSent=t.packetsSent?t.packetsSent+"":"0",a.googPlisReceived=t.pliCount?t.pliCount+"":"0",a.googNacksReceived=t.nackCount?t.nackCount+"":"0",a.googFirsReceived=t.firCount?t.firCount+"":"0",a.googFrameRateSent=t.framerateMean?t.framerateMean+"":"0"),"outboundrtp"===t.type&&"audio"===t.mediaType&&-1===t.id.indexOf("rtcp")&&(r.id=t.id,r.type=t.type,r.mediaType=t.mediaType,r.bytesSent=t.bytesSent?t.bytesSent+"":"0",r.packetsSent=t.packetsSent?t.packetsSent+"":"0"),"inboundrtp"!==t.type||"audio"!==t.mediaType||t.isRemote||-1!==t.id.indexOf("rtcp")||(s.id=t.id,s.type=t.type,s.mediaType=t.mediaType,s.bytesReceived=t.bytesReceived?t.bytesReceived+"":"0",s.packetsLost=t.packetsLost?t.packetsLost+"":"0",s.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",s.googJitterReceived=t.jitter?t.jitter+"":"0"),"inboundrtp"!==t.type||"video"!==t.mediaType||t.isRemote||-1!==t.id.indexOf("rtcp")||(c.id=t.id,c.type=t.type,c.mediaType=t.mediaType,c.bytesReceived=t.bytesReceived?t.bytesReceived+"":"0",c.googFrameRateReceived=t.framerateMean?t.framerateMean+"":"0",c.googFramesDecoded=t.framesDecoded?t.framesDecoded+"":"0",c.packetsLost=t.packetsLost?t.packetsLost+"":"0",c.packetsReceived=t.packetsReceived?t.packetsReceived+"":"0",c.googJitterBufferMs=t.jitter?t.jitter+"":"0",c.googNacksSent=t.nackCount?t.nackCount+"":"0",c.googPlisSent=t.pliCount?t.pliCount+"":"0",c.googFirsSent=t.firCount?t.firCount+"":"0"),-1!==t.id.indexOf("outbound_rtcp_video")&&(a.packetsLost=t.packetsLost?t.packetsLost+"":"0")}));var o=[a,r,s,c];o.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(o,i)}),(function(e){o.default.error("["+t.clientId+"]"+e)}))},t.addStream=function(e){i=!0,t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){if(t.actionNeeded){if("new"===t.state||"established"===t.state)i&&(t.mediaConstraints=void 0),t.peerConnection.createOffer((function(e){if(e.sdp=u(e.sdp),e.sdp=e.sdp.replace(/a=extmap:1 http:\/\/www.webrtc.org\/experiments\/rtp-hdrext\/abs-send-time/,"a=extmap:3 http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();o.default.debug("["+t.clientId+"]Not sending a new offer")}),(function(e){o.default.debug("["+t.clientId+"]Ups! create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;o.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(){o.default.debug("["+t.clientId+"]Ups! Something went wrong")}));else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;var e=t.peerConnection.localDescription.sdp;t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)};var u=function(t){var n;if(e.video&&e.maxVideoBW&&(null==(n=t.match(/m=video.*\r\n/))&&(n=t.match(/m=video.*\n/)),n&&n.length>0)){var i=n[0]+"b=TIAS:"+1e3*e.maxVideoBW+"\r\n";t=t.replace(n[0],i)}return e.audio&&e.maxAudioBW&&(null==(n=t.match(/m=audio.*\r\n/))&&(n=t.match(/m=audio.*\n/)),n&&n.length>0)&&(i=n[0]+"b=TIAS:"+1e3*e.maxAudioBW+"\r\n",t=t.replace(n[0],i)),t};return t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e);else if("iOS"===p.getBrowserOS()||p.isSafari())o.default.debug("["+t.streamId+"]["+t.clientId+"]Safari"),(t=function(e){var t={},n=S.a;t.uid=e.uid,t.isVideoMute=e.isVideoMute,t.isAudioMute=e.isAudioMute,t.isSubscriber=e.isSubscriber,t.clientId=e.clientId,t.pc_config={iceServers:[{urls:["stun:webcs.agora.io:3478","stun:stun.l.google.com:19302"]}],bundlePolicy:"max-bundle"},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map((function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.credential,url:e.url})})):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&(t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:["turn:"+e.turnServer.url+":"+e.turnServer.udpport+"?transport=udp"]}),"string"==typeof e.turnServer.tcpport&&""!==e.turnServer.tcpport&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.credential,credentialType:"password",urls:["turn:"+e.turnServer.url+":"+e.turnServer.tcpport+"?transport=tcp"]}),!0===e.turnServer.forceturn&&(t.pc_config.iceTransportPolicy="relay")))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103;try{t.pc_config.sdpSemantics="plan-b",t.peerConnection=new n(t.pc_config,t.con)}catch(e){delete t.pc_config.sdpSemantics,t.peerConnection=new n(t.pc_config,t.con)}o.default.debug("["+t.clientId+']safari Created RTCPeerConnnection with config "'+JSON.stringify(t.pc_config)+'".'),t.peerConnection.onicecandidate=function(e){var n,i,r,a;i=(n=t.peerConnection.localDescription.sdp).match(/a=candidate:.+typ\ssrflx.+\r\n/),r=n.match(/a=candidate:.+typ\shost.+\r\n/),a=n.match(/a=candidate:.+typ\srelay.+\r\n/),0===t.iceCandidateCount&&(t.timeout=setTimeout((function(){t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded())}),1e3)),null===i&&null===r&&null===a||void 0!==t.ice||(o.default.debug("["+t.clientId+"]srflx candidate : "+i+" relay candidate: "+a+" host candidate : "+r),clearTimeout(t.timeout),t.ice=0,t.moreIceComing=!1,t.markActionNeeded()),t.iceCandidateCount=t.iceCandidateCount+1};var i=function(t){return e.screen&&(t=t.replace("a=x-google-flag:conference\r\n","")),t},r=function(n){var i,r;return e.minVideoBW&&e.maxVideoBW&&(r=(i=n.match(/m=video.*\r\n/))[0]+"b=AS:"+e.maxVideoBW+"\r\n",n=n.replace(i[0],r),o.default.debug("["+t.clientId+"]Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),e.maxAudioBW&&(r=(i=n.match(/m=audio.*\r\n/))[0]+"b=AS:"+e.maxAudioBW+"\r\n",n=n.replace(i[0],r)),n};t.processSignalingMessage=function(e){var n,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=r(n.sdp),n.sdp=n.sdp.replace(/a=x-google-flag:conference\r\n/g,""),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(n={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),n.sdp=r(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))};var a={id:"",type:"",mediaType:"",googCodecName:"opus",aecDivergentFilterFraction:"0",audioInputLevel:"0",bytesSent:"0",packetsSent:"0",googEchoCancellationReturnLoss:"0",googEchoCancellationReturnLossEnhancement:"0"},s={id:"",type:"",mediaType:"",googCodecName:"h264"===e.codec?"H264":"VP8",bytesSent:"0",packetsLost:"0",packetsSent:"0",googAdaptationChanges:"0",googAvgEncodeMs:"0",googEncodeUsagePercent:"0",googFirsReceived:"0",googFrameHeightSent:"0",googFrameHeightInput:"0",googFrameRateInput:"0",googFrameRateSent:"0",googFrameWidthSent:"0",googFrameWidthInput:"0",googNacksReceived:"0",googPlisReceived:"0",googRtt:"0",googFramesEncoded:"0"},c={id:"",type:"",mediaType:"",audioOutputLevel:"0",bytesReceived:"0",packetsLost:"0",packetsReceived:"0",googAccelerateRate:"0",googCurrentDelayMs:"0",googDecodingCNG:"0",googDecodingCTN:"0",googDecodingCTSG:"0",googDecodingNormal:"0",googDecodingPLC:"0",googDecodingPLCCNG:"0",googExpandRate:"0",googJitterBufferMs:"0",googJitterReceived:"0",googPreemptiveExpandRate:"0",googPreferredJitterBufferMs:"0",googSecondaryDecodedRate:"0",googSpeechExpandRate:"0"},d={id:"",type:"",mediaType:"",googTargetDelayMs:"0",packetsLost:"0",googDecodeMs:"0",googMaxDecodeMs:"0",googRenderDelayMs:"0",googFrameWidthReceived:"0",googFrameHeightReceived:"0",googFrameRateReceived:"0",googFrameRateDecoded:"0",googFrameRateOutput:"0",googFramesDecoded:"0",googFrameReceived:"0",googJitterBufferMs:"0",googCurrentDelayMs:"0",googMinPlayoutDelayMs:"0",googNacksSent:"0",googPlisSent:"0",googFirsSent:"0",bytesReceived:"0",packetsReceived:"0"},u={id:"bweforvideo",type:"VideoBwe",googAvailableSendBandwidth:"0",googAvailableReceiveBandwidth:"0",googActualEncBitrate:"0",googRetransmitBitrate:"0",googTargetEncBitrate:"0",googBucketDelay:"0",googTransmitBitrate:"0"},l=0,p=0,f=0;return t.getVideoRelatedStats=function(n){t.peerConnection.getStats().then((function(i){var o={peerId:t.uid,mediaType:"video",isVideoMute:t.isVideoMute};i.forEach((function(i){if(t.isSubscriber){if("track"===i.type&&(~i.id.indexOf("video")||~i.trackIdentifier.indexOf("v"))){if(!t.lastReport)return void(t.lastReport=i);o.frameRateReceived=i.framesReceived-t.lastReport.framesReceived+"",o.frameRateDecoded=i.framesDecoded-t.lastReport.framesDecoded+"",t.lastReport=i}"inbound-rtp"===i.type&&~i.id.indexOf("Video")&&(o.bytesReceived=i.bytesReceived+"",o.packetsReceived=i.packetsReceived+"",o.packetsLost=i.packetsLost+"")}else if("outbound-rtp"===i.type&&~i.id.indexOf("Video")){if(!t.lastReport)return void(t.lastReport=i);n&&n({mediaType:"video",isVideoMute:t.isVideoMute,frameRateInput:e.maxFrameRate+"",frameRateSent:i.framesEncoded-t.lastReport.framesEncoded+""}),t.lastReport=i}})),n&&n(o)}))},t.getAudioRelatedStats=function(e){t.peerConnection.getStats().then((function(n){n.forEach((function(n){t.isSubscriber&&"inbound-rtp"===n.type&&~n.id.indexOf("Audio")&&e&&e({peerId:t.uid,mediaType:"audio",isAudioMute:t.isAudioMute,frameDropped:n.packetsLost+"",frameReceived:n.packetsReceived+"",googJitterReceived:n.jitter+"",bytesReceived:n.bytesReceived+"",packetsReceived:n.packetsReceived+"",packetsLost:n.packetsLost+""})}))}))},t.getStatsRate=function(e){t.getStats((function(t){t.forEach((function(e){"outbound-rtp"===e.type&&"video"===e.mediaType&&e.googFramesEncoded&&(e.googFrameRateSent=((e.googFramesEncoded-l)/3).toString(),l=e.googFramesEncoded),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(e.googFrameRateReceived&&(e.googFrameRateReceived=((e.googFrameReceived-f)/3).toString(),f=e.googFrameReceived),e.googFrameRateDecoded&&(e.googFrameRateDecoded=((e.googFramesDecoded-p)/3).toString(),p=e.googFramesDecoded))})),e(t)}))},t.getStats=function(e){var n=[];t.peerConnection.getStats().then((function(i){i.forEach((function(e){n.push(e),"outbound-rtp"===e.type&&"audio"===e.mediaType&&(a.id=e.id,a.type=e.type,a.mediaType=e.mediaType,a.bytesSent=e.bytesSent?e.bytesSent+"":"0",a.packetsSent=e.packetsSent?e.packetsSent+"":"0"),"outbound-rtp"===e.type&&"video"===e.mediaType&&(s.id=e.id,s.type=e.type,s.mediaType=e.mediaType,s.bytesSent=e.bytesSent?e.bytesSent+"":"0",s.packetsSent=e.packetsSent?e.packetsSent+"":"0",s.googPlisReceived=e.pliCount?e.pliCount+"":"0",s.googNacksReceived=e.nackCount?e.nackCount+"":"0",s.googFirsReceived=e.firCount?e.firCount+"":"0",s.googFramesEncoded=e.framesEncoded?e.framesEncoded+"":"0"),"inbound-rtp"===e.type&&-1!=e.id.indexOf("44444")&&(c.id=e.id,c.type=e.type,c.mediaType="audio",c.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",c.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",c.packetsLost=e.packetsLost?e.packetsLost+"":"0",c.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",c.googJitterReceived=e.jitter?e.jitter+"":"0"),"inbound-rtp"===e.type&&-1!=e.id.indexOf("55543")&&(d.id=e.id,d.type=e.type,d.mediaType="video",d.packetsReceived=e.packetsReceived?e.packetsReceived+"":"0",d.bytesReceived=e.bytesReceived?e.bytesReceived+"":"0",d.packetsLost=e.packetsLost?e.packetsLost+"":"0",d.googJitterBufferMs=e.jitter?e.jitter+"":"0",d.googNacksSent=e.nackCount?e.nackCount+"":"0",d.googPlisSent=e.pliCount?e.pliCount+"":"0",d.googFirsSent=e.firCount?e.firCount+"":"0"),"track"!==e.type||-1==e.id.indexOf("55543")&&!~e.trackIdentifier.indexOf("v")||(d.googFrameWidthReceived=e.frameWidth?e.frameWidth+"":"0",d.googFrameHeightReceived=e.frameHeight?e.frameHeight+"":"0",d.googFrameReceived=e.framesReceived?e.framesReceived+"":"0",d.googFramesDecoded=e.framesDecoded?e.framesDecoded+"":"0"),"track"!==e.type||-1==e.id.indexOf("44444")&&!~e.trackIdentifier.indexOf("a")||(c.audioOutputLevel=e.audioLevel+"",a.audioInputLevel=e.audioLevel+""),"candidate-pair"===e.type&&(0==e.availableIncomingBitrate?u.googAvailableSendBandwidth=e.availableOutgoingBitrate+"":u.googAvailableReceiveBandwidth=e.availableIncomingBitrate+"")}));var o=[u,a,s,c,d];o.push({id:"time",startTime:t.connectedTime,timestamp:new Date}),e(o,n)})).catch((function(e){console.error(e)}))},t.addTrack=function(e,n){t.peerConnection.addTrack(e,n)},t.removeTrack=function(e,n){var i=t.peerConnection.getSenders().find((function(t){return t.track==e}));i.replaceTrack(null),t.peerConnection.removeTrack(i)},t.addStream=function(e){window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?e.getTracks().forEach((function(n){return t.peerConnection.addTrack(n,e)})):t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var n;if(t.actionNeeded){if("new"===t.state||"established"===t.state)e.isSubscriber&&(t.peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.peerConnection.addTransceiver("video",{direction:"recvonly"})),t.peerConnection.createOffer(t.mediaConstraints).then((function(n){if(n.sdp=r(n.sdp),e.isSubscriber||(n.sdp=n.sdp.replace(/a=extmap:4 urn:3gpp:video-orientation\r\n/g,"")),n.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(n),t.state="preparing-offer",void t.markActionNeeded();o.default.debug("["+t.clientId+"]Not sending a new offer")})).catch((function(e){o.default.debug("["+t.clientId+"]peer connection create offer failed ",e)}));else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.prevOffer=t.prevOffer.replace(/a=candidate:.+typ\shost.+\r\n/g,"a=candidate:2243255435 1 udp 2122194687 192.168.0.1 30000 typ host generation 0 network-id 1\r\n"),t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;o.default.debug("["+t.clientId+"]"+n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){o.default.debug("["+t.clientId+"]peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;n=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",n),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.ontrack=function(e){t.onaddstream&&t.onaddstream(e,"ontrack")},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){"connected"===e.currentTarget.iceConnectionState&&(t.connectedTime=new Date),t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.peerConnection.onnegotiationneeded=function(){void 0!==t.prevOffer&&t.peerConnection.createOffer().then((function(e){return e.sdp=e.sdp.replace(/a=recvonly\r\n/g,"a=inactive\r\n"),e.sdp=i(e.sdp),e.sdp=r(e.sdp),t.peerConnection.setLocalDescription(e)})).then((function(){t.onnegotiationneeded&&t.onnegotiationneeded(t.peerConnection.localDescription.sdp)})).catch((function(e){console.log("createOffer error: ",e)}))},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e)).browser="safari";else if(window.navigator.userAgent.indexOf("MSIE "))(t=te(e)).browser="ie";else if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]>=26)(t=te(e)).browser="chrome-stable";else{if(!(window.navigator.userAgent.toLowerCase().indexOf("chrome")>=40))throw t.browser="none","WebRTC stack not available";(t=function(e){var t={},n=webkitRTCPeerConnection;t.pc_config={iceServers:[]},t.con={optional:[{DtlsSrtpKeyAgreement:!0}]},e.iceServers instanceof Array?t.pc_config.iceServers=e.iceServers:(e.stunServerUrl&&(e.stunServerUrl instanceof Array?e.stunServerUrl.map((function(e){"string"==typeof e&&""!==e&&t.pc_config.iceServers.push({url:e})})):"string"==typeof e.stunServerUrl&&""!==e.stunServerUrl&&t.pc_config.iceServers.push({url:e.stunServerUrl})),e.turnServer&&(e.turnServer instanceof Array?e.turnServer.map((function(e){"string"==typeof e.url&&""!==e.url&&t.pc_config.iceServers.push({username:e.username,credential:e.password,url:e.url})})):"string"==typeof e.turnServer.url&&""!==e.turnServer.url&&t.pc_config.iceServers.push({username:e.turnServer.username,credential:e.turnServer.password,url:e.turnServer.url}))),void 0===e.audio&&(e.audio=!0),void 0===e.video&&(e.video=!0),t.mediaConstraints={mandatory:{OfferToReceiveVideo:e.video,OfferToReceiveAudio:e.audio}},t.roapSessionId=103,t.peerConnection=new n(t.pc_config,t.con),t.peerConnection.onicecandidate=function(e){e.candidate?t.iceCandidateCount+=1:(o.default.debug("PeerConnection State: "+t.peerConnection.iceGatheringState),void 0===t.ices&&(t.ices=0),t.ices=t.ices+1,t.ices>=1&&t.moreIceComing&&(t.moreIceComing=!1,t.markActionNeeded()))};var i=function(t){var n,i;return e.minVideoBW&&e.maxVideoBW&&(i=(n=t.match(/m=video.*\r\n/))[0]+"b=AS:"+e.maxVideoBW+"\r\n",t=t.replace(n[0],i),o.default.debug("Set Video Bitrate - min:"+e.minVideoBW+" max:"+e.maxVideoBW)),e.maxAudioBW&&(i=(n=t.match(/m=audio.*\r\n/))[0]+"b=AS:"+e.maxAudioBW+"\r\n",t=t.replace(n[0],i)),t};return t.processSignalingMessage=function(e){var n,o=JSON.parse(e);t.incomingMessage=o,"new"===t.state?"OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"offer-sent"===t.state?"ANSWER"===o.messageType?((n={sdp:o.sdp,type:"answer"}).sdp=i(n.sdp),t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.sendOK(),t.state="established"):"pr-answer"===o.messageType?(n={sdp:o.sdp,type:"pr-answer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n))):"offer"===o.messageType?t.error("Not written yet"):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state):"established"===t.state&&("OFFER"===o.messageType?(n={sdp:o.sdp,type:"offer"},t.peerConnection.setRemoteDescription(new RTCSessionDescription(n)),t.state="offer-received",t.markActionNeeded()):t.error("Illegal message for this state: "+o.messageType+" in state "+t.state))},t.addStream=function(e){t.peerConnection.addStream(e),t.markActionNeeded()},t.removeStream=function(){t.markActionNeeded()},t.close=function(){t.state="closed",t.peerConnection.close()},t.markActionNeeded=function(){t.actionNeeded=!0,t.doLater((function(){t.onstablestate()}))},t.doLater=function(e){window.setTimeout(e,1)},t.onstablestate=function(){var e;if(t.actionNeeded){if("new"===t.state||"established"===t.state)t.peerConnection.createOffer((function(e){if(e.sdp=i(e.sdp),o.default.debug("Changed",e.sdp),e.sdp!==t.prevOffer)return t.peerConnection.setLocalDescription(e),t.state="preparing-offer",void t.markActionNeeded();o.default.debug("Not sending a new offer")}),(function(e){o.default.debug("peer connection create offer failed ",e)}),t.mediaConstraints);else if("preparing-offer"===t.state){if(t.moreIceComing)return;t.prevOffer=t.peerConnection.localDescription.sdp,t.sendMessage("OFFER",t.prevOffer),t.state="offer-sent"}else if("offer-received"===t.state)t.peerConnection.createAnswer((function(e){if(t.peerConnection.setLocalDescription(e),t.state="offer-received-preparing-answer",t.iceStarted)t.markActionNeeded();else{var n=new Date;o.default.debug(n.getTime()+": Starting ICE in responder"),t.iceStarted=!0}}),(function(e){o.default.debug("peer connection create answer failed ",e)}),t.mediaConstraints);else if("offer-received-preparing-answer"===t.state){if(t.moreIceComing)return;e=t.peerConnection.localDescription.sdp,t.sendMessage("ANSWER",e),t.state="established"}else t.error("Dazed and confused in state "+t.state+", stopping here");t.actionNeeded=!1}},t.sendOK=function(){t.sendMessage("OK")},t.sendMessage=function(e,n){var i={};i.messageType=e,i.sdp=n,"OFFER"===e?(i.offererSessionId=t.sessionId,i.answererSessionId=t.otherSessionId,i.seq=t.sequenceNumber+=1,i.tiebreaker=Math.floor(429496723*Math.random()+1)):(i.offererSessionId=t.incomingMessage.offererSessionId,i.answererSessionId=t.sessionId,i.seq=t.incomingMessage.seq),t.onsignalingmessage(JSON.stringify(i))},t._getSender=function(e){if(t.peerConnection&&t.peerConnection.getSenders){var n=t.peerConnection.getSenders().find((function(t){return t.track.kind==e}));if(n)return n}return null},t.hasSender=function(e){return!!t._getSender(e)},t.replaceTrack=function(e,n,i){var o=t._getSender(e.kind);if(!o)return i("NO_SENDER_FOUND");try{o.replaceTrack(e)}catch(e){return i&&i(e)}setTimeout((function(){return n&&n()}),50)},t.error=function(e){throw"Error in RoapOnJsep: "+e},t.sessionId=t.roapSessionId+=1,t.sequenceNumber=0,t.actionNeeded=!1,t.iceStarted=!1,t.moreIceComing=!0,t.iceCandidateCount=0,t.onsignalingmessage=e.callback,t.peerConnection.onopen=function(){t.onopen&&t.onopen()},t.peerConnection.onaddstream=function(e){t.onaddstream&&t.onaddstream(e)},t.peerConnection.onremovestream=function(e){t.onremovestream&&t.onremovestream(e)},t.peerConnection.oniceconnectionstatechange=function(e){t.oniceconnectionstatechange&&t.oniceconnectionstatechange(e.currentTarget.iceConnectionState)},t.onaddstream=null,t.onremovestream=null,t.state="new",t.markActionNeeded(),t}(e)).browser="chrome-canary"}else o.default.error("["+t.streamId+"]["+t.clientId+"]Publish/subscribe video/audio streams not supported yet"),t={addStream:function(){}};return t},ue=function(e,t,n){var i={};if(i.config=e,i.streamId=e.streamId,navigator.getMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,e.screen){if(ie())return e.sourceId?se(e.sourceId,e,(function(e,i){if(e)return n&&n();t&&t(i)})):function(e,t){oe((function(n,i){if(n)return t&&t(n);!function(e,t){var n=document.createElement("div");n.innerText="share screen",n.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");var i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");var o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");var r=document.createElement("div");r.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");var a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");var s=document.createElement("button");s.innerHTML="cancel",s.setAttribute("style","width: 85px;"),s.onclick=function(){document.body.removeChild(c),t&&t("NotAllowedError")},a.appendChild(s),i.appendChild(o),i.appendChild(r),i.appendChild(a);var c=document.createElement("div");c.setAttribute("style","position: absolute; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),c.appendChild(n),c.appendChild(i),document.body.appendChild(c),e.map((function(e){if(e.id){var n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;"),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+e.thumbnail.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name+"</span>",n.onclick=function(){document.body.removeChild(c),t&&t(null,e.id)},r.appendChild(n)}}))}(i,(function(n,i){if(n)return t&&t(n);re(i,e,t)}))}))}(e,(function(e,i){if(e)return n&&n();t&&t(i)}));if(o.default.debug("["+i.streamId+"]Screen access requested"),null!==window.navigator.userAgent.match("Firefox")){if(e.mediaSource=e.mediaSource||"screen",!~["screen","window","application"].indexOf(e.mediaSource))return n&&n("Invalid mediaSource, mediaSource should be one of [screen, window, application]");if(!e.attributes)return n&&n("Share screen attributes is null");var r={};r.video={frameRate:{ideal:e.attributes.mxaFr,max:e.attributes.mxaFr},height:{ideal:e.attributes.height},width:{ideal:e.attributes.width},mediaSource:e.mediaSource},navigator.getMedia(r,t,n)}else if(null!==window.navigator.userAgent.match("Chrome")){if(window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<34)return void n({code:"This browser does not support screen sharing"});var a="okeephmleflklcdebijnponpabbmmgeo";if(e.extensionId)o.default.debug("["+i.streamId+"]extensionId supplied, using "+e.extensionId),a=e.extensionId;else if(window.navigator.mediaDevices.getDisplayMedia){var s={video:{height:{ideal:e.attributes.height},width:{ideal:e.attributes.width},frameRate:{ideal:e.attributes.maxFr,max:e.attributes.maxFr}}};return o.default.debug("use getDisplayMedia, config.attributes:",e.attributes),o.default.debug("use getDisplayMedia, constraints:",s),window.navigator.mediaDevices.getDisplayMedia(s).then((function(e){t&&t(e)})).catch(n)}o.default.debug("["+i.streamId+"]Screen access on chrome stable, looking for extension");try{chrome.runtime.sendMessage(a,{getStream:!0},(function(a){if(void 0!==a){var s=a.streamId,c=e.attributes.width,d=e.attributes.height,u=e.attributes.maxFr,l=e.attributes.minFr;r={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxHeight:d,maxWidth:c,maxFrameRate:u,minFrameRate:l}}},navigator.getMedia(r,t,n)}else o.default.error("["+i.streamId+"]No response from Chrome Plugin. Plugin not installed properly"),n({name:"PluginNotInstalledProperly",message:"No response from Chrome Plugin. Plugin not installed properly."})}))}catch(e){return o.default.debug("["+i.streamId+"]AgoraRTC screensharing plugin is not accessible"),void n({code:"no_plugin_present"})}}else o.default.debug("["+i.streamId+"]This browser does not support screenSharing")}else window.navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")?navigator.mediaDevices.getUserMedia(e).then(t).catch(n):"undefined"!=typeof navigator&&navigator.getMedia?navigator.getMedia(e,t,n):o.default.error("["+i.streamId+"]Video/audio streams not supported yet")},le=n(7),pe=function(e,t,n){if(["End2EndDelay","TransportDelay","PacketLossRate","RecvLevel","RecvBitrate","CodecType","MuteState","TotalFreezeTime","TotalPlayDuration","RecordingLevel","SendLevel","SamplingRate","SendBitrate","CodecType","MuteState","End2EndDelay","TransportDelay","PacketLossRate","RecvBitrate","RecvResolutionWidth","RecvResolutionHeight","RenderResolutionHeight","RenderResolutionWidth","RenderFrameRate","TotalFreezeTime","TotalPlayDuration","TargetSendBitrate","SendFrameRate","SendFrameRate","SendBitrate","SendResolutionWidth","SendResolutionHeight","CaptureResolutionHeight","CaptureResolutionWidth","EncodeDelay","MuteState","TotalFreezeTime","TotalDuration","CaptureFrameRate","RTT","OutgoingAvailableBandwidth","Duration","UserCount","SendBytes","RecvBytes","SendBitrate","RecvBitrate","accessDelay","audioSendBytes","audioSendPackets","videoSendBytes","videoSendPackets","videoSendPacketsLost","videoSendFrameRate","audioSendPacketsLost","videoSendResolutionWidth","videoSendResolutionHeight","accessDelay","audioReceiveBytes","audioReceivePackets","audioReceivePacketsLost","videoReceiveBytes","videoReceivePackets","videoReceivePacketsLost","videoReceiveFrameRate","videoReceiveDecodeFrameRate","videoReceiveResolutionWidth","videoReceiveResolutionHeight","endToEndDelay","videoReceiveDelay","audioReceiveDelay","FirstFrameTime","VideoFreezeRate","AudioFreezeRate","RenderResolutionWidth","RenderResolutionHeight"].indexOf(t)>-1&&("string"==typeof n||isFinite(n)))return e[t]=""+n},fe=n(10),me=new function(){var e=a();return e.devicesHistory={},e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.deviceStates={ACTIVE:"ACTIVE",INACTIVE:"INACTIVE"},e.deviceReloadTimer=null,e._init=function(t,n){e.state=e.states.INITING,e.devicesHistory={},e._reloadDevicesInfo((function(){e.state=e.states.INITED,e.dispatchEvent({type:"inited"}),t&&t()}),(function(t){o.default.warning("Device Detection functionality cannot start properly."),e.state=e.states.UNINIT,n&&n(t)}))},e._enumerateDevices=function(e,t){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return o.default.warning("enumerateDevices() not supported."),t&&t("enumerateDevices() not supported");navigator.mediaDevices.enumerateDevices().then((function(t){e&&setTimeout((function(){e(t)}),0)})).catch((function(e){t&&t(e)}))},e._reloadDevicesInfo=function(t,n){var i=[];e._enumerateDevices((function(n){var r=Date.now();for(var a in n.forEach((function(t){var n=e.devicesHistory[t.deviceId];if((n?n.state:e.deviceStates.INACTIVE)!=e.deviceStates.ACTIVE){var o=n||{initAt:r};o.device=t,o.state=e.deviceStates.ACTIVE,i.push(o),e.devicesHistory[t.deviceId]=o}e.devicesHistory[t.deviceId].lastReloadAt=r})),e.devicesHistory){var s=e.devicesHistory[a];s&&s.state==e.deviceStates.ACTIVE&&s.lastReloadAt!==r&&(s.state=e.deviceStates.INACTIVE,i.push(s)),s.lastReloadAt=r}e.state==e.states.INITED&&i.forEach((function(t){var n=y()({},t);switch(t.device.kind){case"audioinput":n.type="recordingDeviceChanged";break;case"audiooutput":n.type="playoutDeviceChanged";break;case"videoinput":n.type="cameraChanged";break;default:o.default.warning("Unknown device change",n),n.type="unknownDeviceChanged"}e.dispatchEvent(n)})),t&&t()}),n)},e.getDeviceById=function(t,n,i){e.getDevices((function(e){for(var o=0;o<e.length;o++){var r=e[o];if(r&&r.deviceId===t)return n&&n(r)}return i&&i()}))},e.searchDeviceNameById=function(t){var n=e.devicesHistory[t];return n?n.device.label||n.device.deviceId:null},e.getDevices=function(t,n){e._enumerateDevices(t,(function(e){n&&n(e.name+": "+e.message)}))},e.getVideoCameraIdByLabel=function(t,n,i){e.getCameras((function(e){var o=!0,r=!1,a=void 0;try{for(var s,c=e[Symbol.iterator]();!(o=(s=c.next()).done);o=!0){var d=s.value;if(d.label===t)return n&&n(d.deviceId)}}catch(e){r=!0,a=e}finally{try{o||null==c.return||c.return()}finally{if(r)throw a}}return i&&i(Y)}),i)},e.getRecordingDevices=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"audioinput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e.getPlayoutDevices=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"audiooutput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e.getCameras=function(t,n){return e._enumerateDevices((function(e){var n=e.filter((function(e){return"videoinput"==e.kind}));t&&t(n)}),(function(e){n&&n(e)}))},e._init((function(){navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",(function(){e._reloadDevicesInfo()})),e.deviceReloadTimer=setInterval(e._reloadDevicesInfo,5e3)})),e},ge=function(e,t,n){for(var i=0;i<n.length;i++)if(e===n[i])return!0;throw new Error("".concat(t," can only be set as ").concat(JSON.stringify(n)))},ve=function(e,t){if(!e)throw new Error("Invalid param: ".concat(t||"param"," cannot be empty"));if("object"!==v()(e))throw new Error("".concat(t||"This paramter"," is of the object type"));return!0},he=function(e,t,n,i,o){if(Re(n)&&(n=1),i=i||255,Re(o)&&(o=!0),Re(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!be(e,n,i,o))throw new Error("Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(o?" ASCII characters only.":""))},ye=function(e,t,n,i){if(Re(n)&&(n=1),i=i||1e4,Re(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!Ie(e,n,i))throw new Error("Invalid ".concat(t||"number param",": The value range is [").concat(n,",").concat(i,"]. integer only"))},Se=function(e,t){if(Re(e))throw new Error("".concat(t||"param"," cannot be empty"));if(!_e(e))throw new Error("Invalid ".concat(t||"boolean param",": The value is of the boolean type."))},be=function(e,t,n,i){return t||(t=0),n||(n=Number.MAX_SAFE_INTEGER),Re(i)&&(i=!0),we(e)&&(!i||Ce(e))&&e.length>=t&&e.length<=n},Ie=function(e,t,n){return Te(e)&&e>=t&&e<=n},_e=function(e){return"boolean"==typeof e},Ee=function(e){return be(e,1,2047)},Ce=function(e){if("string"==typeof e){for(var t=0;t<e.length;t++){var n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}},Te=function(e){return"number"==typeof e&&e%1==0},we=function(e){return"string"==typeof e},Re=function(e){return null==e},Ae=function(e){var t=a();if(t.params=y()({},e),t.stream=e.stream,t.url=e.url,t.onClose=void 0,t.local=!1,t.videoSource=e.videoSource,t.audioSource=e.audioSource,t.video=!!e.video,t.audio=!!e.audio,t.screen=!!e.screen,t.screenAttributes={width:1920,height:1080,maxFr:5,minFr:1},t.videoSize=e.videoSize,t.player=void 0,t.audioLevelHelper=null,e.attributes=e.attributes||{},t.attributes=e.attributes,t.microphoneId=e.microphoneId,t.cameraId=e.cameraId,t.inSwitchDevice=!1,t.userMuteVideo=!1,t.userMuteAudio=!1,t.peerMuteVideo=!1,t.peerMuteAudio=!1,t.lowStream=null,t.videoWidth=0,t.videoHeight=0,t.streamId=null,t.streamId=e.streamID,t.userId=null,t.mirror=!1!==e.mirror,t.DTX=e.audioProcessing&&e.audioProcessing.DTX,t.audioProcessing=e.audioProcessing,t.highQuality=!1,t.stereo=!1,t.speech=!1,t.screen||delete t.screen,!(void 0===t.videoSize||t.videoSize instanceof Array&&4===t.videoSize.length))throw Error("Invalid Video Size");function n(e,t){return{width:{ideal:e},height:{ideal:t}}}t.videoSize=[640,480,640,480],void 0!==e.local&&!0!==e.local||(t.local=!0),t.initialized=!t.local,function(e){e.audioMixing={audioContextInited:!1,defaultVolume:100,inEarMonitoring:"FILE",sounds:{},states:{IDLE:"IDLE",STARTING:"STARTING",BUSY:"BUSY",PAUSED:"PAUSED"},inEarMonitoringModes:{NONE:"NONE",FILE:"FILE",MICROPHONE:"MOCROPHONE",ALL:"ALL"},ctx:null,mediaStreamSource:null,mediaStreamDest:null,buffer:{}},e._initSoundIfNotExists=function(t,n){e.audioMixing.sounds[t]||(e.audioMixing.sounds[t]={soundId:t,state:"IDLE",muted:e.userMuteAudio,filePath:n,volume:e.audioMixing.defaultVolume,startAt:null,startOffset:null,pauseAt:null,pauseOffset:null,resumeAt:null,resumeOffset:null,stopAt:null,options:null,source:null})},e._initSoundIfNotExists(-1),e.loadAudioBuffer=function(t,n,i){var a=r.b.reportApiInvoke(e.sid,{callback:i,name:"Stream.loadAudioBuffer",options:arguments,tag:"tracer"});he(n,"url",1,1024,!1),he(t,"id",1,1024,!1);var s=new XMLHttpRequest;s.open("GET",n,!0),s.responseType="arraybuffer",s.onload=function(){if(s.status>400){var n=s.statusText;return o.default.error("[".concat(e.streamId,"] loadAudioBuffer Failed: ")+n),a(n)}var i=s.response;e.audioMixing.audioContextInited||e._initAudioContext(),e.audioMixing.ctx.decodeAudioData(i,(function(n){e.audioMixing.buffer[t]=n,a(null)}),(function(t){o.default.error("[".concat(e.streamId,"] decodeAudioData Failed: "),t),a(t)}))},s.send()},e.createAudioBufferSource=function(t){var n=r.b.reportApiInvoke(e.sid,{name:"Stream.createAudioBufferSource",options:arguments,tag:"tracer"});if(e.audioMixing.buffer[t.id]){var i=e.audioMixing.buffer[t.id],a=e.audioMixing.ctx.createBufferSource();a.buffer=i;var s=e.audioMixing.ctx.createGain();if(a.connect(s),s.connect(e.audioMixing.mediaStreamDest),a.gainNode=s,t.loop)a.loop=!0,a.start(0,t.playTime/1e3);else if(t.cycle>1)if(Object(p.isChrome)()){a.loop=!0;var c=t.cycle*i.duration*1e3-(t.playTime||0);a.start(0,t.playTime/1e3,c/1e3)}else o.default.warning("[".concat(e.streamId,"] Cycle Param is ignored by current browser")),a.start(0,t.playTime/1e3);else a.start(0,t.playTime/1e3);var d=e.audioMixing.sounds[t.soundId];return d.source=a,e._flushAudioMixingMuteStatus(),a.addEventListener("ended",(function(){a===d.source&&e.dispatchEvent({type:"audioSourceEnded",soundId:t.soundId,source:a,sound:d})})),n(),a}return o.default.error("[".concat(e.streamId,"] "),"AUDIOBUFFER_NOT_FOUND",t.id),n(!1),!1},e.on("audioSourceEnded",(function(t){t.source;var n=t.sound;n&&n.state===e.audioMixing.states.BUSY&&!n.pauseAt&&(n.state=e.audioMixing.states.IDLE,n.startAt=null,n.startOffset=null,n.resumeAt=null,n.resumeOffset=null,e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest))})),e.clearAudioBufferSource=function(){e.audioBufferSource.forEach((function(e){e.stop()}))},e._isSoundExists=function(t){return!!e.audioMixing.sounds[t.soundId]||(o.default.error("SoundId not exists. #".concat(t.soundId)),!1)},e._initAudioContext=function(){if(e.audioMixing.audioContextInited)throw new Error("Failed to init audio context. Already inited");if(!e.stream)throw new Error("Failed to init audio context. Local Stream not initialized");e.audioMixing.ctx=Object(fe.a)(),e.audioMixing.mediaStreamSource=e.audioMixing.ctx.createMediaStreamSource(e.stream),e.audioMixing.mediaStreamDest=e.audioMixing.ctx.createMediaStreamDestination(),e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest);var t=e.stream.getVideoTracks()[0];if(t&&e.audioMixing.mediaStreamDest.stream.addTrack(t),e._isAudioMuted()?(e._unmuteAudio(),e.stream=e.audioMixing.mediaStreamDest.stream,e._muteAudio()):e.stream=e.audioMixing.mediaStreamDest.stream,e.audioLevelHelper=null,e.pc&&e.pc.peerConnection&&e.pc.peerConnection){var n=(e.pc.peerConnection&&e.pc.peerConnection.getSenders()).find((function(e){return e&&e.track&&"audio"==e.track.kind})),i=e.audioMixing.mediaStreamDest.stream.getAudioTracks()[0];n&&n.replaceTrack&&i&&n.replaceTrack(i)}e.audioMixing.audioContextInited=!0},e._reloadInEarMonitoringMode=function(t){if(t){if(!e.audioMixing.inEarMonitoringModes[t])return o.default.error("[".concat(e.streamId,"] Invalid InEarMonitoringMode ").concat(t));e.audioMixing.inEarMonitoring=t}switch(e.audioMixing.audioContextInited||e._initAudioContext(),e.audioMixing.inEarMonitoring){case e.audioMixing.inEarMonitoringModes.FILE:e.audioMixing.mediaStreamSource.connectedToDestination&&(e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.ctx.destination),e.audioMixing.mediaStreamSource.connectedToDestination=!1);case e.audioMixing.inEarMonitoringModes.ALL:for(var n in e.audioMixing.sounds){var i=e.audioMixing.sounds[n];i&&i.source&&!i.source.connectedToDestination&&(i.source.gainNode.connect(e.audioMixing.ctx.destination),i.source.connectedToDestination=!0)}}switch(e.audioMixing.inEarMonitoring){case e.audioMixing.inEarMonitoringModes.MICROPHONE:e.audioMixing.source.forEach((function(t){t.connectedToDestination&&(t.gainNode.disconnect(e.audioMixing.ctx.destination),t.connectedToDestination=!1)}));case e.audioMixing.inEarMonitoringModes.ALL:e.audioMixing.mediaStreamSource.connectedToDestination||(e.audioMixing.mediaStreamSource.connect(e.audioMixing.ctx.destination),e.audioMixing.mediaStreamSource.connectedToDestination=!0)}},e._startAudioMixingBufferSource=function(t){e.audioMixing.audioContextInited||e._initAudioContext();var n={soundId:t.soundId,id:t.filePath,loop:t.loop,cycle:t.cycle,playTime:t.playTime||0},i=t.replace,o=e.createAudioBufferSource(n);return o.sound=e.audioMixing.sounds[t.soundId],o?(o.addEventListener("ended",e._audioMixingFinishedListener,{once:!0}),e._reloadInEarMonitoringMode(),i&&e.audioMixing.mediaStreamSource.disconnect(e.audioMixing.mediaStreamDest),o):null},e._stopAudioMixingBufferSource=function(t){var n=e.audioMixing.sounds[t.soundId].source;return n?(n.removeEventListener("ended",e._audioMixingFinishedListener),e.audioMixing.mediaStreamSource.connect(e.audioMixing.mediaStreamDest),n.stop(),n):null},e._flushAudioMixingMuteStatus=function(t){for(var n in e.audioMixing.sounds){var i=e.audioMixing.sounds[n];i&&(void 0!==t&&(i.muted=!!t),i.source&&(i.muted?i.source.gainNode.gain.value=0:i.source.gainNode.gain.value=i.volume/100))}},e._handleAudioMixingInvalidStateError=function(t,n,i){var r=e.audioMixing.sounds[n.soundId],a=-1===n.soundId?"INVALID_AUDIO_MIXING_STATE":"INVALID_PLAY_EFFECT_STATE";o.default.error("[".concat(e.streamId,"] Cannot ").concat(t,": ").concat(a,", state is ").concat(r.state)),i&&i(a)},e._handleAudioMixingNoSourceError=function(t,n,i){e.audioMixing.sounds[n.soundId].state=e.audioMixing.states.IDLE;var r=-1===n.soundId?"NO_AUDIO_MIXING_SOURCE":"NO_EFFECT_SOURCE";o.default.error("[".concat(e.streamId,"] Cannot ").concat(t,": ").concat(r)),i&&i(r)},e._getOneEffectStates=function(t){var n=e.audioMixing.sounds[t.soundId];return function(){return n?{state:n.state,startAt:n.startAt,resumeAt:n.resumeAt,pauseOffset:n.pauseOffset,pauseAt:n.pauseAt,resumeOffset:n.resumeOffset,stopAt:n.stopAt,duration:e._getOneEffectDuration(t),position:e._getOneEffectCurrentPosition(t)}:{}}},e._audioMixingFinishedListener=function(){var t=this.sound;t.state===e.audioMixing.states.IDLE&&e.audioMixing.buffer[t.options.filePath]&&!t.options.cacheResource&&(o.default.debug("Recycled buffer ".concat(t.options.filePath)),delete e.audioMixing.buffer[t.options.filePath]),-1===t.soundId&&e.dispatchEvent({type:"audioMixingFinished"})},e._playOneEffect=function(t,n){ve(t,"options");var i=t.soundId,r=(t.filePath,t.cacheResource);if(t.cycle,t.loop,t.playTime,t.replace,Object(p.isSafari)()&&Object(p.getBrowserVersion)()<12){var a="BROWSER_NOT_SUPPORT";return o.default.error("[".concat(e.streamId,"] Cannot _playOneEffect: "),a),n(a)}e.audioMixing.audioContextInited||e._initAudioContext(),e._initSoundIfNotExists(i);var s=e.audioMixing.sounds[i];if(s.state===e.audioMixing.states.IDLE){if(void 0!==t.cycle&&!t.cycle>0)return a="Invalid Parmeter cycle: "+t.cycle,o.default.error("[".concat(e.streamId,"] ").concat(i),a),n(a);if(Re(r)&&(t.cacheResource=!0),s.state=e.audioMixing.states.STARTING,s.options=t,e.audioMixing.buffer[t.filePath]){var c=e._startAudioMixingBufferSource(t);if(c)return s.source=c,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=t.playTime||0,s.state=e.audioMixing.states.BUSY,e._flushAudioMixingMuteStatus(),n(null);s.state=e.audioMixing.states.IDLE;var d="CREATE_BUFFERSOURCE_FAILED";if(n)return n(d);o.default.error("[".concat(e.streamId,"] "),d)}else e.loadAudioBuffer(t.filePath,t.filePath,(function(i){if(i)s.state=e.audioMixing.states.IDLE,n?n(i):o.default.error("[".concat(e.streamId,"] "),i);else{var r=e._startAudioMixingBufferSource(t);if(r)return s.source=r,s.startAt=Date.now(),s.resumeAt=null,s.pauseOffset=null,s.pauseAt=null,s.resumeOffset=null,s.stopAt=null,s.startOffset=t.playTime||0,s.state=e.audioMixing.states.BUSY,e._flushAudioMixingMuteStatus(),n(null);if(s.state=e.audioMixing.states.IDLE,i="CREATE_BUFFERSOURCE_FAILED",n)return n(i);o.default.error("[".concat(e.streamId,"] "),i)}}))}else e._handleAudioMixingInvalidStateError("_playEffect",t,n)},e._stopOneEffect=function(t,n){var i=e.audioMixing.sounds[t.soundId];return e._isSoundExists(t)?i.state===e.audioMixing.states.BUSY||i.state===e.audioMixing.states.PAUSED?(e._stopAudioMixingBufferSource(t),i.stopAt=Date.now(),i.state=e.audioMixing.states.IDLE,e.audioMixing.buffer[i.options.filePath]&&!i.options.cacheResource&&(o.default.debug("Recycled buffer ".concat(i.options.filePath)),delete e.audioMixing.buffer[i.options.filePath]),void(n&&n(null))):void e._handleAudioMixingInvalidStateError("_stopOneEffect",t,n):n("SOUND_NOT_EXISTS")},e._pauseOneEffect=function(t,n){var i=e.audioMixing.sounds[t.soundId];if(i.state===e.audioMixing.states.BUSY)return e._stopAudioMixingBufferSource(t)?(i.pauseAt=Date.now(),i.state=e.audioMixing.states.PAUSED,i.resumeAt?i.pauseOffset=i.pauseAt-i.resumeAt+i.resumeOffset:i.pauseOffset=i.pauseAt-i.startAt+i.startOffset,n&&n(null)):void e._handleAudioMixingNoSourceError("_pauseOneEffect",t,n);e._handleAudioMixingInvalidStateError("_pauseOneEffect",t,n)},e._resumeOneEffect=function(t,n){var i=e.audioMixing.sounds[t.soundId];if(i.state===e.audioMixing.states.PAUSED){var r={soundId:t.soundId,filePath:i.options.filePath,cycle:i.options.cycle,loop:i.options.loop,playTime:i.pauseOffset,replace:i.options.replace},a=e._startAudioMixingBufferSource(r);if(!a){var s="CREATE_BUFFERSOURCE_FAILED";return n(s),void o.default.error("[".concat(e.streamId,"] "),s)}i.source=a,i.resumeAt=Date.now(),i.resumeOffset=i.pauseOffset,i.state=e.audioMixing.states.BUSY,i.pauseAt=null,i.pauseOffset=null,n(null)}else e._handleAudioMixingInvalidStateError("_resumeOneEffect",t,n)},e._getOneEffectDuration=function(t){var n=e.audioMixing.sounds[t.soundId];return n.options&&n.options.filePath&&e.audioMixing.buffer[n.options.filePath]?1e3*e.audioMixing.buffer[n.options.filePath].duration:null},e._getOneEffectCurrentPosition=function(t,n){var i=e.audioMixing.sounds[t.soundId];return i.state===e.audioMixing.states.PAUSED?i.pauseOffset%e._getOneEffectDuration(t):i.state===e.audioMixing.states.BUSY?(Date.now()-i.startAt+i.startOffset)%e._getOneEffectDuration(t):void(n&&e._handleAudioMixingInvalidStateError("_getOneEffectCurrentPosition",t))},e._setOneEffectPosition=function(t,n,i){var r=e.audioMixing.sounds[t.soundId];if(r.state===e.audioMixing.states.BUSY){if(!e._stopAudioMixingBufferSource(t))return void e._handleAudioMixingNoSourceError("_setOneEffectPosition",t,i);var a={soundId:t.soundId,filePath:r.options.filePath,loop:r.options.loop,cycle:r.options.cycle,playTime:n},s=e._startAudioMixingBufferSource(a);if(!s){var c="CREATE_BUFFERSOURCE_FAILED";return i&&i(c),void o.default.error("[".concat(e.streamId,"] "),c)}r.source=s,r.startAt=Date.now(),r.startOffset=n,r.resumeAt=null,r.resumeOffset=null,r.pauseOffset=null,r.pauseAt=null}else{if(r.state!==e.audioMixing.states.PAUSED)return void e._handleAudioMixingInvalidStateError("_setOneEffectPosition",t,i);r.pauseOffset=n}i&&i(null)},e.startAudioMixing=function(t,n){var o=r.b.reportApiInvoke(e.sid,{callback:function(t){if(t)return n&&n(t);e.dispatchEvent({type:"audioMixingPlayed"}),n&&n(null)},getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.startAudioMixing",options:t});ve(t,"options");var a=t.filePath,s=t.cacheResource,c=t.cycle,d=t.loop,u=t.playTime,l=t.replace;he(a,"filePath",1,Object(i.getParameter)("FILEPATH_LENMAX"),!1),ye(u,"playTime",0,1e8),!Re(c)&&ye(c,"cycle"),!Re(d)&&Se(d,"loop"),!Re(l)&&Se(l,"replace"),!Re(s)&&Se(s,"cacheResource");var p=y()({soundId:-1},t);e._playOneEffect(p,o)},e.stopAudioMixing=function(t){var n=r.b.reportApiInvoke(e.sid,{callback:t,getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.stopAudioMixing"});e._stopOneEffect({soundId:-1},n)},e.pauseAudioMixing=function(t){var n=r.b.reportApiInvoke(e.sid,{callback:t,getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.pauseAudioMixing"});return e._pauseOneEffect({soundId:-1},n)},e.resumeAudioMixing=function(t){var n=r.b.reportApiInvoke(e.sid,{callback:function(n,i){if(n)return t&&t(n);e.dispatchEvent({type:"audioMixingPlayed"}),t&&t(null)},getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.resumeAudioMixing"});e._resumeOneEffect({soundId:-1},n)},e.adjustAudioMixingVolume=function(t){var n=r.b.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.adjustAudioMixingVolume",options:arguments,tag:"tracer"});ye(t,"volume",0,100),e.audioMixing.sounds[-1].volume=t,e._flushAudioMixingMuteStatus(),n()},e.getAudioMixingDuration=function(){var t=r.b.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingDuration"}),n=e._getOneEffectDuration({soundId:-1});return t(null,n),n},e.getAudioMixingCurrentPosition=function(){var t=r.b.reportApiInvoke(e.sid,{getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.getAudioMixingCurrentPosition"}),n=e._getOneEffectCurrentPosition({soundId:-1},!0);return t(null,n),n},e.setAudioMixingPosition=function(t,n){var i=r.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",getStates:e._getOneEffectStates({soundId:-1}),name:"Stream.setAudioMixingPosition"});ye(t,"position",0,1e8),e._setOneEffectPosition({soundId:-1},t,i)},e.playEffect=function(t,n){var o=r.b.reportApiInvoke(e.sid,{callback:function(t){if(t)return n&&n(t);e.dispatchEvent({type:"effectPlayed"}),n&&n(null)},name:"Stream.playEffect",options:t});ve(t,"options");var a=t.soundId,s=t.filePath,c=t.cycle;ye(a,"soundId",1,1e4),he(s,"filePath",0,Object(i.getParameter)("FILEPATH_LENMAX"),!1),!Re(c)&&ye(c,"cycle"),e._playOneEffect(t,o)},e.stopEffect=function(t,n){var i=r.b.reportApiInvoke(e.sid,{callback:n,getStates:e._getOneEffectStates({soundId:t}),name:"Stream.stopEffect"});ye(t,"soundId",1,1e4),e._stopOneEffect({soundId:t},i)},e.stopAllEffects=function(t){var n=r.b.reportApiInvoke(e.sid,{callback:t,name:"Stream.stopAllEffect"}),i=!1,o=0,a=0,s=function(e){i||(e?(n(e),i=!0):o+=1,o===a&&(n(null),i=!0))};for(var c in e.audioMixing.sounds){var d=e.audioMixing.sounds[c];-1!==d.soundId&&(d.state!==e.audioMixing.states.BUSY&&d.state!==e.audioMixing.states.PAUSED||(a++,e._stopOneEffect({soundId:c},s)))}a||n(null)},e.preloadEffect=function(t,n,o){var a=r.b.reportApiInvoke(e.sid,{callback:o,options:arguments,tag:"tracer",name:"Stream.preloadEffect"});ye(t,"soundId",1,1e4),he(n,"filePath",1,Object(i.getParameter)("FILEPATH_LENMAX"),!1),e._initSoundIfNotExists(t,n),e.audioMixing.buffer[n]?a(null):e.loadAudioBuffer(n,n,a)},e.unloadEffect=function(t,n){var i=r.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.unloadEffect"});ye(t,"soundId",1,1e4);var a=e.audioMixing.sounds[t];if(!a){var s="SOUND_NOT_EXISTS";return o.default.error(s,t),void i(s)}var c=a.options?a.options.filePath:a.filePath;if(c)delete e.audioMixing.buffer[c],delete e.audioMixing.sounds[t],i(null);else{var d="SOUND_BUFFER_NOT_FOUND";o.default.error(d,t),i(d)}},e.pauseEffect=function(t,n){var i=r.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.pauseEffect"});return e._pauseOneEffect({soundId:t},i)},e.pauseAllEffects=function(t){var n=r.b.reportApiInvoke(e.sid,{callback:t,name:"Stream.pauseAllEffects"}),i=!1,o=0,a=0,s=function(e){i||(e?(n(e),i=!0):o+=1,o===a&&(n(null),i=!0))};for(var c in e.audioMixing.sounds)"-1"!==c&&e.audioMixing.sounds[c].state===e.audioMixing.states.BUSY&&(a++,e._pauseOneEffect({soundId:c},s));a||n(null)},e.resumeEffect=function(t,n){ye(t,"soundId",1,1e4);var i=r.b.reportApiInvoke(e.sid,{callback:n,options:arguments,tag:"tracer",name:"Stream.resumeEffect"});return e._resumeOneEffect({soundId:t},i)},e.resumeAllEffects=function(t){var n=r.b.reportApiInvoke(e.sid,{callback:t,name:"Stream.resumeAllEffects"}),i=!1,o=0,a=0,s=function(e){i||(e?(n(e),i=!0):o+=1,o===a&&(n(null),i=!0))};for(var c in e.audioMixing.sounds)"-1"!==c&&e.audioMixing.sounds[c].state===e.audioMixing.states.PAUSED&&(a++,e._resumeOneEffect({soundId:c},s));a||n(null)},e.getEffectsVolume=function(){var t=[];for(var n in e.audioMixing.sounds){var i=e.audioMixing.sounds[n];i&&"-1"!==n&&t.push({soundId:parseInt(n),volume:i.volume})}return t},e.setEffectsVolume=function(t,n){var i=r.b.reportApiInvoke(e.sid,{name:"Stream.setEffectsVolume",options:arguments,tag:"tracer",callback:n});for(var o in ye(t,"volume",0,100),e.audioMixing.defaultVolume=t,e.audioMixing.sounds){var a=e.audioMixing.sounds[o];"-1"!==o&&(a.volume=t)}e._flushAudioMixingMuteStatus(),i(null)},e.setVolumeOfEffect=function(t,n,i){var o=r.b.reportApiInvoke(e.sid,{name:"Stream.setVolumeOfEffect",options:arguments,tag:"tracer",callback:i});ye(t,"soundId",0,1e4),ye(n,"volume",0,100),e._initSoundIfNotExists(t),e.audioMixing.sounds[t].volume=n,e._flushAudioMixingMuteStatus(),o(null)}}(t),t.on("collectStats",(function(e){e.promises.push(t._getPCStats()),e.promises.push(new Promise((function(e){var n={};t.pc&&t.pc.isSubscriber?null!==window.navigator.userAgent.match("Firefox")&&(pe(n,"videoReceiveResolutionHeight",t.videoHeight),pe(n,"videoReceiveResolutionWidth",t.videoWidth)):t.pc&&!t.pc.isSubscriber&&((Object(p.isSafari)()||Object(p.isFireFox)())&&(pe(n,"videoSendResolutionHeight",t.videoHeight),pe(n,"videoSendResolutionWidth",t.videoWidth)),(Object(p.isSafari)()||Object(p.isFireFox)())&&t.uplinkStats&&pe(n,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),e(n)}))),e.promises.push(new Promise((function(e){var n={};return t.traffic_stats&&t.pc&&t.pc.isSubscriber?(pe(n,"accessDelay",t.traffic_stats.access_delay),pe(n,"endToEndDelay",t.traffic_stats.e2e_delay),pe(n,"videoReceiveDelay",t.traffic_stats.video_delay),pe(n,"audioReceiveDelay",t.traffic_stats.audio_delay)):t.traffic_stats&&t.pc&&!t.pc.isSubscriber&&pe(n,"accessDelay",t.traffic_stats.access_delay),e(n)})))}));var s={true:!0,unspecified:!0,"90p_1":n(160,90),"120p_1":n(160,120),"120p_3":n(120,120),"120p_4":n(212,120),"180p_1":n(320,180),"180p_3":n(180,180),"180p_4":n(240,180),"240p_1":n(320,240),"240p_3":n(240,240),"240p_4":n(424,240),"360p_1":n(640,360),"360p_3":n(360,360),"360p_4":n(640,360),"360p_6":n(360,360),"360p_7":n(480,360),"360p_8":n(480,360),"360p_9":n(640,360),"360p_10":n(640,360),"360p_11":n(640,360),"480p_1":n(640,480),"480p_2":n(640,480),"480p_3":n(480,480),"480p_4":n(640,480),"480p_6":n(480,480),"480p_8":n(848,480),"480p_9":n(848,480),"480p_10":n(640,480),"720p_1":n(1280,720),"720p_2":n(1280,720),"720p_3":n(1280,720),"720p_5":n(960,720),"720p_6":n(960,720),"1080p_1":n(1920,1080),"1080p_2":n(1920,1080),"1080p_3":n(1920,1080),"1080p_5":n(1920,1080),"1440p_1":n(2560,1440),"1440p_2":n(2560,1440),"4k_1":n(3840,2160),"4k_3":n(3840,2160)};return t.setVideoResolution=function(n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.setVideoResolution",options:arguments,tag:"tracer"});return void 0!==s[n+=""]?(e.video=s[n],e.attributes=e.attributes||{},e.attributes.resolution=n,i(),!0):(i(),!1)},t.setVideoFrameRate=function(n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.setVideoFrameRate",options:arguments,tag:"tracer"});return Object(p.isFireFox)()?(i(),!1):"object"===v()(n)&&n instanceof Array&&n.length>1?(e.attributes=e.attributes||{},e.attributes.minFrameRate=n[0],e.attributes.maxFrameRate=n[1],i(),!0):(i(),!1)},t.setVideoBitRate=function(n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.setVideoBitRate",options:arguments,tag:"tracer"});return"object"===v()(n)&&n instanceof Array&&n.length>1?(e.attributes=e.attributes||{},e.attributes.minVideoBW=n[0],e.attributes.maxVideoBW=n[1],t.connectionSpec&&(t.connectionSpec.minVideoBW=n[0],t.connectionSpec.maxVideoBW=n[1]),i(),!0):(i(),!1)},t.setScreenBitRate=function(n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.setScreenBitRate",options:arguments,tag:"tracer"});return"object"===v()(n)&&n instanceof Array&&n.length>1?(e.screenAttributes=e.screenAttributes||{},e.screenAttributes.minVideoBW=n[0],e.screenAttributes.maxVideoBW=n[1],i(),!0):(i(),!1)},t.setScreenProfile=function(e){var n=r.b.reportApiInvoke(t.sid,{name:"Stream.setScreenProfile",options:arguments,tag:"tracer"});if(ge(e,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2"]),"string"==typeof e&&t.screen){switch(e){case"480p_1":t.screenAttributes.width=640,t.screenAttributes.height=480,t.screenAttributes.maxFr=5,t.screenAttributes.minFr=1;break;case"480p_2":t.screenAttributes.width=640,t.screenAttributes.height=480,t.screenAttributes.maxFr=30,t.screenAttributes.minFr=25;break;case"720p_1":t.screenAttributes.width=1280,t.screenAttributes.height=720,t.screenAttributes.maxFr=5,t.screenAttributes.minFr=1;break;case"720p_2":t.screenAttributes.width=1280,t.screenAttributes.height=720,t.screenAttributes.maxFr=30,t.screenAttributes.minFr=25;break;case"1080p_1":t.screenAttributes.width=1920,t.screenAttributes.height=1080,t.screenAttributes.maxFr=5,t.screenAttributes.minFr=1;break;case"1080p_2":t.screenAttributes.width=1920,t.screenAttributes.height=1080,t.screenAttributes.maxFr=30,t.screenAttributes.minFr=25}return n(),!0}return n(),!1},t.setVideoProfileCustom=function(e){var n=r.b.reportApiInvoke(t.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});t.setVideoResolution(e[0]),t.setVideoFrameRate([e[1],e[1]]),t.setVideoBitRate([e[2],e[2]]),n()},t.setVideoProfileCustomPlus=function(i){var o=r.b.reportApiInvoke(t.sid,{name:"Stream.setVideoProfileCustom",options:arguments,tag:"tracer"});e.video=n(i.width,i.height),e.attributes=e.attributes||{},e.attributes.resolution="".concat(i.width,"x").concat(i.height),t.setVideoFrameRate([i.framerate,i.framerate]),t.setVideoBitRate([i.bitrate,i.bitrate]),o()},t.setVideoProfile=function(e){var n=r.b.reportApiInvoke(t.sid,{name:"Stream.setVideoProfile",options:arguments,tag:"tracer"});if(ge(e,"profile",["480p_1","480p_2","720p_1","720p_2","1080p_1","1080p_2","120p","120P","120p_1","120P_1","120p_3","120P_3","180p","180P","180p_1","180P_1","180p_3","180P_3","180p_4","180P_4","240p","240P","240p_1","240P_1","240p_3","240P_3","240p_4","240P_4","360p","360P","360p_1","360P_1","360p_3","360P_3","360p_4","360P_4","360p_6","360P_6","360p_7","360P_7","360p_8","360P_8","360p_9","360P_9","360p_10","360P_10","360p_11","360P_11","480p","480P","480p_1","480P_1","480p_2","480P_2","480p_3","480P_3","480p_4","480P_4","480p_6","480P_6","480p_8","480P_8","480p_9","480P_9","480p_10","480P_10","720p","720P","720p_1","720P_1","720p_2","720P_2","720p_3","720P_3","720p_5","720P_5","720p_6","720P_6","1080p","1080P","1080p_1","1080P_1","1080p_2","1080P_2","1080p_3","1080P_3","1080p_5","1080P_5","1440p","1440P","1440p_1","1440P_1","1440p_2","1440P_2","4k","4K","4k_1","4K_1","4k_3","4K_3"]),t.profile=e,"string"==typeof e&&t.video){switch(e){case"120p":case"120P":case"120p_1":case"120P_1":t.setVideoResolution("120p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([30,65]);break;case"120p_3":case"120P_3":t.setVideoResolution("120p_3"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([30,50]);break;case"180p":case"180P":case"180p_1":case"180P_1":t.setVideoResolution("180p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([30,140]);break;case"180p_3":case"180P_3":t.setVideoResolution("180p_3"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([30,100]);break;case"180p_4":case"180P_4":t.setVideoResolution("180p_4"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([30,120]);break;case"240p":case"240P":case"240p_1":case"240P_1":t.setVideoResolution("240p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([40,200]);break;case"240p_3":case"240P_3":t.setVideoResolution("240p_3"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([40,140]);break;case"240p_4":case"240P_4":t.setVideoResolution("240p_4"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([40,220]);break;case"360p":case"360P":case"360p_1":case"360P_1":t.setVideoResolution("360p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([80,400]);break;case"360p_3":case"360P_3":t.setVideoResolution("360p_3"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([80,260]);break;case"360p_4":case"360P_4":t.setVideoResolution("360p_4"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([80,600]);break;case"360p_6":case"360P_6":t.setVideoResolution("360p_6"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([80,400]);break;case"360p_7":case"360P_7":t.setVideoResolution("360p_7"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([80,320]);break;case"360p_8":case"360P_8":t.setVideoResolution("360p_8"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([80,490]);break;case"360p_9":case"360P_9":t.setVideoResolution("360p_9"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([80,800]);break;case"360p_10":case"360P_10":t.setVideoResolution("360p_10"),t.setVideoFrameRate([24,24]),t.setVideoBitRate([80,800]);break;case"360p_11":case"360P_11":t.setVideoResolution("360p_11"),t.setVideoFrameRate([24,24]),t.setVideoBitRate([80,1e3]);break;case"480p":case"480P":case"480p_1":case"480P_1":t.setVideoResolution("480p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([20,500]);break;case"480p_2":case"480P_2":t.setVideoResolution("480p_2"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([100,1e3]);break;case"480p_3":case"480P_3":t.setVideoResolution("480p_3"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([100,400]);break;case"480p_4":case"480P_4":t.setVideoResolution("480p_4"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([100,750]);break;case"480p_6":case"480P_6":t.setVideoResolution("480p_6"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([100,600]);break;case"480p_8":case"480P_8":t.setVideoResolution("480p_8"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([100,610]);break;case"480p_9":case"480P_9":t.setVideoResolution("480p_9"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([100,930]);break;case"480p_10":case"480P_10":t.setVideoResolution("480p_10"),t.setVideoFrameRate([10,10]),t.setVideoBitRate([100,400]);break;case"720p":case"720P":case"720p_1":case"720P_1":t.setVideoResolution("720p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([120,1130]);break;case"720p_2":case"720P_2":t.setVideoResolution("720p_2"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,2e3]);break;case"720p_3":case"720P_3":t.setVideoResolution("720p_3"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,1710]);break;case"720p_5":case"720P_5":t.setVideoResolution("720p_5"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([120,910]);break;case"720p_6":case"720P_6":t.setVideoResolution("720p_6"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,1380]);break;case"1080p":case"1080P":case"1080p_1":case"1080P_1":t.setVideoResolution("1080p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([120,2080]);break;case"1080p_2":case"1080P_2":t.setVideoResolution("1080p_2"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,3e3]);break;case"1080p_3":case"1080P_3":t.setVideoResolution("1080p_3"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,3150]);break;case"1080p_5":case"1080P_5":t.setVideoResolution("1080p_5"),t.setVideoFrameRate([60,60]),t.setVideoBitRate([120,4780]);break;case"1440p":case"1440P":case"1440p_1":case"1440P_1":t.setVideoResolution("1440p_1"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,4850]);break;case"1440p_2":case"1440P_2":t.setVideoResolution("1440p_2"),t.setVideoFrameRate([60,60]),t.setVideoBitRate([120,7350]);break;case"4k":case"4K":case"4k_1":case"4K_1":t.setVideoResolution("4k_1"),t.setVideoFrameRate([30,30]),t.setVideoBitRate([120,8910]);break;case"4k_3":case"4K_3":t.setVideoResolution("4k_3"),t.setVideoFrameRate([60,60]),t.setVideoBitRate([120,13500]);break;default:t.setVideoResolution("480p_1"),t.setVideoFrameRate([15,15]),t.setVideoBitRate([100,500])}return n(),!0}return n(),!1},t.setAudioProfile=function(e){var n=r.b.reportApiInvoke(t.sid,{name:"Stream.setAudioProfile",options:arguments,tag:"tracer"});if(ge(e,"profile",["speech_low_quality","speech_standard","music_standard","standard_stereo","high_quality","high_quality_stereo"]),t.audioProfile=e,"string"==typeof e&&t.audio){switch(e){case"speech_low_quality":t.highQuality=!1,t.stereo=!1,t.speech=!0,t.lowQuality=!0;break;case"speech_standard":t.highQuality=!1,t.stereo=!1,t.speech=!0,t.lowQuality=!1;break;case"music_standard":t.highQuality=!1,t.stereo=!1,t.speech=!1,t.lowQuality=!1;break;case"standard_stereo":t.highQuality=!1,t.stereo=!0,t.speech=!1,t.lowQuality=!1;break;case"high_quality":t.highQuality=!0,t.stereo=!1,t.speech=!1,t.lowQuality=!1;break;case"high_quality_stereo":t.highQuality=!0,t.stereo=!0,t.speech=!1,t.lowQuality=!1;break;default:t.highQuality=!1,t.stereo=!1,t.speech=!1,t.lowQuality=!1}return n(),!0}return n(),!1},t.getId=function(){return t.streamId},t.getUserId=function(){return t.userId},t.setUserId=function(e){var n=r.b.reportApiInvoke(t.sid,{name:"Stream.setUserId",options:arguments,tag:"tracer"});t.userId&&o.default.warning("[".concat(t.streamId,"] Stream.userId ").concat(t.userId," => ").concat(e)),t.userId=e,n()},t.getAttributes=function(){return e.screen?t.screenAttributes:e.attributes},t.hasAudio=function(){return t.audio},t.hasVideo=function(){return t.video},t.hasScreen=function(){return t.screen},t.isVideoOn=function(){return(t.hasVideo()||t.hasScreen())&&!t.userMuteVideo},t.isAudioOn=function(){return t.hasAudio()&&!t.userMuteAudio},t.init=function(n,i){var a=r.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Stream.init",options:arguments,tag:"tracer"}),s=((new Date).getTime(),arguments[2]);if(void 0===s&&(s=2),!0===t.initialized)return a({type:"warning",msg:"STREAM_ALREADY_INITIALIZED"});if(!0!==t.local)return a({type:"warning",msg:"STREAM_NOT_LOCAL"});if(t.videoSource?t.videoName="videoSource":t.video&&(t.videoName=me.searchDeviceNameById(e.cameraId)||"default"),t.audioSource?t.audioName="audioSource":t.audio&&(t.audioName=me.searchDeviceNameById(e.microphoneId)||"default"),t.screen&&(t.screenName=e.extensionId||"default"),t.videoSource||t.audioSource){var c=new MediaStream;return t.videoSource&&(o.default.debug("[".concat(t.streamId,"] Added videoSource")),c.addTrack(t.videoSource),t.video=!0),t.audioSource&&(o.default.debug("[".concat(t.streamId,"] Added audioSource")),c.addTrack(t.audioSource),t.audio=!0),t.hasVideo()?Object(le.h)(c,(function(e,n){o.default.info("[".concat(t.streamId,"] Video Source width ").concat(e," height ").concat(n)),t.stream=c,t.initialized=!0,a()}),(function(e){o.default.warning("[".concat(t.streamId,"] Failed to get width & height from video source"),e),t.stream=c,t.initialized=!0,a()})):(t.stream=c,t.initialized=!0,a())}try{if((e.audio||e.video||e.screen)&&void 0===e.url){o.default.debug("[".concat(t.streamId,"] Requested access to local media"));var d=e.video;if(e.screen)var u={video:d,audio:!1,screen:!0,data:!0,extensionId:e.extensionId,attributes:t.screenAttributes,fake:e.fake,mediaSource:e.mediaSource,sourceId:e.sourceId,streamId:t.streamId};else if(u={video:d,audio:e.audio,fake:e.fake,streamId:t.streamId},!(null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35)){var l=30,f=30;if(void 0!==e.attributes.minFrameRate&&(l=e.attributes.minFrameRate),void 0!==e.attributes.maxFrameRate&&(f=e.attributes.maxFrameRate),!0===u.audio){u.audio=!e.microphoneId||{deviceId:{exact:e.microphoneId}};var m={};t.audioProcessing&&(void 0!==t.audioProcessing.AGC&&(Object(p.isFireFox)()?m.autoGainControl=t.audioProcessing.AGC:Object(p.isChrome)()&&(m.googAutoGainControl=t.audioProcessing.AGC,m.googAutoGainControl2=t.audioProcessing.AGC)),void 0!==t.audioProcessing.AEC&&(m.echoCancellation=t.audioProcessing.AEC),void 0!==t.audioProcessing.ANS&&(Object(p.isFireFox)()?m.noiseSuppression=t.audioProcessing.ANS:Object(p.isChrome)()&&(m.googNoiseSuppression=t.audioProcessing.ANS))),t.stereo&&Object(p.isChrome)()&&(m.googAutoGainControl=!1,m.googAutoGainControl2=!1,m.echoCancellation=!1,m.googNoiseSuppression=!1),0!==Object.keys(m).length&&(!0===u.audio?u.audio={mandatory:m}:u.audio=y()(u.audio,m))}!0===u.video?(u.video={width:{ideal:t.videoSize[0]},height:{ideal:t.videoSize[1]},frameRate:{ideal:l,max:f}},t.setVideoBitRate([500,500]),u.video.deviceId=e.cameraId?{exact:e.cameraId}:void 0):"object"===v()(u.video)&&(u.video.frameRate={ideal:l,max:f},u.video.deviceId=e.cameraId?{exact:e.cameraId}:void 0)}o.default.debug("[".concat(t.streamId,"] "),u);var g=y()({},u);if(t.constraints=u,ue(g,(function(n){t.screenAudioTrack&&n.addTrack(t.screenAudioTrack);var i=n.getVideoTracks().length>0,r=n.getAudioTracks().length>0;return g.video&&!i&&g.audio&&!r?(o.default.error("[".concat(t.streamId,"] Media access: NO_CAMERA_MIC_PERMISSION")),a("NO_CAMERA_MIC_PERMISSION")):g.video&&!i?(o.default.error("[".concat(t.streamId,"] Media access: NO_CAMERA_PERMISSION")),a("NO_CAMERA_PERMISSION")):g.screen&&!i?(o.default.error("[".concat(t.streamId,"] Media access: NO_SCREEN_PERMISSION")),a("NO_SCREEN_PERMISSION")):g.audio&&!r?(o.default.error("[".concat(t.streamId,"] Media access: NO_MIC_PERMISSION")),a("NO_MIC_PERMISSION")):(o.default.debug("[".concat(t.streamId,"] User has granted access to local media")),t.dispatchEvent({type:"accessAllowed"}),t.stream=n,t.initialized=!0,e.screen&&e.audio&&!t.screenAudioTrack||a(),t.hasVideo()&&Object(le.h)(n,(function(e,n){t.videoWidth=e,t.videoHeight=n}),(function(e){o.default.warning("[".concat(t.streamId,"] vsResHack failed: "),e)})),void(e.screen&&Object(p.isChrome)()&&t.stream&&t.stream.getVideoTracks()[0]&&(t.stream.getVideoTracks()[0].onended=function(){t.dispatchEvent({type:"stopScreenSharing"})})))}),(function(e){var n={type:"error",msg:e.name||e.code||e,info:null};switch(e&&(e.message&&(n.info=e.message),e.code&&(n.info?n.info+=". "+e.code:n.info=" "+e.code),e.constraint&&(n.info?n.info+=". Constraint: "+e.constraint:n.info="constraint: "+e.constraint)),n.msg){case"Starting video failed":case"TrackStartError":if(t.videoSize=void 0,s>0)return void setTimeout((function(){t.init((function(e){return a(e)}),a,s-1)}),1);n.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":n.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":n.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":n.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":t.dispatchEvent({type:"accessDenied"});break;case"InvalidStateError":n.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"NotAllowedError":t.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":n.msg="CONSTRAINT_NOT_SATISFIED";break;default:n.msg||(n.msg="UNDEFINED")}var i="Media access ".concat(n.msg).concat(n.info?": "+n.info:"");o.default.error("[".concat(t.streamId,"] "),i),a(n)})),e.screen&&e.audio){var h=!e.microphoneId||{deviceId:{exact:e.microphoneId}};m={},t.audioProcessing&&(void 0!==t.audioProcessing.AGC&&(Object(p.isFireFox)()?m.autoGainControl=t.audioProcessing.AGC:Object(p.isChrome)()&&(m.googAutoGainControl=t.audioProcessing.AGC,m.googAutoGainControl2=t.audioProcessing.AGC)),void 0!==t.audioProcessing.AEC&&(m.echoCancellation=t.audioProcessing.AEC),void 0!==t.audioProcessing.ANS&&(Object(p.isFireFox)()?m.noiseSuppression=t.audioProcessing.ANS:Object(p.isChrome)()&&(m.googNoiseSuppression=t.audioProcessing.ANS))),t.stereo&&Object(p.isChrome)()&&(m.googAutoGainControl=!1,m.googAutoGainControl2=!1,m.echoCancellation=!1,m.googNoiseSuppression=!1),0!==Object.keys(m).length&&(h=!0===h?{mandatory:m}:y()(h,m));var S={video:!1,audio:h};o.default.debug("[".concat(t.streamId,"] "),S),ue(S,(function(e){o.default.info("[".concat(t.streamId,"] User has granted access to auxiliary local media.")),t.dispatchEvent({type:"accessAllowed"});var n=e.getAudioTracks()[0];t.stream?(t.stream.addTrack(n),a()):t.screenAudioTrack=n}),(function(e){var n={type:"error",msg:e.name||e.code||e,info:null};switch(e&&(e.message&&(n.info=e.message),e.code&&(n.info?n.info+=". "+e.code:n.info=" "+e.code),e.constraint&&(n.info?n.info+=". Constraint: "+e.constraint:n.info="constraint: "+e.constraint)),n.msg){case"Starting video failed":case"TrackStartError":if(t.videoSize=void 0,s>0)return void setTimeout((function(){t.init((function(e){return a(e)}),a,s-1)}),1);n.msg="MEDIA_OPTION_INVALID";break;case"DevicesNotFoundError":n.msg="DEVICES_NOT_FOUND";break;case"NotSupportedError":n.msg="NOT_SUPPORTED";break;case"PermissionDeniedError":case"InvalidStateError":n.msg="PERMISSION_DENIED",t.dispatchEvent({type:"accessDenied"});break;case"PERMISSION_DENIED":case"NotAllowedError":t.dispatchEvent({type:"accessDenied"});break;case"ConstraintNotSatisfiedError":n.msg="CONSTRAINT_NOT_SATISFIED";break;default:n.msg||(n.msg="UNDEFINED")}var i="Media access ".concat(n.msg).concat(n.info?": "+n.info:"");o.default.error("[".concat(t.streamId,"] "),i),a(n)}))}}else a({type:"warning",msg:"STREAM_HAS_NO_MEDIA_ATTRIBUTES"})}catch(e){o.default.error("[".concat(t.streamId,"] Stream init: "),e),a({type:"error",msg:e.message||e})}},t.close=function(){var e=r.b.reportApiInvoke(null,{name:"Stream.close",options:arguments,tag:"tracer"});if(o.default.debug("[".concat(t.streamId,"] Close stream with id"),t.streamId),void 0!==t.stream){var n=t.stream.getTracks();for(var i in n)n.hasOwnProperty(i)&&n[i].stop();t.stream=void 0}Object(p.isSafari)()&&t.pc&&t.pc.peerConnection&&t.pc.peerConnection.removeTrack&&t.pc.peerConnection.getSenders&&t.pc.peerConnection.getSenders().forEach((function(e){e&&(o.default.debug("[".concat(t.streamId,"] Remove Track"),e),t.pc.peerConnection.removeTrack(e))})),t.initialized=!1,t._onAudioMute=void 0,t._onAudioUnmute=void 0,t._onVideoMute=void 0,t._onVideoUnmute=void 0,t.lowStream&&t.lowStream.close(),e()},t.enableAudio=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.enableAudio",options:arguments,tag:"tracer"});o.default.deprecate("[".concat(t.streamId,"] Stream.enableAudio is deprecated and will be removed in the future. Use Stream.unmuteAudio instead"));var n=t._unmuteAudio();return n&&(t.userMuteAudio=!1),e(null,n),n},t.disableAudio=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.disableAudio",options:arguments,tag:"tracer"});o.default.deprecate("[".concat(t.streamId,"] Stream.disableAudio is deprecated and will be removed in the future. Use Stream.muteAudio instead"));var n=t._muteAudio();return n&&(t.userMuteAudio=!0),e(null,n),n},t.enableVideo=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.enableVideo",options:arguments,tag:"tracer"});o.default.deprecate("[".concat(t.streamId,"] Stream.enableVideo is deprecated and will be removed in the future. Use Stream.unmuteVideo instead"));var n=t._unmuteVideo();return n&&(t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1)),e(null,n),n},t.disableVideo=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.disableVideo",options:arguments,tag:"tracer"});o.default.deprecate("[".concat(t.streamId,"] Stream.disableVideo is deprecated and will be removed in the future. Use Stream.muteVideo instead"));var n=t._muteVideo();return n&&(t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0)),e(null,n),n},t.unmuteAudio=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.unmuteAudio",options:arguments,tag:"tracer"}),n=t._unmuteAudio();return n&&(t.userMuteAudio=!1),e(null,n),n},t.muteAudio=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.muteAudio",options:arguments,tag:"tracer"}),n=t._muteAudio();return n&&(t.userMuteAudio=!0),e(null,n),n},t.unmuteVideo=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.unmuteVideo",options:arguments,tag:"tracer"}),n=t._unmuteVideo();return n&&(t.userMuteVideo=!1,t.lowStream&&(t.lowStream.userMuteVideo=!1)),e(null,n),n},t.muteVideo=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.muteVideo",options:arguments,tag:"tracer"}),n=t._muteVideo();return n&&(t.userMuteVideo=!0,t.lowStream&&(t.lowStream.userMuteVideo=!0)),e(null,n),n},t._unmuteAudio=function(){return o.default.debug("[".concat(t.streamId,"] Unmuted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!1),!(!t.hasAudio()||!t.initialized||void 0===t.stream||!0===t.stream.getAudioTracks()[0].enabled||(t._onAudioUnmute&&t._onAudioUnmute(),t.pc&&(t.pc.isAudioMute=!1),t.stream.getAudioTracks()[0].enabled=!0,0))},t._isAudioMuted=function(){if(t.stream&&t.hasAudio()){var e=t.stream.getAudioTracks();return e.length>0&&!e[0].enabled}return!1},t._muteAudio=function(){return o.default.debug("[".concat(t.streamId,"] Muted audio stream with id "),t.streamId),t._flushAudioMixingMuteStatus(!0),!!(t.hasAudio()&&t.initialized&&void 0!==t.stream&&t.stream.getAudioTracks()[0].enabled)&&(t._onAudioMute&&t._onAudioMute(),t.pc&&(t.pc.isAudioMute=!0),t.stream.getAudioTracks()[0].enabled=!1,t.sid&&r.b.audioSendingStopped(t.sid,{succ:!0,reason:"muteAudio"}),!0)},t._unmuteVideo=function(){return o.default.debug("[".concat(t.streamId,"] Unmuted video stream with id"),t.streamId),!(!t.initialized||void 0===t.stream||!t.stream.getVideoTracks().length||!0===t.stream.getVideoTracks()[0].enabled||(t._onVideoUnmute&&t._onVideoUnmute(),t.pc&&(t.pc.isVideoMute=!1),t.stream.getVideoTracks()[0].enabled=!0,t.lowStream&&t.lowStream._unmuteVideo(),0))},t._muteVideo=function(){return o.default.debug("[".concat(t.streamId,"] Muted video stream with id"),t.streamId),!!(t.initialized&&void 0!==t.stream&&t.stream.getVideoTracks().length&&t.stream.getVideoTracks()[0].enabled)&&(t._onVideoMute&&t._onVideoMute(),t.pc&&(t.pc.isVideoMute=!0),t.stream.getVideoTracks()[0].enabled=!1,t.lowStream&&t.lowStream._muteVideo(),t.sid&&r.b.videoSendingStopped(t.sid,{succ:!0,reason:"muteVideo"}),!0)},t.addTrack=function(n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.addTrack",options:arguments,tag:"tracer"});if(t.pc&&t.pc.addTrack(n,t.stream),"audio"==n.kind){var o=new MediaStream;t.userMuteAudio&&(n.enabled=!1),o.addTrack(n);var a=t.stream.getVideoTracks()[0];a&&(o.addTrack(a),t.audio=!0,e.audio=!0),t.stream=o,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream)}else t.userMuteVideo&&(n.enabled=!1),t.stream.addTrack(n),t.video=!0,e.video=!0;i()},t.removeTrack=function(n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.removeTrack",options:arguments,tag:"tracer"});t.pc&&t.pc.removeTrack(n,t.stream),t.stream.removeTrack(n),"audio"===n.kind?(t.audio=!1,e.audio=!1):(t.video=!1,e.video=!1),t.audioLevelHelper=null,"live"==n.readyState&&(n.stop(),o.default.debug("[".concat(t.streamId,"] Track ").concat(n.kind," Stopped"))),i()},t.setAudioOutput=function(e,n,i){var a=r.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Stream.setAudioOutput",options:arguments,tag:"tracer"});return be(e,1,255)?(t.audioOutput=e,t.player?void t.player.setAudioOutput(e,(function(){return a()}),a):a()):(o.default.error("[".concat(t.streamId,"] setAudioOutput Invalid Parameter"),e),a(A))},t.play=function(e,n){var i=r.b.reportApiInvoke(t.sid,{name:"Stream.play",options:arguments,tag:"tracer"});he(e,"elementID"),Re(n)||(Re(n.fit)||ge(n.fit,"fit",["cover","contain"]),Re(n.muted)||Se(n.muted,"muted")),t.elementID=e,t.playOptions=n,t.isPlaying()?o.default.error("[".concat(t.streamId,"] Stream.play(): Stream is already playing")):!t.local||t.video||t.screen?void 0!==e&&(t.player=new ee({id:t.getId(),stream:t,elementID:e,options:n})):t.hasAudio()&&(t.player=new ee({id:t.getId(),stream:t,elementID:e,options:n})),t.audioOutput&&t.player.setAudioOutput(t.audioOutput),void 0!==t.audioLevel&&t.player.setAudioVolume(t.audioLevel),t._flushAudioMixingMuteStatus(!1),i()},t.stop=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.stop",options:arguments,tag:"tracer"});o.default.debug("[".concat(t.streamId,"] Stop stream player with id "),t.streamId),t.player?(t.player.destroy(),delete t.player):o.default.error("[".concat(t.streamId,"] Stream.stop(): Stream is not playing")),t._flushAudioMixingMuteStatus(!0),e()},t.isPlaying=function(){return!!t.player},t.isPaused=function(){return!(!t.player||!(t.player.video&&t.player.video.paused||t.player.audio&&t.player.audio.paused))},t.resume=function(){var e=!1;return t.player&&(t.player.video&&t.player.video.play&&(t.player.video.play(),e=!0),t.player.audio&&t.player.audio.play&&(t.player.audio.play(),e=!0)),e},t.getVideoTrack=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.getVideoTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getVideoTracks){var n=t.stream.getVideoTracks()[0];if(n)return o.default.info("[".concat(t.streamId,"] getVideoTrack"),n),e(),n}o.default.info("[".concat(t.streamId,"] getVideoTrack None")),e(null,"getVideoTrack None")},t.getAudioTrack=function(){var e=r.b.reportApiInvoke(t.sid,{name:"Stream.getAudioTrack",options:arguments,tag:"tracer"});if(t.stream&&t.stream.getAudioTracks){var n=t.stream.getAudioTracks()[0];if(n)return o.default.info("[".concat(t.streamId,"] getAudioTracks"),n),e(),n}o.default.info("[".concat(t.streamId,"] getAudioTracks None")),e(null,"getAudioTracks None")},t._replaceMediaStreamTrack=function(e,n,i){if(t.stream){if("video"==e.kind){if(a=t.stream.getVideoTracks()[0])return t.userMuteVideo&&(e.enabled=!1),t.stream.removeTrack(a),t.stream.addTrack(e),o.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(e.kind," SUCCESS")),"live"==a.readyState&&(a.stop(),o.default.debug("[".concat(t.streamId,"] Track ").concat(a.kind," Stopped"))),n&&n();var r="MEDIASTREAM_TRACK_NOT_FOUND";return o.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(e.kind)),i(r)}if("audio"==e.kind){var a;if(a=t.stream.getAudioTracks()[0]){t.userMuteAudio&&(e.enabled=!1);var s=new MediaStream;s.addTrack(e);var c=t.stream&&t.stream.getVideoTracks()[0];return c&&s.addTrack(c),t.stream=s,t.audioLevelHelper=null,t.player&&t.player.video&&(t.player.video.srcObject=t.stream),o.default.debug("[".concat(t.streamId,"] _replaceMediaStreamTrack SUCCESS")),"live"==a.readyState&&(a.stop(),o.default.debug("[".concat(t.streamId,"] Track ").concat(a.kind," Stopped"))),n&&n()}return r="MEDIASTREAM_TRACK_NOT_FOUND",o.default.error("[".concat(t.streamId,"] MEDIASTREAM_TRACK_NOT_FOUND ").concat(e.kind)),i(r)}return r="INVALID_TRACK_TYPE",o.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(r," ").concat(e.kind)),i&&i(r)}return r="NO_STREAM_FOUND",o.default.error("[".concat(t.streamId,"] _replaceMediaStreamTrack ").concat(r)),i&&i(r)},t.replaceTrack=function(e,n,i){var a=r.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Stream.replaceTrack",options:arguments,tag:"tracer"});return e&&e.kind?t.pc&&t.pc.hasSender&&t.pc.hasSender(e.kind)?void t.pc.replaceTrack(e,(function(){return o.default.debug("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(e.kind," SUCCESS")),t._replaceMediaStreamTrack(e,(function(e){return a(null,e)}),a)}),(function(n){return o.default.error("[".concat(t.streamId,"] PeerConnection.replaceTrack ").concat(e.kind," Failed ").concat(n)),a(n)})):t._replaceMediaStreamTrack(e,(function(e){return a(null,e)}),a):a("INVALID_TRACK")},t.setAudioVolume=function(e){var n=r.b.reportApiInvoke(t.sid,{name:"Stream.setAudioVolume",options:arguments,tag:"tracer"});ye(e,"level",0,100),t.audioLevel=e,t.player&&t.player.setAudioVolume(e),n()},t.getStats=function(e,n){var i={type:"collectStats",promises:[]};t.dispatchEvent(i),Promise.all(i.promises).then((function(n){for(var i={},o=n.length-1;o>=0;o--){var r=n[o];y()(i,r)}e&&setTimeout(e.bind(t,i),0)})).catch((function(e){n&&setTimeout(n.bind(t,e),0)}))},t._getPCStats=function(){return new Promise((function(e,n){if(!t.pc||"established"!==t.pc.state||!t.pc.getStats)return n("PEER_CONNECTION_NOT_ESTABLISHED");t.pc.getStats((function(i){if(!t.pc||"established"!==t.pc.state||!t.pc.getStats)return n("PEER_CONNECTION_STATE_CHANGE");var o=t.pc.isSubscriber?function(e){var t={};return e.forEach((function(e){e.id&&(-1===e.id.indexOf("recv")&&-1===e.id.indexOf("inbound_rtp")&&-1===e.id.indexOf("inbound-rtp")&&-1===e.id.indexOf("InboundRTP")||("audio"===e.mediaType?(pe(t,"audioReceiveBytes",e.bytesReceived),pe(t,"audioReceivePackets",e.packetsReceived),pe(t,"audioReceivePacketsLost",e.packetsLost)):(pe(t,"videoReceiveBytes",e.bytesReceived),pe(t,"videoReceivePacketsLost",e.packetsLost),pe(t,"videoReceivePackets",e.packetsReceived),pe(t,"videoReceiveFrameRate",e.googFrameRateReceived),pe(t,"videoReceiveDecodeFrameRate",e.googFrameRateDecoded),pe(t,"videoReceiveResolutionWidth",e.googFrameWidthReceived),pe(t,"videoReceiveResolutionHeight",e.googFrameHeightReceived))))})),t}(i):function(e){var t={};return e.forEach((function(e){e.id&&(-1===e.id.indexOf("send")&&-1===e.id.indexOf("outbound_rtp")&&-1===e.id.indexOf("OutboundRTP")||("audio"===e.mediaType?(pe(t,"audioSendBytes",e.bytesSent),pe(t,"audioSendPackets",e.packetsSent),pe(t,"audioSendPacketsLost",e.packetsLost)):(pe(t,"videoSendBytes",e.bytesSent),pe(t,"videoSendPackets",e.packetsSent),pe(t,"videoSendPacketsLost",e.packetsLost),pe(t,"videoSendFrameRate",e.googFrameRateSent),pe(t,"videoSendResolutionWidth",e.googFrameWidthSent),pe(t,"videoSendResolutionHeight",e.googFrameHeightSent))))})),t}(i);return e(o)}))})).then((function(e){return t.pc.isSubscriber?(Object(p.isFireFox)()||Object(p.isSafari)())&&(pe(e,"videoReceiveResolutionHeight",t.videoHeight),pe(e,"videoReceiveResolutionWidth",t.videoWidth)):((Object(p.isSafari)()||Object(p.isFireFox)())&&(pe(e,"videoSendResolutionHeight",t.videoHeight),pe(e,"videoSendResolutionWidth",t.videoWidth)),(Object(p.isSafari)()||Object(p.isFireFox)())&&t.uplinkStats&&pe(e,"videoSendPacketsLost",t.uplinkStats.uplink_cumulative_lost)),Promise.resolve(e)}))},t.getAudioLevel=function(){return t.audioLevelHelper?t.audioLevelHelper.getAudioLevel():t.stream?0!==t.stream.getAudioTracks().length?(t.audioLevelHelper=new le.a(t.stream),t.audioLevelHelper.getAudioLevel()):void o.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no audio trace in stream")):(o.default.warning("[".concat(t.streamId,"] can't get audioLevel beacuse no stream exist")),0)},t.setVideoProfile("480P"),t._switchVideoDevice=function(e,n,i){if(e===t.cameraId)return n&&n();t.constraints.video.deviceId={exact:e};var r=y()({},t.constraints);r.audio=!1,o.default.debug("[".concat(t.streamId,"] ").concat(r)),ue(r,(function(o){try{Object(p.isSafari)()?t.replaceTrack(o.getVideoTracks()[0],(function(){t.userMuteVideo&&(t.stream.getVideoTracks()[0].enabled=!1),n&&n()}),i):(t.removeTrack(t.stream.getVideoTracks()[0]),t.addTrack(o.getVideoTracks()[0]),t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID)),t.cameraId=e,t.userMuteVideo&&(t.stream.getVideoTracks()[0].enabled=!1),n&&n())}catch(e){return i&&i(e)}}),(function(e){return i&&i(e)}))},t._switchAudioDevice=function(e,n,i){if(e===t.microphoneId)return n&&n();!0===t.constraints.audio?t.constraints.audio={deviceId:{exact:e}}:t.constraints.audio.deviceId={exact:e};var r=y()({},t.constraints);r.video=!1,o.default.debug("[".concat(t.streamId,"] "),r),ue(r,(function(o){try{Object(p.isSafari)()?t.replaceTrack(o.getAudioTracks()[0],n,i):(t.removeTrack(t.stream.getAudioTracks()[0]),t.addTrack(o.getAudioTracks()[0]),t.audioMixing.audioContextInited&&(t.audioMixing.ctx.close(),t.audioMixing.audioContextInited=!1),t.userMuteAudio&&(t.stream.getAudioTracks()[0].enabled=!1),t.isPlaying()&&(t.stop(),t.elementID&&t.play(t.elementID)),t.microphoneId=e,n&&n())}catch(e){return i&&i(e)}}),(function(e){return i&&i(e)}))},t.switchDevice=function(e,n,i,a){var s=r.b.reportApiInvoke(t.sid,{callback:function(e,t){if(e)return a&&a(e);i&&i(t)},name:"Stream.switchDevice",options:arguments,tag:"tracer"});he(n,"deviceId");var c=function(){return t.inSwitchDevice=!1,s()},d=function(e){t.inSwitchDevice=!1,o.default.error("[".concat(t.streamId,"] "),e),s(e)};if(t.inSwitchDevice)return s("Device switch is in process.");if(t.inSwitchDevice=!0,!t.local)return d("Only the local stream can switch the device.");if(t.screen&&"video"===e)return d("The device cannot be switched during screen-sharing.");if(t.videoSource||t.audioSource)return d("The device cannot be switched when using videoSource or audioSource.");if(t.lowStream)return d("The device cannot be switched when using lowstream.");var u=!1;for(var l in t.audioMixing.sounds)if(t.audioMixing.sounds[l].state!==t.audioMixing.states.IDLE){u=!0;break}if(t.audioMixing.audioContextInited&&u)return d("The device cannot be switched when using audio Mixing.");me.getDeviceById(n,(function(){if("video"===e)t._switchVideoDevice(n,c,d);else{if("audio"!==e)return d("Invalid type.");t._switchAudioDevice(n,c,d)}}),(function(){return d("The device does not exist.")}))},t},Oe=n(12),ke=["live","rtc","web","interop","h264_interop","web-only"],De=["vp8","h264"],Ne=["aes-128-xts","aes-256-xts","aes-128-ecb"],xe=function(e){e&&e.apply(this,[].slice.call(arguments,1))},Me=n(5),Pe=function(e,t){var n={connect:function(){t.host=e,n.signal=function(e){var t=a();return t.needReconnect=!0,t.isTimeout=!1,t.isInit=!0,t.sendbytes=0,t.recvbytes=0,t.startTime=Date.now(),t.clientId=e.clientId,t.hostIndex=0,t.requestID=0,e.host instanceof Array?t.host=e.host:t.host=[e.host],t.getSendBytes=function(){return t.sendbytes},t.getRecvBytes=function(){return t.recvbytes},t.getDuration=function(){return Math.ceil((Date.now()-t.startTime)/1e3)},t.getURL=function(){return t.connection.url},t.reconnect=function(){t.isInit=!0,t.creatConnection()},t.connectNext=function(){t.isInit=!0,++t.hostIndex,o.default.debug("["+t.clientId+"] Gateway length:"+t.host.length+" current index:"+t.hostIndex),t.hostIndex>=t.host.length?t.dispatchEvent(u({type:"recover"})):t.creatConnection()},t.replaceHost=function(e){t.host=e||t.host,t.hostIndex=0,t.creatConnection()},t.creatConnection=function(){o.default.debug("["+t.clientId+"] start connect:"+t.host[t.hostIndex]),t.lts=(new Date).getTime(),t.connection=new WebSocket("wss://"+t.host[t.hostIndex]),t.connection.onopen=function(e){o.default.debug("["+t.clientId+"] websockect opened: "+t.host[t.hostIndex]),t.needReconnect=!0,t.isTimeout=!1,t.isInit=!1,t.sendbytes=0,t.recvbytes=0,t.startTime=Date.now(),Object(Me.d)(),clearTimeout(t.timeoutCheck),t.dispatchEvent(u({type:"onopen",event:e,socket:t}))},t.connection.onmessage=function(e){t.recvbytes+=Object(le.e)(e.data);var n=JSON.parse(e.data);n.hasOwnProperty("_id")?t.dispatchEvent(u({type:n._id,msg:n})):n.hasOwnProperty("_type")&&t.dispatchSocketEvent(u({type:n._type,msg:n.message}))},t.connection.onclose=function(n){t.needReconnect?t.isTimeout||t.isInit?(o.default.debug("["+t.clientId+"] websockect connect timeout"),r.b.joinGateway(e.sid,{lts:t.lts,succ:!1,ec:"timeout",addr:t.connection.url}),t.connectNext()):t.dispatchEvent(u({type:"disconnect",event:n})):(o.default.debug("["+t.clientId+"] websockect closeed"),xe(e.onFailure,n),clearTimeout(t.timeoutCheck),t.dispatchEvent(u({type:"close",event:n})),t.connection.onopen=void 0,t.connection.onclose=void 0,t.connection.onerror=void 0,t.connection.onmessage=void 0,t.connection=void 0)},t.connection.onerror=function(e){},setTimeout((function(){t.connection&&t.connection.readyState!=WebSocket.OPEN&&(t.isTimeout=!0,t.connection.close())}),5e3)},t.creatConnection(),t.sendMessage=function(e,n){if(t.connection&&t.connection.readyState==WebSocket.OPEN){var i=JSON.stringify(e);t.sendbytes+=Object(le.e)(i),t.connection.send(i)}else n({error:"Gateway not connected"})},t.disconnect=function(){t.needReconnect=!0,t.connection.close()},t.close=function(){t.needReconnect=!1,t.connection.onclose=void 0,t.connection.close()},t.sendSignalCommand=function(e,n){e._id="_request_"+t.requestID,t.requestID+=1,"publish_stats"!==e._type&&"subscribe_stats"!==e._type&&"publish_stats_low"!==e._type&&t.on(e._id,(function(i){i.msg&&n&&n(i.msg._result,i.msg.message),delete t.dispatcher.eventListeners[e._id]})),t.sendMessage(e,(function(e){e.reason="NOT_CONNECTED",n&&n(e.reason,e)}))},t}(t),n.on=n.signal.on,n.dispatchEvent=n.signal.dispatchEvent,n.signal.on("onopen",(function(e){n.signal.onEvent=function(e){n.dispatchEvent(u({type:e.event,msg:e}))},n.dispatchEvent(u({type:"connect",msg:e}))})),n.signal.on("onError",(function(e){var t=e.msg;onError(t.code,"error")}))},getSendBytes:function(){return n.signal.getSendBytes()},getRecvBytes:function(){return n.signal.getRecvBytes()},getDuration:function(){return n.signal.getDuration()},disconnect:function(){n.signal.disconnect()},close:function(){n.signal.close()},getURL:function(){return n.signal.getURL()},reconnect:function(){n.signal.reconnect()},connectNext:function(){n.signal.connectNext()},replaceHost:function(e){n.signal.replaceHost(e)},emitSimpleMessage:function(e,t){n.signal.sendSignalCommand(e,t)}};return n.connect(),n},Le=function(e,t,n){var i={service_name:"webrtc_proxy",json_body:JSON.stringify(t)};Object(Me.c)(e,i,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}),{"X-Packet-Service-Type":0,"X-Packet-URI":61})},Ve=function(e){if(!e||[]instanceof Array==0)return[];var t=[];return e.forEach((function(e){var n;e.address&&e.tcp?(e.address.match(/^[\.\:\d]+$/)?n="".concat(e.address.replace(/[^\d]/g,"-"),".edge.agora.io"):(o.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(e.address,". Used As Host instead")),n="".concat(e.address,":").concat(e.tcp)),t.push(n)):o.default.error("["+joinInfo.clientId+"] Invalid address format ",e)})),t},je=function(e,t,n,i){var a=(new Date).getTime(),s="";t.multiIP&&t.multiIP.gateway_ip&&(s={vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]});var c={flag:4,ts:+new Date,key:t.appId,cname:t.cname,detail:{},uid:t.uid||0};s&&(c.detail[5]=JSON.stringify(s)),Object(Me.c)(e,c,(function(s){try{var c=JSON.parse(s).res,d=c.code}catch(e){var u="requestChooseServer failed with unexpected body "+s;return o.default.error("["+joinInfo.clientId+"]",u),i(u)}if(d){var l=b[c.code]||d;return r.b.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:e,serverList:null,ec:l}),i("Get server node failed ["+l+"]",e,l)}var p=[],f=[".agora.io",".agoraio.cn"],m=0;if(e.indexOf(f[1])>-1&&(m=1),c.addresses.forEach((function(e){var t;e.ip&&e.port?(e.ip.match(/^[\.\:\d]+$/)?t="webrtc-".concat(e.ip.replace(/[^\d]/g,"-")).concat(f[m++%f.length],":").concat(e.port):(o.default.info("["+joinInfo.clientId+"] "+"Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),t="".concat(e.ip,":").concat(e.port)),p.push(t)):o.default.error("["+joinInfo.clientId+"] Invalid address format ",e)})),!p.length)return o.default.error("["+joinInfo.clientId+"] Empty Address response",c),l="EMPTY_ADDRESS_RESPONSE",r.b.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:e,serverList:null,ec:l}),i("Get server node failed ["+l+"]",e,l);var g={gateway_addr:p,uid:c.uid,cid:c.cid,uni_lbs_ip:c.detail};return n(g,e)}),(function(e,n){"timeout"===e.type?(r.b.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:n,serverList:null,ec:"timeout"}),i("Connect choose server timeout",n)):r.b.joinChooseServer(t.sid,{lts:a,succ:!1,csAddr:n,serverList:null,ec:"server_wrong"})}),{"X-Packet-Service-Type":0,"X-Packet-URI":44})},Fe=function(e,t,n){var a=!1,s=null,c=1,d=1,u=null,l=function t(n,d){if(!a){var l=!1,f=!1,m=[],g=p.getBrowserInfo()||{};(function(e,t){var n=y()({},e),o=Object(i.getParameter)("WEBCS_DOMAIN").concat(Object(i.getParameter)("WEBCS_DOMAIN_BACKUP_LIST")),r=[],a=!1;(o=o.map((function(e){return n.proxyServer?"https://".concat(n.proxyServer,"/ap/?url=").concat(e+"/api/v1"):"https://".concat(e,"/api/v1")}))).map((function(e){!function(e,t,n){var i={flag:64,cipher_method:0,timeout:1e3,features:t};Object(Me.c)(e,i,(function(e){try{var t=JSON.parse(e);n&&n(null,t)}catch(e){n&&n(e)}n&&n(null,e)}),(function(e){n&&n(e)}),{"X-Packet-Service-Type":0,"X-Packet-URI":54})}(e,n,(function(e,n){a||(e?(r.push(e),r.length>=o.length&&t&&t("ALL_REQUEST_FAILED")):(a=!0,t&&t(null,n)))}))}))})({device:g.name,system:g.os,vendor:e.appId,version:i.VERSION,cname:e.cname,sid:e.sid,session_id:Object(r.a)(),detail:"",proxyServer:n},(function(t,n){f=!0;try{var i=Object.keys(n.test_tags)[0],o=JSON.parse(n.test_tags[i]);u=o[1]}catch(e){u=null}r.b.reportApiInvoke(e.sid,{name:"_config-distribute-request",options:{err:t,res:n}})(),l&&d&&d(m,u)})),function(e,t,n){for(var a=(new Date).getTime(),s=!1,c=!0,d=function(n,i){if(s)r.b.joinChooseServer(e.sid,{lts:a,succ:!0,csAddr:i,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null},!1);else{if(clearTimeout(g),s=!0,o.default.debug("["+e.clientId+"] Get gateway address:",n.gateway_addr),e.proxyServer){for(var c=n.gateway_addr,d=0;d<c.length;d++){var u=c[d].split(":");n.gateway_addr[d]=e.proxyServer+"/ws/?h="+u[0]+"&p="+u[1]}o.default.debug("["+e.clientId+"] Get gateway address:",n.gateway_addr)}t(n),r.b.joinChooseServer(e.sid,{lts:a,succ:!0,csAddr:i,serverList:n.gateway_addr,cid:n.cid+"",uid:n.uid+"",ec:null},!0)}},u=function(t,i,r){c&&(o.default.error("["+e.clientId+"]",t,i,r),r&&!_.includes(r)&&(c=!1,n(r)))},l=Object(i.getParameter)("WEBCS_DOMAIN"),p=0;p<l.length;++p){var f;if("string"==typeof l[p]){var m=l[p];f=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(m+"/api/v1"):"https://".concat(m,"/api/v1"),o.default.debug("["+e.clientId+"] "+"Connect to choose_server: ".concat(f)),je(f,e,d,u)}else o.default.error("["+e.clientId+"] Invalid Host",l[p])}var g=setTimeout((function(){if(!s)for(var t=Object(i.getParameter)("WEBCS_DOMAIN_BACKUP_LIST"),n=0;n<t.length;++n)if("string"==typeof t[n]){var r=t[n];f=e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(r+"/api/v1"):"https://".concat(r,"/api/v1"),o.default.debug("["+e.clientId+"] "+"Connect to backup_choose_server: ".concat(f)),je(f,e,d,u)}else o.default.error("["+e.clientId+"] Invalid Host",t[n])}),1e3);setTimeout((function(){!s&&c&&n()}),Object(i.getParameter)("WEBCS_BACKUP_CONNECT_TIMEOUT"))}(e,(function(e){a=!0,l=!0,m=e,clearTimeout(s),f&&d&&d(m,u)}),(function(i){i?o.default.info("["+e.clientId+"] Join failed: "+i):(o.default.debug("["+e.clientId+"] Request gateway list will be restart in "+c+"s"),s=setTimeout((function(){t(n,d)}),1e3*c),c=c>=3600?3600:2*c)}))}};e.useProxyServer?function n(){!function(e,t){!function(e,t){var n=!1,a=0,s={command:"convergeAllocateEdge",sid:e.sid,appId:e.appId,token:e.token,uid:e.uid,cname:e.cname,ts:Math.floor(Date.now()/1e3),version:i.VERSION,seq:0,requestId:1};Object(i.getParameter)("PROXY_CS").map((function(c){var d=(new Date).getTime();Le("https://"+c+"/api/v1",s,(function(s,u){if(s)return o.default.debug("["+e.clientId+"] Request proxy server failed: ",s),a++,r.b.requestProxyAppCenter(e.sid,{lts:d,succ:!1,APAddr:c,workerManagerList:null,ec:JSON.stringify(s),response:JSON.stringify({err:s,res:u})}),void(a>=Object(i.getParameter)("PROXY_CS").length&&t&&t("Get proxy server failed: request all failed"));if(!n)if((u=JSON.parse(u)).json_body){var l=JSON.parse(u.json_body);if(o.default.debug("["+e.clientId+"] App return:",l.servers),200!==l.code)s="Get proxy server failed: response code ["+l.code+"], reason [ "+l.reason+"]",o.default.debug("["+e.clientId+"] "+s),r.b.requestProxyAppCenter(e.sid,{lts:d,succ:!1,APAddr:c,workerManagerList:null,ec:s,response:JSON.stringify({err:s,res:u})});else{n=!0;var p=Ve(l.servers);r.b.requestProxyAppCenter(e.sid,{lts:d,succ:!0,APAddr:c,workerManagerList:JSON.stringify(p),ec:null,response:JSON.stringify({res:u})}),t&&t(null,p)}}else o.default.debug("["+e.clientId+"] Get proxy server failed: no json_body"),r.b.requestProxyAppCenter(e.sid,{lts:d,succ:!1,APAddr:c,workerManagerList:null,ec:"Get proxy server failed: no json_body",response:JSON.stringify({res:u})})}))}))}(e,(function(n,i){if(n)return t&&t(n);o.default.debug("["+e.clientId+"] getProxyServerList: ",i),function(e,t,n){var i=!1,a=0,s={command:"request",gatewayType:"http",appId:e.appId,cname:e.cname,uid:e.uid+"",sdkVersion:"2.3.1",sid:e.sid,seq:1,ts:+new Date,requestId:3,clientRequest:{appId:e.appId,cname:e.cname,uid:e.uid+"",sid:e.sid}};t.map((function(c){var d=(new Date).getTime();!function(e,t,n){Object(Me.c)(e,t,(function(e){n&&n(null,e)}),(function(e){n&&n(e)}))}("https://"+c+":4000/v2/machine",s,(function(s,u){if(s)return o.default.debug("["+e.clientId+"] Request worker manager failed: ",s),a++,r.b.requestProxyWorkerManager(e.sid,{lts:d,succ:!1,workerManagerAddr:c,ec:JSON.stringify(s),response:JSON.stringify({res:u})}),void(a>=t.length&&n&&n("requeet worker manager server failed: request failed"));if(!i){if(!(u=JSON.parse(u)).serverResponse)return n&&n("requeet worker manager server failed: serverResponse is undefined");i=!0,r.b.requestProxyWorkerManager(e.sid,{lts:d,succ:!0,workerManagerAddr:c,ec:JSON.stringify(s),response:JSON.stringify({res:u})}),n&&n(null,{address:c,serverResponse:u.serverResponse})}}))}))}(e,i,t)}))}(e,(function(i,a){if(i)return o.default.debug("["+e.clientId+"]",i),o.default.debug("["+e.clientId+"] Request proxy will be restart in "+d+"s"),s=setTimeout((function(){n()}),1e3*d),void(d=d>=3600?3600:2*d);clearTimeout(s);var c=a.address;e.proxyServer=c,e.turnServer={url:a.address,tcpport:a.serverResponse.tcpport||"3433",udpport:a.serverResponse.udpport||"3478",username:a.serverResponse.username||"test",credential:a.serverResponse.password||"111111",forceturn:!0},e.turnServer.tcpport+="",e.turnServer.udpport+="",r.b.setProxyServer(c),o.default.setProxyServer(c),l(c,t)}))}():l(null,t)},Be={ERR_NO_VOCS_AVAILABLE:"tryNext",ERR_NO_VOS_AVAILABLE:"tryNext",ERR_JOIN_CHANNEL_TIMEOUT:"tryNext",WARN_REPEAT_JOIN:"quit",ERR_JOIN_BY_MULTI_IP:"recover",WARN_LOOKUP_CHANNEL_TIMEOUT:"tryNext",WARN_OPEN_CHANNEL_TIMEOUT:"tryNext",ERR_VOM_SERVICE_UNAVAILABLE:"tryNext",ERR_TOO_MANY_USERS:"tryNext",ERR_MASTER_VOCS_UNAVAILABLE:"tryNext",ERR_INTERNAL_ERROR:"tryNext",notification_test_recover:"recover",notification_test_tryNext:"tryNext",notification_test_retry:"retry"},Ue={googResidualEchoLikelihood:"A_rel",googResidualEchoLikelihoodRecentMax:"A_rem",googTypingNoiseState:"A_tns",totalSamplesDuration:"A_sd",googAdaptationChanges:"A_ac",googBandwidthLimitedResolution:"A_blr",googCpuLimitedResolution:"A_clr",googEncodeUsagePercent:"A_eup",googHasEnteredLowResolution:"A_helr",googActualEncBitrate:"A_aeb",googAvailableReceiveBandwidth:"A_arb",googAvailableSendBandwidth:"A_asb",googRetransmitBitrate:"A_rb",googTargetEncBitrate:"A_teb",googCaptureStartNtpTimeMs:"A_csnt",googPreemptiveExpandRate:"A_per",googPreferredJitterBufferMs:"A_pjbm",googSecondaryDecodedRate:"A_sder",googSecondaryDiscardedRate:"A_sdir",googSpeechExpandRate:"A_ser",googFrameHeightReceived:"A_fhr",googInterframeDelayMax:"A_ifdm",googMinPlayoutDelayMs:"A_mpdm",aecDivergentFilterFraction:"A_dff",codecImplementationName:"A_cin",googEchoCancellationReturnLoss:"A_ecl",googEchoCancellationReturnLossEnhancement:"A_ece"},We={};for(var Ge in Ue){var He=Ue[Ge];Ue[He]&&console.error("Key Conflict: ".concat(Ge)),We[He]=Ge}var ze=function(e){return Ue[e]||e},qe=function e(t){var n=!1,s=function(e){return{_type:"control",message:e}},u=function(e){var t={};return Object.keys(e).forEach((function(n){t[ze(n)]=e[n]})),{_type:"subscribe_related_stats",options:t}},f=function(e,t,n){return{_type:"publish",options:e,sdp:t,p2pid:n}},m=e.DISCONNECTED,g=e.CONNECTING,h=e.CONNECTED,S=e.DISCONNECTING,b=m,_=a();Object.defineProperty(_,"state",{set:function(t){var n=b;b=t,n!==t&&_.dispatchEvent({type:"connection-state-change",prevState:e.connetionStateMap[n],curState:e.connetionStateMap[t]})},get:function(){return b}}),_.socket=void 0,_.state=m,_.mode=t.mode,_.role=t.role,_.codec=t.codec,_.config={},_.timers={},_.timer_counter={},_.localStreams={},_.remoteStreams={},_.attemps=1,_.p2p_attemps=1,_.audioLevel={},_.activeSpeaker=void 0,_.reconnectMode="retry",_.rejoinAttempt=0,_.hasChangeBGPAddress=!1,_.traffic_stats={},_.clientId=t.clientId,_.p2ps=new Map,_.firstFrameTimer=new Map,_.firstAudioDecodeTimer=new Map,_.liveStreams=new Map,_.injectLiveStreams=new Map,_.remoteStreamsInChannel=new Set,_.inChannelInfo={joinAt:null,duration:0};var C=xe;_.p2pCounter=Object(le.g)(1e5),_.generateP2PId=function(){return++_.p2pCounter},_.audioVolumeIndication={enabled:!1,sortedAudioVolumes:[],smooth:3,interval:2e3},_.remoteVideoStreamTypes={REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2},_.streamFallbackTypes={STREAM_FALLBACK_OPTION_DISABLED:0,STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:1,STREAM_FALLBACK_OPTION_AUDIO_ONLY:2},_.configPublisher=function(e){_.config=e},_.getGatewayInfo=function(e,t){N({_type:"gateway_info"},e,t)},_.setClientRole=function(e,t){o.default.debug("[".concat(_.clientId,"] setClientRole to ").concat(e));var n=r.b.reportApiInvoke(_.joinInfo.sid,{name:"_setClientRole",callback:t});N(function(e){return{_type:"set_client_role",message:e}}(e),(function(){_.role=e,_.dispatchEvent({type:"client-role-changed",role:e}),n&&n(null,{role:e})}),(function(t){var i=t&&t.code?t.code:0,r=E[i];if("ERR_ALREADY_IN_USE"===r)return n&&n(null);r||(r="UNKNOW_ERROR_".concat(i)),o.default.error("set Client role error to "+e+": "+r),n&&n(r)}))},_.join=function(e,n,a,s){e.useProxyServer&&(_.hasChangeBGPAddress=!0);var c=(new Date).getTime(),d=e.uid;if(_.inChannelInfo.joinAt&&(_.inChannelInfo.duration+=c-_.inChannelInfo.joinAt),_.inChannelInfo.joinAt=c,_.state!==g)return o.default.error("[".concat(_.clientId,"] GatewayClient.join Failed: state "),_.state),s&&s(O),void r.b.joinGateway(e.sid,{lts:c,succ:!1,ec:O,addr:null});if(null!=d&&parseInt(d)!==d)return o.default.error("[".concat(_.clientId,"] Input uid is invalid")),_.state=m,s&&s(A),void r.b.joinGateway(e.sid,{lts:c,succ:!1,ec:A,addr:null});var u=Je.register(_,{uid:d,cname:e&&e.cname});if(u)return _.state=m,s&&s(u),void r.b.joinGateway(e.sid,{lts:c,succ:!1,ec:u,addr:null});_.joinInfo=y()({},e),_.uid=d,_.key=n,R(e,(function(n){var d,u;_.state=h,o.default.debug("[".concat(_.clientId,"] Connected to gateway server")),_.pingTimer=setInterval((function(){var e=Date.now();N({_type:"ping"},(function(){var t=Date.now()-e;N({_type:"signal_stats",message:{pingpongElapse:t}},(function(){}),(function(e){}))}),(function(e){}))}),3e3),N((d=_.role,u={appId:t.appId,key:_.key,channel:_.joinInfo.cname,uid:_.uid,version:i.VERSION,browser:navigator.userAgent,mode:_.mode,codec:_.codec,role:d,config:_.config,processId:Object(r.a)()},_.joinInfo.hasOwnProperty("stringUid")&&(u.stringUid=_.joinInfo.stringUid),{_type:"join1",message:u}),(function(t){if(r.b.joinGateway(e.sid,{lts:c,succ:!0,ec:null,vid:t.vid,addr:_.socket.getURL()}),_.rejoinAttempt=0,a&&a(t.uid),_.dispatchEvent({type:"join"}),_.leaveOnConnected){o.default.info("[".concat(_.clientId,"] Calling Leave() once joined"));var n=_.leaveOnConnected;_.leaveOnConnected=null,_.leave(n.onSuccess,n.onFailure)}}),(function(t){if(o.default.error("[".concat(_.clientId,"] User join failed [").concat(t,"]")),Be[t]&&_.rejoinAttempt<4){if(_._doWithAction(Be[t],a,s),_.leaveOnConnected){o.default.error("[".concat(_.clientId,"] Calling Leave() once joined: Join Failed"));var n=_.leaveOnConnected;_.leaveOnConnected=null,n.onFailure(V)}}else s&&s(t);r.b.joinGateway(e.sid,{lts:c,succ:!1,ec:t,addr:_.socket.getURL()})}))}),(function(t){o.default.error("[".concat(_.clientId,"] User join failed [").concat(t,"]")),s&&s(t),r.b.joinGateway(e.sid,{lts:c,succ:!1,ec:t,addr:_.socket.getURL()})})),clearInterval(_.timers.trafficStats),_.timers.trafficStats=setInterval((function(){N({_type:"traffic_stats"},(function(e){_.traffic_stats=e;var t=_.joinInfo.stringUid,n=_.localStreams[d]||_.localStreams[t];n&&(n.traffic_stats={access_delay:e.access_delay}),e.peer_delay&&e.peer_delay.forEach((function(t){var n=_.remoteStreams[t.peer_uid];n&&(n.traffic_stats={access_delay:e.access_delay,e2e_delay:t.e2e_delay,audio_delay:t.audio_delay,video_delay:t.video_delay})}))}))}),3e3),_.resetAudioVolumeIndication()},_.leave=function(e,t){switch(_.state){case m:return o.default.debug("[".concat(_.clientId,"] Client Already in DISCONNECTED status")),void C(e);case S:return o.default.error("[".concat(_.clientId,"] Client Already in DISCONNECTING status")),void C(t,O);case g:return _.leaveOnConnected?(o.default.error("[".concat(_.clientId,"] Client.leave() already called")),void C(t,O)):(o.default.debug("[".concat(_.clientId,"] Client connecting. Waiting for Client Fully Connected(And leave)")),void(_.leaveOnConnected={onSuccess:e,onFailure:t}))}var n=Je.unregister(_);if(n)o.default.error("[".concat(_.clientId,"] "),n);else{for(var i in _.state=S,clearInterval(_.pingTimer),_.timers)_.timers.hasOwnProperty(i)&&clearInterval(_.timers[i]);for(var i in _.inChannelInfo.joinAt&&(_.inChannelInfo.duration+=Date.now()-_.inChannelInfo.joinAt,_.inChannelInfo.joinAt=null),N({_type:"leave"},(function(t){_.socket.close(),_.socket=void 0,o.default.info("[".concat(_.clientId,"] Leave channel success")),_.state=m,e&&e(t)}),(function(e){o.default.error("[".concat(_.clientId,"] Leave Channel Failed"),e),_.state=h,t&&t(e)})),_.localStreams)if(_.localStreams.hasOwnProperty(i)){var r=_.localStreams[i];delete _.localStreams[i],void 0!==r.pc&&(r.pc.close(),r.pc=void 0)}G()}},_.publish=function(e,t,n,i){var a=(new Date).getTime(),c=!1;if(e.publishLTS=a,"object"!==v()(e)||null===e)return o.default.error("[".concat(_.clientId,"] Invalid local stream")),i&&i(k),void r.b.publish(_.joinInfo.sid,{lts:a,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:k});if(null===e.stream&&void 0===e.url)return o.default.error("[".concat(_.clientId,"] Invalid local media stream")),i&&i(k),void r.b.publish(_.joinInfo.sid,{lts:a,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:k});if(_.state!==h)return o.default.error("[".concat(_.clientId,"] User is not in the session")),i&&i(O),void r.b.publish(_.joinInfo.sid,{lts:a,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:O});var u=e.getAttributes()||{};if(e.local&&void 0===_.localStreams[e.getId()]&&(e.hasAudio()||e.hasVideo()||e.hasScreen())){var l=_.generateP2PId();if(_.p2ps.set(l,e),e.p2pId=l,void 0!==e.url)x(f({state:"url",audio:e.hasAudio(),video:e.hasVideo(),attributes:e.getAttributes(),mode:_.mode},e.url),(function(t,n){"success"===t?(e.getUserId()!==n&&e.setUserId(n),_.localStreams[n]=e,e.onClose=function(){_.unpublish(e)}):o.default.error("[".concat(_.clientId,"] Publish local stream failed"),t)}));else{_.localStreams[e.getId()]=e,e.connectionSpec={callback:function(u){o.default.debug("[".concat(_.clientId,"] SDP exchange in publish : send offer --  "),JSON.parse(u)),x(f({state:"offer",id:e.getId(),audio:e.hasAudio(),video:e.hasVideo()||e.hasScreen(),attributes:e.getAttributes(),streamType:t.streamType,dtx:e.DTX,hq:e.highQuality,lq:e.lowQuality,stereo:e.stereo,speech:e.speech,mode:_.mode,codec:_.codec,p2pid:l,turnip:_.joinInfo.turnServer.url,turnport:Number(_.joinInfo.turnServer.udpport),turnusername:_.joinInfo.turnServer.username,turnpassword:_.joinInfo.turnServer.credential},u),(function(p,m){if("error"===p)return o.default.error("[".concat(_.clientId,"] Publish local stream failed")),i&&i(j),void r.b.publish(_.joinInfo.sid,{lts:a,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,localSDP:u,ec:j});e.pc.onsignalingmessage=function(n){e.pc.onsignalingmessage=function(){},x(f({state:"ok",id:e.getId(),audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),streamType:t.streamType,attributes:e.getAttributes(),mode:_.mode},n)),e.getUserId()!==m.id&&e.setUserId(m.id),o.default.info("[".concat(_.clientId,"] Local stream published with uid"),m.id),e.onClose=function(){_.unpublish(e)},e._onAudioUnmute=function(){N(s({action:"audio-out-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoUnmute=function(){N(s({action:"video-out-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onAudioMute=function(){N(s({action:"audio-out-off",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoMute=function(){N(s({action:"video-out-off",streamId:e.getId()}),(function(){}),(function(){}))},e.getId()===e.getUserId()&&(e.isAudioOn()||e.hasAudio()&&(o.default.debug("[".concat(_.clientId,"] local stream audio mute")),e._onAudioMute()),e.isVideoOn()||(e.hasVideo()||e.hasScreen())&&(o.default.debug("[".concat(_.clientId,"] local stream video mute")),e._onVideoMute()))},e.pc.oniceconnectionstatechange=function(t){if("failed"===t){if(null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()]+"_RelatedStats")),o.default.error("[".concat(_.clientId,"] Publisher connection is lost -- streamId: ").concat(e.getId(),", p2pId: ").concat(l)),_.p2ps.delete(l),o.default.debug("[".concat(_.clientId,"] publish p2p failed: "),_.p2ps),!c)return c=!0,r.b.publish(_.joinInfo.sid,{lts:a,succ:!1,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:L}),_.dispatchEvent(d({type:"pubP2PLost",stream:e})),i&&i(L);_.dispatchEvent(d({type:"pubP2PLost",stream:e}))}else if("connected"===t&&(o.default.debug("[".concat(_.clientId,"] publish p2p connected: "),_.p2ps),!c))return c=!0,r.b.publish(_.joinInfo.sid,{lts:a,succ:!0,audioName:e.hasAudio()&&e.audioName,videoName:e.hasVideo()&&e.videoName,screenName:e.hasScreen()&&e.screenName,ec:null}),n&&n()},o.default.debug("[".concat(_.clientId,"] SDP exchange in publish : receive answer --  "),JSON.parse(p)),e.pc.processSignalingMessage(p)}))},audio:e.hasAudio(),video:e.hasVideo(),screen:e.hasScreen(),isSubscriber:!1,stunServerUrl:_.stunServerUrl,turnServer:_.joinInfo.turnServer,maxAudioBW:u.maxAudioBW,minVideoBW:u.minVideoBW,maxVideoBW:u.maxVideoBW,mode:_.mode,codec:_.codec,isVideoMute:e.userMuteVideo||e.peerMuteVideo,isAudioMute:e.userMuteAudio||e.peerMuteAudio,maxFrameRate:e.attributes.maxFrameRate,clientId:_.clientId},e.pc=de(e.connectionSpec),e.pc.addStream(e.stream),o.default.debug("[".concat(_.clientId,"] PeerConnection add stream :"),e.stream),e.pc.onnegotiationneeded=function(t){x(f({state:"negotiation",p2pid:l},t),(function(t,n){e.pc.processSignalingMessage(t)}))},_.timers[e.getId()]=setInterval((function(){var t=0;e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id&&!/_recv$/.test(n.id)&&!/^time$/.test(n.id)&&e.getUserId())if(-1===n.id.indexOf("outbound_rtp")&&-1===n.id.indexOf("OutboundRTP")||"video"!==n.mediaType||(n.googFrameWidthSent=e.videoWidth+"",n.googFrameHeightSent=e.videoHeight+""),e.getId()==e.getUserId()){var i=200*t;t++,setTimeout((function(){var e,t;N((e=n,t={},Object.keys(e).forEach((function(n){t[ze(n)]=e[n]})),{_type:"publish_stats",options:{stats:t},sdp:null}),null,null)}),i)}else i=200*t,t++,setTimeout((function(){var e,t;N((e=n,t={},Object.keys(e).forEach((function(n){t[ze(n)]=e[n]})),{_type:"publish_stats_low",options:{stats:t},sdp:null}),null,null)}),i)}))}))}),3e3);var p=function(){e&&e.pc&&e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats((function(t){var n,i;e.getId()===e.getUserId()?N((n=t,i={},Object.keys(n).forEach((function(e){i[ze(e)]=n[e]})),{_type:"publish_related_stats",options:i}),null,null):N(function(e){var t={};return Object.keys(e).forEach((function(n){t[ze(n)]=e[n]})),{_type:"publish_related_stats_low",options:t}}(t),null,null)}))};p(),_.timers[e.getId()+"_RelatedStats"]=setInterval(p,1e3)}}},_.unpublish=function(e,t,n,i){return"object"!==v()(e)||null===e?(o.default.error("[".concat(_.clientId,"] Invalid local stream")),void C(i,k)):_.state!==h?(o.default.error("[".concat(_.clientId,"] User not in the session")),void C(i,O)):(null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()+"_RelatedStats"])),void(void 0!==_.socket?e.local&&void 0!==_.localStreams[e.getId()]?(delete _.localStreams[e.getId()],N((r=e.getUserId(),a=t.streamType,{_type:"unpublish",message:r,streamType:a})),(e.hasAudio()||e.hasVideo()||e.hasScreen())&&void 0===e.url&&void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e._onAudioMute=void 0,e._onAudioUnute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,_.p2ps.delete(e.p2pId),n&&n()):(o.default.error("[".concat(_.clientId,"] Invalid local stream")),C(i,k)):(o.default.error("[".concat(_.clientId,"] User not in the session")),C(i,O))));var r,a},_.subscribe=function(e,t,n){var i=(new Date).getTime();e.subscribeLTS=i;var a=!1;if(o.default.info("[".concat(_.clientId,"] Gatewayclient ").concat(_.uid," Subscribe ").concat(e.getId(),": ").concat(JSON.stringify(e.subscribeOptions))),"object"!==v()(e)||null===e)return o.default.error("[".concat(_.clientId,"] Invalid remote stream")),n&&n(D),void r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:D});if(_.state!==h&&(o.default.error("[".concat(_.clientId,"] User is not in the session")),!a))return a=!0,r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:O}),n&&n(O);if(!e.local&&_.remoteStreams.hasOwnProperty(e.getId()))if(e.hasAudio()||e.hasVideo()||e.hasScreen()){var l=_.generateP2PId();_.p2ps.set(l,e),e.p2pId=l,e.pc=de({callback:function(t){o.default.debug("[".concat(_.clientId,"] SDP exchange in subscribe : send offer --  "),JSON.parse(t));var a=y()({streamId:e.getId(),video:!0,audio:!0,mode:_.mode,codec:_.codec,p2pid:l,turnip:_.joinInfo.turnServer.url,turnport:Number(_.joinInfo.turnServer.udpport),turnusername:_.joinInfo.turnServer.username,turnpassword:_.joinInfo.turnServer.credential},e.subscribeOptions);x({_type:"subscribe",options:a,sdp:t,p2pid:void 0},(function(t){if("error"===t)return o.default.error("[".concat(_.clientId,"] Subscribe remote stream failed, closing stream "),e.getId()),e.close(),n&&n(F),void r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:F});o.default.debug("[".concat(_.clientId,"] SDP exchange in subscribe : receive answer --  "),JSON.parse(t)),e.pc.processSignalingMessage(t)}))},nop2p:!0,audio:!0,video:!0,screen:e.hasScreen(),isSubscriber:!0,stunServerUrl:_.stunServerUrl,turnServer:_.joinInfo.turnServer,isVideoMute:e.userMuteVideo,isAudioMute:e.userMuteAudio,uid:e.getId(),clientId:_.clientId}),e.pc.onaddstream=function(t,n){if(e._onAudioUnmute=function(){N(s({action:"audio-in-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onAudioMute=function(){N(s({action:"audio-in-off",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoUnmute=function(){N(s({action:"video-in-on",streamId:e.getId()}),(function(){}),(function(){}))},e._onVideoMute=function(){N(s({action:"video-in-off",streamId:e.getId()}),(function(){}),(function(){}))},"ontrack"===n&&"video"===t.track.kind||"onaddstream"===n){o.default.info("[".concat(_.clientId,"] Remote stream subscribed with uid "),e.getId());var i=_.remoteStreams[e.getId()];if(_.remoteStreams[e.getId()].stream="onaddstream"===n?t.stream:t.streams[0],_.remoteStreams[e.getId()].hasVideo()){if(Object(p.isFireFox)()||Object(p.isSafari)()){var r=_.remoteStreams[e.getId()].stream;Object(le.h)(r,(function(t,n){e.videoWidth=t,e.videoHeight=n}),(function(e){return o.default.warning("[".concat(_.clientId,"] vsResHack failed: ")+e)}))}}else{var a=_.remoteStreams[e.getId()];a.peerMuteVideo=!0,_._adjustPCMuteStatus(a)}i&&i.isPlaying()&&i.elementID&&(o.default.debug("[".concat(_.clientId,"] Reload Player ").concat(i.elementID," StreamId ").concat(i.getId())),e.audioOutput=i.audioOutput,i.stop(),e.play(i.elementID,i.playOptions));var d=c({type:"stream-subscribed",stream:_.remoteStreams[e.getId()]});_.dispatchEvent(d)}},_.timers[e.getId()]=setInterval((function(){var t=0;e&&e.pc&&e.pc.getStats&&e.pc.getStatsRate((function(n){n.forEach((function(n){if(n&&n.id){if(/_send$/.test(n.id)||/^time$/.test(n.id)||/^bweforvideo$/.test(n.id))return;-1===n.id.indexOf("inbound_rtp")&&-1===n.id.indexOf("inbound-rtp")||"video"!==n.mediaType||(n.googFrameWidthReceived=e.videoWidth+"",n.googFrameHeightReceived=e.videoHeight+"");var i=200*t;t++;var o=e.getId();setTimeout((function(){var e,t,i;x((e=o,t=n,i={},Object.keys(t).forEach((function(e){i[ze(e)]=t[e]})),{_type:"subscribe_stats",options:{id:e,stats:i},sdp:null}),null,null)}),i)}}))}))}),3e3),_.timers[e.getId()+"_RelatedStats"]=setInterval((function(){e&&e.pc&&(e.pc.getVideoRelatedStats&&e.pc.getVideoRelatedStats((function(e){N(u(e),null,null)})),e.pc.getAudioRelatedStats&&e.pc.getAudioRelatedStats((function(e){N(u(e),null,null)})))}),1e3),_.audioLevel[e.getId()]=0,_.timers[e.getId()+"audio"]=setInterval((function(){_.hasListeners("active-speaker")&&e&&e.pc&&"established"===e.pc.state&&e.pc.getStats&&e.pc.getStats((function(t){t.forEach((function(t){if("audio"===t.mediaType){if(t.audioOutputLevel>5e3)for(var n in _.audioLevel[e.getId()]<20&&(_.audioLevel[e.getId()]+=1),_.audioLevel)n!==""+e.getId()&&_.audioLevel[n]>0&&(_.audioLevel[n]-=1);var i=Object.keys(_.audioLevel).sort((function(e,t){return _.audioLevel[t]-_.audioLevel[e]}));if(_.activeSpeaker!==i[0]){var r=d({type:"active-speaker",uid:i[0]});_.dispatchEvent(r),_.activeSpeaker=i[0],o.default.debug("[".concat(_.clientId,"] Update active speaker: ").concat(_.activeSpeaker))}}}))}))}),50),e.pc.oniceconnectionstatechange=function(s){if("failed"===s)null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()]+"audio")),o.default.error("[".concat(_.clientId,"] Subscriber connection is lost -- streamId: ").concat(e.getId(),", p2pId: ").concat(l)),o.default.debug("[".concat(_.clientId,"] subscribe p2p failed: "),_.p2ps),a||(a=!0,n&&n(L),r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:L})),_.remoteStreams[e.getId()]&&_.p2ps.has(l)&&(_.p2ps.delete(l),_.dispatchEvent(d({type:"subP2PLost",stream:e})));else if("connected"===s&&(o.default.debug("[".concat(_.clientId,"] subscribe p2p connected: "),_.p2ps),!a))return a=!0,r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!0,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:null}),_._adjustPCMuteStatus(e),_.firstAudioDecodeTimer.set(e.getId(),setInterval((function(){e.pc?e.pc.getStats((function(t){t.forEach((function(t){-1!==t.id.indexOf("recv")&&"audio"===t.mediaType&&parseInt(t.googDecodingNormal)>0&&(clearInterval(_.firstAudioDecodeTimer.get(e.getId())),_.firstAudioDecodeTimer.delete(e.getId()),r.b.reportApiInvoke(_.joinInfo.sid,{name:"firstAudioDecode"})(null,{elapse:Date.now()-e.subscribeLTS}))}))})):(clearInterval(_.firstAudioDecodeTimer.get(e.getId())),_.firstAudioDecodeTimer.delete(e.getId()))}),100)),_.firstFrameTimer.set(e.getId(),setInterval((function(){e.pc?e.pc.getStats((function(t){t.forEach((function(t){-1===t.id.indexOf("recv")&&-1===t.id.indexOf("inbound_rtp")&&-1===t.id.indexOf("inbound-rtp")&&-1===t.id.indexOf("InboundRTP")||"video"===t.mediaType&&(t.framesDecoded>0||t.googFramesDecoded>0)&&(clearInterval(_.firstFrameTimer.get(e.getId())),_.firstFrameTimer.delete(e.getId()),e.firstFrameTime=(new Date).getTime()-e.subscribeLTS,r.b.firstRemoteFrame(_.joinInfo.sid,{lts:(new Date).getTime(),peerid:e.getId(),succ:!0,width:+t.googFrameWidthReceived,height:+t.googFrameHeightReceived}))}))})):(clearInterval(_.firstFrameTimer.get(e.getId())),_.firstFrameTimer.delete(e.getId()))}),100)),e.sid=_.joinInfo.sid,t&&t()}}else o.default.error("[".concat(_.clientId,"] Invalid remote stream")),a||(a=!0,n&&n(D),r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:D}));else o.default.error("[".concat(_.clientId,"] No such remote stream")),a||(a=!0,n&&n(U),r.b.subscribe(_.joinInfo.sid,{lts:i,succ:!1,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:U}))},_.subscribeChange=function(e,t,n){var i,a,s=Date.now();o.default.info("[".concat(_.clientId,"] Gatewayclient ").concat(_.uid," SubscribeChange ").concat(e.getId(),": ").concat(JSON.stringify(e.subscribeOptions))),_._adjustPCMuteStatus(e),N((i=e.getId(),a=e.subscribeOptions,{_type:"subscribe_change",options:y()({streamId:i},a)}),(function(i){if("error"===i)return o.default.error("[".concat(_.clientId,"] Subscribe Change Failed ").concat(e.getId())),void C(n,"SUBSCRIBE_CHANGE_FAILED");var a=c({type:"stream-subscribe-changed",stream:_.remoteStreams[e.getId()]});r.b.subscribe(_.joinInfo.sid,{lts:s,succ:!0,video:e.subscribeOptions&&e.subscribeOptions.video,audio:e.subscribeOptions&&e.subscribeOptions.audio,peerid:e.getId(),ec:null}),_.dispatchEvent(a),t&&t()}),n)},_._adjustPCMuteStatus=function(e){!e.local&&e.pc&&e.pc.peerConnection.getReceivers&&e.pc.peerConnection.getReceivers().forEach((function(t){if(t&&t.track&&"audio"===t.track.kind){var n=!e.userMuteAudio&&!e.peerMuteAudio;e.subscribeOptions&&!e.subscribeOptions.audio&&(n=!1),t.track.enabled=!!n}else if(t&&t.track&&"video"===t.track.kind){var i=!e.userMuteVideo&&!e.peerMuteVideo;e.subscribeOptions&&!e.subscribeOptions.video&&(i=!1),t.track.enabled=!!i}}))},_.unsubscribe=function(e,t,n){if("object"!==v()(e)||null===e)return o.default.error("[".concat(_.clientId,"] Invalid remote stream")),void C(n,D);if(_.state!==h)return o.default.error("[".concat(_.clientId,"] User is not in the session")),void C(n,O);if(null!=_.timers[e.getId()]&&(clearInterval(_.timers[e.getId()]),clearInterval(_.timers[e.getId()]+"audio")),null!=_.audioLevel[e.getId()]&&delete _.audioLevel[e.getId()],null!=_.timer_counter[e.getId()]&&delete _.timer_counter[e.getId()],_.remoteStreams.hasOwnProperty(e.getId())){if(!_.socket)return o.default.error("[".concat(_.clientId,"] User is not in the session")),void C(n,O);if(e.local)return o.default.error("[".concat(_.clientId,"] Invalid remote stream")),void C(n,D);e.close(),N({_type:"unsubscribe",message:e.getId()},(function(i){if("error"===i)return o.default.error("[".concat(_.clientId,"] Unsubscribe remote stream failed ").concat(e.getId())),void C(n,B);void 0!==e.pc&&(e.pc.close(),e.pc=void 0),e.onClose=void 0,e._onAudioMute=void 0,e._onAudioUnute=void 0,e._onVideoMute=void 0,e._onVideoUnmute=void 0,delete e.subscribeOptions,_.p2ps.delete(e.p2pId),o.default.info("[".concat(_.clientId,"] Unsubscribe stream success")),t&&t()}),n)}else C(n,U)},_.setRemoteVideoStreamType=function(e,t){if(o.default.debug("[".concat(_.clientId,"] Switching remote video stream ").concat(e.getId()," to ").concat(t)),"object"===v()(e)&&null!==e)if(_.state===h){if(!e.local){switch(t){case _.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_HIGH:case _.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_LOW:case _.remoteVideoStreamTypes.REMOTE_VIDEO_STREAM_MEDIUM:break;default:return}N(function(e,t){return{_type:"switchVideoStream",message:{id:e,type:t}}}(e.getId(),t),null,null)}}else o.default.error("[".concat(_.clientId,"] User is not in the session"));else o.default.error("[".concat(_.clientId,"] Invalid remote stream"))},_.renewToken=function(e,t,n){e?_.key?_.state!==h?(o.default.debug("[".concat(_.clientId,"] Client is not connected. Trying to rejoin")),_.key=e,_.rejoin(),t&&t()):(o.default.debug("[".concat(_.clientId,"] renewToken from ").concat(_.key," to ").concat(e)),N(function(e){return{_type:"renew_token",message:{token:e}}}(e),t,n)):(o.default.error("[".concat(_.clientId,"] Client is previously joined without token")),n&&n(A)):(o.default.error("[".concat(_.clientId,"] Invalid Token ").concat(e)),n&&n(A))},_.setStreamFallbackOption=function(e,t){if(o.default.debug("[".concat(_.clientId,"] Set stream fallback option ").concat(e.getId()," to ").concat(t)),"object"===v()(e)&&null!==e)if(_.state===h){if(!e.local){switch(t){case _.streamFallbackTypes.STREAM_FALLBACK_OPTION_DISABLED:case _.streamFallbackTypes.STREAM_FALLBACK_OPTION_VIDEO_STREAM_LOW:case _.streamFallbackTypes.STREAM_FALLBACK_OPTION_AUDIO_ONLY:break;default:return}N(function(e,t){return{_type:"setFallbackOption",message:{id:e,type:t}}}(e.getId(),t),null,null)}}else o.default.error("[".concat(_.clientId,"] User is not in the session"));else o.default.error("[".concat(_.clientId,"] Invalid remote stream"))},_.startLiveStreaming=function(e,t){_.liveStreams.set(e,t),o.default.debug("[".concat(_.clientId,"] Start live streaming ").concat(e," ").concat(t," ").concat(t)),_.state===h?N(function(e,t){return{_type:"start_live_streaming",message:{url:e,transcodingEnabled:t}}}(e,t),null,null):o.default.error("[".concat(_.clientId,"] User is not in the session"))},_.stopLiveStreaming=function(e){o.default.debug("[".concat(_.clientId,"] Stop live streaming ").concat(e)),_.state===h?(_.liveStreams.delete(e),N(function(e){return{_type:"stop_live_streaming",message:{url:e}}}(e),null,null)):o.default.error("[".concat(_.clientId,"] User is not in the session"))},_.setLiveTranscoding=function(e){Object(le.d)(e)&&(_.transcoding=e,o.default.debug("[".concat(_.clientId,"] Set live transcoding "),e),_.state===h?N(function(e){return{_type:"set_live_transcoding",message:{transcoding:e}}}(e),null,null):o.default.error("[".concat(_.clientId,"] User is not in the session")))},_.addInjectStreamUrl=function(e,t){_.injectLiveStreams.set(e,t),o.default.debug("[".concat(_.clientId,"] Add inject stream url ").concat(e," config "),t),_.state===h?N(function(e,t){return{_type:"add_inject_stream_url",message:{url:e,config:t}}}(e,t),null,null):o.default.error("[".concat(_.clientId,"] User is not in the session"))},_.removeInjectStreamUrl=function(e){o.default.debug("[".concat(_.clientId,"] Remove inject stream url ").concat(e)),_.state===h?(_.injectLiveStreams.delete(e),N(function(e){return{_type:"remove_inject_stream_url",message:{url:e}}}(e),null,null)):o.default.error("[".concat(_.clientId,"] User is not in the session"))},_.enableAudioVolumeIndicator=function(e,t){_.audioVolumeIndication.enabled=!0,_.audioVolumeIndication.interval=e,_.audioVolumeIndication.smooth=t,_.resetAudioVolumeIndication()},_.resetAudioVolumeIndication=function(){if(clearInterval(_.timers.audioVolumeIndication),clearInterval(_.timers.audioVolumeSampling),_.audioVolumeIndication.enabled&&_.audioVolumeIndication.interval){var e=Math.floor(1e3*_.audioVolumeIndication.smooth/100);_.timers.audioVolumeSampling=setInterval((function(){_.audioVolumeSampling||(_.audioVolumeSampling={});var t={};for(var n in _.remoteStreams){var i=_.remoteStreams[n];if(i.stream&&i.hasAudio()){var o=i.getAudioLevel();o>0&&o<1&&(o*=100);var r=_.audioVolumeSampling[n]||[];for(r.push(o);r.length>e;)r.shift();t[n]=r}}_.audioVolumeSampling=t}),100),_.timers.audioVolumeIndication=setInterval((function(){var e=[];for(var t in _.remoteStreams)if(_.audioVolumeSampling&&_.audioVolumeSampling[t]){var n=_.audioVolumeSampling[t],i=0;n.forEach((function(e){i+=e}));var r={uid:t,level:Math.floor(i/n.length)};r.level&&e.push(r)}var a=e.sort((function(e,t){return e.level-t.level}));o.default.debug("[".concat(_.clientId,"] volume-indicator "),JSON.stringify(a)),_.audioVolumeIndication.sortedAudioVolumes=a;var s=d({type:"volume-indicator",attr:a});_.dispatchEvent(s)}),_.audioVolumeIndication.interval)}},_.closeGateway=function(){o.default.debug("[".concat(_.clientId,"] close gateway")),_.state=m,_.socket.close(),T()};var T=function(){for(var e in _.timers)_.timers.hasOwnProperty(e)&&clearInterval(_.timers[e]);for(var e in _.remoteStreams)if(_.remoteStreams.hasOwnProperty(e)){var t=_.remoteStreams[e],n=d({type:"stream-removed",uid:t.getId(),stream:t});_.dispatchEvent(n)}_.p2ps.clear(),G(),W(),clearInterval(_.pingTimer)};_.rejoin=function(){_.socket&&(clearInterval(_.pingTimer),_.socket.close(),_.socket=void 0),_.state=g,w()};var w=function(e,t){_.dispatchEvent(d({type:"rejoin-start"})),e=e||function(e){o.default.info("[".concat(_.clientId,"] User ").concat(e," is re-joined to ").concat(_.joinInfo.cname)),_.dispatchEvent(d({type:"rejoin"})),_.liveStreams&&_.liveStreams.size&&_.liveStreams.forEach((function(e,t){e&&_.setLiveTranscoding(_.transcoding),_.startLiveStreaming(t,e)})),_.injectLiveStreams&&_.injectLiveStreams.size&&_.injectLiveStreams.forEach((function(e,t){_.addInjectStreamUrl(t,e)}))},t=t||function(e){o.default.error("[".concat(_.clientId,"] Re-join to channel failed "),e),_.dispatchEvent(c({type:"error",reason:e}))},_.key?(++_.rejoinAttempt,_.join(_.joinInfo,_.key,e,t)):o.default.error("[".concat(_.clientId,"] Connection recover failed [Invalid channel key]"))},R=function(e,t,i){var a;_.onConnect=t,void 0!==_.socket?(_.dispatchEvent({type:"reconnect"}),"retry"===_.reconnectMode?(o.default.debug("[".concat(_.clientId,"] Retry current gateway")),_.socket.reconnect()):"tryNext"===_.reconnectMode?(o.default.debug("[".concat(_.clientId,"] Try next gateway")),_.socket.connectNext()):"recover"===_.reconnectMode&&(o.default.debug("[".concat(_.clientId,"] Recover gateway")),o.default.debug("[".concat(_.clientId,"] Try to reconnect choose server and get gateway list again ")),Fe(_.joinInfo,(function(e){_.socket.replaceHost(e.gateway_addr)})))):(a=e.gatewayAddr,_.socket=Pe(a,{sid:_.joinInfo.sid,clientId:_.clientId}),_.socket.on("onUplinkStats",(function(e){_.OutgoingAvailableBandwidth=e.uplink_available_bandwidth,_.localStreams[_.uid]&&(_.localStreams[_.uid].uplinkStats=e)})),_.socket.on("connect",(function(){_.dispatchEvent({type:"connected"}),_.attemps=1,N(function(e){var t=e;return e.uni_lbs_ip&&(t=y()(e,{wanip:e.uni_lbs_ip,hasChange:_.hasChangeBGPAddress})),{_type:"token",message:t}}(e),_.onConnect,i)})),_.socket.on("recover",(function(){_.state=g,o.default.debug("[".concat(_.clientId,"] Try to reconnect choose server and get gateway list again ")),Fe(_.joinInfo,(function(e){_.socket.replaceHost(e.gateway_addr)}))})),_.socket.on("disconnect",(function(e){if(_.state!==m){_.state=m;var t=c({type:"error",reason:P});if(_.dispatchEvent(t),0===_.p2ps.size?_.reconnectMode="tryNext":_.reconnectMode="retry",T(),1!=n){var i,r=(i=_.attemps,1e3*Math.min(30,Math.pow(2,i)-1));o.default.error("[".concat(_.clientId,"] Disconnect from server [").concat(e,"], attempt to recover [#").concat(_.attemps,"] after ").concat(r/1e3," seconds")),setTimeout((function(){_.attemps++,_.state=g,w()}),r)}}})),_.socket.on("onAddAudioStream",(function(e){if(o.default.info("[".concat(_.clientId,"] Newly added audio stream with uid ").concat(e.id)),_.remoteStreamsInChannel.has(e.id)||_.remoteStreamsInChannel.add(e.id),void 0===_.remoteStreams[e.id]){var t=Ae({streamID:e.id,local:!1,audio:e.audio,video:e.video,screen:e.screen,attributes:e.attributes});_.remoteStreams[e.id]=t;var n=c({type:"stream-added",stream:t});_.dispatchEvent(n)}})),_.socket.on("onUpdateStream",(function(e){var t=_.remoteStreams[e.id];if(t){delete e.id,t.audio=e.audio,t.video=e.video,t.screen=e.screen,t.pc&&_._adjustPCMuteStatus(t);var n=c({type:"stream-updated",stream:t});_.dispatchEvent(n)}else o.default.debug("[".concat(_.clientId,"] Ignoring onUpdateStream event before onAddStream for uid ").concat(e.id))})),_.socket.on("onAddVideoStream",(function(e){if(o.default.info("[".concat(_.clientId,"] Newly added remote stream with uid ").concat(e.id,".")),_.remoteStreamsInChannel.has(e.id)||_.remoteStreamsInChannel.add(e.id),void 0===_.remoteStreams[e.id]){var t=Ae({streamID:e.id,local:!1,audio:e.audio,video:e.video,screen:e.screen,attributes:e.attributes});_.remoteStreams[e.id]=t;var n=c({type:"stream-added",stream:t});_.dispatchEvent(n)}else{var i=_.remoteStreams[e.id];if(void 0!==i.stream){if((t=_.remoteStreams[e.id]).video=!0,t._unmuteVideo(),o.default.info("[".concat(_.clientId,"] Stream changed: enable video ").concat(e.id)),t.isPlaying()){var r=t.player.elementID;t.stop(),t.play(r)}}else i.p2pId?_.remoteStreams[e.id].video=!0:(t=Ae({streamID:e.id,local:!1,audio:!0,video:!0,screen:!1,attributes:e.attributes}),_.remoteStreams[e.id]=t,o.default.info("[".concat(_.clientId,"] Stream changed: modify video ").concat(e.id)))}})),_.socket.on("onRemoveStream",(function(e){_.remoteStreamsInChannel.has(e.id)&&_.remoteStreamsInChannel.delete(e.id);var t=_.remoteStreams[e.id];if(t){delete _.remoteStreams[e.id];var n=c({type:"stream-removed",stream:t});_.dispatchEvent(n),t.close(),void 0!==t.pc&&(t.pc.close(),t.pc=void 0,_.p2ps.delete(t.p2pId))}else console.log("ERROR stream ",e.id," not found onRemoveStream ",e)})),_.socket.on("onPublishStream",(function(e){var t=_.localStreams[e.id],n=c({type:"streamPublished",stream:t});_.dispatchEvent(n)})),_.socket.on("mute_audio",(function(e){o.default.info("[".concat(_.clientId,"] rcv peer mute audio: ").concat(e.peerid));var t=d({type:"mute-audio",uid:e.peerid}),n=_.remoteStreams[e.peerid];n&&(n.peerMuteAudio=!0),n.pc&&_._adjustPCMuteStatus(n),_.dispatchEvent(t)})),_.socket.on("unmute_audio",(function(e){o.default.info("[".concat(_.clientId,"] rcv peer unmute audio: ").concat(e.peerid));var t=d({type:"unmute-audio",uid:e.peerid}),n=_.remoteStreams[e.peerid];n&&(n.peerMuteAudio=!1),n.pc&&_._adjustPCMuteStatus(n),_.dispatchEvent(t)})),_.socket.on("mute_video",(function(e){o.default.info("[".concat(_.clientId,"] rcv peer mute video: ").concat(e.peerid));var t=d({type:"mute-video",uid:e.peerid}),n=_.remoteStreams[e.peerid];n&&(n.peerMuteVideo=!0),n.pc&&_._adjustPCMuteStatus(n),_.dispatchEvent(t)})),_.socket.on("unmute_video",(function(e){o.default.info("[".concat(_.clientId,"] rcv peer unmute video: ").concat(e.peerid));var t=d({type:"unmute-video",uid:e.peerid}),n=_.remoteStreams[e.peerid];n&&(n.peerMuteVideo=!1),n.pc&&_._adjustPCMuteStatus(n),_.dispatchEvent(t)})),_.socket.on("user_banned",(function(e){o.default.info("[".concat(_.clientId,"] user banned uid: ").concat(e.id," error: ").concat(e.errcode));var t=d({type:"client-banned",uid:e.id,attr:e.errcode});_.dispatchEvent(t),n=!0,leave()})),_.socket.on("stream_fallback",(function(e){o.default.info("[".concat(_.clientId,"] stream fallback uid: ").concat(e.id," peerId: ").concat(e.peerid," type: ").concat(e.type));var t=d({type:"stream-fallback",uid:e.id,stream:e.peerid,attr:e.type});_.dispatchEvent(t)})),_.socket.on("stream_recover",(function(e){o.default.info("[".concat(_.clientId,"] stream recover uid: ").concat(e.id," peerId: ").concat(e.peerid," type: ").concat(e.type));var t=d({type:"stream-recover",uid:e.id,stream:e.peerid,attr:e.type});_.dispatchEvent(t)})),_.socket.on("onP2PLost",(function(e){if(o.default.debug("[".concat(_.clientId,"] p2plost: "),e,"p2ps:",_.p2ps),"publish"===e.event){var t=_.localStreams[e.uid];t&&r.b.publish(_.joinInfo.sid,{lts:t.publishLTS,succ:!1,audioName:t.hasAudio()&&t.audioName,videoName:t.hasVideo()&&t.videoName,screenName:t.hasScreen()&&t.screenName,ec:"DTLS failed"})}if("subscribe"===e.event){var n=_.remoteStreams[e.uid];n&&r.b.subscribe(_.joinInfo.sid,{lts:n.subscribeLTS,succ:!1,video:n.subscribeOptions&&n.subscribeOptions.video,audio:n.subscribeOptions&&n.subscribeOptions.audio,peerid:e.uid+"",ec:"DTLS failed"})}o.default.debug("[".concat(_.clientId,"] p2plost:"),e.p2pid);var i=_.p2ps.get(e.p2pid);i&&(_.p2ps.delete(e.p2pid),i.local?_.dispatchEvent(d({type:"pubP2PLost",stream:i})):_.remoteStreams[i.getId()]&&_.dispatchEvent(d({type:"subP2PLost",stream:i})))})),_.socket.on("onTokenPrivilegeWillExpire",(function(e){o.default.debug("[".concat(_.clientId,"] Received Message onTokenPrivilegeWillExpire")),_.dispatchEvent(d({type:"onTokenPrivilegeWillExpire"}))})),_.socket.on("onTokenPrivilegeDidExpire",(function(){o.default.warning("[".concat(_.clientId,"] Received Message onTokenPrivilegeDidExpire, please get new token and join again")),_.closeGateway(),_.dispatchEvent(d({type:"onTokenPrivilegeDidExpire"}))})),_._doWithAction=function(e,t,n){"tryNext"===e?function(e,t){o.default.debug("[".concat(_.clientId,"] Connect next gateway")),_.state=m,_.socket.close(),T(),_.reconnectMode="tryNext",w(e,t)}(t,n):"retry"===e?function(e,t){o.default.debug("[".concat(_.clientId,"] Reconnect gateway")),_.state=m,_.socket.close(),T(),_.reconnectMode="retry",w(e,t)}(t,n):"quit"===e?(o.default.debug("[".concat(_.clientId,"] quit gateway")),_.state=m,_.socket.close(),T()):"recover"===e&&(o.default.debug("[".concat(_.clientId,"] Reconnect gateway")),_.state=m,_.socket.close(),T(),_.reconnectMode="recover",w())},_.socket.on("notification",(function(e){if(o.default.debug("[".concat(_.clientId,"] Receive notification: "),e),"ERR_JOIN_BY_MULTI_IP"===I[e.code])return _.dispatchEvent({type:"onMultiIP",arg:e});e.detail?_._doWithAction(Be[I[e.code]]):e.action&&_._doWithAction(e.action)})),_.socket.on("onPeerLeave",(function(e){var t=d({type:"peer-leave",uid:e.id});if(_.remoteStreamsInChannel.has(e.id)&&_.remoteStreamsInChannel.delete(e.id),_.remoteStreams.hasOwnProperty(e.id)&&(t.stream=_.remoteStreams[e.id]),_.dispatchEvent(t),_.remoteStreams.hasOwnProperty(e.id)){o.default.info("[".concat(_.clientId,"] closing stream on peer leave"),e.id);var n=_.remoteStreams[e.id];n.close(),delete _.remoteStreams[e.id],void 0!==n.pc&&(n.pc.close(),n.pc=void 0,_.p2ps.delete(n.p2pId))}_.timers.hasOwnProperty(e.id)&&(clearInterval(_.timers[e.id]),clearInterval(_.timers[e.id]+"_RelatedStats"),delete _.timers[e.id]),null!=_.audioLevel[e.id]&&delete _.audioLevel[e.id],null!=_.timer_counter[e.id]&&delete _.timer_counter[e.id]})),_.socket.on("onUplinkStats",(function(e){})),_.socket.on("liveStreamingStarted",(function(e){var t=l({type:"liveStreamingStarted",url:e.url});_.dispatchEvent(t)})),_.socket.on("liveStreamingFailed",(function(e){var t=l({type:"liveStreamingFailed",url:e.url});_.dispatchEvent(t)})),_.socket.on("liveStreamingStopped",(function(e){var t=l({type:"liveStreamingStopped",url:e.url});_.dispatchEvent(t)})),_.socket.on("liveTranscodingUpdated",(function(e){var t=l({type:"liveTranscodingUpdated",reason:e.reason});_.dispatchEvent(t)})),_.socket.on("streamInjectedStatus",(function(e){var t=l({type:"streamInjectedStatus",url:e.url,uid:e.uid,status:e.status});_.dispatchEvent(t)})),_.socket.on("onUserOnline",(function(e){_.dispatchEvent({type:"peer-online",uid:e.id})})))},N=function(e,t,n){if(void 0===_.socket)return o.default.error("[".concat(_.clientId,"] No socket available")),void C(n,O);try{_.socket.emitSimpleMessage(e,(function(e,i){"success"===e?"function"==typeof t&&t(i):"function"==typeof n&&n(I[i]||i)}))}catch(t){o.default.error("[".concat(_.clientId,"] Socket emit message failed ").concat(JSON.stringify(e))),o.default.error("[".concat(_.clientId,"] "),t),C(n,M)}},x=function(e,t){if(void 0!==_.socket)try{_.socket.emitSimpleMessage(e,(function(e,n){t&&t(e,n)}))}catch(e){o.default.error("[".concat(_.clientId,"] Error in sendSimpleSdp [").concat(e,"]"))}else o.default.error("[".concat(_.clientId,"] Error in sendSimpleSdp [socket not ready]"))},W=function(){for(var e in _.localStreams)if(void 0!==_.localStreams[e]){var t=_.localStreams[e];delete _.localStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}},G=function(){for(var e in _.remoteStreamsInChannel.clear(),_.remoteStreams)if(_.remoteStreams.hasOwnProperty(e)){var t=_.remoteStreams[e];t.isPlaying()&&t.stop(),t.close(),delete _.remoteStreams[e],void 0!==t.pc&&(t.pc.close(),t.pc=void 0)}};return _},Je={_gatewayClients:{},register:function(e,t){if(!t.uid){var n="NO_UID_PROVIDED";return o.default.error("[".concat(e.clientId,"] "),n,t),n}return t.cname?this._gatewayClients[t.cname]&&this._gatewayClients[t.cname][t.uid]&&this._gatewayClients[t.cname][t.uid]!==e?(n="UID_CONFLICT",o.default.error("[".concat(e.clientId,"] "),n,t),n):(o.default.debug("[".concat(e.clientId,"] register client Channel"),t.cname,"Uid",t.uid),this._gatewayClients[t.cname]||(this._gatewayClients[t.cname]={}),this._gatewayClients[t.cname][t.uid]=e,null):(n="NO_CHANNEL_PROVIDED",o.default.error("[".concat(e.clientId,"] "),n,t),n)},unregister:function(e){var t=e&&e.uid,n=e.joinInfo&&e.joinInfo.cname;if(!t||!n){var i="INVALID_GATEWAYCLIENT";return o.default.error("[".concat(e.clientId,"] "),i),i}if(this._gatewayClients[n]&&this._gatewayClients[n][t])return this._gatewayClients[n][t]!==e?(i="GATEWAYCLIENT_UID_CONFLICT",o.default.error("[".concat(e.clientId,"] "),i),i):(o.default.debug("[".concat(e.clientId,"] unregister client "),e.uid),delete this._gatewayClients[n][t],null);i="GATEWEAY_CLIENT_UNREGISTERED",o.default.error("[".concat(e.clientId,"] "),i)}};qe.DISCONNECTED=0,qe.CONNECTING=1,qe.CONNECTED=2,qe.DISCONNECTING=3,qe.connetionStateMap={0:"DISCONNECTED",1:"CONNECTING",2:"CONNECTED",3:"DISCONNECTING"};var Ke=qe,Ye=function(e){var t;switch(e){case"120p":case"120p_1":t=["120p_1","120p_1","120p_1"];break;case"120p_3":t=["120p_3","120p_3","120p_3"];break;case"180p":case"180p_1":t=["90p_1","90p_1","180p_1"];break;case"180p_3":t=["120p_3","120p_3","180p_3"];break;case"180p_4":t=["120p_1","120p_1","180p_4"];break;case"240p":case"240p_1":t=["120p_1","120p_1","240p_1"];break;case"240p_3":t=["120p_3","120p_3","240p_3"];break;case"240p_4":t=["120p_4","120p_4","240p_4"];break;case"360p":case"360p_1":case"360p_4":case"360p_9":case"360p_10":case"360p_11":t=["90p_1","90p_1","360p_1"];break;case"360p_3":case"360p_6":t=["120p_3","120p_3","360p_3"];break;case"360p_7":case"360p_8":t=["120p_1","120p_1","360p_7"];break;case"480p":case"480p_1":case"480p_2":case"480p_4":case"480p_10":t=["120p_1","120p_1","480p_1"];break;case"480p_3":case"480p_6":t=["120p_3","120p_3","480p_3"];break;case"480p_8":case"480p_9":t=["120p_4","120p_4","480p_8"];break;case"720p":case"720p_1":case"720p_2":case"720p_3":t=["90p_1","90p_1","720p_1"];break;case"720p_5":case"720p_6":t=["120p_1","120p_1","720p_5"];break;case"1080p":case"1080p_1":case"1080p_2":case"1080p_3":case"1080p_5":t=["90p_1","90p_1","1080p_1"];break;case"1440p":case"1440p_1":case"1440p_2":t=["90p_1","90p_1","1440p_1"];break;case"4k":case"4k_1":case"4k_3":t=["90p_1","90p_1","4k_1"];break;default:t=["120p_1","120p_1","360p_7"]}return Object(p.isOpera)()?[e,15,50]:Object(p.isFireFox)()?[t[1],15,100]:Object(p.isSafari)()?[t[2],15,50]:[t[0],15,50]},Xe={1001:"FRAMERATE_INPUT_TOO_LOW",1002:"FRAMERATE_SENT_TOO_LOW",1003:"SEND_VIDEO_BITRATE_TOO_LOW",1005:"RECV_VIDEO_DECODE_FAILED",2001:"AUDIO_INPUT_LEVEL_TOO_LOW",2002:"AUDIO_OUTPUT_LEVEL_TOO_LOW",2003:"SEND_AUDIO_BITRATE_TOO_LOW",2005:"RECV_AUDIO_DECODE_FAILED",3001:"FRAMERATE_INPUT_TOO_LOW_RECOVER",3002:"FRAMERATE_SENT_TOO_LOW_RECOVER",3003:"SEND_VIDEO_BITRATE_TOO_LOW_RECOVER",3005:"RECV_VIDEO_DECODE_FAILED_RECOVER",4001:"AUDIO_INPUT_LEVEL_TOO_LOW_RECOVER",4002:"AUDIO_OUTPUT_LEVEL_TOO_LOW_RECOVER",4003:"SEND_AUDIO_BITRATE_TOO_LOW_RECOVER",4005:"RECV_AUDIO_DECODE_FAILED_RECOVER"},Qe={FramerateInput:1001,FramerateSent:1002,SendVideoBitrate:1003,VideoDecode:1005,AudioIntputLevel:2001,AudioOutputLevel:2002,SendAudioBitrate:2003,AudioDecode:2005},$e=function(e){var t={remoteStreamStorage:{},localStreamStorage:{}};return t.gatewayClient=e,t.checkAudioOutputLevel=function(e){return!(e&&parseInt(e.audioRecvBytesDelta)>0&&parseInt(e.audioDecodingNormalDelta)>0&&0===parseInt(e.audioOutputLevel))},t.checkAudioIntputLevel=function(e){return!e||0!==parseInt(e.audioInputLevel)},t.checkFramerateInput=function(e,t){if(!e||!t.attributes)return!0;var n=parseInt(t.attributes.maxFrameRate),i=parseInt(e.googFrameRateInput);return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)},t.checkFramerateSent=function(e){return!(e&&parseInt(e.googFrameRateInput)>5&&parseInt(e.googFrameRateSent)<=1)},t.checkSendVideoBitrate=function(e){return!e||0!==parseInt(e.videoSendBytesDelta)},t.checkSendAudioBitrate=function(e){return!e||0!==parseInt(e.audioSendBytesDelta)},t.checkVideoDecode=function(e){return!e||0===parseInt(e.videoRecvBytesDelta)||0!==parseInt(e.googFrameRateDecoded)},t.checkAudioDecode=function(e){return!e||0===parseInt(e.audioRecvBytesDelta)||0!==parseInt(e.audioDecodingNormalDelta)},t.record=function(e,n,i,o,r){i[e]||(i[e]={isPrevNormal:!0,record:[]});var a=i[e],s=t["check"+e](n,r);if(a.record.push(s),a.record.length>=5){a.isCurNormal=a.record.includes(!0);var c=Qe[e];a.isPrevNormal&&!a.isCurNormal&&t.gatewayClient.dispatchEvent({type:"exception",code:c,msg:Xe[c],uid:o}),!a.isPrevNormal&&a.isCurNormal&&t.gatewayClient.dispatchEvent({type:"exception",code:c+2e3,msg:Xe[c+2e3],uid:o}),a.isPrevNormal=a.isCurNormal,a.record=[]}},t.setLocalStats=function(e){var n={};Object.keys(e).map((function(i){var o=e[i],r=t.gatewayClient.localStreams[parseInt(i)],a=t.localStreamStorage[i]||{};r&&r.hasVideo()&&(t.record("SendVideoBitrate",o.videoStats,a,i),t.record("FramerateInput",o.videoStats,a,i,r),t.record("FramerateSent",o.videoStats,a,i)),r&&r.hasAudio()&&(t.record("AudioIntputLevel",o.audioStats,a,i),t.record("SendAudioBitrate",o.audioStats,a,i)),n[i]=a})),t.localStreamStorage=n},t.setRemoteStats=function(n){var i={};Object.keys(n).map((function(o){var r=n[o],a=e.remoteStreams[o],s=t.remoteStreamStorage[o]||{};a&&a.hasVideo()&&a.isPlaying()&&t.record("VideoDecode",r.videoStats,s,o),a&&a.hasAudio()&&a.isPlaying()&&(t.record("AudioOutputLevel",r.audioStats,s,o),t.record("AudioDecode",r.audioStats,s,o)),i[o]=s})),t.remoteStreamStorage=i},t},Ze=new function(){var e=a();return e.states={UNINIT:"UNINIT",INITING:"INITING",INITED:"INITED"},e.state=e.states.UNINIT,e.type=null,e.lastConnectedAt=null,e.lastDisconnectedAt=null,e.lastTypeChangedAt=null,e.networkChangeTimer=null,e._init=function(t,n){if(e.state=e.states.INITING,navigator.connection&&navigator.connection.addEventListener){var i=e._getNetworkInfo();e.type=i&&i.type,e.state=e.states.INITED,t&&t()}else e.state=e.states.UNINIT,n&&n("DO_NOT_SUPPORT")},e._getNetworkInfo=function(){return navigator.connection},e._reloadNetworkInfo=function(){var t=e._getNetworkInfo(),n=t&&t.type||"UNSUPPORTED",i=Date.now();if(n!==e.type){e.lastTypeChangedAt=i,"none"==n?e.lastDisconnectedAt=i:"none"==e.type&&(e.lastConnectedAt=i),e.type=n;var o={type:"networkTypeChanged",networkType:n};e.dispatchEvent(o)}},e.getStats=function(t,n){var i={},o=e._getNetworkInfo();o&&(i.NetworkType=o.type||"UNSUPPORTED"),setTimeout((function(){t(i)}),0)},e._init((function(){navigator.connection.addEventListener("change",(function(){e._reloadNetworkInfo()})),e.networkChangeTimer=setInterval((function(){e._reloadNetworkInfo()}),5e3)}),(function(e){})),e},et=function(e){var t={key:void 0,highStream:null,lowStream:null,lowStreamParameter:null,isDualStream:!1,highStreamState:2,lowStreamState:2,proxyServer:null,turnServer:{},useProxyServer:!1};return t.mode=e.mode,t.clientId=Object(le.b)().slice(0,5),e=y()({},e),t.aespassword=null,t.aesmode="none",t.hasPublished=!1,t.getConnectionState=function(){var n=r.b.reportApiInvoke(e.sessionId,{name:"Client.getConnectionState",options:arguments,tag:"tracer"}),i=Ke.connetionStateMap[t.gatewayClient.state];return n(),i},t.setClientRole=function(n,i){var a=r.b.reportApiInvoke(e.sessionId,{callback:i,name:"Client.setClientRole",options:arguments,tag:"tracer"});if(ge(n,"setClientRole",["host","audience"]),"rtc"===t.mode){var s="RTC mode can not use setClientRole";return o.default.warning("[".concat(t.clientId,"] ").concat(s)),a&&a(s)}t.gatewayClient&&t.gatewayClient.state===Ke.CONNECTED?("audience"===n&&(0===this.highStreamState?this._unpublish(this.highStream,(function(){a&&a(null,{role:n})}),(function(e){a&&a(e)})):t.gatewayClient.setClientRole("audience",a)),"host"===n&&t.gatewayClient.setClientRole("host",a)):(t.gatewayClient.role=n,a&&a(null,{role:n}))},t.getGatewayInfo=function(e){if(t.gatewayClient.state!==Ke.CONNECTED){var n="Client is not in connected state";return o.default.error("[".concat(t.clientId,"] ").concat(n)),void e(n)}t.gatewayClient.getGatewayInfo((function(t){e(null,t)}),e)},t.renewToken=function(n,i,a){var s=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return a&&a(e);i&&i(t)},name:"Client.renewToken",options:arguments,tag:"tracer"});if(!Ee(n))throw new Error("Invalid token: Token is of the string type .Length of the string: [1,255]. ASCII characters only.");t.gatewayClient||(o.default.error("[".concat(t.clientId,"] renewToken Failed. GatewayClient not Exist")),s(O)),t.key?(t.key=n,t.gatewayClient.renewToken(n,(function(e){return s(null,e)}),s)):(o.default.error("[".concat(t.clientId,"] renewToken should not be called before user join")),s(O))},t.setLowStreamParameter=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.setLowStreamParameter",options:arguments,tag:"tracer"});ve(n,"param");var a=n.width,s=n.height,c=n.framerate,d=n.bitrate;Re(a)||ye(a,"width"),Re(s)||ye(s,"height"),Re(c)||ye(c,"framerate"),Re(d)||ye(d,"bitrate",1,1e7),(!a&&s||a&&!s)&&o.default.warning("[".concat(t.clientId,"] The width and height parameters take effect only when both are set")),t.lowStreamParameter=n,i()},t.init=function(n,i,a){var s=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return a&&a(e);i&&i(t)},name:"Client.init",options:arguments,tag:"tracer"});he(n),Object(p.isChromeKernel)()&&Object(p.getChromeKernelVersion)()<=48?a?s(Z):Object(le.f)():(o.default.info("[".concat(t.clientId,"] Initializing AgoraRTC client, appId: ").concat(n,".")),e.appId=n,e.sessionId=Object(le.b)(),s())},t.setTurnServer=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.setTurnServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==Ke.DISCONNECTED)throw new Error("Set turn server before join channel");if(t.useProxyServer)throw new Error("You have already set the proxy");ve(n,"turnServer");var a=n.turnServerURL,s=n.username,c=n.password,d=n.udpport,u=n.forceturn,l=n.tcpport;he(a,"turnServerURL"),he(s,"username"),he(c,"password"),he(d,"udpport"),Re(u)||Se(u,"forceturn"),t.turnServer.url=a,t.turnServer.udpport=d,t.turnServer.username=s,t.turnServer.credential=c,t.turnServer.forceturn=u||!1,Re(l)||(he(l,"tcpport"),t.turnServer.tcpport=l,o.default.info("[".concat(t.clientId,"] Set turnserver tcpurl. ").concat(t.turnServer.url,":").concat(t.turnServer.tcpport))),o.default.info("[".concat(t.clientId,"] Set turnserver udpurl. ").concat(t.turnServer.url,":").concat(t.turnServer.udpport,",username: ").concat(t.turnServer.uername,",password: ").concat(t.turnServer.credential)),i()},t.setProxyServer=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.setProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==Ke.DISCONNECTED)throw new Error("Set proxy server before join channel");if(!n)throw new Error("Do not set the proxyServer parameter as empty");if(t.useProxyServer)throw new Error("You have already set the proxy");he(n,"proxyServer"),t.proxyServer=n,r.b.setProxyServer(n),o.default.setProxyServer(n),i()},t.startProxyServer=function(){var n=r.b.reportApiInvoke(e.sessionId,{name:"Client.startProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==Ke.DISCONNECTED)throw new Error("Start proxy server before join channel");if(t.proxyServer||t.turnServer.url)throw new Error("You have already set the proxy");t.useProxyServer=!0,n()},t.stopProxyServer=function(){var n=r.b.reportApiInvoke(e.sessionId,{name:"Client.stopProxyServer",options:arguments,tag:"tracer"});if(t.gatewayClient&&t.gatewayClient.state!==Ke.DISCONNECTED)throw new Error("Stop proxy server after leave channel");r.b.setProxyServer(),o.default.setProxyServer(),t.turnServer={},t.proxyServer=null,t.useProxyServer=!1,n()},t.setEncryptionSecret=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.setEncryptionSecret",options:arguments,tag:"tracer"});he(n,"password"),t.aespassword=n,i()},t.setEncryptionMode=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.setEncryptionMode",options:arguments,tag:"tracer"});if(he(n,"encryptionMode"),!Ne.includes(n))throw new Error('Invalid encryptionMode: encryptionMode should be "aes-128-xts" | "aes-256-xts" | "aes-128-ecb"');t.aesmode=n,i()},t.configPublisher=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.configPublisher",options:arguments,tag:"tracer"});ve(n,"config");var o=n.width,a=n.height,s=n.framerate,c=n.bitrate,d=n.publisherUrl;ye(o,"width"),ye(a,"height"),ye(s,"framerate"),ye(c,"bitrate",1,1e7),d&&he(d,"publisherUrl"),t.gatewayClient.configPublisher(n),i()},t.enableDualStream=function(n,i){var a=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Client.enableDualStream",options:arguments,tag:"tracer"});return"iOS"===Object(p.getBrowserOS)()?(r.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),a(W)):Object(p.isWeChatBrowser)()?(r.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!1}),a(G)):(r.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!0,succ:!0}),t.isDualStream=!0,void(0===t.highStreamState?t._publishLowStream((function(e){return a(null,e)}),(function(e){o.default.warning("[".concat(t.clientId,"]"),e),a(X)})):1===t.highStreamState?a(z):a(null)))},t.disableDualStream=function(n,i){var a=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Client.disableDualStream",options:arguments,tag:"tracer"});r.b.streamSwitch(e.sessionId,{lts:(new Date).getTime(),isdual:!1,succ:!0}),t.isDualStream=!1,0===t.highStreamState?t._unpublishLowStream((function(){t.highStream.lowStream=null,a()}),(function(e){o.default.warning("[".concat(t.clientId,"]"),e),a(Q)})):1===t.highStreamState?a(z):a()},t._createLowStream=function(e,n){if(t.highStream&&t.highStream.stream){var r=y()({},t.highStream.params);if(r.streamID+=1,r.audio=!1,r.video){var a=t.highStream.stream.getVideoTracks()[0];a?me.getVideoCameraIdByLabel(a.label,(function(a){r.cameraId=a;var s=new Ae(r);if(s.streamId=t.highStream.getId()+1,t.lowStreamParameter){var c=y()({},t.lowStreamParameter);if(!c.width||!c.height){var d=Ye(t.highStream.profile),u=i.SUPPORT_RESOLUTION_LIST[d[0]];c.width=u[0],c.height=u[1]}c.framerate=c.framerate||5,c.bitrate=c.bitrate||50,(Object(p.isSafari)()||Object(p.isOpera)())&&(o.default.debug("[".concat(t.clientId,"] Shimming lowStreamParameter")),u=i.SUPPORT_RESOLUTION_LIST[t.highStream.profile],c.width=u[0],c.height=u[1]),s.setVideoProfileCustomPlus(c)}else s.setVideoProfileCustom(Ye(t.highStream.profile));s.init((function(){t.highStream.lowStream=s,t.highStream.userMuteVideo&&s.muteVideo(),e&&e(s)}),n)}),n):n&&n(K)}else n&&n(K)}else n&&n(K)},t._getLowStream=function(e,n){t.lowStream?e(t.lowStream):t._createLowStream((function(n){t.lowStream=n,e(t.lowStream)}),n)},t._publishLowStream=function(e,n){return 2!==t.lowStreamState?n&&n(q):t.highStream&&t.highStream.hasScreen()?n&&n(H):void t._getLowStream((function(i){t.lowStreamState=1,t.gatewayClient.publish(i,{streamType:1},(function(){t.lowStreamState=0,e&&e()}),(function(e){o.default.debug("[".concat(t.clientId,"] publish low stream failed")),n&&n(e)}))}),n)},t._unpublishLowStream=function(e,n){if(0!==t.lowStreamState)return n&&n(J);t.lowStream&&(t.gatewayClient.unpublish(t.lowStream,{streamType:1},(function(){}),(function(e){o.default.debug("[".concat(t.clientId,"] unpublish low stream failed")),n&&n(e)})),t.lowStream.close(),t.lowStream=null,t.lowStreamState=2,e&&e())},t.join=function(n,i,a,s,c){var d,u=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return c&&c(e);s&&s(t)},name:"Client.join",options:arguments,tag:"tracer"});if(n&&!Ee(n))return o.default.warning("[".concat(t.clientId,"] Param channelKey should be string")),u(A);if(!we(d=i)||!/^[a-zA-Z0-9!#$%&()+-:;<=.>?@[\]^_{}|~,\s]{1,64}$/.test(d))return o.default.warning("[".concat(t.clientId,"] The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")),u(A);if("string"==typeof i&&""===i)return o.default.warning("[".concat(t.clientId,"] Param channel should not be empty")),u(A);if(a&&!Object(le.c)(a)&&!be(a,1,255))return o.default.warning("[".concat(t.clientId,"] [String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]")),u(A);if("string"==typeof a&&0==a.length)return o.default.warning("[".concat(t.clientId,"] String uid should not be empty")),u(A);if("string"==typeof a&&a.length>256)return o.default.warning("[".concat(t.clientId,"] Length of string uid should be less than 255")),u(A);t.highStream=null,t.lowStream=null,t.lowStreamParameter=null,t.isDualStream=!1,t.highStreamState=2,t.lowStreamState=2;var l={clientId:t.clientId,appId:e.appId,sid:e.sessionId,cname:i,uid:a,turnServer:t.turnServer,proxyServer:t.proxyServer,token:n||e.appId,useProxyServer:t.useProxyServer};if("string"==typeof a&&(l.stringUid=a,l.uid=0),t.aespassword&&"none"!==t.aesmode&&y()(l,{aespassword:t.aespassword,aesmode:t.aesmode}),r.b.sessionInit(e.sessionId,{lts:(new Date).getTime(),cname:i,appid:e.appId,mode:e.mode,succ:!0}),t.onSuccess=function(e){return u(null,e)},t.onFailure=function(e){return u(e)},t.channel=i,t.gatewayClient.state!==Ke.DISCONNECTED)return o.default.error("[".concat(t.clientId,"] Client already in connecting/connected state")),u(O),void r.b.joinGateway(e.sessionId,{lts:Date.now(),succ:!1,ec:O,addr:null});t.gatewayClient.state=Ke.CONNECTING,Fe(l,(function(r,a){o.default.info("[".concat(t.clientId,"] Joining channel: ").concat(i)),t.gatewayClient.dispatchEvent({type:"config-distribute",config:a,joinInfo:l}),t.key=n||e.appId,l.cid=r.cid,l.uid=r.uid,r.uni_lbs_ip&&r.uni_lbs_ip[1]&&(l.uni_lbs_ip=r.uni_lbs_ip[1]),l.gatewayAddr=r.gateway_addr,t.joinInfo=l,t.gatewayClient.join(l,t.key,(function(e){o.default.info("[".concat(t.clientId,"] Join channel ").concat(i," success, join with uid: ").concat(e,".")),t.onSuccess=null,u(null,e)}),(function(e){return u(e)}))}))},t.renewChannelKey=function(n,i,a){var s=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return a&&a(e);i&&i(t)},name:"Client.renewChannelKey",options:arguments,tag:"tracer"});he(n,"key",1,2047),void 0===t.key?(o.default.error("[".concat(t.clientId,"] renewChannelKey should not be called before user join")),s(O)):(t.key=n,t.gatewayClient.key=n,t.gatewayClient.rejoin(),s())},t.leave=function(n,i){var a=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e);n&&n(t)},name:"Client.leave",options:arguments,tag:"tracer"});o.default.info("[".concat(t.clientId,"] Leaving channel")),t._renewSession(),t.gatewayClient.leave((function(e){return a(e)}),a)},t._renewSession=function(){var n=Object(le.b)();if(o.default.debug("renewSession ".concat(e.sessionId," => ").concat(n)),e.sessionId=n,t.joinInfo&&(t.joinInfo.sid=n),t.gatewayClient&&(t.gatewayClient.joinInfo&&(t.gatewayClient.joinInfo.sid=n),t.gatewayClient.localStreams))for(var i in t.gatewayClient.localStreams){var r=t.gatewayClient.localStreams[i];r&&(r.sid=n)}},t._publish=function(n,i,r){if(2!==t.highStreamState)return o.default.warning("[".concat(t.clientId,"] Can't publish stream when stream already publish ").concat(n.getId())),r&&r(N);o.default.info("[".concat(t.clientId,"] Publishing stream, uid ").concat(n.getId())),t.highStream=n,t.highStreamState=1,t.highStream.streamId=t.joinInfo.stringUid||t.joinInfo.uid,t.hasPublished=!1;var a=function(n,i,r){t.gatewayClient.publish(n,{streamType:0},(function(){n.sid=e.sessionId,t.highStreamState=0,o.default.info("[".concat(t.clientId,"] Publish success, uid: ").concat(n.getId())),t.isDualStream?t._publishLowStream((function(){i&&i()}),(function(e){o.default.warning("[".concat(t.clientId,"] "),e),i&&i()})):i&&i()}),r)};"audience"===t.gatewayClient.role&&"live"===t.mode?t.gatewayClient.setClientRole("host",(function(e){if(e)return r&&r(e);a(n,i,r)})):a(n,i,r)},t._unpublish=function(e,n,i){if(0!==t.highStreamState)return o.default.warning("[".concat(t.clientId,"] Can't unpublish stream when stream not publish")),i&&i(x);o.default.info("[".concat(t.clientId,"] Unpublish stream, uid ").concat(e.getId()));var r=function(e,n,i){t.isDualStream&&t.lowStream?(t._unpublishLowStream(null,i),t.gatewayClient.unpublish(e,{streamType:0},null,i),t.highStreamState=2,o.default.info("[".concat(t.clientId,"] Unpublish stream success, uid: ").concat(e.getId()))):(t.gatewayClient.unpublish(e,{streamType:0},null,i),t.highStreamState=2,o.default.info("[".concat(t.clientId,"] Unpublish stream success, uid: ").concat(e.getId()))),n&&n()};"host"===t.gatewayClient.role&&"live"===t.mode?t.gatewayClient.setClientRole("audience",(function(t){if(t)return i&&i(t);r(e,n,i)})):r(e,n,i)},t.publish=function(n,i){var o=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e)},name:"Client.publish",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});2===t.highStreamState?t._publish(n,(function(e){return o(null,e)}),(function(e){return o(e)})):o(N)},t.unpublish=function(n,i){var o=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e)},name:"Client.unpublish",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});0===t.highStreamState?t._unpublish(n,(function(e){return o(null,e)}),(function(e){return o(e)})):o(x)},t.subscribe=function(n,i,a){var s=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return a&&a(e)},name:"Client.subscribe",tag:"tracer",options:{stream:"too long to show",options:i,onFailure:!!a}});"function"==typeof i&&(a=i,i=null),ve(n,"stream"),Re(i)||(ve(i,"options"),Re(i.video)||Se(i.video,"options.video"),Re(i.audio)||Se(i.audio,"options.audio"));var c={video:!0,audio:!0};if(!Re(i)){if(Object(p.isSafari)()&&(!i.video||!i.audio)){var d="SAFARI_NOT_SUPPORTED_FOR_TRACK_SUBSCRIPTION";return o.default.error("[".concat(t.clientId,"] "),d),void s(d)}if(!Re(i.video)&&!_e(i.video)||!Re(i.audio)&&!_e(i.audio)||!1===i.audio&&!1===i.video)return d="INVALID_PARAMETER ".concat(JSON.stringify(i)),o.default.error("[".concat(t.clientId,"] "),d),void s(d)}n.subscribeOptions?(y()(n.subscribeOptions,c,i),t.gatewayClient.subscribeChange(n,(function(e){return s(null,e)}),s)):(n.subscribeOptions=y()({},c,i),t.gatewayClient.subscribe(n,(function(e){return s(null,e)}),s))},t.unsubscribe=function(n,i){var a=r.b.reportApiInvoke(e.sessionId,{callback:function(e,t){if(e)return i&&i(e)},name:"Client.unsubscribe",tag:"tracer",options:{stream:"too long to show",onFailure:!!i}});o.default.info("[".concat(t.clientId,"] Unsubscribe stream, uid: ").concat(n.getId())),t.gatewayClient.unsubscribe(n,(function(e){return a(null,e)}),a)},t.setRemoteVideoStreamType=function(n,i){var o=r.b.reportApiInvoke(e.sessionId,{name:"Client.setRemoteVideoStreamType",tag:"tracer",options:{stream:"too long to show",streamType:i}});ge(i,"streamType",[0,1]),t.gatewayClient.setRemoteVideoStreamType(n,i),o()},t.setStreamFallbackOption=function(n,i){var o=r.b.reportApiInvoke(e.sessionId,{name:"Client.setStreamFallbackOption",tag:"tracer",options:{stream:"too long to show",fallbackType:i}});ge(i,"fallbackType",[0,1,2]),t.gatewayClient.setStreamFallbackOption(n,i),o()},t.startLiveStreaming=function(n,i){var o=r.b.reportApiInvoke(e.sessionId,{name:"Client.startLiveStreaming",options:arguments,tag:"tracer"});he(n,"url"),Re(i)||Se(i,"transcodingEnabled"),t.gatewayClient.startLiveStreaming(n,i),o()},t.stopLiveStreaming=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.stopLiveStreaming",options:arguments,tag:"tracer"});he(n,"url"),t.gatewayClient.stopLiveStreaming(n),i()},t.setLiveTranscoding=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.setLiveTranscoding",options:arguments,tag:"tracer"});ve(n,"transcoding");var o=n.width,a=n.height,s=n.videoBitrate,c=n.videoFramerate,d=n.lowLatency,u=n.audioSampleRate,l=n.audioBitrate,p=n.audioChannels,f=n.videoGop,m=n.videoCodecProfile,g=n.userCount,v=n.backgroundColor,h=n.transcodingUsers;if(Re(o)||ye(o,"width"),Re(a)||ye(a,"height"),Re(s)||ye(s,"videoBitrate",1,1e6),Re(c)||ye(c,"videoFramerate"),Re(d)||Se(d,"lowLatency"),Re(u)||ge(u,"audioSampleRate",[32e3,44100,48e3]),Re(l)||ye(l,"audioBitrate",1,128),Re(p)||ge(p,"audioChannels",[1,2,3,4,5]),Re(f)||ye(f,"videoGop"),Re(m)||ge(m,"videoCodecProfile",[66,77,100]),Re(g)||ye(g,"userCount",0,17),Re(v)||ye(v,"backgroundColor",0,16777215),!Re(h)){if(!(h instanceof Array))throw new Error("[transcodingUsers]: transcodingUsers should be Array");if(h.length>17)throw new Error("The length of transcodingUsers cannot greater than 17");h.map((function(e,t){if(!Re(e.uid)&&!Object(le.c)(e.uid)&&!be(e.uid,1,255))throw new Error("[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");if(Re(e.x)||ye(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),Re(e.y)||ye(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),Re(e.width)||ye(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),Re(e.height)||ye(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),Re(e.zOrder)||ye(e.zOrder,"transcodingUser[".concat(t,"].zOrder"),0,100),!(Re(e.alpha)||"number"==typeof e.alpha&&e.alpha<=1&&e.alpha>=0))throw new Error("transcodingUser[${index}].alpha: The value range is [0, 1]")}))}y()(tt,n),t.gatewayClient.setLiveTranscoding(tt),i()},t.addInjectStreamUrl=function(n,i){var o=r.b.reportApiInvoke(e.sessionId,{name:"Client.addInjectStreamUrl",options:arguments,tag:"tracer"});he(n,"url",1,255),ve(i,"config"),!Re(i&&i.width)&&ye(i.width,"config.width",0,1e4),!Re(i&&i.height)&&ye(i.height,"config.height",0,1e4),!Re(i&&i.videoGop)&&ye(i.videoGop,"config.videoGop",1,1e4),!Re(i&&i.videoFramerate)&&ye(i.videoFramerate,"config.videoFramerate",1,1e4),!Re(i&&i.videoBitrate)&&ye(i.videoBitrate,"config.videoBitrate",1,1e4),!Re(i&&i.audioSampleRate)&&ge(i.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),!Re(i&&i.audioBitrate)&&ye(i.audioBitrate,"config.audioBitrate",1,1e4),!Re(i&&i.audioChannels)&&ye(i.audioChannels,"config.audioChannels",1,2),y()(nt,i),t.gatewayClient.addInjectStreamUrl(n,nt),o()},t.removeInjectStreamUrl=function(n){var i=r.b.reportApiInvoke(e.sessionId,{name:"Client.removeInjectStreamUrl",options:arguments,tag:"tracer"});he(n,"url",1,255),t.gatewayClient.removeInjectStreamUrl(n),i()},t.enableAudioVolumeIndicator=function(n,i){var a=r.b.reportApiInvoke(e.sessionId,{name:"Client.enableAudioVolumeIndicator",options:arguments,tag:"tracer"});n=n||2e3,ye(i=i||3,"smooth",1,100),ye(n,"interval",50,1e5),t.audioVolumeIndication=t.audioVolumeIndication||{enabled:!0},t.audioVolumeIndication.interval=n,t.audioVolumeIndication.smooth=i,t.audioVolumeIndication={interval:n,smooth:i},o.default.info("[".concat(t.clientId,"] enableAudioVolumeIndicator interval ").concat(n," smooth ").concat(i)),t.gatewayClient.enableAudioVolumeIndicator(n,i),a()},t.getNetworkStats=function(e,n){return o.default.deprecate("[".concat(t.clientId,"] client.getNetworkStats is deprecated. Use client.getTransportStats instead.")),Ze.getStats(e,n)},t.getSystemStats=function(e,t){return m.getStats(e,t)},t.getRecordingDevices=function(e,t){return me.getRecordingDevices(e,t)},t.getPlayoutDevices=function(e,t){return me.getPlayoutDevices(e,t)},t.getCameras=function(e,t){return me.getCameras(e,t)},t.getRemoteAudioStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioStats(e,n)},t.getLocalAudioStats=function(e,n){return t.rtcStatsCollector.getLocalAudioStats(e,n)},t.getRemoteVideoStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoStats(e,n)},t.getLocalVideoStats=function(e,n){return t.rtcStatsCollector.getLocalVideoStats(e,n)},t._getRemoteVideoQualityStats=function(e,n){return t.rtcStatsCollector.getRemoteVideoQualityStats(e,n)},t._getRemoteAudioQualityStats=function(e,n){return t.rtcStatsCollector.getRemoteAudioQualityStats(e,n)},t.getTransportStats=function(e,n){return t.rtcStatsCollector.getTransportStats((function(t){return Ze.getStats((function(n){var i=y()({},t,n);e&&e(i)}),n)}),n)},t.getSessionStats=function(e,n){return t.rtcStatsCollector.getSessionStats(e,n)},t.onNetworkQuality=function(){return t.rtcStatsCollector.onNetworkQuality(onSuccess,onFailure)},e.clientId=t.clientId,t.gatewayClient=Ke(e),t.on=t.gatewayClient.on,t.rtcStatsCollector=function(e){var t=a();return t.gatewayClient=e,t.exceptionMonitor=new $e(e),t.localStats={},t.remoteStats={},t.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0},t.getRemoteAudioStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];pe(o,"End2EndDelay",r.peer_delay&&r.peer_delay.audio_delay),pe(o,"TransportDelay",r.peer_delay&&r.peer_delay.e2e_delay),pe(o,"PacketLossRate",r.peer_delay&&r.peer_delay.e2e_audio_lost_ratio_400ms),pe(o,"RecvLevel",r.audioStats&&r.audioStats.audioOutputLevel),pe(o,"RecvBitrate",r.audioRecvBitrate),pe(o,"CodecType",r.audioStats&&r.audioStats.googCodecName),pe(o,"MuteState",r.audioDisabled),pe(o,"TotalFreezeTime",r.audioStats&&r.audioStats.audioTotalFreezeTime),pe(o,"TotalPlayDuration",r.audioStats&&r.audioStats.audioTotalPlayDuration),n[i]=o}e&&e(n)},t.getLocalAudioStats=function(e){var n={};for(var i in t.localStats){var o={},r=t.localStats[i];pe(o,"RecordingLevel",r.audioStats&&r.audioStats.audioInputLevel),pe(o,"SendLevel",r.audioStats&&r.audioStats.totalAudioEnergy),pe(o,"SamplingRate",r.audioStats&&r.audioStats.totalSamplesDuration),pe(o,"SendBitrate",r.audioSendBitrate),pe(o,"CodecType",r.audioStats&&r.audioStats.googCodecName),pe(o,"MuteState",r.audioDisabled);var a=t.gatewayClient.localStreams[i];a&&a.isPlaying()&&pe(o,"MuteState",a.userMuteAudio?"1":"0"),n[i]=o}e&&e(n)},t.getRemoteVideoStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];pe(o,"End2EndDelay",r.peer_delay&&r.peer_delay.video_delay),pe(o,"TransportDelay",r.peer_delay&&r.peer_delay.e2e_delay),pe(o,"PacketLossRate",r.peer_delay&&r.peer_delay.e2e_video_lost_ratio_400ms),pe(o,"RecvBitrate",r.videoRecvBitrate),pe(o,"RecvResolutionWidth",r.videoStats&&r.videoStats.googFrameWidthReceived),pe(o,"RecvResolutionHeight",r.videoStats&&r.videoStats.googFrameHeightReceived),pe(o,"RenderResolutionWidth",r.videoStats&&r.videoStats.renderRemoteWidth),pe(o,"RenderResolutionHeight",r.videoStats&&r.videoStats.renderRemoteHeight),pe(o,"RenderFrameRate",r.videoStats&&r.videoStats.googFrameRateOutput),pe(o,"MuteState",r.videoDisabled),pe(o,"TotalFreezeTime",r.videoStats&&r.videoStats.videoTotalFreezeTime),pe(o,"TotalPlayDuration",r.videoStats&&r.videoStats.videoTotalPlayDuration),n[i]=o}e&&e(n)},t.getLocalVideoStats=function(e){var n={};for(var i in t.localStats){var o={},r=t.localStats[i];pe(o,"TargetSendBitrate",r.videoTargetSendBitrate),pe(o,"SendFrameRate",r.videoStats&&r.videoStats.googFrameRateSent),pe(o,"SendBitrate",r.videoSendBitrate),pe(o,"SendResolutionWidth",r.videoStats&&r.videoStats.googFrameWidthSent),pe(o,"SendResolutionHeight",r.videoStats&&r.videoStats.googFrameHeightSent),pe(o,"CaptureResolutionWidth",r.videoStats&&r.videoStats.renderLocalWidth),pe(o,"CaptureResolutionHeight",r.videoStats&&r.videoStats.renderLocalHeight),pe(o,"EncodeDelay",r.videoStats&&r.videoStats.googAvgEncodeMs),pe(o,"MuteState",r.videoDisabled),pe(o,"TotalFreezeTime",r.videoStats&&r.videoStats.videoTotalFreezeTime),pe(o,"TotalDuration",r.videoStats&&r.videoStats.videoTotalPlayDuration),pe(o,"CaptureFrameRate",r.videoStats&&r.videoStats.googFrameRateSent),n[i]=o,e&&e(n)}},t.getRemoteVideoQualityStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];pe(o,"videoReceiveDelay",r.videoStats&&r.videoStats.googCurrentDelayMs),pe(o,"VideoFreezeRate",r.videoStats&&r.videoStats.videoFreezeRate),pe(o,"FirstFrameTime",r.firstFrameTime),n[i]=o}e&&e(n)},t.getRemoteAudioQualityStats=function(e){var n={};for(var i in t.remoteStats){var o={},r=t.remoteStats[i];pe(o,"audioReceiveDelay",r.audioStats&&r.audioStats.googCurrentDelayMs),pe(o,"AudioFreezeRate",r.videoStats&&r.videoStats.videoFreezeRate),n[i]=o}e&&e(n)},t.getTransportStats=function(e){var n={},i={},o=t.gatewayClient.traffic_stats,r=o.peer_delay;if(pe(n,"OutgoingAvailableBandwidth",t.gatewayClient.OutgoingAvailableBandwidth/1e3),pe(n,"RTT",o&&o.access_delay),r){var a=!0,s=!1,c=void 0;try{for(var d,u=r[Symbol.iterator]();!(a=(d=u.next()).done);a=!0){var l=d.value;l.downlink_estimate_bandwidth&&(i[l.peer_uid]=l.downlink_estimate_bandwidth/1e3+"")}}catch(e){s=!0,c=e}finally{try{a||null==u.return||u.return()}finally{if(s)throw c}}}n.IncomingAvailableBandwidth=i,e&&e(n)},t.getSessionStats=function(e){var n={},i=t.gatewayClient.traffic_stats,o=t.gatewayClient.socket,r=0,a=0;for(var s in t.remoteStats)(c=t.remoteStats[s])&&c.videoStats&&c.videoStats.videoRecvBytesDelta&&(a+=parseInt(c.videoStats.videoRecvBytesDelta)),c&&c.audioStats&&c.audioStats.audioRecvBytesDelta&&(a+=parseInt(c.audioStats.audioRecvBytesDelta));for(var s in t.localStats){var c;(c=t.localStats[s])&&c.videoStats&&c.videoStats.videoSendBytesDelta&&(r+=parseInt(c.videoStats.videoSendBytesDelta)),c&&c.audioStats&&c.audioStats.audioSendBytesDelta&&(r+=parseInt(c.audioStats.audioSendBytesDelta))}var d=r+t.session.WSSendBytesDelta+t.session.HTTPSendBytesDelta,u=a+t.session.WSRecvBytesDelta+t.session.HTTPRecvBytesDelta,l=t.session.sendBytes+Object(Me.b)(),p=t.session.recvBytes+Object(Me.a)();t.gatewayClient.socket&&t.gatewayClient.socket.state===t.gatewayClient.CONNECTED&&(l+=o.getSendBytes(),p+=o.getRecvBytes());var f=1;i.peer_delay&&(f=i.peer_delay.length,f+=1),pe(n,"Duration",o.getDuration()),pe(n,"UserCount",f),pe(n,"SendBytes",l),pe(n,"RecvBytes",p),pe(n,"SendBitrate",8*d/1e3),pe(n,"RecvBitrate",8*u/1e3),e&&e(n)},t.isLocalVideoFreeze=function(e,t){var n=0,i=0;if(!e||!t)return!1;if(Object(p.isChrome)()||Object(p.isOpera)())n=e.googFrameRateInput,i=e.googFrameRateSent;else if(Object(p.isSafari)())n=parseInt(e.framerateMean),i=parseInt(e.framesEncoded)-parseInt(t.framesEncoded);else{if(!Object(p.isFireFox)())return!1;n=parseInt(e.framerateMean),i=parseInt(e.framesEncoded)-parseInt(t.framesEncoded)}return n>5&&i<3},t.isRemoteVideoFreeze=function(e,t){var n=0,i=0;if(!e||!t)return!1;if(Object(p.isChrome)()||Object(p.isOpera)())n=e.googFrameRateReceived,i=e.googFrameRateDecoded;else if(Object(p.isSafari)())n=e.framerateMean,i=parseInt(e.framesDecoded)-parseInt(t.framesDecoded);else{if(!Object(p.isFireFox)())return!1;n=parseInt(e.framesReceived)-parseInt(t.framesReceived),i=parseInt(e.framesDecoded)-parseInt(t.framesDecoded)}return n>5&&n<10&&i<3||n>10&&n<20&&i<4||n>20&&i<5},t.isAudioFreeze=function(e){if(Object(p.isChrome)()&&e){if(e.googDecodingPLC&&e.googDecodingPLCCNG&&e.googDecodingCTN)return(parseInt(e.googDecodingPLC)+parseInt(e.googDecodingPLCCNG))/parseInt(e.googDecodingCTN)>.2}else if((Object(p.isSafari)()||Object(p.isFireFox)())&&e.packetsLost&&e.packetsReceived)return parseInt(e.packetsLost)/(parseInt(e.packetsLost)+parseInt(e.packetsReceived))>.2;return!1},t.isAudioDecodeFailed=function(e){return!!((Object(p.isChrome)()||Object(p.isOpera)())&&e&&parseInt(e.bytesReceived)>0&&0===parseInt(e.googDecodingNormal))},t.networkQualityTimer=setInterval((function(){var e=t.gatewayClient.traffic_stats;t.gatewayClient.dispatchEvent({type:"network-quality",uplinkNetworkQuality:t.networkQualityTrans(e.uplink_network_quality),downlinkNetworkQuality:t.networkQualityTrans(e.downlink_network_quality)})}),2e3),t.networkQualityTrans=function(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0},t.getStatsTimer=setInterval((function(){var e=t.gatewayClient.traffic_stats,n=Date.now();t.gatewayClient.dispatchEvent({type:"_testException"}),Object.keys(t.localStats).length&&t.exceptionMonitor.setLocalStats(t.localStats),Object.keys(t.remoteStats).length&&t.exceptionMonitor.setRemoteStats(t.remoteStats);var i={};Object.keys(t.gatewayClient.remoteStreams).forEach((function(o){var r=t.gatewayClient.remoteStreams[o],a=t.remoteStats[o],s={id:o,updatedAt:n};i[o]=s,s.firstFrameTime=r.firstFrameTime,a?(s.audioTotalPlayDuration=a.audioTotalPlayDuration+1,s.audioTotalFreezeTime=a.audioTotalFreezeTime,s.isAudioFreeze=!1,s.isAudioDecodeFailed=!1,s.videoTotalPlayDuration=a.videoTotalPlayDuration+1,s.videoTotalFreezeTime=a.videoTotalFreezeTime,s.isVideoFreeze=!1):(s.audioTotalPlayDuration=1,s.audioTotalFreezeTime=0,s.videoTotalPlayDuration=1,s.videoTotalFreezeTime=0);var c=e&&e.peer_delay&&e.peer_delay.find((function(e){return e.peer_uid==o}));c&&(s.peer_delay=c),r&&(r.isPlaying()&&(s.audioDisabled=r.userMuteAudio?"1":"0",s.videoDisabled=r.userMuteVideo?"1":"0"),a&&a.peer_delay&&c&&a.peer_delay.stream_type!==c.stream_type&&t.gatewayClient.dispatchEvent({type:"streamTypeChange",uid:o,streamType:c.stream_type}),r.pc&&"established"==r.pc.state&&r.pc.getStats((function(e){if(s.pcStats=e,s.audioStats=e.find((function(e){return"audio"==e.mediaType&&(e.id.indexOf("_recv")>-1||e.id.toLowerCase().indexOf("inbound")>-1)})),s.videoStats=e.find((function(e){return"video"==e.mediaType&&(e.id.indexOf("_recv")>-1||e.id.toLowerCase().indexOf("inbound")>-1)})),a&&a.audioStats&&s.audioStats){var n=parseInt(s.audioStats.bytesReceived)-parseInt(a.audioStats.bytesReceived),i=parseInt(s.audioStats.googDecodingNormal)-parseInt(a.audioStats.googDecodingNormal);if(s.audioStats.audioRecvBytesDelta=n,s.audioStats.audioDecodingNormalDelta=i,t.session.recvBytes+=n,isFinite(n)&&s.audioStats.timestamp){var o=s.audioStats.timestamp.getTime()-a.audioStats.timestamp.getTime();s.audioRecvBitrate=Math.floor(8*n/o)}t.isAudioFreeze(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.audioTotalFreezeTime++,s.isAudioFreeze=!0),t.isAudioDecodeFailed(s.audioStats)&&s.audioTotalPlayDuration>10&&(s.isAudioDecodeFailed=!0),s.audioStats.audioTotalFreezeTime=s.audioTotalFreezeTime,s.audioStats.audioTotalPlayDuration=s.audioTotalPlayDuration,s.audioStats.audioFreezeRate=Math.ceil(100*s.audioTotalFreezeTime/s.audioTotalPlayDuration)}if(a&&a.videoStats&&s.videoStats){var c=parseInt(s.videoStats.bytesReceived)-parseInt(a.videoStats.bytesReceived);s.videoStats.videoRecvBytesDelta=c,t.session.recvBytes+=c,isFinite(c)&&s.videoStats.timestamp&&(o=s.videoStats.timestamp.getTime()-a.videoStats.timestamp.getTime(),s.videoRecvBitrate=Math.floor(8*c/o)),t.isRemoteVideoFreeze(s.videoStats,a.videoStats)&&(s.videoTotalFreezeTime++,s.isVideoFreeze=!0),s.videoStats.videoTotalFreezeTime=s.videoTotalFreezeTime,s.videoStats.videoTotalPlayDuration=s.videoTotalPlayDuration,s.videoStats.videoFreezeRate=Math.ceil(100*s.videoTotalFreezeTime/s.videoTotalPlayDuration),s.videoStats.renderRemoteWidth=r.videoWidth||s.videoStats.googFrameWidthReceived,s.videoStats.renderRemoteHeight=r.videoHeight||s.videoStats.googFrameHeightReceived}})))})),t.remoteStats=i;var o={};if(Object.keys(t.gatewayClient.localStreams).forEach((function(e){var i=t.gatewayClient.localStreams[e],r=t.localStats[e],a={id:e,updatedAt:n};o[e]=a,r?(a.videoTotalPlayDuration=r.videoTotalPlayDuration+1,a.videoTotalFreezeTime=r.videoTotalFreezeTime,a.isVideoFreeze=!1):(a.videoTotalPlayDuration=1,a.videoTotalFreezeTime=0),i&&(i.isPlaying()&&(a.audioDisabled=i.userMuteAudio?"1":"0",a.videoDisabled=i.userMuteVideo?"1":"0"),i.video&&i.attributes.maxVideoBW?a.videoTargetSendBitrate=i.attributes.maxVideoBW:i.video&&i.screenAttributes&&(a.videoTargetSendBitrate=i.screenAttributes.maxVideoBW),i.pc&&"established"==i.pc.state&&i.pc.getStats((function(e){if(a.pcStats=e.reverse(),a.audioStats=e.find((function(e){return"audio"==e.mediaType&&(e.id.indexOf("_send")>-1||e.id.toLowerCase().indexOf("outbound")>-1)})),a.videoStats=e.find((function(e){return"video"==e.mediaType&&(e.id.indexOf("_send")>-1||e.id.toLowerCase().indexOf("outbound")>-1)})),a.audioStats&&r&&r.audioStats){var n=parseInt(a.audioStats.bytesSent)-parseInt(r.audioStats.bytesSent);if(a.audioStats.audioSendBytesDelta=n,t.session.sendBytes+=n,isFinite(n)&&a.audioStats.timestamp){var o=a.audioStats.timestamp.getTime()-r.audioStats.timestamp.getTime();a.audioSendBitrate=Math.floor(8*n/o)}}if(a.videoStats&&r&&r.videoStats){var s=parseInt(a.videoStats.bytesSent)-parseInt(r.videoStats.bytesSent);a.videoStats.videoSendBytesDelta=s,t.session.sendBytes+=s,isFinite(s)&&a.videoStats.timestamp&&(o=a.videoStats.timestamp.getTime()-r.videoStats.timestamp.getTime(),a.videoSendBitrate=Math.floor(8*s/o)),t.isLocalVideoFreeze(a.videoStats,r.videoStats)&&(a.videoTotalFreezeTime++,a.isVideoFreeze=!0),a.videoStats.videoTotalFreezeTime=a.videoTotalFreezeTime,a.videoStats.videoTotalPlayDuration=a.videoTotalPlayDuration,a.videoStats.videoFreezeRate=Math.ceil(100*a.videoTotalFreezeTime/a.videoTotalPlayDuration),a.videoStats.renderLocalWidth=i.videoWidth||a.videoStats.googFrameWidthSent,a.videoStats.renderLocalHeight=i.videoHeight||a.videoStats.googFrameHeightSent}})))})),t.localStats=o,t.session.HTTPSendBytesDelta=Object(Me.b)()-t.session.HTTPSendBytes,t.session.HTTPSendBytes=Object(Me.b)(),t.session.HTTPRecvBytesDelta=Object(Me.a)()-t.session.HTTPRecvBytes,t.session.HTTPRecvBytes=Object(Me.a)(),t.gatewayClient.socket&&t.gatewayClient.socket.state===t.gatewayClient.CONNECTED){var r=t.gatewayClient.socket;t.session.WSSendBytesDelta=r.getSendBytes()-t.session.WSSendBytes,t.session.WSSendBytes=r.getSendBytes(),t.session.WSRecvBytesDelta=r.getRecvBytes()-t.session.WSRecvBytes,t.session.WSRecvBytes=r.getRecvBytes()}}),1e3),t.gatewayClient.on("join",(function(){t.session={sendBytes:0,recvBytes:0,WSSendBytes:0,WSSendBytesDelta:0,WSRecvBytes:0,WSRecvBytesDelta:0,HTTPSendBytes:0,HTTPSendBytesDelta:0,HTTPRecvBytes:0,HTTPRecvBytesDelta:0}})),t}(t.gatewayClient),t.configDistributManager=function(e){var t={};return t.client=e,t.client.on("config-distribute",(function(n){var o=n.joinInfo,a=n.config;if(a){Re(a.uploadLog)||(Object(i.setParameter)("UPLOAD_LOG",a.uploadLog),r.b.reportApiInvoke(o.sid,{name:"_configDistribute",options:{feature:"uploadLog",value:a.uploadLog}})()),Re(a.dualStream)||(e.isDualStream=a.dualStream,r.b.reportApiInvoke(o.sid,{name:"_configDistribute",options:{feature:"dualStream",value:a.dualStream}})()),Re(a.streamFallbackOption)||t.client.on("stream-subscribed",(function(e){var n=e.stream;n?(t.client.gatewayClient.setStreamFallbackOption(n,a.streamFallbackOption),r.b.reportApiInvoke(o.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:a.streamFallbackOption,streamId:n.getId()}})()):r.b.reportApiInvoke(o.sid,{name:"_configDistribute",options:{feature:"streamFallbackOption",value:a.streamFallbackOption,streamId:n.getId(),err:"invalid stream"}})()}));try{Object.keys(a).map((function(e){return Object(i.setParameter)(e,a[e])}))}catch(e){}}})),t}(t),Re(e.turnServer)||t.setTurnServer(e.turnServer),Re(e.proxyServer)||t.setProxyServer(e.proxyServer),"live"===t.mode&&(t.gatewayClient.role="audience"),"rtc"===t.mode&&(t.gatewayClient.role="host"),t.on("onMultiIP",(function(e){t.gatewayClient.closeGateway(),t.gatewayClient.socket=void 0,t.gatewayClient.hasChangeBGPAddress=!0,t.joinInfo.multiIP=e.arg.option,t.gatewayClient.state=Ke.CONNECTING,Fe(t.joinInfo,(function(e){o.default.info("[".concat(t.clientId,"] Joining channel: ").concat(t.channel)),t.joinInfo.cid=e.cid,t.joinInfo.uid=e.uid,t.joinInfo.uni_lbs_ip=e.uni_lbs_ip,t.joinInfo.gatewayAddr=e.gateway_addr,t.onSuccess?t.gatewayClient.join(t.joinInfo,t.key,(function(e){o.default.info("[".concat(t.clientId,"] Join channel ").concat(t.channel," success"));var n=t.onSuccess;t.onSuccess=null,t.onFailure=null,n(e)}),t.onFailure):(t.gatewayClient.joinInfo=y()({},t.joinInfo),t.gatewayClient.rejoin())}),t.onFailure)})),t.on("rejoin-start",(function(){t._renewSession(),r.b.sessionInit(e.sessionId,{lts:(new Date).getTime(),extend:{rejoin:!0},cname:t.channel,appid:e.appId,mode:e.mode,succ:!0})})),t.on("recover",(function(){t._renewSession(),r.b.sessionInit(e.sessionId,{lts:(new Date).getTime(),extend:{recover:!0},cname:t.channel,appid:e.appId,mode:e.mode,succ:!0})})),t.on("rejoin",(function(){var e=2===t.highStreamState?2:0;t.highStream&&0===e&&(o.default.info("[".concat(t.clientId,"] publish after rejoin")),t.highStreamState=2,t.lowStreamState=2,t.publish(t.highStream,(function(e){e&&o.default.info("[".concat(t.clientId,"] "),e)})))})),t.on("streamPublished",(function(e){t.hasPublished||(t.hasPublished=!0,t.gatewayClient.dispatchEvent(c({type:"stream-published",stream:e.stream})))})),t.on("pubP2PLost",(function(e){o.default.debug("[".concat(t.clientId,"] Start reconnect local peerConnection: ").concat(t.highStream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:t.highStream.getId()}),1===t.highStreamState&&(t.highStreamState=0,t.lowStreamState=0),t._unpublish(t.highStream,(function(){t._publish(t.highStream,(function(){o.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection success: ").concat(t.highStream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!0,reason:""})}),(function(e){o.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection failed: ").concat(e)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!1,reason:e})}))}),(function(e){o.default.debug("[".concat(t.clientId,"] Reconnect local peerConnection failed: ").concat(e)),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:t.highStream.getId(),success:!1,reason:e})}))})),t.on("subP2PLost",(function(e){o.default.debug("[".concat(t.clientId,"] Start reconnect remote peerConnection: ").concat(e.stream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-start",uid:e.stream.getId()}),t.gatewayClient.unsubscribe(e.stream,(function(){t.gatewayClient.subscribe(e.stream,(function(){o.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection success: ").concat(e.stream.getId())),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:""})}),(function(n){o.default.debug("[".concat(t.clientId,"] Reconnect remote peerConnection failed: "),n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:n})}))}),(function(n){o.default.debug("[".concat(t.clientId,"] \" + 'Reconnect remote peerConnection failed: "),n),t.gatewayClient.dispatchEvent({type:"stream-reconnect-end",uid:e.stream.getId(),success:!1,reason:n})}))})),Ze.on("networkTypeChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=y()({},e,{type:"network-type-changed"});t.gatewayClient.dispatchEvent(n)})),me.on("recordingDeviceChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=y()({},e,{type:"recording-device-changed"});t.gatewayClient.dispatchEvent(n)})),me.on("playoutDeviceChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=y()({},e,{type:"playout-device-changed"});t.gatewayClient.dispatchEvent(n)})),me.on("cameraChanged",(function(e){t.gatewayClient&&t.gatewayClient.dispatchEvent(e);var n=y()({},e,{type:"camera-changed"});t.gatewayClient.dispatchEvent(n)})),t.gatewayClient.on("streamTypeChange",(function(n){var i=y()({},n,{type:"stream-type-changed"});t.gatewayClient.dispatchEvent(i),r.b.reportApiInvoke(e.sessionId,{name:"streamTypeChange"})(null,JSON.stringify(n))})),t},tt={width:640,height:360,videoBitrate:400,videoFramerate:15,lowLatency:!1,audioSampleRate:48e3,audioBitrate:48,audioChannels:1,videoGop:30,videoCodecProfile:100,userCount:0,userConfigExtraInfo:{},backgroundColor:0,transcodingUsers:[]},nt={width:0,height:0,videoGop:30,videoFramerate:15,videoBitrate:400,audioSampleRate:44100,audioBitrate:48,audioChannels:1},it=me.getDevices,ot=ae;t.default={TranscodingUser:{uid:0,x:0,y:0,width:0,height:0,zOrder:0,alpha:1},LiveTranscoding:tt,createClient:function(e){var t=r.b.reportApiInvoke(null,{name:"createClient",options:arguments,tag:"tracer"});(e=y()({},e||{})).codec||(e.codec=function(e){switch(e){case"h264_interop":return"h264";default:return"vp8"}}(e.mode));var n=function(e){return ke.includes(e.mode)?De.includes(e.codec)?"h264_interop"==e.mode&&"h264"!==e.codec&&w:T:C}(e);if(n)throw o.default.error("Invalid parameter setting MODE: ".concat(e.mode," CODEC: ").concat(e.codec," ERROR ").concat(n)),t(n),new Error(n);return o.default.info("Creating client, MODE: ".concat(e.mode," CODEC: ").concat(e.codec)),function(e){switch(e.mode){case"interop":case"h264_interop":e.mode="live";break;case"web-only":e.mode="rtc"}}(e),t(null,e),et(e)},createStream:function(e){var t=r.b.reportApiInvoke(null,{name:"createStream",options:arguments,tag:"tracer"});ve(e,"StreamSpec");var n=e.streamID,i=e.audio,a=e.video,s=e.screen,c=(e.audioSource,e.videoSource,e.cameraId),d=e.microphoneId,u=e.mirror,l=e.extensionId,p=e.mediaSource,f=e.audioProcessing;if(!Re(n)&&!Object(le.c)(n)&&!be(n,1,255))throw new Error("[String streamID] Length of the string: [1,255]. ASCII characters only. [Number streamID] The value range is [0,10000]");if(Se(i,"audio"),Se(a,"video"),Re(s)||Se(s,"screen"),Re(c)||he(c,"cameraId",0,255,!1),Re(d)||he(d,"microphoneId",0,255,!1),Re(l)||he(l,"extensionId"),Re(p)||ge(p,"mediaSource",["screen","application","window"]),Re(u)||Se(u,"mirror"),!Re(f)){var m=f.AGC,g=f.AEC,v=f.ANS;Re(m)||Se(m,"AGC"),Re(g)||Se(g,"AEC"),Re(v)||Se(v,"ANS")}o.default.debug("Create stream");var h=Ae(e);return t(),h},Logger:o.default,getDevices:it,getScreenSources:ot,getParameter:i.getParameter,setParameter:i.setParameter,checkSystemRequirements:function(){var e=r.b.reportApiInvoke(null,{name:"checkSystemRequirements",options:arguments,tag:"tracer"}),t=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket,a=!!t&&!!n&&!!i,s=!1;o.default.debug(p.getBrowserInfo(),"isAPISupport:"+a),p.isChrome()&&p.getBrowserVersion()>=58&&"iOS"!==p.getBrowserOS()&&(s=!0),p.isFireFox()&&p.getBrowserVersion()>=56&&(s=!0),p.isOpera()&&p.getBrowserVersion()>=45&&(s=!0),p.isSafari()&&p.getBrowserVersion()>=11&&(s=!0),(p.isWeChatBrowser()||p.isQQBrowser())&&"iOS"!==p.getBrowserOS()&&(s=!0),p.isSupportedPC()||p.isSupportedMobile()||(s=!1);var c=a&&s;return e(null,c),c},getSupportedCodec:Oe.getSupportedCodec,VERSION:i.VERSION,BUILD:i.BUILD,AUDIO_SAMPLE_RATE_32000:32e3,AUDIO_SAMPLE_RATE_44100:44100,AUDIO_SAMPLE_RATE_48000:48e3,VIDEO_CODEC_PROFILE_BASELINE:66,VIDEO_CODEC_PROFILE_MAIN:77,VIDEO_CODEC_PROFILE_HIGH:100,REMOTE_VIDEO_STREAM_HIGH:0,REMOTE_VIDEO_STREAM_LOW:1,REMOTE_VIDEO_STREAM_MEDIUM:2}}]).default},258:function(e,t){t.endianness=function(){return"LE"},t.hostname=function(){return"undefined"!=typeof location?location.hostname:""},t.loadavg=function(){return[]},t.uptime=function(){return 0},t.freemem=function(){return Number.MAX_VALUE},t.totalmem=function(){return Number.MAX_VALUE},t.cpus=function(){return[]},t.type=function(){return"Browser"},t.release=function(){return"undefined"!=typeof navigator?navigator.appVersion:""},t.networkInterfaces=t.getNetworkInterfaces=function(){return{}},t.arch=function(){return"javascript"},t.platform=function(){return"browser"},t.tmpdir=t.tmpDir=function(){return"/tmp"},t.EOL="\n",t.homedir=function(){return"/"}},259:function(e,t,n){"use strict";t.__esModule=!0,t.WinZego=void 0;var i=n(32);t.WinZego=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="window zego",i.loggerColor="darkblue",i.isSupportBeauty=i._getSupportBeaty_(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init=function(){e.prototype.init.call(this)},t}(i.WinAgora)},260:function(e,t,n){"use strict";t.__esModule=!0,t.WinTencentOne=void 0;var i=n(32),o=n(21),r=n(36);t.WinTencentOne=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n)),o=n.tencentSign;return i.rtcName="window tencent1",i.loggerColor="lightpink",i.isSupportBeauty=!1,i.tencentSign=o,i._onTencentRoomCreate_=i._onTencentRoomCreate_.bind(i),i._onTencentJoinRoomSucc_=i._onTencentJoinRoomSucc_.bind(i),i.tencentRoomCreate=i.tencentRoomCreate.bind(i),i.pushTencentStream=i.pushTencentStream.bind(i),i.createRoom=i.createRoom.bind(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._onTencentRoomCreate_=function(e){this.rtcCb({name:"tencent room create",data:e})},t.prototype._onTencentJoinRoomSucc_=function(e){this.rtcCb({name:"tencent join room succ",data:{}})},t.prototype.createRoom=function(e){(0,r.windowNativeMethod)("OnTencentRoomNum",[""+e])},t.prototype.tencentRoomCreate=function(e){(0,r.windowNativeMethod)("OnTencentRoomCreate",[e.roomId])},t.prototype.pushTencentStream=function(){(0,r.windowNativeMethod)("pushTencentStream",[])},t.prototype.init=function(){e.prototype.init.call(this),(0,r.nativeOff)("tencent room create",this._onTencentRoomCreate_),(0,r.nativeOn)("tencent room create",this._onTencentRoomCreate_),(0,r.nativeOff)("tencent join room succ",this._onTencentJoinRoomSucc_),(0,r.nativeOn)("tencent join room succ",this._onTencentJoinRoomSucc_),this._isFirstLocalFrameInited_=!0},t.prototype.joinRoom=function(){var e=(0,o.getRoleType)(this.role,this.isWatcher),t=(0,o.getChanelType)(this.channel),n=this.roomId,i=this.uid,a=this.lessonId,s={roleType:e,classType:0,channelType:t,roomId:n,userId:i,duration:this.duration,isFace:0,mobile:this.mobile,lessonId:a,tencentSign:this.tencentSign,bu:""};(0,r.windowNativeMethod)("EnterRoom",[JSON.stringify(s)]),(0,r.windowNativeMethod)("moveVideoWin",[0,0,0,0,i]),this.rtcCb({name:"onFirstLocalVideoFrame",data:{code:this._code_enum_.MESSAGE_CODE_STREAM}})},t}(i.WinAgora)},261:function(e,t,n){"use strict";t.__esModule=!0,t.MacTencentOne=void 0;var i=n(113),o=n(21),r=n(20),a=n(36);t.MacTencentOne=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n)),o=n.tencentSign;return i.rtcName="mac tencent1",i.loggerColor="cornflowerblue",i.tencentSign=o,i._onTencentRoomCreate_=i._onTencentRoomCreate_.bind(i),i._onTencentJoinRoomSucc_=i._onTencentJoinRoomSucc_.bind(i),i.tencentRoomCreate=i.tencentRoomCreate.bind(i),i.pushTencentStream=i.pushTencentStream.bind(i),i.createRoom=i.createRoom.bind(i),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init=function(){e.prototype.init.call(this),this._isFirstLocalFrameInited_=!0},t.prototype._onTencentRoomCreate_=function(e){this.rtcCb({name:"tencent room create",data:e})},t.prototype._onTencentJoinRoomSucc_=function(e){this.rtcCb({name:"tencent join room succ",data:{}})},t.prototype.tencentRoomCreate=function(e){(0,a.macNativeMethod)(["joinRoom",e.roomId,"rolename","LiveMaster"])},t.prototype.createRoom=function(e){(0,a.macNativeMethod)(["createRoom",e])},t.prototype.pushTencentStream=function(){(0,a.macNativeMethod)(["startPushStream"])},t.prototype._initModule_=function(){var e=(0,o.getRoleType)(this.role,this.isWatcher);(0,a.macNativeMethod)(["initModule","getNativeWin-classroomwin","appid",r.TENCENT_APP_ID,"apptype",r.TENCENT_APP_TYPE,"roomid",this.roomId,"uid",""+this.uid,"password","","sig",this.tencentSign,"watcherflag",e]),this.rtcCb({name:"onFirstLocalVideoFrame",data:{code:this._code_enum_.MESSAGE_CODE_STREAM}})},t}(i.MacAgora)},262:function(e,t,n){"use strict";t.__esModule=!0,t.WinTencentTwo=void 0;var i=n(32);t.WinTencentTwo=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="window tencent2",i.loggerColor="lightsalmon",i.isSupportBeauty=i._getSupportBeaty_(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init=function(){e.prototype.init.call(this)},t}(i.WinAgora)},263:function(e,t,n){"use strict";t.__esModule=!0,t.WinZmRtc=void 0;var i=n(32);t.WinZmRtc=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="window zmrtc",i.loggerColor="lightcoral",i.isSupportBeauty=i._getSupportBeaty_(),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.rtcCb({name:"onFirstLocalVideoFrame",data:{code:this._code_enum_.MESSAGE_CODE_STREAM}}),this._isFirstLocalFrameInited_=!0},t}(i.WinAgora)},264:function(e,t,n){"use strict";t.__esModule=!0,t.ElectronZego=void 0;n(31),n(21);var i=n(20),o=n(114);t.ElectronZego=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return o.rtcName="electron zego",o.loggerColor="lightpink",o.APP_ID=i.APP_ID,o.appSign="",o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(o.ElectronAgora)},265:function(e,t,n){"use strict";t.__esModule=!0,t.MobileAgora=void 0;var i,o=n(31),r=n(266),a=(i=r)&&i.__esModule?i:{default:i},s=n(20);t.MobileAgora=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="mobile agora",i.loggerColor="darkgreen",i.isSupportBeauty=!1,i._getSupportBeaty_=i._getSupportBeaty_.bind(i),i._initModule_=i._initModule_.bind(i),i._isFirstLocalFrameInited_=!0,i.avsEngine=null,i.ZmAvsSDK=null,i.APP_ID=s.APP_ID,i.appSign="",i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._initModule_=function(){},t.prototype.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1v1";this._client_||(this.rtcCb({name:"inited",data:{code:this._code_enum_.MESSAGE_CODE_INIT}}),this._initModule_(),this.joinRoom(e),this._client_={})},t.prototype.joinRoom=function(e){var t=e,n=e,i=e,o=this.channel,r=this.uid,s=this.role,c={lesson_uid:this.roomId,room_id:this.roomId,channel_name:o,lesson_info:"regular",class_type:t,bu_type:n,bu_class_type:i,user_info:[{uid:"123456789",phone:"123456789",role:"teacher"},{uid:""+r,phone:""+r,role:s}],frame:{x:30,y:20,width:30,height:10}};console.log("data",c),a.default.openAudioVideo(c,(function(e){}))},t.prototype.leaveRoom=function(){},t.prototype.playById=function(e){},t.prototype.disableVideo=function(e){e.id,e.flag},t.prototype.disableAudio=function(e){e.id,e.flag},t.prototype.setFaceValue=function(e){},t.prototype._getSupportBeaty_=function(){return!1},t}(o.RtcKit)},266:function(e,t,n){(function(t){e.exports=function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{};function n(e,t){return e(t={exports:{}},t.exports),t.exports}var i,o,r,a,s=function(e){return e&&e.Math==Math&&e},c=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof e&&e)||Function("return this")(),d=function(e){try{return!!e()}catch(e){return!0}},u=!d((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})),l={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,f={f:p&&!l.call({1:2},1)?function(e){var t=p(this,e);return!!t&&t.enumerable}:l},m=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},g={}.toString,v=function(e){return g.call(e).slice(8,-1)},h="".split,y=d((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==v(e)?h.call(e,""):Object(e)}:Object,S=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},b=function(e){return y(S(e))},I=function(e){return"object"==typeof e?null!==e:"function"==typeof e},_=function(e,t){if(!I(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!I(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!I(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!I(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")},E={}.hasOwnProperty,C=function(e,t){return E.call(e,t)},T=c.document,w=I(T)&&I(T.createElement),R=!u&&!d((function(){return 7!=Object.defineProperty(w?T.createElement("div"):{},"a",{get:function(){return 7}}).a})),A=Object.getOwnPropertyDescriptor,O={f:u?A:function(e,t){if(e=b(e),t=_(t,!0),R)try{return A(e,t)}catch(e){}if(C(e,t))return m(!f.f.call(e,t),e[t])}},k=function(e){if(!I(e))throw TypeError(String(e)+" is not an object");return e},D=Object.defineProperty,N={f:u?D:function(e,t,n){if(k(e),t=_(t,!0),k(n),R)try{return D(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},x=u?function(e,t,n){return N.f(e,t,m(1,n))}:function(e,t,n){return e[t]=n,e},M=function(e,t){try{x(c,e,t)}catch(n){c[e]=t}return t},P=c["__core-js_shared__"]||M("__core-js_shared__",{}),L=n((function(e){(e.exports=function(e,t){return P[e]||(P[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.4.1",mode:"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})})),V=L("native-function-to-string",Function.toString),j=c.WeakMap,F="function"==typeof j&&/native code/.test(V.call(j)),B=0,U=Math.random(),W=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++B+U).toString(36)},G=L("keys"),H={},z=c.WeakMap;if(F){var q=new z,J=q.get,K=q.has,Y=q.set;i=function(e,t){return Y.call(q,e,t),t},o=function(e){return J.call(q,e)||{}},r=function(e){return K.call(q,e)}}else{var X=G[a="state"]||(G[a]=W(a));H[X]=!0,i=function(e,t){return x(e,X,t),t},o=function(e){return C(e,X)?e[X]:{}},r=function(e){return C(e,X)}}var Q={set:i,get:o,has:r,enforce:function(e){return r(e)?o(e):i(e,{})},getterFor:function(e){return function(t){var n;if(!I(t)||(n=o(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},$=n((function(e){var t=Q.get,n=Q.enforce,i=String(V).split("toString");L("inspectSource",(function(e){return V.call(e)})),(e.exports=function(e,t,o,r){var a=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,d=!!r&&!!r.noTargetGet;"function"==typeof o&&("string"!=typeof t||C(o,"name")||x(o,"name",t),n(o).source=i.join("string"==typeof t?t:"")),e!==c?(a?!d&&e[t]&&(s=!0):delete e[t],s?e[t]=o:x(e,t,o)):s?e[t]=o:M(t,o)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||V.call(this)}))})),Z=c,ee=function(e){return"function"==typeof e?e:void 0},te=function(e,t){return arguments.length<2?ee(Z[e])||ee(c[e]):Z[e]&&Z[e][t]||c[e]&&c[e][t]},ne=Math.ceil,ie=Math.floor,oe=function(e){return isNaN(e=+e)?0:(e>0?ie:ne)(e)},re=Math.min,ae=function(e){return e>0?re(oe(e),9007199254740991):0},se=Math.max,ce=Math.min,de=function(e){return function(t,n,i){var o,r=b(t),a=ae(r.length),s=function(e,t){var n=oe(e);return n<0?se(n+t,0):ce(n,t)}(i,a);if(e&&n!=n){for(;a>s;)if((o=r[s++])!=o)return!0}else for(;a>s;s++)if((e||s in r)&&r[s]===n)return e||s||0;return!e&&-1}},ue=(de(!0),de(!1)),le=function(e,t){var n,i=b(e),o=0,r=[];for(n in i)!C(H,n)&&C(i,n)&&r.push(n);for(;t.length>o;)C(i,n=t[o++])&&(~ue(r,n)||r.push(n));return r},pe=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],fe=pe.concat("length","prototype"),me={f:Object.getOwnPropertyNames||function(e){return le(e,fe)}},ge={f:Object.getOwnPropertySymbols},ve=te("Reflect","ownKeys")||function(e){var t=me.f(k(e)),n=ge.f;return n?t.concat(n(e)):t},he=function(e,t){for(var n=ve(t),i=N.f,o=O.f,r=0;r<n.length;r++){var a=n[r];C(e,a)||i(e,a,o(t,a))}},ye=/#|\.prototype\./,Se=function(e,t){var n=Ie[be(e)];return n==Ee||n!=_e&&("function"==typeof t?d(t):!!t)},be=Se.normalize=function(e){return String(e).replace(ye,".").toLowerCase()},Ie=Se.data={},_e=Se.NATIVE="N",Ee=Se.POLYFILL="P",Ce=Se,Te=O.f,we=function(e,t){var n,i,o,r,a,s=e.target,d=e.global,u=e.stat;if(n=d?c:u?c[s]||M(s,{}):(c[s]||{}).prototype)for(i in t){if(r=t[i],o=e.noTargetGet?(a=Te(n,i))&&a.value:n[i],!Ce(d?i:s+(u?".":"#")+i,e.forced)&&void 0!==o){if(typeof r==typeof o)continue;he(r,o)}(e.sham||o&&o.sham)&&x(r,"sham",!0),$(n,i,r,e)}},Re=Object.keys||function(e){return le(e,pe)},Ae=function(e){return Object(S(e))},Oe=Object.assign,ke=!Oe||d((function(){var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=Oe({},e)[n]||"abcdefghijklmnopqrst"!=Re(Oe({},t)).join("")}))?function(e,t){for(var n=Ae(e),i=arguments.length,o=1,r=ge.f,a=f.f;i>o;)for(var s,c=y(arguments[o++]),d=r?Re(c).concat(r(c)):Re(c),l=d.length,p=0;l>p;)s=d[p++],u&&!a.call(c,s)||(n[s]=c[s]);return n}:Oe;we({target:"Object",stat:!0,forced:Object.assign!==ke},{assign:ke});var De=!!Object.getOwnPropertySymbols&&!d((function(){return!String(Symbol())})),Ne=c.Symbol,xe=L("wks"),Me=function(e){return xe[e]||(xe[e]=De&&Ne[e]||(De?Ne:W)("Symbol."+e))},Pe=Me("toStringTag"),Le="Arguments"==v(function(){return arguments}()),Ve={};Ve[Me("toStringTag")]="z";var je="[object z]"!==String(Ve)?function(){return"[object "+(void 0===this?"Undefined":null===this?"Null":"string"==typeof(t=function(e,t){try{return e[t]}catch(e){}}(e=Object(this),Pe))?t:Le?v(e):"Object"==(n=v(e))&&"function"==typeof e.callee?"Arguments":n)+"]";var e,t,n}:Ve.toString,Fe=Object.prototype;je!==Fe.toString&&$(Fe,"toString",je,{unsafe:!0});var Be=function(){var e=k(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Ue=RegExp.prototype,We=Ue.toString,Ge=d((function(){return"/a/b"!=We.call({source:"a",flags:"b"})})),He="toString"!=We.name;(Ge||He)&&$(RegExp.prototype,"toString",(function(){var e=k(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in Ue)?Be.call(e):n)}),{unsafe:!0});var ze,qe,Je="当前不在掌门APP内",Ke="当前Bridge不支持此方法",Ye=Array.isArray||function(e){return"Array"==v(e)},Xe=function(e,t,n){var i=_(t);i in e?N.f(e,i,m(0,n)):e[i]=n},Qe=Me("species"),$e=function(e,t){var n;return Ye(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Ye(n.prototype)?I(n)&&null===(n=n[Qe])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},Ze=te("navigator","userAgent")||"",et=c.process,tt=et&&et.versions,nt=tt&&tt.v8;nt?qe=(ze=nt.split("."))[0]+ze[1]:Ze&&(!(ze=Ze.match(/Edge\/(\d+)/))||ze[1]>=74)&&(ze=Ze.match(/Chrome\/(\d+)/))&&(qe=ze[1]);var it=qe&&+qe,ot=Me("species"),rt=Me("isConcatSpreadable"),at=it>=51||!d((function(){var e=[];return e[rt]=!1,e.concat()[0]!==e})),st=it>=51||!d((function(){var e=[];return(e.constructor={})[ot]=function(){return{foo:1}},1!==e.concat(Boolean).foo})),ct=function(e){if(!I(e))return!1;var t=e[rt];return void 0!==t?!!t:Ye(e)};we({target:"Array",proto:!0,forced:!at||!st},{concat:function(e){var t,n,i,o,r,a=Ae(this),s=$e(a,0),c=0;for(t=-1,i=arguments.length;t<i;t++)if(r=-1===t?a:arguments[t],ct(r)){if(c+(o=ae(r.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,c++)n in r&&Xe(s,c,r[n])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");Xe(s,c++,r)}return s.length=c,s}});var dt,ut,lt=RegExp.prototype.exec,pt=String.prototype.replace,ft=lt,mt=(dt=/a/,ut=/b*/g,lt.call(dt,"a"),lt.call(ut,"a"),0!==dt.lastIndex||0!==ut.lastIndex),gt=void 0!==/()??/.exec("")[1];(mt||gt)&&(ft=function(e){var t,n,i,o,r=this;return gt&&(n=new RegExp("^"+r.source+"$(?!\\s)",Be.call(r))),mt&&(t=r.lastIndex),i=lt.call(r,e),mt&&i&&(r.lastIndex=r.global?i.index+i[0].length:t),gt&&i&&i.length>1&&pt.call(i[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i});var vt=ft,ht=Me("species"),yt=!d((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),St=!d((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),bt=function(e,t,n,i){var o=Me(e),r=!d((function(){var t={};return t[o]=function(){return 7},7!=""[e](t)})),a=r&&!d((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[ht]=function(){return n},n.flags="",n[o]=/./[o]),n.exec=function(){return t=!0,null},n[o](""),!t}));if(!r||!a||"replace"===e&&!yt||"split"===e&&!St){var s=/./[o],c=n(o,""[e],(function(e,t,n,i,o){return t.exec===vt?r&&!o?{done:!0,value:s.call(t,n,i)}:{done:!0,value:e.call(n,t,i)}:{done:!1}})),u=c[0],l=c[1];$(String.prototype,e,u),$(RegExp.prototype,o,2==t?function(e,t){return l.call(e,this,t)}:function(e){return l.call(e,this)}),i&&x(RegExp.prototype[o],"sham",!0)}},It=function(e){return function(t,n){var i,o,r=String(S(t)),a=oe(n),s=r.length;return a<0||a>=s?e?"":void 0:(i=r.charCodeAt(a))<55296||i>56319||a+1===s||(o=r.charCodeAt(a+1))<56320||o>57343?e?r.charAt(a):i:e?r.slice(a,a+2):o-56320+(i-55296<<10)+65536}},_t=(It(!1),It(!0)),Et=function(e,t,n){return t+(n?_t(e,t).length:1)},Ct=function(e,t){var n=e.exec;if("function"==typeof n){var i=n.call(e,t);if("object"!=typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==v(e))throw TypeError("RegExp#exec called on incompatible receiver");return vt.call(e,t)},Tt=Math.max,wt=Math.min,Rt=Math.floor,At=/\$([$&'`]|\d\d?|<[^>]*>)/g,Ot=/\$([$&'`]|\d\d?)/g;bt("replace",2,(function(e,t,n){return[function(n,i){var o=S(this),r=null==n?void 0:n[e];return void 0!==r?r.call(n,o,i):t.call(String(o),n,i)},function(e,o){var r=n(t,e,this,o);if(r.done)return r.value;var a=k(e),s=String(this),c="function"==typeof o;c||(o=String(o));var d=a.global;if(d){var u=a.unicode;a.lastIndex=0}for(var l=[];;){var p=Ct(a,s);if(null===p)break;if(l.push(p),!d)break;""===String(p[0])&&(a.lastIndex=Et(s,ae(a.lastIndex),u))}for(var f,m="",g=0,v=0;v<l.length;v++){p=l[v];for(var h=String(p[0]),y=Tt(wt(oe(p.index),s.length),0),S=[],b=1;b<p.length;b++)S.push(void 0===(f=p[b])?f:String(f));var I=p.groups;if(c){var _=[h].concat(S,y,s);void 0!==I&&_.push(I);var E=String(o.apply(void 0,_))}else E=i(h,s,y,S,I,o);y>=g&&(m+=s.slice(g,y)+E,g=y+h.length)}return m+s.slice(g)}];function i(e,n,i,o,r,a){var s=i+e.length,c=o.length,d=Ot;return void 0!==r&&(r=Ae(r),d=At),t.call(a,d,(function(t,a){var d;switch(a.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,i);case"'":return n.slice(s);case"<":d=r[a.slice(1,-1)];break;default:var u=+a;if(0===u)return t;if(u>c){var l=Rt(u/10);return 0===l?t:l<=c?void 0===o[l-1]?a.charAt(1):o[l-1]+a.charAt(1):t}d=o[u-1]}return void 0===d?"":d}))}}));var kt={viewAppear:{ios:"5.6",android:"5.7"},viewDisappear:{ios:"5.6",android:"5.7"},pageCanShareCallJs:{},sharePageCallJs:{},audioVideoCBCallJS:{}},Dt="zm-bridge:  ";function Nt(e){console&&console.error&&console.error(Dt,e)}function xt(e,t){return!!kt[e]||!!t||(Nt("".concat(Ke,"，").concat(e)),!1)}function Mt(e){return!!e&&"Object"===function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t?"Array":"[object Object]"==t?"Object":""}(e)}function Pt(){var e={};if(window&&window.navigator){var t=navigator.userAgent;for(var n in e={isAndroid:t.indexOf("Android")>-1||t.indexOf("Adr")>-1,isIPhone:t.indexOf("iPhone")>-1,isIPad:t.indexOf("iPad")>-1,isWeixin:t.indexOf("MicroMessenger")>-1,isQQ:" qq"==t.match(/\sQQ/i)})e[n]||delete e[n]}return e}bt("match",1,(function(e,t,n){return[function(t){var n=S(this),i=null==t?void 0:t[e];return void 0!==i?i.call(t,n):new RegExp(t)[e](String(n))},function(e){var i=n(t,e,this);if(i.done)return i.value;var o=k(e),r=String(this);if(!o.global)return Ct(o,r);var a=o.unicode;o.lastIndex=0;for(var s,c=[],d=0;null!==(s=Ct(o,r));){var u=String(s[0]);c[d]=u,""===u&&(o.lastIndex=Et(r,ae(o.lastIndex),a)),d++}return 0===d?null:c}]}));var Lt=[].slice,Vt=function(e){return function(t,n){var i=arguments.length>2,o=i?Lt.call(arguments,2):void 0;return e(i?function(){("function"==typeof t?t:Function(t)).apply(this,o)}:t,n)}};function jt(e){window&&window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",(function(){e(WebViewJavascriptBridge)}),!1)}function Ft(e){if(window.WebViewJavascriptBridge)return e(WebViewJavascriptBridge);if(window.WVJBCallbacks)return window.WVJBCallbacks.push(e);window.WVJBCallbacks=[e];var t=document.createElement("iframe");t.style.display="none",t.src="https://__bridge_loaded__",document.documentElement.appendChild(t),setTimeout((function(){document.documentElement.removeChild(t)}),0)}function Bt(e,t,n){return e?this.isInZmApp()?("function"==typeof t&&(n=t,t=void 0),void function(e,t,n){Pt().isAndroid?jt((function(){window.WebViewJavascriptBridge.callHandler(e,t,(function(e){var t;try{t=JSON.parse(e)}catch(n){t=e}n&&n(t)}))})):(Pt().isIPhone||Pt().isIPad)&&Ft((function(i){i.callHandler(e,t,(function(e){var t;try{t=JSON.parse(e)}catch(n){t=e}n&&n(t)}))}))}(e,t,n)):(Nt(Je),!1):(Nt("方法未传入"),!1)}we({global:!0,bind:!0,forced:/MSIE .\./.test(Ze)},{setTimeout:Vt(c.setTimeout),setInterval:Vt(c.setInterval)});var Ut={getJSBridgeVersion:function(){return"1.0.3"},isInZmApp:function(){return!(!window||!window.navigator)&&/Zmlearn/i.test(navigator.userAgent)},getAppInfo:function(e){Bt.call(this,"getAppInfo",e)},getAppVersion:function(e){Bt.call(this,"getAppVersion",e)},getNetType:function(e){Bt.call(this,"getNetType",e)},getCurrentOS:function(e){Bt.call(this,"getCurrentOS",(function(t){var n={};Mt(t)&&(n=Object.assign(Pt(),t)),e&&e(n)}))},setTitle:function(e){e?Bt.call(this,"setTitle",e):Nt("参数错误")},toast:function(e){e?Bt.call(this,"toast",e):Nt("参数错误")},isSupport:function(e){return e?this.isInZmApp()?xt(e,!!this[e]):(Nt(Je),!1):(Nt("方法未传入"),!1)},pageCanShare:function(e){void 0!==e?"0"!==(e=e.toString()||"0")&&"1"!==e||Bt.call(this,"pageCanShare",e):Nt("参数错误")},sharePage:function(e,t){e&&Mt(e)?Bt.call(this,"sharePage",e,t):Nt("参数错误")},broadcast:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;Pt().isIPhone||Pt().isIPad?(Object.assign(t,{_broadcast_key:e}),Bt.call(this,"broadcast",t,n)):Bt.call(this,"broadcast==".concat(e),t,n)},registerNativeCalledJS:function(e,t){this.isInZmApp()?"undefined"!=typeof window&&kt[e]?(console.log("call =>>>> :",e),function(e,t,n){xt(e,!!Ut[e])&&("function"==typeof t&&(n=t,t=void 0),Pt().isAndroid?jt((function(t){t.registerHandler(e,n)})):Ft((function(t){t.registerHandler(e,n)})))}(e,t)):Nt(Ke):Nt(Je)},createView:function(e,t){e&&Mt(e)?Bt.call(this,"create_view",e,t):Nt("参数错误")},removeView:function(e,t){e&&Mt(e)?Bt.call(this,"remove_view",e,t):Nt("参数错误")},updateView:function(e,t){e&&Mt(e)?Bt.call(this,"update_view",e,t):Nt("参数错误")},getView:function(e,t){e&&Mt(e)?Bt.call(this,"get_view",e,t):Nt("参数错误")},clearAll:function(e){Bt.call(this,"clear_all",e)},addAnimation:function(e,t){e&&Mt(e)?Bt.call(this,"add_animation",e,t):Nt("参数错误")},openAudioVideo:function(e,t){e&&Mt(e)?Bt.call(this,"openAudioVideo",e,t):Nt("参数错误")},closeAudioVideo:function(e,t){e&&Mt(e)?Bt.call(this,"closeAudioVideo",e,t):Nt("参数错误")}};return Ut}()}).call(this,n(22))},31:function(e,t,n){"use strict";t.__esModule=!0,t.RtcKit=void 0;var i=n(20);t.RtcKit=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var n=t.uid,o=t.roomId,r=t.isWatcher,a=t.role,s=t.duration,c=t.channel,d=t.mobile,u=t.lessonId,l=t.isFace,p=t.docroot,f=t.rtcCb,m=void 0===f?function(){}:f;this.uid=n,this.roomId=o,this.isSupportBeauty=!1,this.isWatcher=r,this.role=a,this.duration=s,this.channel=c,this.mobile=d,this.lessonId=u,this.isFace=l,this.rtcName="",this.document=p||window.document,this.rtcCb=m,this.loggerColor="black",this.microphoneId=null,this.cameraId=null,this._client_=null,this._code_enum_={MESSAGE_CODE_INIT:i.MESSAGE_CODE_INIT,MESSAGE_CODE_ROOM:i.MESSAGE_CODE_ROOM,MESSAGE_CODE_STREAM:i.MESSAGE_CODE_STREAM,MESSAGE_CODE_UNKONOWN:i.MESSAGE_CODE_UNKONOWN},this.init=this.init.bind(this)}return e.prototype.init=function(){},e.prototype.joinRoom=function(){},e.prototype.leaveRoom=function(){},e.prototype.playById=function(e){},e.prototype.disableVideo=function(e){e.id,e.flag},e.prototype.disableAudio=function(e){e.id,e.flag},e.prototype.hideVideoById=function(e){},e.prototype.showVideoById=function(e){},e.prototype.setFaceValue=function(e){},e.prototype.logger=function(){for(var e,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];(e=console).log.apply(e,["%c "+this.rtcName+" zmRtcKit："+new Date,"color: "+this.loggerColor].concat(n))},e.prototype.switchDevice=function(e,t){},e}()},32:function(e,t,n){"use strict";t.__esModule=!0,t.WinAgora=void 0;var i=n(31),o=n(36),r=n(21);t.WinAgora=function(e){function t(n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,n));return i.rtcName="window agora",i.loggerColor="blue",i.isSupportBeauty=!0,i._uids_=[],i._timeId_=null,i._focTimeId_=null,i._hiddenUids_=[],i._remoteJoin_=i._remoteJoin_.bind(i),i._moveFunc_=i._moveFunc_.bind(i),i._moveById_=i._moveById_.bind(i),i._getSupportBeaty_=i._getSupportBeaty_.bind(i),i._onFirstLocalVideoFrame_=i._onFirstLocalVideoFrame_.bind(i),i._initModule_=i._initModule_.bind(i),i._callBackEvents_=["RemoteJoin","RemoteLeave","onFirstLocalVideoFrame","UpdateDevice","agora speech analysis","deviceChange","AudioVolumeChange","volumn level","WinDoubleClick","onFirstLocalAudioFrame","CurrentSystemData","mute_remote_video","rtcStatus","ConnectionLost"],i._eventCallBackLogic_=i._eventCallBackLogic_.bind(i),i._isFirstLocalFrameInited_=!1,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype._eventCallBackLogic_=function(e){var t=e.MsgType;switch(t){case"RemoteJoin":this._remoteJoin_(e);break;case"onFirstLocalVideoFrame":this._isFirstLocalFrameInited_=!0,this._onFirstLocalVideoFrame_(e)}this.rtcCb({name:t,data:Object.assign({},e,{code:this._code_enum_.MESSAGE_CODE_STREAM})}),this.logger("_eventCallBackLogic_",e,performance.now())},t.prototype._moveFunc_=function(){var e=this;this._timeId_&&(clearTimeout(this._timeId_),this._timeId_=null),this._timeId_=setTimeout((function(){e._uids_.filter((function(t){return!e._hiddenUids_.includes(t)})).forEach((function(t){e._moveById_(t)}))}),200)},t.prototype._remoteJoin_=function(e){var t=e.uid;this._updateUids_(t),(0,o.windowNativeMethod)("showRemoteVideoWin",[-1e3,-1e3,0,0,t]),this._moveFunc_()},t.prototype._updateUids_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";if(e=""+e,"add"===t)this._uids_.includes(e)||this._uids_.push(e);else if("miu"===t){var n=this._uids_.indexOf(e);this._uids_.splice(n,1)}},t.prototype._updateHidderUids_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add";if(e=""+e,"add"===t)this._hiddenUids_.includes(e)||this._hiddenUids_.push(e);else if("miu"===t&&this._hiddenUids_.includes(e)){var n=this._hiddenUids_.indexOf(e);this._hiddenUids_.splice(n,1)}},t.prototype._onFirstLocalVideoFrame_=function(){this._moveFunc_()},t.prototype._initModule_=function(){var e=(0,o.getCurrentWin)().getNativeWindowHandle();(0,o.windowNativeMethod)("setClassRoomWinHandler",[e])},t.prototype.init=function(){var e=this;if(!this._client_){this._updateUids_(this.uid);var t=(0,o.getCurrentWin)();this._initModule_(),t.removeListener("move",this._moveFunc_),t.on("move",this._moveFunc_);for(var n=this._callBackEvents_.length,i=0;i<n;i++)(0,o.nativeOn)(this._callBackEvents_[i],this._eventCallBackLogic_);this.logger("this is inited"),this.rtcCb({name:"inited",data:{code:this._code_enum_.MESSAGE_CODE_INIT}}),this.joinRoom(),this._client_={},setTimeout((function(){e._isFirstLocalFrameInited_||e.isWatcher||e.rtcCb({name:"error",data:{msg:"本地加载视频第一帧失败",name:"onFirstLocalVideoFrame",code:e._code_enum_.MESSAGE_CODE_STREAM}})}),1e4)}},t.prototype.joinRoom=function(){var e=(0,r.getRoleType)(this.role,this.isWatcher),t=(0,r.getChanelType)(this.channel),n=this.roomId,i=this.uid,a=this.roomId,s=this.isFace,c={roleType:e,classType:0,channelType:t,roomId:n,userId:i,duration:this.duration,isFace:s,mobile:this.mobile,lessonId:a,bu:""};(0,o.windowNativeMethod)("EnterRoom",[JSON.stringify(c)]),(0,o.windowNativeMethod)("moveVideoWin",[0,0,0,0,i])},t.prototype.leaveRoom=function(){(0,o.windowNativeMethod)("LeaveRoom",["LeaveRoom"])},t.prototype.playById=function(e){},t.prototype.disableVideo=function(e){var t=e.id,n=e.flag;(0,o.windowNativeMethod)("MuteVideo",[JSON.stringify({mute:n,uid:t})])},t.prototype.disableAudio=function(e){var t=e.id,n=e.flag;(0,o.windowNativeMethod)("MuteVoice",[JSON.stringify({mute:n,uid:t})])},t.prototype.hideVideoById=function(e){e=""+e,(0,o.windowNativeMethod)("moveVideoWin",[0,0,0,0,e]),this._updateHidderUids_(e,"add")},t.prototype.showVideoById=function(e){this._moveById_(e),this._updateHidderUids_(e,"miu")},t.prototype.setFaceValue=function(e){(0,o.windowNativeMethod)("FaceValue",[JSON.stringify({value:e})])},t.prototype._moveById_=function(e){e=""+e;var t=(0,o.getCurrentWin)(),n=t.getContentBounds(),i=n.x,r=n.y,a=window.devicePixelRatio,s=this.document.getElementById(e);if(s){var c=s.getBoundingClientRect(),d=parseInt((i+c.left)*a),u=parseInt((r+c.top)*a),l=parseInt(c.width*a),p=parseInt(c.height*a);this.logger("window move "+d+","+u+", "+l+", "+p+", "+e),(0,o.windowNativeMethod)("moveVideoWin",[d,u,l,p,e]),this._focTimeId_&&(clearTimeout(this._focTimeId_),this._focTimeId_=null),this._focTimeId_=setTimeout((function(){t.isMinimized()||(0,o.focusCurrentWindow)()}),500)}},t.prototype._getSupportBeaty_=function(){try{var e=(0,o.windowNativeMethodSync)("getFaceInfo",[JSON.stringify({courseType:1})]);return"-1"!==e&&JSON.parse(e).datas.includes(this.channel)}catch(e){return!1}},t}(i.RtcKit)},36:function(e,t,n){"use strict";(function(e,i){t.__esModule=!0,t.getRemote=d,t.getWinManager=u,t.addCustomListener=l,t.windowNativeMethod=p,t.xpNativeMethod=f,t.windowNativeMethodSync=function(e,t){try{var n;return null===a&&(a=m()),(n=a)[e].apply(n,t)}catch(e){return"-1"}},t.getZmlearnPlugin=m,t.hasMethod=function(e){try{if(E())return null===a&&(a=m()),!!a[e];if(_()){var t=window.require("nodobjc"),n=d().app.getAppPath();t.importFramework(n+"/videochatplugin.framework");for(var i=t.AgoraVideo.getInstanceMethods(),o=!1,r=0;r<i.length;r++){if(i[r].split(":")[0]===e){o=!0;break}}return o}return!1}catch(e){return!1}},t.macNativeClassInit=function(t){try{if(S(t))return S(t);var n=d().require("nodobjc");n.import(e+"/videochatplugin.framework");var i=n[t]("alloc")("init");return b(t,i),i}catch(e){return-1}},t.macNativeMethod=g,t.macSendWinHandle=function(e){u().bridge.emit("createwinhandle",{myView:e,name:"classroomwin"})},t.macInitModule=function(e){u().bridge.emit("InitModule",{channelType:e})},t.getClientVersion=h,t.getCurrentWin=y,t.getCurentWinSize=function(){var e=y();return[e.getContentBounds().width,e.getContentBounds().height]},t.focusCurrentWindow=function(){return y().focus()},t.getShareDataByName=S,t.setShareDataByName=b,t.getPlatform=I,t.isMac=_,t.isWin=E,t.isWeb=function(){return"web"===I()},t.isXp=C,t.isXpNative=function(){return C()&&window.nw.App.manifest.version>"2.0.2"},t.createClassRoomWin=function(e){var t=u().get(e.name);t||((t=u().createNew(e.name,"",e.url,!1,{width:e.width,height:e.height,minimizable:e.ismin,maximizable:e.ismax,resizable:e.isresize,backgroundColor:"#2e2c29"})).open(),t.focus());t.open(),t.focus()},t.closeClassRoomWin=function(e){E()?p("LeaveRoom",["LeaveRoom"]):_()&&g(["LeaveRoom"]);window.onbeforeunload=null,u().close(e)},t.generateUUID=function e(){try{e.tail=e.tail||function(e){var t,n,o,r;for(t in e)for(n in e[t])(o=e[t][n]).internal||0===o.address.indexOf("fe80::")&&(r=r||o.address.slice(6).split(/:/).map((function(e,t,n){return parseInt(e,16)})));return r||(n=Math.pow(2,16),(r=[]).push(4096|Math.floor(Math.random()*n)),r.push(Math.floor(Math.random()*n)),r.push(Math.floor(Math.random()*n)),r.push(Math.floor(Math.random()*n))),r[3]=65536|r[3],r[2]=65536|65280&r[1]|255&r[2],r[1]=65536|512^r[0],r[0]=98304|16383&i.pid,(r=r.map((function(e,t,n){return e.toString(16).slice(1)})))[0]+"-"+r[1]+r[2]+r[3]}(n(258).networkInterfaces());var t=i.hrtime(),o=Math.floor(Date.now()/1e3);return t[1]=Math.floor(.268435456*t[1]),t[2]=(69632|4095&t[1]).toString(16).slice(1),t[1]=(65536|t[1]>>>12&65535).toString(16).slice(1),t[0]=(4294967296+o).toString(16).slice(1),t.concat(e.tail).join("-")}catch(e){return""}},t.nativeEmit=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2],i=arguments[3];if(!e)return void alert("方法名不能为空");var a={funcName:e,params:t,className:i};if(n){var s=o+=1;a.cbStr=s,T(),r[s]=n,v(a)}else v(a)},t.nativeOn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e+":"+(o+=1);T(),r[n]=t},t.nativeOff=function(e,t){for(var n=Object.keys(r),i=n.length,o=0;o<i;o++)0!==n[o].indexOf(e+":")||r[n[o]]!==t&&t||delete r[n[o]]},t.formatNativeViewPoi=function(e){var t=e.x,n=e.y,i=e.w,o=e.h;if(E()){var r=y().getContentBounds(),a=window.devicePixelRatio,s=parseInt((t+r.x)*a),c=parseInt((n+r.y)*a),d=parseInt(i*a),u=parseInt(o*a);return{x:s,y:c,w:d,h:u}}if(_()){var l=y().getContentBounds(),p=parseInt(t),f=parseInt(i),m=parseInt(o),g=parseInt(l.height-m-n);return{x:p,y:g,w:f,h:m}}return e};var o=0,r={},a=null,s={},c=!1;function d(){return window.require("electron").remote}function u(){return d().require("electron-window-manager")}function l(e,t){s[e]?s[e].push(t):(s[e]=[t],u().bridge.on(e,(function(){for(var t,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];var r=s[e].length;(t=console).log.apply(t,["addCustomListener name",e,s[e],r].concat(i));for(var a=0;a<r;a++){var c;(c=s[e])[a].apply(c,i)}})))}function p(e,t){try{C()?f(e,t):u().bridge.emit("nativemethodexec",{funcname:e,params:t})}catch(e){return"-1"}}function f(e,t){var n;null===a&&(a=window.require("./zmlearn")),(n=a)[e].apply(n,t)}function m(){if(h()>="2.4.21"){var e=window.require("path");return d().require(e.join(d().app.getAppPath(),"../../zmlearn"))}return d().require("./zmlearn")}function g(e){try{u().bridge.emit("nativemethodexec",{params:e})}catch(e){return"-1"}}function v(e){try{u().bridge.emit("nativemethodexec",e)}catch(e){return"-1"}}function h(){try{return window.nw&&window.nw.App?"xp"+window.nw.App.manifest.version:d().app.getVersion()}catch(e){return"0.0.0"}}function y(){return d().getCurrentWindow()}function S(e){return u().sharedData.fetch(e)}function b(e,t){u().sharedData.set(e,t)}function I(){return window.process?window.process.platform:"web"}function _(){return"darwin"===I()}function E(){return"win32"===I()}function C(){return window.nw&&window.nw.App}function T(){c||(c=!0,l("nativeCallBack",(function(e){if(e.cbStr){if(r[e.cbStr]){try{r[e.cbStr](e)}catch(e){console.log("call back error")}delete r[e.cbStr]}}else for(var t=Object.keys(r),n=t.length,i=0;i<n;i++)0===t[i].indexOf(e.MsgType+":")&&r[t[i]](e)})))}}).call(this,"/",n(40))}}]);